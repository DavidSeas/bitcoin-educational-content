---
name: Confidențialitatea pe Bitcoin
goal: Înțelege și stăpânește principiile protecției confidențialității atunci când folosești Bitcoin
objectives:
  - Definește noțiunile teoretice necesare pentru înțelegerea mizelor protecției confidențialității
  - Știe cum să identifici și să atenuezi riscurile asociate cu pierderea confidențialității utilizatorilor pe Bitcoin
  - Utilizează metode și unelte pentru a-ți proteja confidențialitatea pe Bitcoin
  - Înțelege metodele de analiză a lanțului și dezvoltă strategii de apărare
---
# Protejează-ți Confidențialitatea pe Bitcoin

Într-o lume în care confidențialitatea tranzacțiilor financiare devine treptat un lux, înțelegerea și stăpânirea principiilor protecției confidențialității în utilizarea ta de Bitcoin este esențială. Acest training îți oferă toate cheile, atât teoretice cât și practice, pentru a realiza acest lucru autonom.

Astăzi, pe Bitcoin, există companii specializate în analiza lanțului. Afacerea lor principală este precis să se infiltreze în sfera ta privată, pentru a compromite confidențialitatea tranzacțiilor tale. De fapt, "dreptul la confidențialitate" pe Bitcoin nu există. Prin urmare, este responsabilitatea ta, ca utilizator, să îți afirmi drepturile naturale și să protejezi confidențialitatea tranzacțiilor tale, pentru că nimeni altcineva nu o va face pentru tine.

Acest training este prezentat ca o călătorie completă și generalistă. Fiecare noțiune tehnică este detaliată și susținută de diagrame explicative. Scopul este de a face cunoștințele accesibile tuturor. BTC204 este deci abordabil pentru utilizatorii începători și intermediari. Acest training oferă de asemenea valoare adăugată celor mai experimentați bitcoineri, deoarece explorăm unele concepte tehnice care sunt adesea necunoscute.

Alătură-te nouă pentru a-ți transforma utilizarea Bitcoin și a deveni un utilizator informat, capabil să înțeleagă problemele legate de confidențialitate și să-ți protejezi confidențialitatea.

+++

# Introducere
<partId>e17474a8-8899-4bdb-a7f8-bc52ddb01440</partId>

## Introducere în Training
<chapterId>08ba1933-f393-4fb5-8279-777d874caedb</chapterId>

Într-o lume în care confidențialitatea tranzacțiilor financiare devine treptat un lux, înțelegerea și stăpânirea principiilor protecției confidențialității în utilizarea ta de Bitcoin este esențială. Acest training îți oferă toate cheile, atât teoretice cât și practice, pentru a realiza acest lucru autonom.
Astăzi, în ecosistemul Bitcoin, există companii care se specializează în analiza lanțului. Afacerea lor principală este precis să se infiltreze în sfera ta privată, compromițând confidențialitatea tranzacțiilor tale. În realitate, "dreptul la confidențialitate" pe Bitcoin nu există. Prin urmare, este responsabilitatea ta, ca utilizator, să îți afirmi drepturile naturale și să protejezi confidențialitatea tranzacțiilor tale, pentru că nimeni altcineva nu o va face pentru tine.

Bitcoin nu este doar acolo pentru "Numărul Crește" și pentru conservarea valorii economiilor. Datorită caracteristicilor sale unice și istoriei sale, este în primul rând instrumentul contra-economiei. Mulțumită acestei invenții remarcabile, poți să îți gestionezi liber banii, să îi cheltui și să îi acumulezi, fără ca nimeni să te poată împiedica.

Bitcoin oferă o evadare pașnică de sub jugul statelor, permițându-ți să te bucuri pe deplin de drepturile tale naturale, care nu pot fi contestate de legile stabilite. Mulțumită invenției lui Satoshi Nakamoto, ai puterea de a impune respect pentru proprietatea ta privată și de a recâștiga libertatea de a contracta.

Cu toate acestea, Bitcoin nu este anonim în mod implicit, ceea ce poate reprezenta un risc pentru persoanele angajate în contra-economie, în special în regiunile sub regimuri despote. Dar acesta nu este singurul pericol. Având în vedere că bitcoin este un activ valoros și necenzurabil, acesta poate atrage atenția hoților. Astfel, protejarea confidențialității tale devine și o chestiune de securitate: te poate ajuta să previi atacurile cibernetice și agresiunile fizice.
Pe măsură ce vom vedea, deși protocolul oferă anumite protecții intrinseci ale confidențialității, este crucial să utilizăm instrumente suplimentare pentru a optimiza și apăra această confidențialitate.
Acest curs este conceput ca un curs cuprinzător și generalist pentru a înțelege mizele confidențialității pe Bitcoin. Fiecare noțiune tehnică este discutată în detaliu și susținută de diagrame explicative. Scopul este de a face cunoștințele accesibile tuturor, chiar și utilizatorilor începători și intermediari. Pentru bitcoinerii mai experimentați, acoperim de asemenea concepte foarte tehnice și uneori mai puțin cunoscute pe parcursul acestui curs pentru a aprofunda înțelegerea fiecărui subiect.

Scopul acestui curs nu este de a vă face complet anonimi în utilizarea Bitcoin, ci mai degrabă de a vă oferi instrumentele esențiale pentru a ști cum să vă protejați confidențialitatea conform obiectivelor personale. Veți avea libertatea de a alege din conceptele și instrumentele prezentate pentru a dezvolta propriile strategii, adaptate obiectivelor și nevoilor specifice.

### Secțiunea 1: Definiții și Concepte Cheie
Pentru început, vom revizui împreună principiile fundamentale care guvernează funcționarea Bitcoin, pentru a putea apoi aborda liniștiți noțiunile legate de confidențialitate. Este esențial să stăpâniți câteva concepte de bază, cum ar fi UTXO-urile, adresele de primire sau scripturile, înainte de a putea înțelege pe deplin conceptele pe care le vom aborda în secțiunile următoare. Vom introduce de asemenea modelul general al confidențialității Bitcoin, așa cum a fost conceput de Satoshi Nakamoto, ceea ce ne va permite să înțelegem mizele și riscurile asociate.
![BTC204](assets/en/11/1.webp)

### Secțiunea 2: Înțelegerea Analizei Lanțului și Cum să te Protejezi Împotriva Ei

În a doua secțiune, studiem tehnicile utilizate de companiile de analiză a lanțului pentru a urmări activitatea dvs. pe Bitcoin. Înțelegerea acestor metode este crucială pentru îmbunătățirea protecției confidențialității dvs. Această parte are ca scop examinarea strategiilor atacatorilor pentru a înțelege mai bine riscurile și a pune bazele tehnicilor pe care le vom studia în secțiunile următoare. Vom analiza modelele de tranzacții, euristicile interne și externe, precum și interpretările plauzibile ale acestor modele. Pe lângă o componentă teoretică, vom învăța să folosim un explorator de blocuri pentru a efectua analiza lanțului, prin exemple practice și exerciții.

![BTC204](assets/notext/11/2.webp)

### Secțiunea 3: Stăpânirea Celor Mai Bune Practici pentru Protejarea Confidențialității Tale

În a treia secțiune a cursului nostru, ajungem la esență: practica! Scopul este de a stăpâni toate cele mai bune practici esențiale care ar trebui să devină reflexe naturale pentru orice utilizator Bitcoin. Vom acoperi utilizarea adreselor proaspete, etichetarea, consolidarea, utilizarea nodurilor complete, precum și KYC și metodele de achiziție. Scopul este de a vă oferi o imagine de ansamblu cuprinzătoare a capcanelor de evitat pentru a stabili fundații solide în căutarea noastră de protecție a confidențialității. Pentru unele dintre aceste practici, veți fi îndrumați către un tutorial specific pentru a le implementa.

![BTC204](assets/en/11/3.webp)

### Secțiunea 4: Înțelegerea Tranzacțiilor Coinjoin

Cum putem vorbi despre confidențialitate pe Bitcoin fără a discuta despre coinjoins? În secțiunea 4, veți descoperi tot ce trebuie să știți despre această metodă de amestecare. Veți învăța ce este un coinjoin, istoria și obiectivele sale, precum și diferitele tipuri de coinjoins care există. În final, pentru utilizatorii mai experimentați, vom descoperi ce sunt anonseturile și entropia, și cum să calculăm acești indicatori.

![BTC204](assets/en/11/4.webp)

### Secțiunea 5: Înțelegerea Mizelor Altor Tehnici Avansate de Confidențialitate
În a cincea secțiune, vom oferi o prezentare generală a tuturor celorlalte tehnici existente pentru a proteja confidențialitatea pe Bitcoin, în afara de coinjoin. De-a lungul anilor, dezvoltatorii au demonstrat o creativitate remarcabilă în proiectarea uneltelor dedicate confidențialității. Vom examina toate aceste metode, cum ar fi payjoin, tranzacțiile colaborative, Coin Swap și Atomic Swap, detaliind modul lor de operare, obiectivele și potențialele slăbiciuni.
De asemenea, vom aborda confidențialitatea la nivelul rețelei de noduri și diseminarea tranzacțiilor. Vom discuta și despre diferitele protocoale care au fost propuse de-a lungul anilor pentru a îmbunătăți confidențialitatea utilizatorilor pe Bitcoin, inclusiv protocoalele de adrese statice.

![BTC204](assets/notext/11/5.webp)

# Definiții și Concepte Cheie

## Modelul UTXO Bitcoin

Bitcoin este în primul rând o monedă, dar știi concret cum sunt reprezentate BTC-urile în protocol?

### Ce sunt UTXO-urile Bitcoin?

În protocolul Bitcoin, gestionarea unităților monetare se învârte în jurul modelului UTXO, un acronim pentru "_Unspent Transaction Output_".

Acest model este profund diferit de sistemele bancare tradiționale, care se bazează pe un mecanism de cont și balanță pentru a urmări fluxurile financiare. Într-adevăr, în sistemul bancar, soldurile individuale sunt menținute în conturi atașate unei identități. De exemplu, când cumperi o baghetă de la brutar, banca ta pur și simplu debitează suma achiziției din contul tău, reducându-ți astfel soldul, în timp ce contul brutarului este creditat cu aceeași sumă, crescându-i soldul. În acest sistem, nu există noțiunea de legătură între banii care intră în contul tău și banii care ies din el, în afară de înregistrările tranzacțiilor.

![BTC204](assets/en/21/1.webp)
Pe Bitcoin, lucrurile funcționează diferit. Conceptul de cont nu există, iar unitățile monetare nu sunt gestionate prin solduri, ci prin intermediul UTXO-urilor. Un UTXO reprezintă o anumită sumă de bitcoini care nu a fost încă cheltuită, formând astfel o "bucată de bitcoin", care poate fi mare sau mică. De exemplu, un UTXO ar putea valora `500 BTC` sau doar `700 SATS`.
**> Reminder:** Satoshi, adesea abreviat ca sat, este cea mai mică unitate de Bitcoin, comparabilă cu un cent în monedele fiat.

```plaintext
1 BTC = 100,000,000 SATS
```

Teoretic, un UTXO poate reprezenta orice valoare în bitcoini, variind de la un sat până la maximul teoretic de aproximativ 21 de milioane de BTC. Cu toate acestea, este logic imposibil să deții toți cei 21 de milioane de bitcoini, și există un prag economic inferior numit "dust", sub care un UTXO este considerat economic neviabil de cheltuit.

**> Știai?** Cel mai mare UTXO creat vreodată pe Bitcoin a fost evaluat la `500,000 BTC`. A fost creat de platforma MtGox în timpul unei operațiuni de consolidare în noiembrie 2011: [29a3efd3ef04f9153d47a990bd7b048a4b2d213daaa5fb8ed670fb85f13bdbcf](https://mempool.space/fr/tx/29a3efd3ef04f9153d47a990bd7b048a4b2d213daaa5fb8ed670fb85f13bdbcf)

### UTXO-uri și Condițiile de Cheltuire
UTXO-urile sunt instrumentele de schimb pe Bitcoin. Fiecare tranzacție rezultă în consumarea UTXO-urilor ca intrări și crearea de noi UTXO-uri ca ieșiri. Când se efectuează o tranzacție, UTXO-urile utilizate ca intrări sunt considerate "cheltuite", iar noi UTXO-uri sunt generate și alocate destinatarilor indicați în ieșirile tranzacției. Astfel, un UTXO reprezintă pur și simplu o ieșire de tranzacție necheltuită și, prin urmare, o sumă de bitcoini aparținând unui utilizator la un moment dat.
![BTC204](assets/en/21/2.webp)
Toate UTXO-urile sunt securizate de scripturi care definesc condițiile sub care pot fi cheltuite. Pentru a consuma un UTXO, un utilizator trebuie să demonstreze rețelei că îndeplinește condițiile stipulate de scriptul care securizează acel UTXO. În general, UTXO-urile sunt protejate de o cheie publică (sau o adresă de primire care reprezintă această cheie publică). Pentru a cheltui un UTXO asociat cu această cheie publică, utilizatorul trebuie să dovedească că deține cheia privată corespunzătoare, furnizând o semnătură digitală realizată cu această cheie. De aceea se spune că portofelul tău Bitcoin nu conține de fapt bitcoini, ci mai degrabă stochează cheile tale private, care la rândul lor îți oferă acces la UTXO-urile tale și, prin extensie, la bitcoinii pe care îi reprezintă.
![BTC204](assets/en/21/3.webp)

Având în vedere că conceptul de cont este absent în Bitcoin, soldul unui portofel corespunde pur și simplu sumei valorilor tuturor UTXO-urilor pe care le poate cheltui. De exemplu, dacă portofelul tău Bitcoin poate cheltui următoarele 4 UTXO-uri:

```plaintext
- 2 BTC
- 8 BTC
- 5 BTC
- 2 BTC
```

Soldul total al portofelului tău ar fi `17 BTC`.

![BTC204](assets/en/21/4.webp)

## Structura tranzacțiilor Bitcoin
<chapterId>29d3aaab-de2e-4746-ab40-c9748898850c</chapterId>

### Intrările și ieșirile unei tranzacții

O tranzacție Bitcoin este o operațiune înregistrată pe blockchain care permite transferul de proprietate al bitcoinilor de la o persoană la alta. Mai specific, deoarece suntem într-un model UTXO și nu există conturi, tranzacția satisface condițiile de cheltuire care au securizat unul sau mai multe UTXO-uri, le consumă și creează echivalent noi UTXO-uri dotate cu noi condiții de cheltuire. Pe scurt, o tranzacție mută bitcoinii de la un script care este satisfăcut la un nou script destinat să îi securizeze.

![BTC204](assets/en/22/1.webp)

Fiecare tranzacție Bitcoin este astfel compusă din una sau mai multe intrări și una sau mai multe ieșiri. Intrările sunt UTXO-urile consumate de tranzacție pentru a genera ieșirile. Ieșirile sunt noi UTXO-uri care vor fi utilizabile ca intrări pentru tranzacțiile viitoare.

![BTC204](assets/en/22/2.webp)

**> Știai că?** Teoretic, o tranzacție bitcoin ar putea avea un număr infinit de intrări și ieșiri. Doar dimensiunea maximă a unui bloc limitează acest număr.
Fiecare intrare într-o tranzacție Bitcoin se referă la un UTXO anterior, necheltuit (Unspent Transaction Output). Pentru a utiliza un UTXO ca intrare, deținătorul său trebuie să demonstreze că este proprietarul legitim validând scriptul asociat cu acesta, adică îndeplinind condiția impusă de cheltuire. În general, acest lucru implică furnizarea unei semnături digitale produse cu cheia privată corespunzătoare cheii publice care a securizat inițial acel UTXO. Scriptul verifică astfel că semnătura se potrivește cu cheia publică utilizată la primirea fondurilor.
![BTC204](assets/en/22/3.webp)
Pe de altă parte, fiecare ieșire specifică cantitatea de bitcoin care trebuie transferată, precum și destinatarul. Acesta din urmă este definit printr-un nou script care, în general, blochează noul UTXO creat cu o adresă de primire sau o nouă cheie publică.
Pentru ca o tranzacție să fie considerată validă conform regulilor de consens, totalul ieșirilor trebuie să fie mai mic sau egal cu totalul intrărilor. Cu alte cuvinte, suma noilor UTXO-uri generate de tranzacție nu trebuie să depășească aceea a UTXO-urilor consumate ca intrări. Acest principiu este logic: dacă ai doar o sumă de `500,000 SATS`, nu poți face o achiziție de `700,000 SATS`.

### Schimb și Consolidare într-o Tranzacție Bitcoin

Acțiunea unei tranzacții Bitcoin asupra UTXO-urilor poate fi astfel comparată cu topirea unei monede de aur. Într-adevăr, un UTXO nu este divizibil, ci doar fuzionabil. Acest lucru înseamnă că un utilizator nu poate pur și simplu să divizeze un UTXO reprezentând o anumită cantitate de bitcoin în mai multe UTXO-uri mai mici. Trebuie să-l consume în întregime într-o tranzacție pentru a crea unul sau mai multe UTXO-uri noi cu valori arbitrare în ieșiri, care trebuie să fie mai mici sau egale cu valoarea inițială.

Acest mecanism este similar cu cel al unei monede de aur. Imaginează-ți că deții o monedă de 2 uncii și vrei să faci un plată de 1 uncie, presupunând că vânzătorul nu îți poate da rest. Ar trebui să-ți topești moneda și să turni 2 noi monede de câte 1 uncie fiecare.
Pe Bitcoin, operațiunea este similară. Să ne imaginăm că Alice are un UTXO de `10,000 SATS` și vrea să cumpere o baghetă costând `4,000 SATS`. Alice va face o tranzacție cu o intrare de 1 UTXO de `10,000 SATS` pe care îl va consuma în întregime, și în ieșiri, va crea 2 UTXO-uri evaluate la `4,000 SATS` și `6,000 SATS`. UTXO-ul de `4,000 SATS` va fi trimis brutarului ca plată pentru baghetă, în timp ce UTXO-ul de `6,000 SATS` va reveni la Alice ca rest. Acest UTXO care revine expeditorului inițial al tranzacției este ceea ce se numește "rest" în jargonul Bitcoin.
![BTC204](assets/en/22/4.webp)

Acum imaginează-ți că Alice nu are un singur UTXO de `10,000 SATS`, ci mai degrabă două UTXO-uri de `3,000 SATS` fiecare. În această situație, niciunul dintre UTXO-uri individual nu este suficient pentru a acoperi `4,000 SATS` pentru baghetă. Prin urmare, Alice trebuie să folosească ambele UTXO-uri de `3,000 SATS` ca intrări pentru tranzacția ei simultan. În acest mod, suma totală a intrărilor va ajunge la `6,000 SATS`, permițându-i să acopere plata de `4,000 SATS` către brutar. Această metodă, care implică gruparea mai multor UTXO-uri în intrările unei tranzacții, este adesea referită prin termenul "consolidare".
![BTC204](assets/en/22/5.webp)

### Taxele de Tranzacție
Intuitiv, cineva ar putea crede că taxele de tranzacție reprezintă de asemenea un rezultat al unei tranzacții. Dar, în realitate, acest lucru nu este adevărat. Taxele unei tranzacții reprezintă diferența dintre totalul intrărilor și totalul ieșirilor. Acest lucru înseamnă că, după utilizarea unei părți din valoarea intrărilor pentru a acoperi ieșirile dorite într-o tranzacție, o anumită sumă din intrări rămâne neutilizată. Această sumă reziduală constituie taxele tranzacției.
```plaintext
Taxe = total intrări - total ieșiri
```

Să ne întoarcem la exemplul lui Alice care are un UTXO de `10,000 SATS` și vrea să cumpere o baghetă pentru `4,000 SATS`. Alice creează o tranzacție cu UTXO-ul ei de `10,000 SATS` ca intrare. Apoi, generează o ieșire de `4,000 SATS` destinată brutarului pentru plata baghetei. Pentru a încuraja minerii să includă tranzacția ei într-un bloc, Alice alocă `200 SATS` ca taxe. Astfel, ea creează o a doua ieșire, restul, care îi va reveni, însumând `5,800 SATS`.

![BTC204](assets/en/22/6.webp)

Aplicând formula taxei, vedem într-adevăr că rămân `200 SATS` pentru mineri:
```plaintext
Taxe = total intrări - total ieșiri
Cheltuieli = 10,000 - (4,000 + 5,800)
Cheltuieli = 10,000 - 9,800
Cheltuieli = 200
```

Când un miner validează cu succes un bloc, are dreptul să colecteze aceste taxe pentru toate tranzacțiile incluse în blocul său, prin așa-numita tranzacție "coinbase".

### Crearea UTXO-urilor pe Bitcoin

Dacă ai urmărit cu atenție paragrafele anterioare, acum știi că UTXO-urile pot fi create doar consumând alte UTXO-uri existente. Astfel, monedele pe Bitcoin formează un lanț continuu. Totuși, s-ar putea să te întrebi cum au apărut primele UTXO-uri în acest lanț. Acest lucru ridică o problemă similară cu cea a oului și a găinii: de unde au venit aceste UTXO-uri originale?

Răspunsul se află în **tranzacția coinbase**.

Coinbase este un tip specific de tranzacție Bitcoin, unic pentru fiecare bloc și întotdeauna prima din ele. Permite minerului care a găsit o dovadă de muncă validă să primească recompensa blocului său. Această recompensă constă din două elemente: **subvenția blocului** și **taxele de tranzacție** despre care am vorbit în partea anterioară.

Caracteristica unică a tranzacției coinbase este că este singura care poate crea bitcoin din nimic, fără a avea nevoie să consume intrări pentru a genera ieșirile sale. Acești bitcoin nou creați constituie ceea ce s-ar putea numi "UTXO-urile originale".

![BTC204](assets/en/22/7.webp)

Bitcoinii din subvenția blocului sunt BTC noi creați din nimic, urmând un program de emitere pre-stabilit în regulile de consens. Subvenția blocului este înjumătățită la fiecare 210,000 de blocuri, ceea ce se întâmplă aproximativ la fiecare patru ani, într-un proces numit "halving". Inițial, 50 de bitcoin au fost creați cu fiecare subvenție, dar această sumă a scăzut treptat; în prezent, este de 3.125 bitcoin per bloc.
În ceea ce privește partea legată de taxele de tranzacție, deși acestea reprezintă de asemenea BTC nou creat, ele nu trebuie să depășească diferența dintre totalul intrărilor și ieșirilor tuturor tranzacțiilor dintr-un bloc. Am văzut anterior că aceste taxe reprezintă porțiunea din intrări care nu este utilizată în ieșirile tranzacțiilor. Această parte este tehnic "pierdută" în timpul tranzacției, iar minerul are dreptul de a recrea această valoare sub forma unuia sau mai multor UTXO-uri noi. Prin urmare, acesta este un transfer de valoare de la expeditorul tranzacției către minerul care o adaugă în blockchain.
**> Știai?** Bitcoinii generați de o tranzacție coinbase sunt supuși unei perioade de maturitate de 100 de blocuri în timpul căreia nu pot fi cheltuiți de miner. Această regulă este intenționată pentru a evita complicațiile legate de utilizarea bitcoinilor nou creați pe un lanț care ulterior ar putea fi considerat învechit.

### Implicațiile Modelului UTXO

În primul rând, modelul UTXO influențează direct taxele de tranzacție pe Bitcoin. Având în vedere că capacitatea fiecărui bloc este limitată, minerii favorizează tranzacțiile care oferă cele mai bune taxe în raport cu spațiul pe care îl vor ocupa în bloc. Într-adevăr, cu cât o tranzacție include mai multe UTXO-uri ca intrări și ieșiri, cu atât este mai grea și, prin urmare, necesită taxe mai mari. Aceasta este una dintre motivele pentru care adesea se face un efort de a reduce numărul de UTXO-uri din portofelul nostru, ceea ce poate afecta de asemenea confidențialitatea, un subiect pe care îl vom aborda în detaliu în partea a treia a acestui curs.

În continuare, așa cum s-a menționat în părțile anterioare, monedele pe Bitcoin sunt esențialmente un lanț de UTXO-uri. Fiecare tranzacție creează astfel o legătură între un UTXO din trecut și un UTXO viitor. UTXO-urile permit astfel urmărirea explicită a traseului bitcoinilor de la crearea lor până la cheltuirea lor actuală. Această transparență poate fi văzută în mod pozitiv, deoarece permite fiecărui utilizator să se asigure de autenticitatea bitcoinilor primiți. Totuși, este și pe acest principiu de trasabilitate și auditabilitate care se bazează analiza lanțului, o practică menită să compromită confidențialitatea ta. Vom studia această practică în profunzime în partea a doua a cursului.

## Modelul de Confidențialitate al Bitcoinului
<chapterId>769d8963-3ed5-4094-b21d-9203c7d9e465</chapterId>

### Moneda: Autenticitate, Integritate și Dubla Cheltuire

Una dintre funcțiile monedei este de a rezolva problema dublei coincidențe a dorințelor. Într-un sistem bazat pe barter, realizarea unui schimb necesită nu doar găsirea unui individ care oferă un bun care îmi satisface nevoia, dar și oferirea lor a unui bun de valoare echivalentă care să satisfacă propria lor nevoie. Găsirea acestui echilibru se dovedește a fi complexă.

![BTC204](assets/notext/23/1.webp)

De aceea apelăm la monedă, care permite transferul de valoare atât în spațiu cât și în timp.

![BTC204](assets/notext/23/2.webp)

Pentru ca moneda să rezolve această problemă, este esențial ca partea care oferă un bun sau serviciu să fie convinsă de capacitatea sa de a cheltui acea sumă mai târziu. Astfel, orice individ rațional care dorește să accepte o bucată de monedă, fie ea digitală sau fizică, se va asigura că aceasta îndeplinește două criterii fundamentale:
- **Moneda trebuie să fie intactă și autentică;**
- **și nu trebuie să fie cheltuită de două ori.**
Când se utilizează moneda fizică, prima caracteristică este cea mai complexă de afirmat. De-a lungul diferitelor perioade din istorie, integritatea monedelor metalice a fost adesea compromisă prin practici precum tăierea marginilor sau găurirea. De exemplu, în Roma antică, era obișnuit ca cetățenii să rașcheteze marginile monedelor de aur pentru a colecta un pic din metalul prețios, păstrându-le totuși pentru tranzacții viitoare. Valoarea intrinsecă a monedei era astfel redusă, dar valoarea nominală rămânea aceeași. Acesta este motivul notabil pentru care mai târziu au fost create margini zimțate pe marginea monedelor.
Autenticitatea este, de asemenea, o caracteristică dificil de verificat cu mediile monetare fizice. În zilele noastre, tehnicile de combatere a contrafacerii sunt din ce în ce mai complexe, forțând comercianții să investească în sisteme de verificare costisitoare.

Pe de altă parte, datorită naturii lor, cheltuirea dublă nu este o problemă pentru monedele fizice. Dacă îți dau o bancnotă de €10, aceasta părăsește irevocabil posesia mea pentru a intra în a ta, excluzând în mod natural orice posibilitate de a cheltui aceleași unități monetare de mai multe ori. Pe scurt, nu voi putea să cheltui din nou acea bancnotă de €10.

![BTC204](assets/notext/23/3.webp)

Pentru moneda digitală, dificultatea este diferită. Asigurarea autenticității și integrității unei monede este adesea mai simplă. Așa cum am văzut în secțiunea precedentă, modelul UTXO al Bitcoinului permite urmărirea unei monede înapoi la originea sa, verificând astfel că a fost creată în conformitate cu regulile de consens de către un miner.

Cu toate acestea, asigurarea absenței cheltuirii duble este mai complexă, deoarece orice bun digital este, în esență, informație. Spre deosebire de bunurile fizice, informația nu se divide în timpul schimburilor, ci se propagă prin multiplicare. De exemplu, dacă îți trimit un document prin e-mail, acesta devine duplicat. La capătul tău, nu poți verifica cu certitudine că am șters documentul original.

![BTC204](assets/notext/23/4.webp)

### Prevenirea Cheltuirii Duble pe Bitcoin

Singura modalitate de a evita duplicarea unui bun digital este să fii conștient de toate schimburile din sistem. În acest mod, se poate ști cine deține ce și se pot actualiza deținerile tuturor pe baza tranzacțiilor efectuate. Acest lucru se face, de exemplu, cu banii în conturi în sistemul bancar. Când plătești €10 unui comerciant cu cardul de credit, banca notează acest schimb și actualizează registrul.
Pe Bitcoin, prevenirea cheltuirii duble se realizează în același mod. Scopul este de a confirma absența unei tranzacții care a cheltuit deja monedele în cauză. Dacă aceste monede nu au fost niciodată folosite, atunci putem fi asigurați că nu va avea loc o cheltuire dublă. Acest principiu a fost descris de Satoshi Nakamoto în White Paper cu această frază faimoasă:

**"*Singura modalitate de a confirma absența unei tranzacții este să fii conștient de toate tranzacțiile.*"**

Cu toate acestea, spre deosebire de modelul bancar, nu există dorința de a trebui să avem încredere într-o entitate centrală pe Bitcoin. Este necesar ca toți utilizatorii să poată confirma această absență a cheltuirii duble, fără a se baza pe o terță parte. Astfel, toată lumea trebuie să fie conștientă de toate tranzacțiile Bitcoin. Acesta este motivul pentru care tranzacțiile Bitcoin sunt transmise public în toate nodurile rețelei și înregistrate în mod clar pe blockchain.

Este tocmai această diseminare publică a informațiilor care complică protecția intimității pe Bitcoin. În sistemul bancar tradițional, în teorie, doar instituția financiară este conștientă de tranzacțiile efectuate. Pe de altă parte, pe Bitcoin, toți utilizatorii sunt informați despre toate tranzacțiile, prin nodurile lor respective.

### Modelul de intimitate: sistemul bancar vs Bitcoin
În sistemul tradițional, contul tău bancar este legat de identitatea ta. Banca are posibilitatea să știe cărui client îi aparține fiecare cont bancar și ce tranzacții sunt asociate cu acesta. Totuși, acest flux de informații este întrerupt între bancă și domeniul public. Cu alte cuvinte, este imposibil să cunoști soldul și tranzacțiile unui cont bancar care aparține altei persoane. Doar banca are acces la aceste informații.

De exemplu, bancherul tău știe că îți cumperi bagheta în fiecare dimineață de la brutăria din cartier, dar vecinul tău nu este conștient de această tranzacție. Astfel, fluxul de informații este accesibil părților implicate, în mod notabil băncii, dar rămâne inaccesibil pentru exterior.

Din cauza constrângerii de diseminare publică a tranzacțiilor pe care am văzut-o în partea precedentă, modelul de confidențialitate al Bitcoin nu poate urma modelul sistemului bancar. În cazul Bitcoin, deoarece fluxul de informații nu poate fi întrerupt între tranzacții și domeniul public, **modelul de confidențialitate se bazează pe separarea între identitatea utilizatorului și tranzacțiile** în sine.

De exemplu, dacă cumperi o baghetă de la brutar plătind în BTC, vecinul tău, care deține propriul nod complet, poate vedea tranzacția ta desfășurându-se, la fel cum poate vedea toate celelalte tranzacții din sistem. Totuși, dacă principiile de confidențialitate sunt respectate, ei nu ar trebui să poată lega această tranzacție specifică de identitatea ta.

Dar, deoarece tranzacțiile Bitcoin sunt făcute publice, devine totuși posibil să se stabilească legături între ele pentru a deduce informații despre părțile implicate. Această activitate constituie chiar o specialitate în sine numită "analiza lanțului". În partea următoare a instruirii, te invit să explorezi fundamentele analizei lanțului pentru a înțelege cum sunt urmărite bitcoinii tăi și să știi cum să te aperi mai bine împotriva acesteia.

# Înțelegerea Analizei Lanțului și Cum să te Protejezi
<partId>4739371e-9fef-45b0-bcaa-b7a4df6b4470</partId>

## Ce este Analiza Lanțului pe Bitcoin?
<chapterId>7d198ba6-4af2-4f24-86cb-3c79cb25627e</chapterId>

### Definiție și Funcționare

Analiza lanțului este o practică care cuprinde toate metodele utilizate pentru a urmări fluxul de bitcoini pe blockchain. În general, analiza lanțului se bazează pe observarea caracteristicilor în eșantioane de tranzacții anterioare. Apoi, implică identificarea acestor caracteristici într-o tranzacție pe care cineva dorește să o analizeze și deducerea unor interpretări plauzibile. Această metodă de rezolvare a problemelor dintr-o abordare practică, pentru a găsi o soluție suficient de bună, este ceea ce se numește o "euristică".

Pentru a simplifica, analiza lanțului se face în trei pași principali:
1. **Observarea blockchain-ului;**
2. **Identificarea caracteristicilor cunoscute;**
3. **Deducerea ipotezelor.**

Analiza lanțului poate fi efectuată de oricine. Este suficient să ai acces la informațiile publice ale blockchain-ului prin intermediul unui nod complet pentru a observa mișcările tranzacțiilor și a face ipoteze. Există și unelte gratuite care facilitează această analiză, ca site-ul [OXT.me](https://oxt.me/) pe care îl vom explora în detaliu în ultimele două capitole ale acestei părți. Totuși, principalul risc pentru confidențialitate vine din partea companiilor specializate în analiza lanțului. Aceste companii au dus analiza lanțului la un nivel industrial și își vând serviciile instituțiilor financiare sau guvernelor. Printre aceste companii, Chainalysis este probabil cea mai cunoscută.

### Obiectivele Analizei Lanțului
Unul dintre obiectivele analizei lanțului este de a grupa diverse activități pe Bitcoin pentru a determina unicitatea utilizatorului care le-a efectuat. Ulterior, va fi posibil să încercăm să legăm acest pachet de activități de o identitate reală.
![BTC204](assets/notext/31/2.webp)

Amintește-ți de capitolul anterior. Am explicat de ce modelul de confidențialitate al Bitcoin se baza inițial pe separarea identității utilizatorului de tranzacțiile sale. Prin urmare, ar fi tentant să credem că analiza lanțului este inutilă, deoarece chiar dacă cineva reușește să grupeze activitățile onchain, acestea nu pot fi asociate cu o identitate reală.

Teoretic, această afirmație este precisă. În prima parte a acestui training, am văzut că perechile de chei criptografice sunt folosite pentru a stabili condiții asupra UTXO. Prin esență, aceste perechi de chei nu dezvăluie nicio informație despre identitatea deținătorilor lor. Astfel, chiar dacă cineva reușește să grupeze activități asociate cu diferite perechi de chei, acest lucru nu ne spune nimic despre entitatea din spatele acestor activități.

![BTC204](assets/notext/31/3.webp)

Cu toate acestea, realitatea practică este mult mai complexă. Există o multitudine de comportamente care riscă să lege o identitate reală de o activitate onchain. În analiză, acest lucru se numește un punct de intrare, și există multe dintre ele.

Cel mai comun, desigur, este KYC (*Know Your Customer*). Dacă retragi bitcoinii tăi de pe o platformă reglementată la una dintre adresele tale personale de primire, atunci unele persoane pot să-ți lege identitatea de această adresă. Mai larg, un punct de intrare poate fi orice formă de interacțiune între viața ta reală și o tranzacție Bitcoin. De exemplu, dacă publici o adresă de primire pe rețelele tale sociale, aceasta poate fi un punct de intrare pentru analiză. Dacă faci o plată în bitcoin către brutarul tău, acesta poate asocia fața ta (care face parte din identitatea ta) cu o adresă Bitcoin.

Aceste puncte de intrare sunt aproape inevitabile în utilizarea Bitcoin. Deși se poate căuta să se limiteze domeniul lor de aplicare, ele vor rămâne prezente. De aceea este crucial să combinăm metodele menite să-ți păstrezi confidențialitatea. Deși menținerea unei separări între identitatea ta reală și tranzacțiile tale este o abordare interesantă, rămâne insuficientă astăzi. Într-adevăr, dacă toate activitățile tale onchain pot fi grupate, atunci cel mai mic punct de intrare este susceptibil să compromită singurul strat de confidențialitate pe care l-ai stabilit.

![BTC204](assets/notext/31/4.webp)

### Apărarea Împotriva Analizei Lanțului
Astfel, este de asemenea necesar să putem face față analizei blockchain în utilizarea noastră a Bitcoin. Procedând în acest mod, putem minimiza agregarea activităților noastre și limita impactul unui punct de intrare asupra confidențialității noastre.
![BTC204](assets/notext/31/5.webp)

Într-adevăr, pentru a contracara mai bine analiza blockchain, ce metodă mai bună decât familiarizarea cu metodele utilizate în analiza blockchain? Dacă vrei să știi cum să-ți îmbunătățești confidențialitatea pe Bitcoin, trebuie să înțelegi aceste metode. Acest lucru îți va permite să înțelegi mai bine tehnici precum [coinjoin](https://planb.network/fr/tutorials/privacy/coinjoin-samourai-wallet) sau [payjoin](https://planb.network/fr/tutorials/privacy/payjoin) (tehnici pe care le vom studia în ultimele părți ale trainingului), și să reduci greșelile pe care le-ai putea face.
În acest context, putem face o analogie cu criptografia și criptanaliza. Un bun criptograf este, în primul rând, un bun criptanalist. Pentru a imagina un nou algoritm de criptare, trebuie să știi cu ce atacuri se va confrunta și, de asemenea, să studiezi de ce algoritmii anteriori au fost spart. Același principiu se aplică și pentru confidențialitatea pe Bitcoin. Înțelegerea metodelor de analiză a blockchain-ului este cheia pentru a te proteja împotriva acesteia. De aceea, propun o secțiune întreagă despre analiza blockchain-ului în acest training.
### Metodele de analiză a blockchain-ului

Este important de înțeles că analiza blockchain-ului nu este o știință exactă. Se bazează pe euristici derivate din observații anterioare sau interpretări logice. Aceste reguli permit obținerea de rezultate destul de fiabile, dar niciodată cu precizie absolută. Cu alte cuvinte, **analiza blockchain-ului implică întotdeauna o dimensiune de probabilitate în concluziile emise**. De exemplu, se poate estima cu mai mult sau mai puțină certitudine că două adrese aparțin aceleiași entități, dar certitudinea totală va fi întotdeauna inaccesibilă.

Întregul obiectiv al analizei blockchain-ului constă exact în agregarea diverselor euristici pentru a minimiza riscul de eroare. Este, într-un fel, o acumulare de dovezi care ne permite să ne apropiem mai mult de realitate.

Aceste faimoase euristici pot fi grupate în diferite categorii pe care le vom detalia împreună:
- **Modele de tranzacții (sau modele de tranzacționare);**
- **Euristici interne tranzacției;**
- **Euristici externe tranzacției.**

### Satoshi Nakamoto și analiza blockchain-ului
Trebuie menționat că primele două euristici pentru analiza lanțului au fost descoperite de însuși Satoshi Nakamoto. El le discută în partea 10 a White Paper-ului Bitcoin. Acestea sunt:
- Euristica de Proprietate Comună a Intrărilor (CIOH);
- și reutilizarea adresei.

![BTC204](assets/notext/31/6.webp)

Sursa: S. Nakamoto, "Bitcoin: A Peer-to-Peer Electronic Cash System", https://bitcoin.org/bitcoin.pdf, 2009.

În capitolele următoare, vom explora în ce constau acestea, dar este deja interesant de remarcat că aceste două euristici încă păstrează o preeminență în analiza lanțului astăzi.

## Modele de Tranzacții
<chapterId>d365a101-2d37-46a5-bfb9-3c51e37bf96b</chapterId>

Un model de tranzacție este pur și simplu un model sau o structură generală a unei tranzacții tipice care poate fi găsită pe blockchain, a cărei interpretare este probabil cunoscută. Când studiem modelele, ne vom concentra pe o singură tranzacție pe care o vom analiza la un nivel înalt.

Cu alte cuvinte, ne vom uita doar la numărul de UTXO-uri în intrări și la numărul de UTXO-uri în ieșiri, fără a ne pierde în detalii mai specifice sau în mediul tranzacției. Din modelul observat, vom putea interpreta natura tranzacției. Vom căuta apoi caracteristici în structura sa și vom deduce o interpretare.

![BTC204](assets/en/32/01.webp)

În această parte, vom descoperi împreună principalele modele de tranzacții care pot fi întâlnite în analiza lanțului, și pentru fiecare model, vă voi oferi interpretarea probabilă a acestei structuri, împreună cu un exemplu concret.

### Trimitere Simplă (sau Plată Simplă)

Începem cu un model foarte răspândit, deoarece este cel care apare în majoritatea plăților bitcoin. Modelul de plată simplă este caracterizat de consumul uneia sau mai multor UTXO-uri în intrări și producția a 2 UTXO-uri în ieșiri. Acest model va arăta astfel:

![BTC204](assets/en/32/02.webp)
Când observăm această structură de tranzacție pe blockchain, putem deja să tragem o interpretare. Așa cum sugerează și numele, acest model indică faptul că suntem în prezența unei tranzacții de expediere sau plată. Utilizatorul și-a consumat propriul UTXO în intrări pentru a satisface în ieșiri un UTXO de plată și un UTXO de rest (bani returnați aceluiași utilizator).
Astfel, știm că utilizatorul observat probabil nu mai este în posesia unuia dintre cele două UTXO-uri în ieșiri (cel de plată), dar încă deține celălalt UTXO (cel de rest).
În acest moment, este imposibil pentru noi să specificăm care ieșire reprezintă care UTXO, deoarece acesta nu este scopul studiului modelelor. Vom realiza acest lucru bazându-ne pe euristicile pe care le vom studia în părțile următoare. La această etapă, scopul nostru este limitat la identificarea naturii tranzacției în cauză, care este, în acest caz, o simplă expediere.

De exemplu, iată o tranzacție Bitcoin care adoptă modelul de expediere simplă:

```plaintext
b6cc79f45fd2d7669ff94db5cb14c45f1f879ea0ba4c6e3d16ad53a18c34b769
```

![BTC204](assets/en/32/03.webp)

Sursa: [Mempool.space](https://mempool.space/fr/tx/b6cc79f45fd2d7669ff94db5cb14c45f1f879ea0ba4c6e3d16ad53a18c34b769)

După acest prim exemplu, ar trebui să aveți o înțelegere mai bună a ceea ce înseamnă să studiezi un "model de tranzacție". Examinăm o tranzacție concentrându-ne doar pe structura sa, fără a lua în considerare mediul său sau detaliile specifice ale tranzacției. O observăm doar într-o manieră globală în acest prim pas.

Acum că înțelegeți ce este un model, să trecem la celelalte modele existente.

### Sweeping

Acest al doilea model este caracterizat de consumul unui singur UTXO ca intrare și producerea unui singur UTXO ca ieșire.

![BTC204](assets/en/32/04.webp)

Interpretarea acestui model este că suntem în prezența unui auto-transfer. Utilizatorul și-a transferat bitcoinii lui însuși, către o altă adresă pe care o deține. Deoarece nu există rest în tranzacție, este foarte puțin probabil că suntem în prezența unei plăți. Într-adevăr, când se face o plată, este aproape imposibil pentru plătitor să aibă un UTXO care să se potrivească exact cu suma cerută de vânzător, plus taxele de tranzacție. În general, plătitorul este deci obligat să producă o ieșire de rest.

Știm atunci că utilizatorul observat probabil încă deține acest UTXO. În contextul unei analize a lanțului, dacă știm că UTXO-ul utilizat ca intrare în tranzacție îi aparține lui Alice, putem presupune că UTXO-ul din ieșire îi aparține de asemenea. Ce va deveni interesant mai târziu este să găsim euristici interne tranzacției care ar putea întări această presupunere (vom studia aceste euristici în capitolul 3.3).

De exemplu, iată o tranzacție Bitcoin care adoptă modelul de sweeping:

```plaintext
35f1072a0fda5ae106efb4fda871ab40e1f8023c6c47f396441ad4b995ea693d
```

![BTC204](assets/en/32/05.webp)
Sursa: [Mempool.space](https://mempool.space/fr/tx/35f1072a0fda5ae106efb4fda871ab40e1f8023c6c47f396441ad4b995ea693d) Totuși, acest tip de model poate dezvălui de asemenea un autotransfer către contul unei platforme de schimb de criptomonede. Va fi studiul adreselor cunoscute și contextul tranzacției care ne va permite să știm dacă este vorba despre un sweep către un portofel de auto-custodie sau o retragere către o platformă. Într-adevăr, adresele platformelor de schimb sunt adesea ușor de identificat.

Să ne întoarcem la exemplul lui Alice: dacă sweep-ul conduce la o adresă cunoscută a unei platforme (cum ar fi Binance, de exemplu), acest lucru poate însemna că bitcoinii au fost transferați din posesia directă a lui Alice, probabil cu intenția de a-i vinde sau de a-i stoca pe această platformă. Pe de altă parte, dacă adresa destinație este necunoscută, este rezonabil să presupunem că este pur și simplu un alt portofel care încă îi aparține lui Alice. Dar acest tip de studiu cade mai mult în categoria euristicilor și nu în studiul modelelor.

### Consolidare

Acest model este caracterizat de consumul mai multor UTXO-uri ca intrare și producerea unui singur UTXO ca ieșire.

![BTC204](assets/en/32/06.webp)

Interpretarea acestui model este că ne aflăm în prezența unei consolidări. Aceasta este o practică comună printre utilizatorii Bitcoin, având ca scop unirea mai multor UTXO-uri în anticiparea unei posibile creșteri a taxelor de tranzacție. Efectuând această operațiune într-o perioadă când taxele sunt scăzute, este posibil să economisiți pe taxele viitoare. Vom vorbi mai mult despre această practică în capitolul 4.3.

Putem deduce că utilizatorul din spatele acestui model de tranzacție era probabil în posesia tuturor UTXO-urilor la intrare și este încă în posesia UTXO-ului la ieșire. Acesta este cu siguranță un autotransfer.

La fel ca și în cazul sweep-urilor, acest tip de model poate dezvălui de asemenea un autotransfer către contul unei platforme de schimb. Va fi studiul adreselor cunoscute și contextul tranzacției care ne va permite să știm dacă este vorba despre o consolidare către un portofel de auto-custodie sau o retragere către o platformă.

De exemplu, iată o tranzacție Bitcoin care adoptă modelul de consolidare:

```plaintext
77c16914211e237a9bd51a7ce0b1a7368631caed515fe51b081d220590589e94
```

![BTC204](assets/en/32/07.webp)

Sursa: [Mempool.space](https://mempool.space/fr/tx/77c16914211e237a9bd51a7ce0b1a7368631caed515fe51b081d220590589e94)
În contextul unei analize a lanțului, acest model poate dezvălui multe informații. De exemplu, dacă știm că una dintre intrări îi aparține lui Alice, putem presupune că toate celelalte intrări și ieșirea acestei tranzacții îi aparțin de asemenea. Această presupunere ne-ar permite atunci să urmărim înapoi prin lanțurile de tranzacții anterioare pentru a descoperi și analiza alte tranzacții probabil asociate cu Alice.
![BTC204](assets/en/32/08.webp)

### Cheltuirea Grupată

Acest model este caracterizat de consumul a câtorva UTXO-uri ca intrări (adesea doar una) și producția de numeroase UTXO-uri ca ieșiri.

![BTC204](assets/en/32/09.webp)
Interpretarea acestui model este că ne aflăm în prezența unei cheltuieli grupate. Aceasta este o practică care probabil dezvăluie o activitate economică semnificativă, cum ar fi o platformă de schimb, de exemplu. Cheltuirea grupată permite acestor entități să economisească la taxe prin consolidarea cheltuielilor lor într-o singură tranzacție.
Putem deduce din acest model că intrarea UTXO provine de la o companie cu activitate economică semnificativă și că ieșirile UTXO se vor dispersa. Multe vor aparține clienților companiei care au retras bitcoini de pe platformă. Altele pot merge către companii partenere. În final, cu siguranță va exista una sau mai multe schimburi care se întorc la compania emitentă.

De exemplu, iată o tranzacție Bitcoin care adoptă modelul cheltuielii grupate (probabil, este o tranzacție emisă de platforma Bybit):

```plaintext
8a7288758b6e5d550897beedd13c70bcbaba8709af01a7dbcc1f574b89176b43
```

![BTC204](assets/en/32/10.webp)

Sursa: [Mempool.space](https://mempool.space/fr/tx/8a7288758b6e5d550897beedd13c70bcbaba8709af01a7dbcc1f574b89176b43)

### Tranzacții Specifice Protocolului

Printre modelele de tranzacții, putem identifica și modele care dezvăluie utilizarea unui protocol specific. De exemplu, Whirlpool coinjoins (pe care îl vom discuta în partea a 5-a) va avea o structură ușor identificabilă care le permite să fie diferențiate de alte tranzacții mai tradiționale.

![BTC204](assets/en/32/11.webp)

Analiza acestui model sugerează că probabil ne aflăm în prezența unei tranzacții colaborative. De asemenea, este posibil să observăm un coinjoin. Dacă această ultimă ipoteză se dovedește a fi exactă, atunci numărul de ieșiri ne-ar putea oferi o estimare aproximativă a numărului de participanți la coinjoin.

De exemplu, iată o tranzacție Bitcoin care adoptă modelul tipului de tranzacție colaborativă coinjoin:

```plaintext
00601af905bede31086d9b1b79ee8399bd60c97e9c5bba197bdebeee028b9bea
```

![BTC204](assets/en/32/12.webp)

Sursa: [Mempool.space](https://mempool.space/fr/tx/00601af905bede31086d9b1b79ee8399bd60c97e9c5bba197bdebeee028b9bea)

Există multe alte protocoale care au propriile structuri specifice. Astfel, am putea distinge tranzacții de tipul Wabisabi, tranzacții Stamps, sau chiar Runes, de exemplu.

Mulțumită acestor modele de tranzacții, putem deja interpreta o serie de informații despre o tranzacție dată. Dar structura tranzacției nu este singura sursă de informații pentru analiză. Putem studia și detaliile sale. Aceste detalii, interne unei tranzacții, sunt ceea ce îmi place să numesc "euristici interne", și le vom studia în capitolul următor.

## Euristici Interne
<chapterId>c54b5abe-872f-40f4-a0d0-c59faff228ba</chapterId>

O euristică internă este o caracteristică specifică identificată în cadrul unei tranzacții în sine, fără a fi nevoie să examinăm mediul său, care ne permite să facem deducții. Spre deosebire de modelele care se concentrează pe structura generală a tranzacției la un nivel înalt, euristicile interne se bazează pe setul de date extragibile. Aceasta include:
- Cantitățile diferitelor UTXO-uri, atât cele care intră, cât și cele care ies;
- Totul despre scripturi: adresele de primire, versionarea, timpii de blocare...

În general, acest tip de euristică ne va permite să identificăm schimbarea într-o tranzacție specifică. Făcând acest lucru, putem apoi continua să urmărim o entitate prin mai multe tranzacții diferite. Într-adevăr, dacă identificăm un UTXO care aparține unui utilizator pe care dorim să-l urmărim, este crucial să determinăm, când efectuează o tranzacție, care output a fost transferat altui utilizator și care output reprezintă restul, rămânând astfel în posesia sa.

![BTC204](assets/en/33/01.webp)

Încă o dată, vă reamintesc că aceste euristici nu sunt absolut precise. Luate individual, ele ne permit doar să identificăm scenarii plauzibile. Este acumularea mai multor euristici care ajută la reducerea incertitudinii, fără a o elimina complet vreodată.

### Similarități Interne

Această euristică implică studiul similarităților între inputurile și outputurile aceleiași tranzacții. Dacă observăm aceeași caracteristică pe inputuri și pe doar unul dintre outputurile tranzacției, atunci este probabil ca acest output să constituie restul.

Cea mai evidentă caracteristică este reutilizarea unei adrese de primire în aceeași tranzacție.

![BTC204](assets/en/33/02.webp)
Această euristică lasă puțin loc de îndoială. Cu excepția cazului în care cheia privată a fost spartă, aceeași adresă de primire dezvăluie inevitabil activitatea unui singur utilizator. Interpretarea care urmează este că schimbul din tranzacție este outputul cu aceeași adresă ca inputul. Acest lucru permite urmărirea continuă a individului pe baza acestui rest.
De exemplu, iată o tranzacție la care această euristică poate fi aplicată în mod rezonabil:

```plaintext
54364146665bfc453a55eae4bfb8fdf7c721d02cb96aadc480c8b16bdeb8d6d0
```

![BTC204](assets/notext/33/03.webp)

Sursa: [Mempool.space](https://mempool.space/tx/54364146665bfc453a55eae4bfb8fdf7c721d02cb96aadc480c8b16bdeb8d6d0)

Aceste similarități între inputuri și outputuri nu se opresc la reutilizarea adresei. Orice asemănare în utilizarea scripturilor poate permite aplicarea unei euristici. De exemplu, uneori se poate observa aceeași versionare între un input și unul dintre outputurile tranzacției.

![BTC204](assets/en/33/04.webp)

În acest diagramă, putem vedea că inputul Nr. 0 deblochează un script P2WPKH (SegWit V0 începând cu `bc1q`). Outputul Nr. 0 folosește același tip de script. Cu toate acestea, outputul Nr. 1 folosește un script P2TR (SegWit V1 începând cu `bc1p`). Interpretarea acestei caracteristici este că este probabil ca adresa cu aceeași versionare ca inputul să fie adresa de rest. Prin urmare, ar aparține în continuare aceluiași utilizator.

Iată o tranzacție la care această euristică poate fi aplicată în mod rezonabil:

```plaintext
db07516288771ce5d0a06b275962ec4af1b74500739f168e5800cbcb0e9dd578
```

![BTC204](assets/notext/33/05.webp)

Sursa: [Mempool.space](https://mempool.space/tx/db07516288771ce5d0a06b275962ec4af1b74500739f168e5800cbcb0e9dd578)
În acest caz, putem observa că intrarea Nr. 0 și ieșirea Nr. 1 folosesc scripturi P2WPKH (SegWit V0), în timp ce ieșirea Nr. 0 utilizează un tip diferit de script, P2PKH (Legacy). La începutul anilor 2010, această euristică bazată pe versionarea scripturilor era relativ puțin utilă din cauza limitării tipurilor de scripturi disponibile. Cu toate acestea, în timp și cu actualizări succesive ale Bitcoin, a fost introdusă o diversitate tot mai mare de tipuri de scripturi. Această euristică devine din ce în ce mai relevantă deoarece, cu o gamă mai largă de tipuri de scripturi, utilizatorii sunt împărțiți în grupuri mai mici, crescând astfel șansele de aplicare a acestei euristici de reutilizare a versiunii interne. Din acest motiv, doar din perspectiva confidențialității, este recomandabil să optezi pentru tipul de script cel mai comun. De exemplu, în momentul în care scriu aceste rânduri, scripturile Taproot (`bc1p`) sunt utilizate mai rar decât scripturile SegWit V0 (`bc1q`). Deși primele oferă beneficii economice și de confidențialitate în anumite contexte specifice, pentru utilizările tradiționale cu semnătură unică, ar fi înțelept să te ții de un standard mai vechi din motive de confidențialitate, până când noul standard este adoptat pe scară largă.

### Plăți cu Număr Rotund

O altă euristică internă care ne poate ajuta să identificăm restul este cea a numărului rotund. În general, când ne confruntăm cu un model simplu de plată (1 intrare și 2 ieșiri), dacă una dintre ieșiri cheltuiește o sumă rotundă, atunci aceasta reprezintă plata.

![BTC204](assets/en/33/06.webp)

Prin eliminare, dacă o ieșire reprezintă plata, cealaltă reprezintă restul. Se poate deci infera că este probabil ca utilizatorul care a introdus tranzacția să dețină în continuare ieșirea identificată ca fiind restul.

Trebuie menționat că această euristică nu este întotdeauna aplicabilă, deoarece majoritatea plăților sunt încă efectuate în unități de monedă fiat. Într-adevăr, când un comerciant din Franța acceptă bitcoin, în general, nu afișează prețuri stabile în sats. Ei ar opta mai degrabă pentru o conversie între prețul în euro și suma în bitcoin care trebuie plătită. Prin urmare, nu ar trebui să existe un număr rotund în ieșirea tranzacției.

Cu toate acestea, un analist ar putea încerca să facă această conversie luând în considerare rata de schimb în vigoare în momentul difuzării tranzacției pe rețea. Să luăm exemplul unei tranzacții cu o intrare de `97,552 sats` și două ieșiri, una de `31,085 sats` și cealaltă de `64,152 sats`. La prima vedere, această tranzacție nu pare să implice sume rotunde. Cu toate acestea, aplicând rata de schimb de €64,339 la momentul tranzacției, obținem o conversie în euro care arată astfel:
- O intrare de €62.76;
- O ieșire de €20;
- O ieșire de €41.27.
Odată convertită în monedă fiat, această tranzacție permite aplicarea euristicii plăților cu sumă rotundă. Ieșirea de €20 a fost probabil destinată unui comerciant, sau cel puțin și-a schimbat proprietarul. Prin deducție, ieșirea de €41.27 a rămas probabil în posesia utilizatorului original.
![BTC204](assets/en/33/07.webp)

Dacă într-o zi, Bitcoin devine unitatea de cont preferată în tranzacțiile noastre, această euristică ar putea deveni și mai utilă pentru analiză.

De exemplu, iată o tranzacție unde această euristică poate fi aplicată probabil:

```plaintext
2bcb42fab7fba17ac1b176060e7d7d7730a7b807d470815f5034d52e96d2828a
```

![BTC204](assets/notext/33/08.webp)
Sursa: [Mempool.space](https://mempool.space/tx/2bcb42fab7fba17ac1b176060e7d7d7730a7b807d470815f5034d52e96d2828a)
### Cel Mai Mare Output

Când se observă un decalaj suficient de mare între două output-uri ale unei tranzacții într-un model simplu de plată, se poate estima că output-ul mai mare este probabil restul.

![BTC204](assets/en/33/09.webp)

Această euristică a celui mai mare output este probabil cea mai imprecisă dintre toate. Identificată singură, este destul de slabă. Totuși, această caracteristică poate fi combinată cu alte euristici pentru a reduce incertitudinea interpretării noastre.

De exemplu, dacă examinăm o tranzacție care prezintă un output cu o sumă rotundă și un alt output cu o sumă mai mare, aplicarea combinată a euristicii plăților rotunde și a celei privind cel mai mare output ne permite să reducem nivelul de incertitudine.

De exemplu, iată o tranzacție unde această euristică poate fi aplicată probabil:

```plaintext
b79d8f8e4756d34bbb26c659ab88314c220834c7a8b781c047a3916b56d14dcf
```

![BTC204](assets/notext/33/10.webp)

Sursa: [Mempool.space](https://mempool.space/tx/b79d8f8e4756d34bbb26c659ab88314c220834c7a8b781c047a3916b56d14dcf)

## Euristici Externe
<chapterId>4a170e3b-200d-431a-8285-18a23ff617ba</chapterId>

Studiul euristicilor externe implică analizarea asemănărilor, modelelor și caracteristicilor anumitor elemente care nu sunt inerente tranzacției în sine. Cu alte cuvinte, dacă anterior ne-am limitat la exploatarea elementelor intrinseci tranzacției cu euristici interne, acum ne extindem câmpul de analiză la mediul tranzacției datorită euristicilor externe.

### Reutilizarea Adreselor

Aceasta este una dintre cele mai cunoscute euristici printre entuziaștii Bitcoin. Reutilizarea adreselor permite stabilirea unei legături între diferite tranzacții și diferite UTXO-uri. Este observată atunci când o adresă de primire Bitcoin este utilizată de mai multe ori.

Astfel, este posibil să exploatezi reutilizarea adreselor în cadrul aceleiași tranzacții ca o euristică internă pentru a identifica restul (așa cum am văzut în capitolul anterior). Totuși, reutilizarea adreselor poate servi, de asemenea, ca o euristică externă pentru a recunoaște unicitatea unei entități din spatele mai multor tranzacții.

Interpretarea reutilizării adreselor este că toate UTXO-urile blocate pe această adresă aparțin (sau au aparținut) aceleiași entități. Această euristică lasă puțin loc pentru incertitudine. Când este posibil să o identificăm, interpretarea care urmează este foarte probabil să corespundă realității. Astfel, permite gruparea diferitelor activități onchain.

![BTC204](assets/en/34/01.webp)

Așa cum a fost explicat în introducerea acestei părți a 3-a, această euristică a fost descoperită de Satoshi Nakamoto însuși. În White Paper, el menționează specific o soluție pentru utilizatori de a evita producerea acesteia, care este pur și simplu să utilizeze o adresă proaspătă pentru fiecare tranzacție nouă:

"_Ca un firewall suplimentar, un nou pereche de chei ar putea fi utilizată pentru fiecare tranzacție pentru a le împiedica să fie legate de un proprietar comun._"

![BTC204](assets/notext/34/02.webp)

Sursa: S. Nakamoto, "Bitcoin: A Peer-to-Peer Electronic Cash System", https://bitcoin.org/bitcoin.pdf, 2009.

De exemplu, iată o adresă reutilizată în mai multe tranzacții:

```plaintext
```bc1qqtmeu0eyvem9a85l3sghuhral8tk0ar7m4a0a0```

![BTC204](assets/notext/34/03.webp)

Sursa: [Mempool.space](https://mempool.space/address/bc1qqtmeu0eyvem9a85l3sghuhral8tk0ar7m4a0a0)

### Similaritatea Scripturilor și Amprentele Portofelelor

Dincolo de reutilizarea adreselor, există numeroase alte euristici care permit legarea acțiunilor la același portofel sau la un cluster de adrese.
În primul rând, un analist poate beneficia de similaritățile în utilizarea scripturilor. De exemplu, anumite scripturi minoritare precum multisig pot fi identificate mai ușor decât scripturile SegWit V0. Cu cât grupul în care ne ascundem este mai mare, cu atât este mai greu să fim observați. Acesta este motivul pentru care, în protocoalele bune de Coinjoin, toți participanții folosesc exact același tip de script.
Mai larg, un analist se poate concentra și pe amprentele caracteristice ale unui portofel. Acestea sunt procese specifice legate de o utilizare pe care cineva ar putea să încerce să le identifice cu scopul de a le exploata ca euristici de urmărire. Cu alte cuvinte, dacă se observă o acumulare a acelorași caracteristici interne pe tranzacțiile atribuite entității urmărite, se poate încerca identificarea acestor caracteristici și pe alte tranzacții.

De exemplu, se poate identifica că utilizatorul urmărit trimite sistematic restul către adrese P2TR (`bc1p…`). Dacă acest proces se repetă, poate fi folosit ca o euristică pentru continuarea analizei noastre. Alte amprente pot fi de asemenea folosite, cum ar fi ordinea UTXO-urilor, plasarea restului în output-uri, semnalizarea RBF (Replace-by-Fee), sau chiar, numărul versiunii, câmpul `nSequence` și câmpul `nLockTime`.

![BTC204](assets/en/34/04.webp)

Așa cum [@LaurentMT](https://twitter.com/LaurentMT) specifică în [Space Kek #19](https://podcasters.spotify.com/pod/show/decouvrebitcoin/episodes/SpaceKek-19---Analyse-de-chane--anonsets-et-entropie-e1vfuji) (un podcast francofon), utilitatea amprentelor portofelelor în analiza lanțului crește semnificativ în timp. Într-adevăr, numărul în creștere de tipuri de scripturi și desfășurarea tot mai treptată a acestor noi caracteristici de către software-urile portofelelor accentuează diferențele. Se poate chiar întâmpla ca cineva să identifice cu precizie software-ul folosit de entitatea urmărită. Prin urmare, este important să înțelegem că studiul amprentei unui portofel se dovedește a fi deosebit de relevant pentru tranzacțiile recente, mai mult decât pentru cele inițiate în primele decenii ale anilor 2010.

Pentru a rezuma, o amprentă poate fi orice practică specifică, efectuată automat de portofel sau manual de utilizator, care poate fi găsită pe alte tranzacții pentru a ne asista în analiza noastră.

### Euristica Proprietății Comune a Intrărilor (CIOH)

CIOH, pentru "Common Input Ownership Heuristic" în engleză, este o euristică care afirmă că atunci când o tranzacție include multiple intrări, acestea provin probabil toate de la o singură entitate. Prin urmare, proprietatea lor este comună.
Pentru a aplica Euristica de Proprietate Comună a Intrărilor (CIOH), observăm mai întâi o tranzacție care are multiple intrări. Aceasta ar putea avea cât de puțin 2 intrări sau până la 30 de intrări. Odată ce această caracteristică este identificată, verificăm dacă tranzacția nu se încadrează într-un model de tranzacție cunoscut. De exemplu, dacă are 5 intrări cu sume aproximativ egale și 5 ieșiri cu sume exact egale, știm că este structura unui coinjoin. Prin urmare, nu putem aplica CIOH.

Totuși, dacă tranzacția nu se încadrează în niciun model cunoscut de tranzacție colaborativă, atunci putem deduce că toate intrările provin probabil de la aceeași entitate. Acest lucru poate fi foarte util pentru extinderea unui cluster cunoscut sau pentru continuarea urmăririi.

CIOH a fost descoperit de Satoshi Nakamoto. El discută despre acesta în partea 10 a White Paper-ului:

"_[...] legătura este inevitabilă cu tranzacțiile cu multiple intrări, care dezvăluie în mod necesar că intrările lor au fost deținute de același proprietar. Riscul este că, dacă proprietarul unei chei este dezvăluit, legăturile pot dezvălui alte tranzacții care au aparținut aceluiași proprietar._"

Este deosebit de fascinant de observat că Satoshi Nakamoto, chiar înainte de lansarea oficială a Bitcoin, identificase deja cele două principale vulnerabilități în ceea ce privește confidențialitatea utilizatorilor, și anume CIOH și reutilizarea adreselor. O astfel de previziune este destul de remarcabilă, deoarece aceste două euristici rămân, chiar și astăzi, cele mai utile în analiza lanțului.

Pentru a vă da un exemplu, iată o tranzacție la care putem aplica probabil CIOH:

```plaintext
20618e63b6eed056263fa52a2282c8897ab2ee71604c7faccfe748e1a202d712
```

Sursa: [Mempool.space](https://mempool.space/tx/20618e63b6eed056263fa52a2282c8897ab2ee71604c7faccfe748e1a202d712)

### Date Offchain

Evident, analiza lanțului nu se limitează exclusiv la datele onchain. Orice date din analizele anterioare sau disponibile pe internet pot fi, de asemenea, utilizate pentru a rafina o analiză.
De exemplu, dacă se observă că tranzacțiile urmărite sunt transmise sistematic de la același nod Bitcoin și adresa sa IP poate fi identificată, ar putea fi posibil să se identifice alte tranzacții de la aceeași entitate, în plus față de determinarea unei părți a identității expeditorului. Deși această practică nu este ușor de realizat, deoarece necesită operarea multor noduri, este posibil ca unele companii specializate în analiza lanțului să o folosească.

Analistul are, de asemenea, opțiunea de a se baza pe analizele anterior făcute open-source, sau pe propriile analize anterioare. Poate că va găsi o ieșire care indică spre un cluster de adrese care fusese deja identificat. Uneori, este posibil să se bazeze și pe ieșiri care indică spre o platformă de schimb, adresele acestor companii fiind în general cunoscute.

În același mod, se poate efectua o analiză prin eliminare. De exemplu, dacă în timpul analizei unei tranzacții cu două ieșiri, una dintre ele este legată de un cluster de adrese deja cunoscut, dar distinct de entitatea urmărită, atunci se poate interpreta că cealaltă ieșire reprezintă probabil restul.

Analiza lanțului include și o parte de OSINT (*Open Source Intelligence*) care este un pic mai generalistă cu căutări pe internet. De aceea, se sfătuiește împotriva publicării adreselor de primire direct pe rețelele sociale sau pe un site web, fie sub un pseudonim sau nu.

![BTC204](assets/notext/34/10.webp)

### Modele Temporale
Este mai puțin cunoscut, dar anumite comportamente umane sunt recunoscibile în lanțul de blocuri. Cel mai util în analiză ar putea fi modelul tău de somn! Da, când dormi, presupunem că nu transmiți tranzacții Bitcoin. Deoarece, în general, dormi în aceleași ore, este comun să se utilizeze analize temporale în analiza lanțului. Aceasta implică pur și simplu catalogarea orelor la care tranzacțiile unei anumite entități sunt transmise în rețeaua Bitcoin. Analizând aceste modele temporale ne permite să deducem multe informații.

În primul rând, o analiză temporală uneori permite identificarea naturii entității urmărite. Dacă se observă că tranzacțiile sunt transmise constant pe parcursul a 24 de ore, atunci acest lucru va trăda o activitate economică puternică. Entitatea din spatele acestor tranzacții este probabil o companie, potențial internațională, și poate cu proceduri automate intern.

De exemplu, [am recunoscut acest model acum câteva luni](https://twitter.com/Loic_Pandul/status/1701127409712452072) analizând [tranzacția care alocase din greșeală 19 bitcoini în taxe](https://mempool.space/tx/d5392d474b4c436e1c9d1f4ff4be5f5f9bb0eb2e26b61d2781751474b7e870fd). O simplă analiză temporală mi-a permis să ipotezez că aveam de-a face cu un serviciu automatizat, și deci probabil o entitate mare precum o platformă de schimb.

Într-adevăr, câteva zile mai târziu, s-a descoperit că fondurile aparțineau PayPal, prin intermediul platformei de schimb Paxos.

Dimpotrivă, dacă vedem că modelul temporal este mai degrabă răspândit pe 16 ore foarte specifice, atunci putem estima că avem de-a face cu un utilizator individual, sau poate o afacere locală în funcție de volumele tranzacționate.

Dincolo de natura entității observate, modelul temporal poate oferi, de asemenea, o locație aproximativă a utilizatorului datorită fusurilor orare. Putem astfel lega alte tranzacții și folosi marca temporală a acestora ca o euristică suplimentară care poate fi adăugată la analiza noastră.

De exemplu, pe adresa reutilizată despre care am vorbit anterior, putem observa că tranzacțiile, fie că sunt de intrare sau de ieșire, sunt concentrate pe un interval de 13 ore.

```plaintext
bc1qqtmeu0eyvem9a85l3sghuhral8tk0ar7m4a0a0
```

![BTC204](assets/notext/34/11.webp)

Sursa: OXT.me

Acest interval corespunde probabil Europei, Africii sau Orientului Mijlociu. Putem deci infera că utilizatorul din spatele acestor tranzacții locuiește acolo.

Într-un registru diferit, este de asemenea o analiză temporală de acest tip care a permis ipoteza că Satoshi Nakamoto nu opera din Japonia, ci de fapt din Statele Unite: [*Fusurile Orare ale lui Satoshi Nakamoto*](https://medium.com/@insearchofsatoshi/the-time-zones-of-satoshi-nakamoto-aa40f035178f)

## Aplicație Practică cu un Explorator de Blocuri
<chapterId>6493cf2f-225c-405f-9375-c4304f1087ed</chapterId>

În acest capitol final, vom aplica concret conceptele pe care le-am studiat până acum. Vă voi prezenta exemple de tranzacții Bitcoin reale, și va trebui să extrageți informațiile pe care vi le cer.
Ideal, pentru aceste exerciții, utilizarea unui instrument profesionist de analiză a lanțurilor ar fi preferabilă. Totuși, deoarece creatorii portofelului Samourai au fost arestați, singurul instrument gratuit de analiză, OXT.me, nu mai este disponibil. Prin urmare, vom opta pentru un explorator clasic de blocuri pentru aceste exerciții. Recomand utilizarea [Mempool.space](https://mempool.space/) pentru numeroasele sale caracteristici și gama de instrumente de analiză a lanțurilor, dar puteți alege și un alt explorator, cum ar fi [Bitcoin Explorer](https://bitcoinexplorer.org/). Pentru început, voi prezenta exercițiile. Utilizați exploratorul de blocuri pentru a le completa și notați-vă răspunsurile pe o bucată de hârtie. Apoi, la sfârșitul acestui capitol, voi oferi răspunsurile pentru ca să vă puteți verifica și corecta rezultatele.

*Tranzacțiile selectate pentru aceste exerciții au fost alese exclusiv pentru caracteristicile lor într-o manieră oarecum aleatorie. Acest capitol este destinat exclusiv scopurilor educaționale și informative. Vreau să clarific că nu susțin sau încurajez utilizarea acestor instrumente în scopuri răuvoitoare. Scopul este să vă învăț cum să vă protejați împotriva analizei lanțurilor, nu să efectuați analize pentru a expune informații private ale altora.*

### Exercițiul 1

ID-ul tranzacției de analizat:

```plaintext
3769d3b124e47ef4ffb5b52d11df64b0a3f0b82bb10fd6b98c0fd5111789bef7
```

Care este numele modelului acestei tranzacții și ce interpretări plauzibile pot fi desprinse examinând doar modelul său, adică structura tranzacției?

### Exercițiul 2

ID-ul tranzacției de analizat:

```plaintext
baa228f6859ca63e6b8eea24ffad7e871713749d693ebd85343859173b8d5c20
```

Care este numele modelului acestei tranzacții și ce interpretări plauzibile pot fi desprinse examinând doar modelul său, adică structura tranzacției?

### Exercițiul 3

ID-ul tranzacției de analizat:

```plaintext
3a9eb9ccc3517cc25d1860924c66109262a4b68f4ed2d847f079b084da0cd32b
```

Care este modelul acestei tranzacții?

După identificarea modelului său, folosind euristicile interne ale tranzacției, care dintre ieșiri reprezintă probabil schimbul?

### Exercițiul 4

ID-ul tranzacției de analizat:

```plaintext
35f0b31c05503ebfdf7311df47f68a048e992e5cf4c97ec34aa2833cc0122a12
```

Care este modelul acestei tranzacții?
După identificarea modelului său, folosind euristicile interne ale tranzacției, care dintre ieșiri reprezintă probabil schimbul?
### Exercițiul 5

Imaginați-vă că Loïc a postat una dintre adresele sale de primire Bitcoin pe rețeaua socială Twitter:

![BTC204](assets/notext/35/1.webp)

```plaintext
bc1qja0hycrv7g9ww00jcqanhfpqmzx7luqalum3vu
```

Folosind **doar euristica reutilizării adresei**, ce tranzacții Bitcoin îi putem lega de identitatea lui Loïc?

*Evident, nu sunt proprietarul real al acestei adrese de primire și nu am postat-o pe rețele sociale. Este o adresă pe care am ales-o la întâmplare din blockchain.*

### Exercițiul 6

Urmând Exercițiul 5, datorită euristicii reutilizării adresei, ați reușit să identificați mai multe tranzacții Bitcoin în care Loïc pare să fie implicat. În mod normal, printre tranzacțiile identificate, ar trebui să fi observat aceasta:

```plaintext
Această tranzacție este prima care trimite fonduri către adresa lui Loïc. În opinia ta, de unde provin bitcoinii primiți de Loïc prin această tranzacție?

### Exercițiul 7

Urmând Exercițiul 5, datorită euristicilor de reutilizare a adresei, ai reușit să identifici mai multe tranzacții Bitcoin în care Loïc pare să fie implicat. Acum dorești să afli de unde este Loïc. Pe baza tranzacțiilor găsite, efectuează o analiză temporală pentru a găsi fusul orar probabil utilizat de Loïc. Din acest fus orar, determină o locație unde Loïc pare să locuiască (țară, stat/regiune, oraș...).

![BTC204](assets/notext/35/2.webp)

### Exercițiul 8

Iată tranzacția Bitcoin de studiat:

```plaintext
bb346dae645d09d32ed6eca1391d2ee97c57e11b4c31ae4325bcffdec40afd4f
```

Observând doar această tranzacție, ce informații putem interpreta?

### Soluții la exerciții

***Exercițiul 1:***
Modelul acestei tranzacții este acela al unui plată simplă. Dacă studiem doar structura sa, putem interpreta că unul dintre outputuri reprezintă restul și celălalt output reprezintă o plată efectivă. Prin urmare, știm că utilizatorul observat probabil nu mai deține unul dintre cele două UTXO-uri din outputuri (cel pentru plată), dar încă deține celălalt UTXO (cel pentru rest).

***Exercițiul 2:***
Modelul acestei tranzacții este acela al unei cheltuieli în lot. Acest model indică probabil o activitate economică semnificativă, cum ar fi o platformă de schimb, de exemplu. Putem deduce că UTXO-ul din input provine de la o companie cu activitate economică semnificativă și că UTXO-urile din outputuri se vor dispersa. Unele vor aparține clienților companiei care și-au retras bitcoinii în portofele de auto-custodie. Altele pot merge către companii partenere. În final, cu siguranță va exista un rest care se întoarce la compania emitentă.

***Exercițiul 3:***

Modelul acestei tranzacții este acela al unei plăți simple. Prin urmare, putem aplica euristici interne tranzacției pentru a încerca să identificăm restul.

Personal, am identificat cel puțin două euristici interne care susțin aceeași ipoteză:
- Reutilizarea aceluiași tip de script;
- Cel mai mare output.

Cea mai evidentă euristică este reutilizarea aceluiași tip de script. Într-adevăr, outputul `0` este un `P2SH`, recunoscut după adresa sa care începe cu `3`:

```plaintext
3Lcdauq6eqCWwQ3UzgNb4cu9bs88sz3mKD
```

În timp ce outputul `1` este un `P2WPKH`, identificabil după adresa sa care începe cu `bc1q`:

```plaintext
bc1qya6sw6sta0mfr698n9jpd3j3nrkltdtwvelywa
```

UTXO-ul utilizat în input pentru această tranzacție folosește de asemenea un script `P2WPKH`:

```plaintext
bc1qyfuytw8pcvg5vx37kkgwjspg73rpt56l5mx89k
```

Astfel, putem presupune că outputul `0` corespunde unei plăți și că outputul `1` este restul tranzacției, ceea ce ar însemna că utilizatorul din input deține încă outputul `1`.
Pentru a susține sau a infirma această ipoteză, putem căuta alte euristici care fie confirmă gândirea noastră, fie scad probabilitatea că ipoteza noastră este corectă.
Am identificat cel puțin o altă euristică. Este vorba despre cel mai mare output. Output-ul `0` măsoară `123,689 sats`, în timp ce output-ul `1` măsoară `505,839 sats`. Există, prin urmare, o diferență semnificativă între aceste două output-uri. Euristica celui mai mare output sugerează că output-ul cel mai voluminos este probabil restul. Această euristică întărește astfel ipoteza noastră inițială.

Se pare probabil că utilizatorul care a furnizat UTXO-ul la intrare deține încă output-ul `1`, care pare să reprezinte restul tranzacției.

***Exercițiul 4:***
Modelul acestei tranzacții este acela al unui plată simplă. Prin urmare, putem aplica euristici interne tranzacției pentru a încerca să identificăm restul.
Am identificat personal cel puțin două euristici interne care susțin aceeași ipoteză:
- Reutilizarea aceluiași tip de script;
- Output-ul unei sume rotunde.

Cea mai evidentă euristică este reutilizarea aceluiași tip de script. Într-adevăr, output-ul `0` este un `P2SH`, recunoscut după adresa sa care începe cu `3`:

```plaintext
3FSH5Mnq6S5FyQoKR9Yjakk3X4KCGxeaD4
```

În timp ce output-ul `1` este un `P2WPKH`, identificabil după adresa sa care începe cu `bc1q`:

```plaintext
bc1qvdywdcfsyavt4v8uxmmrdt6meu4vgeg439n7sg
```

UTXO-ul utilizat ca intrare pentru această tranzacție folosește de asemenea un script `P2WPKH`:

```plaintext
bc1qku3f2y294h3ks5eusv63dslcua2xnlzxx0k6kp
```

Astfel, putem presupune că output-ul `0` corespunde unei plăți și că output-ul `1` este restul tranzacției, ceea ce ar însemna că utilizatorul la intrare deține încă output-ul `1`.

Pentru a susține sau a infirma această ipoteză, putem căuta alte euristici care fie confirmă gândirea noastră, fie scad probabilitatea că ipoteza noastră este corectă.

Am identificat cel puțin o altă euristică. Este vorba despre output-ul unei sume rotunde. Output-ul `0` măsoară `70,000 sats`, în timp ce output-ul `1` măsoară `22,962 sats`. Prin urmare, suntem în prezența unui output perfect rotund în unitatea de cont BTC. Euristica output-ului rotund sugerează că UTXO-ul cu o sumă rotundă este probabil plata, și prin eliminare, celălalt reprezintă restul. Această euristică întărește astfel ipoteza noastră inițială.

Cu toate acestea, în acest exemplu, o altă euristică ar putea pune la îndoială ipoteza noastră inițială. Într-adevăr, output-ul `0` este mai mare decât output-ul `1`. Dacă ne bazăm pe euristica că cel mai mare output este în general restul, am putea deduce că output-ul `0` este restul. Cu toate acestea, această contra-ipoteză pare improbabilă, deoarece celelalte două euristici par substanțial mai convingătoare decât cea a celui mai mare output. Prin urmare, pare rezonabil să menținem ipoteza noastră inițială în ciuda acestei aparente contradicții.
Se pare deci probabil că utilizatorul care a furnizat UTXO-ul ca intrare deține încă output-ul `1`, care pare să reprezinte restul tranzacției.
***Exercițiul 5:***
Putem vedea că 8 tranzacții pot fi asociate cu identitatea lui Loïc. Printre acestea, 4 implică primirea de bitcoin:

```plaintext
***Exercițiul 6:***
Dacă examinăm modelul acestei tranzacții, este evident că este vorba despre o cheltuială grupată. Într-adevăr, tranzacția are un singur input și 51 de output-uri, ceea ce indică o activitate economică semnificativă. Prin urmare, putem ipotetiza că Loïc a efectuat o retragere de bitcoini de pe o platformă de schimb.

Mai multe elemente întăresc această ipoteză. În primul rând, tipul de script folosit pentru a securiza UTXO-ul la input este un script P2SH multisig 2/3, ceea ce indică un nivel avansat de securitate tipic platformelor de schimb:

```plaintext
OP_PUSHNUM_2
OP_PUSHBYTES_33 03eae02975918af86577e1d8a257773118fd6ceaf43f1a543a4a04a410e9af4a59
OP_PUSHBYTES_33 03ba37b6c04aaf7099edc389e22eeb5eae643ce0ab89ac5afa4fb934f575f24b4e
OP_PUSHBYTES_33 03d95ef2dc0749859929f3ed4aa5668c7a95baa47133d3abec25896411321d2d2d
OP_PUSHNUM_3
OP_CHECKMULTISIG
```
Mai mult, adresa analizată `3PUv9tQMSDCEPSMsYSopA5wDW86pwRFbNF` este reutilizată în mai mult de 220.000 de tranzacții diferite, ceea ce este adesea caracteristic platformelor de schimb, în general nepreocupate de confidențialitatea lor. Euristică temporală aplicată acestei adrese arată de asemenea o răspândire regulată a tranzacțiilor aproape zilnic pe o perioadă de 3 luni, cu ore extinse pe parcursul a 24 de ore, sugerând activitatea continuă a unei platforme de schimb.

În final, volumele procesate de această entitate sunt enorme. Într-adevăr, adresa a primit și a trimis 44 BTC în timpul a 222.262 tranzacții între decembrie 2022 și martie 2023. Aceste volume semnificative confirmă și mai mult natura probabilă a activității unei platforme de schimb.

***Exercițiul 7:***
Analizând timpurile de confirmare ale tranzacțiilor, se pot nota următoarele ore UTC:
```plaintext
05:43
20:51
18:12
17:16
04:28
23:38
07:45
21:55
```

Analizând aceste ore, se pare că fusurile orare UTC-7 și UTC-8 sunt consistente cu o gamă de activități umane comune (între 08:00 și 23:00) pentru majoritatea timpurilor:

```plaintext
05:43 UTC > 22:43 UTC-7
20:51 UTC > 13:51 UTC-7
18:12 UTC > 11:12 UTC-7
17:16 UTC > 10:16 UTC-7
04:28 UTC > 21:28 UTC-7
23:38 UTC > 16:38 UTC-7
07:45 UTC > 00:45 UTC-7
21:55 UTC > 14:55 UTC-7

05:43 UTC > 21:43 UTC-8
20:51 UTC > 12:51 UTC-8
18:12 UTC > 10:12 UTC-8
17:16 UTC > 09:16 UTC-8
04:28 UTC > 20:28 UTC-8
23:38 UTC > 15:38 UTC-8
07:45 UTC > 23:45 UTC-8
21:55 UTC > 13:55 UTC-8
```

![BTC204](assets/notext/35/2.webp)

Fusul orar UTC-7 este deosebit de relevant în vară, deoarece include state și regiuni precum:
- California (cu orașe precum Los Angeles, San Francisco și San Diego);
- Nevada (cu Las Vegas);
- Oregon (cu Portland);
- Washington (cu Seattle);
- Regiunea canadiană Columbia Britanică (cu orașe precum Vancouver și Victoria).

Aceste informații sugerează că Loïc ar putea locui plauzibil pe coasta de vest a Statelor Unite sau a Canadei.

***Exercițiul 8:***
Analiza acestei tranzacții dezvăluie 5 intrări și o singură ieșire, ceea ce pare să indice o consolidare. Aplicarea euristicului CIOH sugerează că toate UTXO-urile din intrări sunt deținute de o singură entitate, și că UTXO-ul din ieșire aparține de asemenea acestei entități. Se pare că utilizatorul a ales să consolideze mai multe UTXO-uri pe care le deținea într-un singur UTXO în ieșire, cu scopul de a-și consolida monedele. Această abordare a fost probabil motivată de dorința de a profita de taxele de tranzacție scăzute de la acel moment pentru a reduce taxele viitoare.
___

*Pentru redactarea acestei părți 3 privind analiza lanțului, m-am bazat pe următoarele resurse:*
- *Seria de patru articole numită: [Understanding Bitcoin Privacy with OXT](https://medium.com/oxt-research/understanding-bitcoin-privacy-with-oxt-part-1-4-8177a40a5923), produsă de Samourai Wallet în 2021;*
- *Diversele rapoarte de la [OXT Research](https://medium.com/oxt-research), precum și instrumentul lor gratuit de analiză a lanțului (care nu mai este disponibil în prezent în urma arestării fondatorilor Samourai Wallet);*
- *Mai larg, cunoștințele mele provin din diversele tweet-uri și conținut de la [@LaurentMT](https://twitter.com/LaurentMT) și [@ErgoBTC](https://twitter.com/ErgoBTC);*
- *The [Space Kek #19](https://podcasters.spotify.com/pod/show/decouvrebitcoin/episodes/SpaceKek-19---Analyse-de-chane--anonsets-et-entropie-e1vfuji) la care am participat alături de [@louneskmt](https://twitter.com/louneskmt), [@TheoPantamis](https://twitter.com/TheoPantamis), [@Sosthene___](https://twitter.com/Sosthene___), și [@LaurentMT](https://twitter.com/LaurentMT).*
*Aș dori să le mulțumesc autorilor, dezvoltatorilor și producătorilor. Mulțumiri și recenzorilor care au corectat meticulos articolul care a servit drept bază pentru această parte 3 și m-au onorat cu sfaturile lor experte:*
- *[Gilles Cadignan](https://twitter.com/gillesCadignan);*
- *[Ludovic Lars](https://viresinnumeris.fr/).*

# Stăpânirea celor mai bune practici pentru protejarea confidențialității tale
<partId>9bd04b63-f1af-4e50-9061-6bc90009df68</partId>


## Reutilizarea Adreselor
<chapterId>f3e97645-3df3-41bc-a4ed-d2c740113d96</chapterId>
După ce am studiat tehnicile care pot compromite confidențialitatea pe Bitcoin, în această a treia parte, vom examina acum cele mai bune practici de adoptat pentru a te proteja. Această parte nu are ca scop explorarea metodelor de îmbunătățire a confidențialității, un subiect care va fi abordat mai târziu, ci mai degrabă de a înțelege cum să interacționezi corect cu Bitcoin pentru a menține confidențialitatea pe care o oferă în mod natural, fără a recurge la tehnici suplimentare.
Evident, pentru a începe această a treia parte, vom vorbi despre reutilizarea adreselor. Acest fenomen constituie principala amenințare la adresa confidențialității utilizatorilor. Prin urmare, acest capitol este probabil cel mai important din întregul curs de formare.

### Ce este o adresă de primire?

O adresă de primire Bitcoin este un șir de caractere sau un identificator utilizat pentru a primi bitcoin într-un portofel.

Tehnic, o adresă de primire Bitcoin nu "primește" bitcoin în sensul literal, ci mai degrabă definește condițiile sub care bitcoinii pot fi cheltuiți. Mai precis, când ți se trimite o plată, tranzacția expeditorului creează un nou UTXO destinat ție în output din UTXO-urile pe care le-a consumat în inputs. Pe acest output, se aplică un script care definește cum acest UTXO poate fi cheltuit mai târziu. Acest script este cunoscut sub numele de "*ScriptPubKey*" sau "*Locking Script*". Adresa ta de primire, mai precis payload-ul său, este integrată în acest script. Pentru a simplifica, acest script stipulează în esență:

> "*Pentru a cheltui acest nou UTXO, trebuie furnizată o semnătură digitală folosind cheia privată asociată cu această adresă de primire.*"

![BTC204](assets/notext/41/01.webp)

Adresele Bitcoin vin în diferite tipuri, în funcție de modelul de script utilizat. Primele modele, cunoscute sub numele de "*Legacy*," includ adrese `P2PKH` (*Pay-to-PubKey-Hash*) și `P2SH` (*Pay-to-Script-Hash*). Adresele P2PKH încep întotdeauna cu `1` și P2SH cu `3`. Deși încă sunt sigure, aceste formate sunt acum învechite, deoarece rezultă în taxe de tranzacție mai mari și oferă mai puțină confidențialitate comparativ cu noile standarde.
Adresele SegWit V0 (`P2WPKH` și `P2WSH`) și Taproot / SegWit V1 (`P2TR`) reprezintă formatele moderne. Adresele SegWit încep cu `bc1q`, iar adresele Taproot, introduse în 2021, încep cu `bc1p`.
De exemplu, iată o adresă de primire Taproot:

```text
bc1ps5gd2ys8kllz9alpmcwxqegn7kl3elrpnnlegwkm3xpq2h8da07spxwtf5
```

Modul în care este construit ScriptPubKey va depinde de standardul pe care îl utilizați:
| Model Script    | ScriptPubKey                                                || ---------------- | ----------------------------------------------------------- |
| P2PKH           | OP_DUP OP_HASH160 `<pubKeyHash>` OP_EQUALVERIFY OP_CHECKSIG |
| P2SH            | OP_HASH160 `<scriptHash>` OP_EQUAL                          |
| P2WPKH          | 0 `<pubKeyHash>`                                            |
| P2WSH           | 0 `<witnessScriptHash>`                                     |
| P2SH - P2WPKH   | OP_HASH160 `<redeemScriptHash>` OP_EQUAL                    |
| P2SH - P2WSH    | OP_HASH160 `<redeemScriptHash>` OP_EQUAL                    |
| P2TR            | 1 `<pubKey>`                                                |

În ceea ce privește construcția adreselor de primire, aceasta depinde și de modelul de script ales:
- Pentru adresele `P2PKH` și `P2WPKH`, payload-ul, adică nucleul adresei, reprezintă hash-ul cheii publice;
- Pentru adresele `P2SH` și `P2WSH`, payload-ul reprezintă hash-ul unui script;
- În cazul adreselor `P2TR`, payload-ul este o cheie publică modificată. Ieșirile `P2TR` combină aspecte ale _Pay-to-PubKey_ și _Pay-to-Script_. Cheia publică modificată este rezultatul adăugării unei chei publice clasice de cheltuieli cu un "tweak", derivat din rădăcina Merkle a unui set de scripturi care pot fi folosite de asemenea pentru a cheltui bitcoins.

![BTC204](assets/en/67/01.webp)

Adresele afișate în software-ul portofelului dumneavoastră includ de asemenea o HRP (*Human-Readable Part*), tipic `bc` pentru adresele post-SegWit, un separator `1`, și un număr de versiune `q` pentru SegWit V0 și `p` pentru Taproot/SegWit V1. Se adaugă de asemenea un checksum pentru a asigura integritatea și validitatea adresei în timpul transmisiei.

În final, adresele sunt puse într-un format standard:
- Base58check pentru adresele Legacy vechi;
- Bech32 pentru adresele SegWit;
- Bech32m pentru adresele Taproot.

Iată matricea de adunare pentru formatele bech32 și bech32m (SegWit și Taproot) din baza 10:

| +   | 0   | 1   | 2   | 3   | 4   | 5   | 6   | 7   |
| --- | --- | --- | --- | --- | --- | --- | --- | --- |
| 0   | q   | p   | z   | r   | y   | 9   | x   | 8   |
| 8   | g   | f   | 2   | t   | v   | d   | w   | 0   |
| 16  | s   | 3   | j   | n   | 5   | 4   | k   | h   || 24  | c   | e   | 6   | m   | u   | a   | 7   | l   |
### Ce este Reutilizarea Adreselor?

Reutilizarea adreselor se referă la practica de a folosi aceeași adresă de primire pentru a bloca mai multe UTXO-uri diferite.

Așa cum am văzut în secțiunea anterioară, fiecare UTXO are propriul său ScriptPubKey care îl blochează și trebuie să fie satisfăcut pentru ca UTXO-ul să fie consumat ca intrare într-o nouă tranzacție. Este în acest ScriptPubKey că adresele de primire (payload) sunt integrate.

Când diferite ScriptPubKeys conțin aceeași adresă de primire, acest lucru este cunoscut ca reutilizarea adresei. În practică, acest lucru înseamnă că un utilizator a furnizat aceeași adresă de mai multe ori expeditorilor pentru a primi bitcoins prin mai multe plăți. Și într-adevăr, această practică este catastrofală pentru confidențialitatea ta.

### De ce este Reutilizarea Adreselor o Problemă?

Având în vedere că blockchain-ul este public, este ușor de văzut care adrese blochează care UTXO-uri și câți bitcoins. Dacă aceeași adresă este folosită pentru mai multe tranzacții, devine posibil să se deducă că toți bitcoins asociați cu acea adresă aparțin aceleiași persoane. Această practică compromite confidențialitatea utilizatorului permițând stabilirea de legături deterministe între diferite tranzacții și urmărirea bitcoins pe blockchain. Satoshi Nakamoto însuși a evidențiat această problemă în White Paper-ul Bitcoin:

> *Ca un firewall suplimentar, un nou pereche de chei ar putea fi folosită pentru fiecare tranzacție pentru a le împiedica să fie legate de un proprietar comun.*

![BTC204](assets/notext/34/02.webp)

Sursa: S. Nakamoto, "Bitcoin: A Peer-to-Peer Electronic Cash System", https://bitcoin.org/bitcoin.pdf, 2009.

Scopul urmărit de Satoshi în această declarație era de a crea un firewall suplimentar în cazul asocierii dintre identitatea utilizatorului și un pereche de chei pe Bitcoin, pentru a evita ca toată activitatea lor să fie public legată de identitatea lor. Astăzi, cu proliferarea companiilor de analiză a lanțului și reglementările KYC, utilizarea adreselor unice nu mai este un "firewall suplimentar", ci o practică necesară pentru oricine dorește să-și păstreze confidențialitatea la un minim.

Când reutilizezi o adresă, faci o legătură aproape indubitabilă între toate tranzacțiile asociate cu acea adresă. Deși acest lucru nu pune direct în pericol fondurile tale, deoarece criptografia pe curbe eliptice asigură securitatea cheilor tale private, facilitează monitorizarea activităților tale. Într-adevăr, oricine cu un nod poate observa tranzacțiile și soldurile adreselor, compromițând complet anonimatul tău.

![BTC204](assets/en/34/01.webp)
Pentru a ilustra acest punct, să luăm exemplul lui Bob, un utilizator care cumpără regulat bitcoins în sume mici prin DCA (Dollar Cost Averaging) și le trimite întotdeauna la aceeași adresă. După doi ani, această adresă conține o sumă substanțială de bitcoins. Dacă Bob folosește această adresă pentru a face o plată unui comerciant local, acesta din urmă ar putea vedea toate fondurile asociate și ar putea deduce bogăția lui Bob. Acest lucru ar putea duce la riscuri de securitate personală, inclusiv încercări de furt sau extorcare. Dacă Bob ar fi folosit o adresă proaspătă pentru a primi fiecare achiziție periodică, ar fi dezvăluit infinit mai puține informații comerciantului său.

În analiza lanțului, diferențiem între 2 tipuri de reutilizare a adreselor:
- Reutilizare externă;
- Reutilizare internă în cadrul unei tranzacții.

Prima este observată când o adresă este reutilizată în mai multe tranzacții Bitcoin diferite. Acesta este ceea ce am discutat mai devreme: această euristică ne permite să deducem că toate UTXO-urile care au trecut prin această adresă aparțin unei singure entități.
Reutilizarea internă a adreselor este observată nu atunci când reutilizarea are loc între mai multe tranzacții, ci când se întâmplă în cadrul aceleiași tranzacții. Într-adevăr, dacă aceeași adresă care a fost folosită pentru a bloca o intrare este utilizată ca o ieșire într-o tranzacție, atunci putem deduce că această ieșire încă aparține aceluiași utilizator (rest), și că a doua ieșire reprezintă plata efectivă. Această altă euristică permite urmărirea fondurilor pe parcursul mai multor tranzacții.
![BTC204](assets/en/33/02.webp)

Reutilizarea adreselor este un adevărat flagel pentru Bitcoin. Conform site-ului OXT.me (momentan inaccesibil), rata generală a reutilizării adreselor pe Bitcoin era de aproximativ 52% în 2022:

![BTC204](assets/notext/41/02.webp)

Această rată este enormă, dar provine în mare parte de la platformele de schimb, și nu de la utilizatorii individuali.

### Cum să eviți reutilizarea adreselor?

Evitarea reutilizării adreselor este destul de simplă: **folosește pur și simplu o adresă nouă, proaspătă pentru fiecare nouă plată primită în portofelul tău**.

Mulțumită BIP32, portofelele moderne sunt acum deterministe și ierarhice. Asta înseamnă că un utilizator poate genera un număr mare de adrese dintr-o singură informație inițială: seed-ul. Salvând această singură informație, este posibil să restaurezi toate cheile private ale portofelului, accesând astfel fondurile securizate de adresele corespunzătoare.

![BTC204](assets/notext/41/03.webp)
Acesta este motivul pentru care, când apeși butonul "*primește*" în software-ul portofelului tău, ți se oferă de fiecare dată o adresă de primire neutilizată. După ce primești bitcoin pe această adresă, software-ul sugerează automat una nouă.
> *PS: Recent, unele software-uri de portofel au anunțat intenția de a înceta generarea de adrese goale, temându-se că acest lucru ar putea fi perceput ca o formă de spălare a banilor de către autorități. Dacă software-ul tău se numără printre acestea, îți recomand cu tărie să-l înlocuiești imediat, deoarece acest lucru nu este acceptabil pentru utilizator.*

Dacă ai nevoie de un identificator static pentru a primi plăți, cum ar fi pentru a primi donații, de exemplu, se sfătuiește să nu folosești o adresă Bitcoin clasică din cauza riscului de reutilizare. Preferă utilizarea unei adrese Lightning, sau pentru un identificator de plată onchain static, poți opta pentru BIP47 sau Plăți Silențioase. Funcționarea acestor protocoale este detaliată în partea 6 a acestui curs de formare.

## Etichetarea și Controlul Monedelor
<chapterId>fbdb07cd-c025-48f2-97b0-bd1bc21c68a8</chapterId>

Așa cum am descoperit în partea despre analiza lanțului, există o multitudine de euristici și modele care pot fi folosite pentru a infera informații despre o tranzacție. Ca utilizator, este important să fii conștient de aceste tehnici pentru a te proteja mai bine.

Acest lucru implică, în mod notabil, o gestionare riguroasă a portofelului tău de auto-custodie, care include cunoașterea originii UTXO-urilor tale, precum și o selecție gândită a UTXO-urilor de consumat în timpul plăților. Această gestionare eficientă a portofelului se bazează pe două caracteristici importante ale unor bune portofele Bitcoin: etichetarea și controlul monedelor.

În acest capitol, vom studia aceste caracteristici și vom vedea cum ai putea să le folosești inteligent, fără a adăuga prea multă muncă, pentru a-ți optimiza în mare măsură confidențialitatea pe Bitcoin.

### Ce este Etichetarea?

Etichetarea este o practică care implică atribuirea unei adnotări sau a unei etichete unui UTXO specific într-un portofel Bitcoin. Aceste adnotări sunt stocate local de software-ul portofelului și nu sunt niciodată transmise prin rețeaua Bitcoin. Astfel, etichetarea este un instrument pentru gestionarea personală.

De exemplu, dacă dețin un UTXO dintr-o achiziție P2P pe Bisq cu Charles, i-aș putea atribui eticheta "`Non-KYC Bisq Charles`".
Etichetarea este o practică bună care ajută la amintirea originii sau destinației intenționate a unui UTXO, facilitând astfel gestionarea fondurilor și optimizând confidențialitatea. Într-adevăr, portofelul tău Bitcoin probabil securizează mai multe UTXO-uri. Dacă sursele acestor UTXO-uri sunt diferite, s-ar putea să nu dorești să le combini în viitor, altfel, ai putea dezvălui proprietatea comună a acestora. Etichetând corespunzător toate monedele tale, te asiguri că îți vei aminti originea lor atunci când trebuie să le folosești, chiar dacă acest lucru se va întâmpla doar peste câțiva ani.

### Ce este controlul monedelor?

Utilizarea activă a etichetării devine și mai interesantă atunci când este combinată cu o opțiune de control al monedelor în software-ul tău de portofel.

Controlul monedelor este o caracteristică prezentă în software-ul bun de portofel Bitcoin, care îți oferă capacitatea de a selecta manual UTXO-uri specifice pentru a le folosi ca intrări pentru a efectua o tranzacție. Într-adevăr, pentru a satisface un plată în ieșire, este necesar să consumi un UTXO în intrare în schimb. Din mai multe motive pe care le vom vedea mai târziu, s-ar putea să dorești să alegi precis care monede să consumi în intrări pentru a satisface o plată dată. Exact acest lucru îți permite să faci controlul monedelor. Pentru a-ți oferi o analogie, această caracteristică este similară cu acțiunea de a alege o monedă specifică din portofelul tău atunci când plătești pentru bagheta ta.

![BTC204](assets/notext/42/01.webp)

Utilizarea software-ului de portofel cu control al monedelor, împreună cu etichetarea UTXO-urilor, permite utilizatorilor să distingă și să selecteze precis UTXO-urile pentru tranzacțiile lor.

### Cum să etichetezi corect UTXO-urile tale?

Nu există o metodă universală de etichetare a UTXO-urilor care să se potrivească tuturor. Ține de tine să definești un sistem de etichetare astfel încât să poți găsi ușor calea în jurul portofelului tău. În orice caz, ține minte că o bună etichetare este aceea pe care vei putea să o înțelegi atunci când ai nevoie de ea. Dacă portofelul tău Bitcoin este destinat în principal economiilor, este posibil ca etichetele să fie utile doar peste câteva decenii. Prin urmare, asigură-te că sunt clare, precise și cuprinzătoare.

Este important ca cei dragi să poată identifica ușor originea fondurilor dacă, într-o zi, vor avea nevoie să acceseze portofelul tău. Acest lucru i-ar putea ajuta din motive de confidențialitate, precum și pentru necesități legale, în cazul în care ar trebui să justifice proveniența fondurilor în fața unei autorități.
Aspectul cel mai important al etichetării este să notezi sursa UTXO-ului. Ar trebui să indici pur și simplu cum a ajuns această monedă în portofelul tău. Este dintr-o achiziție pe o platformă de schimb? Un plată de la un client? Un schimb peer-to-peer? Sau este restul de la o achiziție? Astfel, ai putea specifica:
- `Retragere Exchange.com`;
- `Plată Client David`;
- `Achiziție P2P Charles`;
- `Rest de la achiziția de canapea`

![BTC204](assets/en/42/02.webp)

Pentru a-ți rafina gestionarea UTXO-urilor și a adera la strategiile tale de segregare a fondurilor în cadrul portofelului tău, ai putea îmbogăți etichetele tale cu un indicator suplimentar care reflectă aceste separări. Dacă portofelul tău conține două categorii de UTXO-uri pe care nu dorești să le amesteci, ai putea integra un marker în etichetele tale pentru a distinge clar aceste grupuri. Acești markeri de separare vor depinde de criteriile tale proprii, cum ar fi distincția între UTXO-urile dintr-un proces de achiziție care implică KYC, sau între fondurile profesionale și personale. Luând exemplele de etichete menționate anterior, acest lucru s-ar putea traduce în:
- `KYC - Retragere Exchange.com`;
- `KYC - Plată Client David`;
- `FĂRĂ KYC - Achiziție P2P Charles`;
- `FĂRĂ KYC - Rest de la achiziția de canapea`

![BTC204](assets/en/42/03.webp)
Este de asemenea recomandabil să perpetuați etichetarea unei monede de-a lungul tranzacțiilor. De exemplu, când consolidați UTXO-uri fără KYC, asigurați-vă că marcați UTXO-ul rezultat nu doar ca `consolidare`, ci specific ca `consolidare fără KYC` pentru a menține o urmă clară a originii monedei.
În final, nu este obligatoriu să puneți o dată pe o etichetă. Majoritatea software-urilor pentru portofele afișează deja data tranzacției, și este întotdeauna posibil să recuperați această informație pe un explorator de blocuri folosind TXID-ul său.

### Cum să Vă Alegeți Monedele Corect?

Când faceți o tranzacție, controlul monedelor vă permite să alegeți specific care UTXO-uri să consumați ca intrări pentru a satisface ieșirea plății. Două aspecte ar trebui luate în considerare în această alegere:
- Posibilitatea ca destinatarul plății să lege o parte din identitatea dvs. de UTXO-urile folosite ca intrări;
- Capacitatea unui observator extern de a stabili legături între toate UTXO-urile consumate ca intrări.
Pentru a ilustra primul punct, să luăm un exemplu concret. Să presupunem că cumpărați o baghetă cu bitcoin de la brutarul local. Folosiți unul sau mai multe UTXO-uri pe care le dețineți ca intrări pentru a acoperi cel puțin prețul baghetei în ieșiri, precum și taxele de tranzacție. Brutarul dvs. ar putea atunci să asocieze potențial fața dvs., sau orice altă parte a identității dvs. pe care o cunoaște, cu monedele folosite ca intrări. Cunoscând existența acestei legături, ați putea prefera să alegeți un UTXO specific în locul altuia atunci când faceți plata.
![BTC204](assets/notext/42/04.webp)

De exemplu, dacă unul dintre UTXO-urile dvs. provine de pe o platformă de schimb și preferați ca brutarul să nu fie conștient de contul dvs. pe această platformă, ați evita să folosiți acest UTXO pentru plată. Dacă dețineți un UTXO de mare valoare care dezvăluie o sumă semnificativă de bitcoin, ați putea alege, de asemenea, să nu-l folosiți pentru a preveni ca brutarul să afle despre averea dvs. în BTC.

Alegerea UTXO-urilor de folosit pentru acest prim punct se bazează deci pe o decizie personală, influențată de ceea ce sunteți dispus să dezvăluiți sau nu. Etichetele pe care le-ați atribuit UTXO-urilor dvs. la primirea lor vă vor ajuta să selectați acele care, odată cheltuite, expun doar informațiile cu care vă simțiți confortabil să le dezvăluiți destinatarului.

Dincolo de informațiile potențial dezvăluite destinatarului, alegerea intrărilor influențează, de asemenea, ce dezvăluiți tuturor observatorilor blockchain-ului. Într-adevăr, folosind multiple UTXO-uri ca intrări pentru tranzacția dvs., dezvăluiți că acestea sunt deținute de aceeași entitate, conform Euristicăi de Proprietate Comună a Intrărilor (CIOH).

![BTC204](assets/notext/42/05.webp)

Când selectați monedele dvs., trebuie deci să fiți conștient că tranzacția pe care sunteți pe cale să o transmiteți va crea o legătură între toate UTXO-urile folosite. Această legătură poate fi problematică pentru intimitatea dvs. personală, mai ales dacă UTXO-urile provin din surse diferite.

![BTC204](assets/notext/42/06.webp)

Să ne întoarcem la exemplul meu cu UTXO fără KYC de pe Bisq; vreau să evit combinarea acestuia cu un UTXO de pe, să zicem, o platformă de schimb reglementată care îmi cunoaște identitatea. Într-adevăr, dacă vreodată folosesc aceste 2 UTXO-uri ca intrări în aceeași tranzacție, platforma reglementată va putea să lege identitatea mea cu UTXO-ul pe care l-am cumpărat pe Bisq, deși nu era legat de identitatea mea înainte.

![BTC204](assets/notext/42/07.webp)
În final, pentru a alege corect care UTXO-uri să fie consumate ca intrări pentru o tranzacție, cel mai important lucru este să eviți utilizarea mai multor UTXO-uri. Ori de câte ori este posibil, selectează o singură monedă care este suficient de mare pentru a acoperi plata ta. Făcând acest lucru, eviți complet riscurile asociate cu COINJOIN. Totuși, dacă niciun UTXO individual nu este suficient pentru plată și trebuie să consumi mai multe, asigură-te că provin din surse similare pentru a minimiza riscurile legăturilor nedorite. De asemenea, ține minte că destinatarul ar putea asocia informațiile pe care le are despre tine cu istoricul monedelor folosite ca intrări.

### Înțelegerea Selecției Automate a Monedelor

În secțiunile anterioare, am discutat despre selecția manuală a UTXO-urilor pentru o tranzacție. Dar ce se întâmplă când software-ul portofelului face această selecție automat? Există mai multe metode pentru determinarea monedelor de consumat, iar selecția UTXO-urilor este un domeniu real de cercetare în Bitcoin. Scopul principal al acestui proces automat este adesea de a minimiza taxele de tranzacție pentru utilizator.

Metode de selecție UTXO cum ar fi FIFO (*First In First Out*) și LIFO (*Last In First Out*) se numără printre cele mai simple, dar și cele mai puțin eficiente. Cu FIFO, cele mai vechi monede din portofel sunt folosite prima dată. Această abordare este în general ineficientă atât pentru minimizarea taxelor de tranzacție, cât și pentru păstrarea confidențialității, exceptând cazurile în care sunt folosite timelock-uri relative care trebuie reînnoite regulat. Pe de altă parte, LIFO prioritizează utilizarea UTXO-urilor cele mai recente. Deși simple, aceste două metode se dovedesc adesea a fi ineficiente.

O metodă mai avansată este *Knapsack Solver*. Aceasta a fost metoda folosită în portofelul Bitcoin Core până la versiunea 0.17. Implică selectarea iterativă și aleatorie a UTXO-urilor din portofel, adăugându-le în subgrupuri și păstrând soluția care reduce greutatea tranzacției cât mai mult posibil, pentru a reduce taxele pentru utilizator.
*Branch-and-Bound* (BNB), adesea poreclit "algoritmul Murch" în referire la inventatorul său, a înlocuit *Knapsack Solver* în Bitcoin Core începând cu versiunea 0.17. Această metodă mai avansată își propune să găsească un set de UTXO-uri care se potrivește exact cu suma necesară pentru a satisface ieșirile unei tranzacții. Scopul BNB este de a minimiza cantitatea de rest, precum și taxele, reducând ceea ce se numește criteriul de risipă care ia în considerare atât costurile imediate, cât și costurile viitoare așteptate pentru rest. Această metodă derivă din conceptul original de *Branch-and-Bound*, conceput în 1960 de Ailsa Land și Alison Harcourt, și oferă o optimizare mai precisă a taxelor comparativ cu *Knapsack Solver*.
Toate aceste metode de selecție automată a UTXO-urilor pot fi eficiente în reducerea taxelor de tranzacție, dar sunt adesea ineficiente în păstrarea confidențialității utilizatorului. Într-adevăr, aceste algoritmi pot combina mai multe UTXO-uri în intrări, dezvăluind astfel o proprietate comună a acestor UTXO-uri din cauza COH. Evident, aceste metode nu pot lua în considerare etichetele atașate UTXO-urilor, care sunt cruciale pentru alegerea conștientă a monedelor de dezvăluit destinatarului tranzacției. În prezent, singura soluție pentru optimizarea confidențialității la selectarea monedelor este să o faci manual.

### Tutorial despre Etichetarea UTXO

Dacă vrei să înveți cum să îți etichetezi UTXO-urile, am creat un tutorial complet despre principalele software-uri de portofel Bitcoin existente:

https://planb.network/tutorials/privacy/utxo-labelling

## KYC și Identificarea Cheii
<chapterId>cec6b9d9-0eed-4f85-bc4e-1e9aa59ca605</chapterId>
KYC este acronimul pentru "Know Your Customer" (Cunoaște-ți Clientul), care reprezintă o procedură de reglementare implementată de unele companii care operează în sectorul Bitcoin. Această procedură are ca scop verificarea și înregistrarea identității clienților lor cu obiectivul declarat de a combate spălarea banilor și finanțarea terorismului.
Concret, KYC implică colectarea diverselor date personale de la client, care pot varia în funcție de jurisdicții, dar include în general un document de identitate, o fotografie și o dovadă a rezidenței. Aceste informații sunt apoi verificate și păstrate pentru utilizare viitoare.

Această procedură a devenit obligatorie pentru toate platformele de schimb reglementate în majoritatea țărilor occidentale. Acest lucru înseamnă că oricine dorește să schimbe valute fiat pentru bitcoin prin aceste platforme trebuie să respecte cerințele KYC.
Această procedură nu este fără riscuri pentru confidențialitatea și securitatea utilizatorilor. În acest capitol, vom examina aceste riscuri în detaliu și vom analiza impacturile specifice ale KYC și proceselor de identificare asupra confidențialității utilizatorilor Bitcoin.
### Facilitarea Urmăririi Onchain

Primul risc asociat cu KYC este că oferă un punct de intrare privilegiat pentru analiza lanțului. Așa cum am văzut în partea anterioară, analiștii pot grupa și urmări activitățile pe blockchain folosind modele de tranzacții și euristici. Odată ce au reușit să clustereze activitatea onchain a unui utilizator, găsirea doar a unui punct de intrare printre toate tranzacțiile și cheile lor este suficientă pentru a compromite complet confidențialitatea acestuia.

![BTC204](assets/notext/43/1.webp)

Când te supui KYC, oferi un punct de intrare de foarte bună calitate pentru analiza lanțului, deoarece leagă adresele tale de primire utilizate atunci când îți retragi bitcoinii de pe o platformă de schimb de identitatea ta completă și verificată. În teorie, aceste informații sunt cunoscute doar de compania căreia i le-ai furnizat, dar, așa cum vom vedea mai târziu, riscul scurgerii de date este real. Mai mult, simplul fapt că o companie deține aceste informații poate fi problematic, chiar dacă nu le împărtășește.

Astfel, dacă nu iei alte măsuri pentru a limita gruparea activităților tale pe blockchain, oricine este conștient de acest punct de intrare care este KYC poate potențial să lege toată activitatea ta pe Bitcoin de identitatea ta. Din perspectiva acestei companii, utilizarea ta a Bitcoinului își pierde astfel toată confidențialitatea.

![BTC204](assets/notext/43/2.webp)

Pentru a ilustra acest lucru printr-o comparație, este ca și cum banca ta de la *Banca X* ar avea acces nu doar la toate tranzacțiile tale efectuate cu *Banca X*, dar ar putea observa și tranzacțiile tale cu *Banca Y* și toate tranzacțiile tale în numerar.

Amintește-ți din prima parte a acestui curs: modelul de confidențialitate al Bitcoinului, așa cum a fost conceput de Satoshi Nakamoto, se bazează pe separarea între identitatea utilizatorului și perechile sale de chei. Deși acest strat de confidențialitate nu mai este suficient astăzi, este totuși înțelept să limitezi cât mai mult posibil degradarea sa.

### Expunerea la Supravegherea Statului

A doua problemă majoră cu KYC este că dezvăluie statului că ai deținut bitcoin la un moment dat. Când cumperi bitcoin prin intermediul unui actor reglementat, devine posibil pentru stat să afle despre această posesiune. În prezent, acest lucru poate părea trivial, dar este important să ne amintim că viitorul politic și economic al țării tale nu este în mâinile tale.
În primul rând, statul poate adopta rapid o poziție autoritară. Istoria este plină de exemple în care politicile s-au schimbat brusc. Astăzi, în Europa, entuziaștii Bitcoin pot scrie articole despre Bitcoin, pot participa la conferințe și își pot gestiona portofelele în auto-custodie. Dar cine poate spune ce ne rezervă mâine? Dacă Bitcoin ar deveni brusc inamicul public numărul unu, asocierea cu acesta în înregistrările statului ar putea fi problematică.
În continuare, în fața unor crize economice severe, statul ar putea lua în considerare confiscarea bitcoinilor deținuți de cetățeni. Poate că mâine, Bitcoinerii vor fi văzuți ca profitori ai crizei și vor fi taxati excesiv datorită câștigurilor lor de capital în fața devalorizării monedei fiat.
Ai putea crede că acest lucru nu este o problemă pentru că bitcoinii tăi sunt amestecați și, prin urmare, imposibil de urmărit. Totuși, urmărirea nu este problema aici. Problema reală este că statul știe că ai deținut bitcoin. Această simplă informație ar putea fi suficientă pentru a te incrimina sau pentru a solicita un cont. Ai putea încerca să afirmi că ți-ai cheltuit bitcoinii, dar acest lucru ar trebui să se reflecte în declarația ta fiscală, și ai fi prins. Ai putea de asemenea să spui că ți-ai pierdut cheile într-un accident de barcă, dar dincolo de gluma de pe Twitter, crezi cu adevărat că asta ar fi suficient pentru a te exonera?

Prin urmare, este important să iei în considerare riscul asociat cu simplul fapt că statul ar putea ști că ai deținut BTC, chiar dacă acest risc poate părea îndepărtat astăzi.

O altă problemă prezentată de KYC în termeni de supraveghere de stat este raportarea obligatorie de către platformele reglementate. Deși nu sunt familiarizat cu reglementările din alte jurisdicții, în Franța, *Furnizorii de Servicii pentru Active Digitale* (PSAN) sunt obligați să raporteze autorităților de supraveghere financiară orice mișcare de fonduri pe care o consideră suspectă.

Astfel, în Franța în 2023, 1.449 de acte suspecte au fost raportate de către PSAN-uri. Pentru moment, majoritatea acestor acte sunt legate de criminalitate. Totuși, autoritățile solicită de asemenea platformelor reglementate să raporteze orice tranzacție Bitcoin suspectă bazată exclusiv pe structura sa. Dacă efectuezi o tranzacție colaborativă, sau chiar doar o tranzacție care prezintă un model oarecum atipic, și această tranzacție are loc aproape de retragerea bitcoinilor tăi de pe aceste platforme, te-ai putea găsi raportat autorităților. Chiar și în absența unei fapte reprobabile și în exercitarea legitimă a drepturilor tale, acest raport poate duce la verificări și supravegheri crescute, inconveniente pe care le-ai fi evitat fără KYC.

### Riscul scurgerii datelor personale
O altă problemă cu KYC stă în faptul că necesită stocarea tuturor datelor tale personale pe serverele unei companii private. Evenimentele recente ne-au reamintit că nimeni nu este imun la eșecuri, fie că sunt financiare sau legate de IT. În 2022, clienții Celsius au suferit consecințele. Urmând falimentul companiei, numele creditorilor și suma activelor lor au fost făcute publice de sistemul de justiție american în timpul procedurii administrative.

Cu puțin peste doi ani în urmă, o entitate de frunte în domeniul securității cibernetice în domeniul criptomonedelor a experimentat furtul datelor personale ale clienților săi. Deși acest incident nu a fost direct legat de achiziția de bitcoini, un astfel de risc rămâne și pentru platformele de schimb. Prin urmare, există un risc definit asociat cu aceste date personale.

Este adevărat că deja încredințăm o mulțime de datele noastre personale companiilor private. Totuși, riscul aici este dublu deoarece aceste date nu doar că te permit să fii identificat, dar sunt și legate de o activitate pe Bitcoin. Într-adevăr, când un hacker reușește să acceseze datele clienților unei platforme de schimb, pot presupune în mod rezonabil că acești clienți dețin bitcoini. Acest risc este astfel amplificat de faptul că bitcoinul, ca orice alt activ valoros, atrage interesul hoților.

În cazul unei scurgeri de date, în cel mai bun caz, ai putea fi ținta unor încercări de phishing țintite. În cel mai rău caz, ai putea te găsești în centrul amenințărilor fizice la adresa casei tale.
Pe lângă riscurile specifice legate de Bitcoin, este necesar să se ia în considerare și pericolele asociate cu transmiterea documentelor de identitate. Într-adevăr, în cazul unei scurgeri de date, este posibil să devii victimă a furtului de identitate. Astfel, mizele nu se limitează doar la protecția confidențialității tranzacțiilor, ci privesc și siguranța personală a fiecărui individ.

### Concepute greșite comune despre KYC

Este important să demontăm unele concepții greșite despre KYC care sunt frecvent întâlnite pe Twitter sau în discuțiile noastre printre bitcoineri.
În primul rând, este incorect să crezi că protejarea intimității pentru bitcoinii achiziționați prin KYC (Know Your Customer) este inutilă. Instrumentele și metodele pentru intimitate pe Bitcoin sunt variate și servesc scopuri diferite. Utilizarea tranzacțiilor coinjoin pentru bitcoinii proveniți din KYC, de exemplu, nu este o idee rea. Desigur, este necesar să fii precaut cu platformele de schimb reglementate pentru a evita înghețarea sau interzicerea contului tău, dar dintr-un punct de vedere strict tehnic, aceste practici nu sunt incompatibile. Coinjoin are efectul de a rupe istoricul unei monede, ceea ce te ajută să contracarezi unele dintre riscurile de analiză a lanțului asociate cu KYC. Deși nu elimină toate riscurile, reprezintă deja un beneficiu semnificativ.

Intimitatea pe Bitcoin nu ar trebui văzută într-o manieră binară, ca o distincție între bitcoinii "anonimi" și ceilalți care nu sunt. Deținerea de bitcoinii achiziționați prin KYC nu înseamnă că totul este pierdut; dimpotrivă, utilizarea instrumentelor de intimitate se poate dovedi a fi și mai benefică.

Pe de altă parte, achiziționarea de bitcoin prin metode non-KYC nu garantează o intimitate perfectă și nu te exonerează de necesitatea de a lua alte măsuri de protecție. Dacă deții bitcoin non-KYC, dar reutilizezi adresele de primire de mai multe ori, tranzacțiile tale pot fi urmărite și grupate. Cea mai mică legătură cu lumea din afara Bitcoinului ar putea compromite singurul strat de intimitate pe care îl aveai. Prin urmare, este important să consideri toate instrumentele și metodele care îmbunătățesc intimitatea pe Bitcoin ca fiind complementare. Fiecare tehnică abordează un risc specific și poate adăuga un strat suplimentar de protecție. Astfel, deținerea de bitcoin non-KYC absolut nu te exonerează de a lua alte precauții.

### Poate fi KYC anulat?

Mi se întreabă uneori dacă este posibil să "te întorci" după ce ai completat KYC, și după cum îți poți imagina din paragrafele anterioare, răspunsul este nuanțat. Pentru a evita riscurile asociate cu KYC, metoda cea mai simplă este să nu îl folosești atunci când achiziționezi bitcoinii. Vom aprofunda acest subiect în capitolul următor. Totuși, dacă KYC a fost deja efectuat și au fost achiziționați bitcoini, există modalități de a atenua riscurile suportate?

În ceea ce privește riscul de urmăribilitate a tranzacțiilor tale, utilizarea coinjoin este o soluție. Vom discuta această metodă în detaliu mai târziu în curs, dar fii conștient că coinjoin poate rupe istoricul unei monede și împiedica urmărirea sa din trecut-prezent și prezent-trecut. Chiar și pentru BTC obținut prin intermediul unei platforme reglementate, această tehnică poate preveni urmăribilitatea lor.
Cu toate acestea, coinjoin nu elimină al doilea risc asociat cu KYC: faptul că statul este informat despre deținerile tale de bitcoin. Într-adevăr, chiar dacă monedele tale nu mai sunt urmăribile, statul, în funcție de jurisdicție, poate avea acces la declarațiile tale privind dispozițiile de active cripto. Deoarece acest risc nu este tehnic, ci administrativ, nu există soluții specifice Bitcoin pentru a-l elimina, altfel decât să nu te expui inițial KYC-ului. Singura abordare legală pentru a atenua acest risc este să vinzi bitcoinii achiziționați prin platforme reglementate pe platforme reglementate și apoi să-i răscumperi prin mijloace fără KYC. Prin vânzarea și declararea dispoziției, administrația ar trebui să observe că nu le mai deții.

În ceea ce privește riscul scurgerii datelor personale și a documentelor de identitate, acesta este un pericol extern față de Bitcoin, și nu există o soluție tehnică pentru a-l evita. Odată ce datele tale sunt dezvăluite, este dificil să inversezi această operațiune. Poți încerca să-ți închizi contul pe platformă, dar acest lucru nu garantează ștergerea datelor tale KYC, mai ales când verificarea identității este externalizată. Verificarea ștergerii complete a informațiilor tale este imposibilă. Prin urmare, nu există o soluție pentru a preveni complet acest risc și a asigura că nu mai există.

### Diferența dintre KYC și identificarea cheii

Uneori, unii bitcoineri tind să extindă termenul "KYC" la orice schimb BTC care implică un transfer sau o plată cu cardul de credit, deoarece aceste mijloace pot dezvălui de asemenea originea plății, la fel cum ar face KYC. Cu toate acestea, este important să nu confundăm KYC cu identificarea cheii. Personal, trebuie să recunosc că percepția mea asupra acestui subiect a evoluat în timp.

KYC se referă în mod specific la o procedură de reglementare implementată de unele companii pentru a verifica și înregistra identitatea clienților lor. Este ceva binar: când achiziționezi bitcoinii tăi, fie te supui KYC, fie nu. Cu toate acestea, identificarea cheii, care se referă la legarea unui aspect al identității unui utilizator de activitatea onchain, nu este la fel de binară, ci mai degrabă reprezintă un continuum. Într-adevăr, în contextul achiziționării sau dispoziției de bitcoin, această identificare este întotdeauna posibilă în diferite grade.
De exemplu, dacă cumperi bitcoin pe o platformă reglementată în Elveția, KYC (Know Your Customer) nu este necesar. Cu toate acestea, ar putea exista o identificare a cheilor tale, deoarece achiziția a fost făcută prin contul tău bancar. Aici sunt unde primele două riscuri asociate cu KYC — facilitarea urmăririi onchain și expunerea la supravegherea statului — se pot manifesta și într-un schimb non-KYC. Dacă entitatea elvețiană raportează tranzacții suspecte autorităților din țara ta, acestea pot pur și simplu verifica contul bancar utilizat pentru achiziție pentru a descoperi identitatea ta. Astfel, cumpărarea fără KYC pe platforme reglementate este destul de sus pe scara riscului pentru identificarea cheii.

![BTC204](assets/notext/43/4.webp)

Cu toate acestea, evitarea platformelor reglementate și optarea pentru metode de achiziție P2P (Peer-to-Peer) nu elimină complet riscul de identificare a cheii, ci doar îl reduce. Luați în considerare exemplul unei achiziții pe Bisq sau o altă platformă P2P. Pentru a te regla cu contrapartea ta, probabil vei folosi contul tău bancar. Dacă autoritățile îl interoghează pe persoana cu care ai făcut schimbul și cer numele tău, întâlnim riscurile 1 și 2 menționate anterior. Aceste riscuri sunt cu siguranță mult mai mici decât în timpul unei achiziții non-KYC pe o platformă, și chiar mai reduse decât în timpul unei achiziții cu KYC, dar sunt încă prezente într-o măsură mai mică.

![BTC204](assets/notext/43/5.webp)
În final, chiar dacă îți achiziționezi bitcoinii printr-un schimb fizic pentru numerar, nu ești complet anonim. Persoana cu care ai făcut schimbul ți-a văzut fața, care face parte din identitatea ta. Deși în acest exemplu impactul este minim, există totuși posibilitatea unei identificări cheie.
![BTC204](assets/notext/43/6.webp)

În concluzie, în timpul unui schimb de bitcoini pentru alte active, fie că este vorba de o achiziție în monedă fiat sau de o vânzare pentru un bun real, există întotdeauna o formă de identificare cheie. În funcție de metoda de schimb aleasă, această identificare poate varia ca intensitate. Este important să nu confundăm această identificare cu KYC, care este un proces de reglementare bine definit. Totuși, există o legătură între KYC și spectrul identificării, deoarece KYC se află la capătul superior al acestui spectru, facilitând sistematic identificarea cheilor utilizatorului de către autorități.

## Metode de Vânzare și Achiziție
<chapterId>756598af-95aa-4c77-ac48-243c7ad89530</chapterId>
După ce ai citit capitolul anterior, s-ar putea să te întrebi despre modalități de a cumpăra sau vinde bitcoin fără a trebui să treci printr-un proces de verificare a identității, pentru a evita riscurile asociate cu KYC. Există mai multe metode pentru a efectua schimburi.

### Schimburi P2P cu Numerar

După cum am văzut, cea mai bună metodă în termeni de confidențialitate rămâne schimbul P2P (peer-to-peer) cu o soluționare în numerar. Această metodă îți permite să minimizezi urmele lăsate și reduce semnificativ posibilitatea unei identificări cheie, fie că ești cumpărător sau vânzător.

![BTC204](assets/notext/44/01.webp)

Totuși, această practică prezintă riscuri pentru siguranța personală. Principalul pericol constă în faptul că, în timpul schimbului, contrapartida va ști că deții o sumă semnificativă, fie în numerar, fie în bitcoini. Această informație poate atrage atenția persoanelor rău-intenționate. De fapt, se recomandă în general să rămâi discret în legătură cu posesia ta de bitcoin. Acest sfat ar putea fi aplicat și în cazul numerarului. Totuși, în timpul unui schimb față în față, este inevitabil să revelezi că deții bitcoini, ceea ce poate stârni lăcomia.

![BTC204](assets/notext/44/02.webp)

Pentru a limita acest risc, îți recomand să prioritizezi tranzacțiile cu numerar cu persoane de încredere, cum ar fi membrii familiei sau prietenii apropiați. Alternativ, ai putea lua în considerare și participarea la [întâlniri locale Bitcoin](https://btcmap.org/communities/map), după ce ai participat de câteva ori. Acest lucru îți va permite să cunoști mai bine ceilalți participanți și să nu fii singur în timpul schimbului fizic. Totuși, este important să recunoaștem că schimbul P2P cu numerar prezintă în mod inerent riscuri pentru siguranța ta personală care nu există atunci când faci achiziții prin intermediul unei platforme reglementate și contul tău bancar.

Mai mult, în funcție de locul în care trăiești, transportul și depozitarea unor sume mari de bani pot prezenta riscuri, fie că este vorba de bitcoin sau de numerar.

Schimbul cu numerar poate prezenta, de asemenea, riscuri legale în timpul controalelor poliției sau altele. Deși în majoritatea țărilor nu există restricții privind suma de numerar pe care o poți purta asupra ta, sumele prea mari pot trezi suspiciuni. Așadar, fii precaut, mai ales dacă trebuie să călătorești pe distanțe lungi, și evită să faci tranzacții prea mari deodată pentru a nu trebui să justifici posesia unor sume semnificative.
În final, un alt dezavantaj al achizițiilor P2P este că prețul este adesea mai mare decât cel observat pe platformele reglementate. Vânzătorii impun adesea un adaos care variază de la 1% la uneori mai mult de 10%. Mai multe motive explică această diferență de preț. În primul rând, este o practică comună printre vânzătorii P2P care s-a stabilit în timp. Apoi, vânzătorii au taxe de tranzacție asociate cu trimiterea fondurilor către cumpărător. Există, de asemenea, un risc crescut de furt în vânzările P2P comparativ cu tranzacțiile pe platforme, ceea ce justifică compensația pentru riscul asumat. În ultimul rând, suprataxa poate fi legată de cerere și de calitatea schimbului în termeni de confidențialitate. Ca cumpărător, câștigul în confidențialitate are un preț care este reflectat în adaosul aplicat de vânzător. Unii bitcoineri cred, de asemenea, că prețul crescut al BTC cumpărat în P2P reflectă adevărata sa valoare și argumentează că prețurile mai scăzute de pe platformele reglementate sunt rezultatul unui compromis privind confidențialitatea datelor personale.

### Schimburi P2P prin intermediul unei Platforme de Potrivire

O alternativă mai puțin riscantă în termeni de securitate personală este să conduci schimburi P2P exclusiv online, prin metode de plată electronică precum PayPal, transferuri bancare sau Revolut.

Această abordare ajută la evitarea multor riscuri asociate cu tranzacțiile în numerar. Cu toate acestea, riscul ca partea opusă să nu își onoreze angajamentele în timpul unui schimb online este mai mare. Într-adevăr, în timpul unui schimb fizic, dacă îi dai bani vânzătorului care nu îți trimite bitcoinii în schimb, îl poți trage imediat la răspundere deoarece se află în fața ta. Online, pe de altă parte, este adesea imposibil să găsești o persoană care te-a furat.

Pentru a atenua acest risc, este posibil să folosești platforme specializate în potrivire pentru schimburi P2P. Aceste platforme folosesc mecanisme de rezolvare a conflictelor pentru a proteja utilizatorii vătămați. În general, oferă un sistem de escrow, unde bitcoinii sunt reținuți până când plata în monedă fiat este confirmată de vânzător.

În termeni de securitate personală, această metodă de achiziție este semnificativ mai sigură decât schimburile fizice în numerar. Cu toate acestea, după cum s-a menționat anterior, schimburile P2P online lasă mai multe urme decât un schimb fizic, ceea ce poate fi dăunător pentru confidențialitatea pe Bitcoin. Folosind o metodă de plată fiat online, cum ar fi o bancă, expui mai multe informații care ar putea facilita identificarea cheilor.

Încă o dată, recomand să nu faci schimburi mari într-o singură tranzacție pe aceste platforme. Prin împărțirea tranzacțiilor tale, împrăștii riscurile asociate cu furtul potențial de către partea opusă.
Din nou, un alt dezavantaj al achizițiilor P2P este că prețul este adesea mai mare decât cel observat pe platformele reglementate. Vânzătorii impun adesea un adaos care variază de la 1% la uneori mai mult de 10%. Mai multe motive explică această diferență de preț. În primul rând, este o practică comună printre vânzătorii P2P, care s-a stabilit în timp. Apoi, vânzătorii au taxe de tranzacție asociate cu trimiterea fondurilor către cumpărător. Există, de asemenea, un risc crescut de furt în vânzările P2P comparativ cu tranzacțiile pe platforme, ceea ce justifică compensația pentru riscul asumat. În final, suprataxa poate fi legată de cerere și de calitatea schimbului în termeni de confidențialitate. Ca cumpărător, câștigul în materie de confidențialitate are un preț care se reflectă în adaosul aplicat de vânzător. Unii bitcoineri cred, de asemenea, că prețul crescut al BTC cumpărat P2P reflectă adevărata sa valoare și argumentează că prețurile mai scăzute de pe platformele reglementate sunt rezultatul unui compromis privind confidențialitatea datelor personale.
![BTC204](assets/notext/44/03.webp)

În ceea ce privește soluțiile, personal am folosit întotdeauna [Bisq](https://bisq.network/) și sunt foarte mulțumit de acesta. Sistemul lor este bine stabilit și pare fiabil. Totuși, Bisq este disponibil doar pe PC și interfața sa poate fi prea complexă pentru începători. Un alt dezavantaj este că Bisq funcționează exclusiv cu tranzacții onchain, care pot deveni costisitoare în perioadele de taxe mari de tranzacție pe Bitcoin.

[-> Descoperă tutorialul nostru despre Bisq.](https://planb.network/en/tutorials/exchange/bisq)

Pentru o opțiune mai simplă, poți încerca [Peach](https://peachbitcoin.com/), o aplicație mobilă care facilitează conexiunea între cumpărători și vânzători cu un sistem integrat de rezolvare a disputelor. Procesul este mai intuitiv decât cel al Bisq.

[-> Descoperă tutorialul nostru despre Peach.](https://planb.network/en/tutorials/exchange/peach-wallet)
O altă opțiune online este [HodlHodl](https://hodlhodl.com/), o platformă bine stabilită care oferă o bună lichiditate, deși personal nu am testat-o.
[-> Descoperă tutorialul nostru despre HodlHodl.](https://planb.network/en/tutorials/exchange/hodlhodl)

Pentru soluții bazate pe Lightning Network, poți încerca [RoboSats](https://learn.robosats.com/) și [LNP2PBot](https://lnp2pbot.com/). RoboSats este accesibil printr-un site web și este relativ simplu de utilizat. LNP2PBot este mai atipic, deoarece funcționează printr-un sistem de schimb pe aplicația de mesagerie Telegram.

[-> Descoperă tutorialul nostru despre RoboSats.](https://planb.network/en/tutorials/exchange/robosats)
[-> Descoperă tutorialul nostru despre LNP2PBot.](https://planb.network/en/tutorials/exchange/lnp2pbot)

![BTC204](assets/notext/44/08.webp)

### Platforme reglementate fără KYC

În funcție de țara în care locuiești, ai putea avea acces la platforme reglementate care nu necesită o procedură KYC pentru a cumpăra sau vinde bitcoin. În Elveția, de exemplu, poți folosi platforme precum [Relai](https://relai.app/) și [MtPelerin](https://www.mtpelerin.com/).

[-> Descoperă tutorialul nostru despre Relai.](https://planb.network/en/tutorials/exchange/relai)
După cum am văzut în capitolul anterior, acest tip de platformă te scutește de riscurile asociate cu procedurile KYC, dar prezintă un nivel mai ridicat de risc pentru identificarea cheilor. În ceea ce privește confidențialitatea pe Bitcoin, aceste platforme oferă deci o protecție mai bună decât metodele de achiziție cu KYC, dar sunt mai puțin interesante decât schimburile P2P.
Totuși, în ceea ce privește securitatea personală, utilizarea acestor platforme este semnificativ mai puțin riscantă decât schimburile P2P. De asemenea, sunt adesea mai simple de utilizat decât platformele care facilitează schimburile P2P.

### ATM-uri

O altă opțiune pentru cumpărarea sau vânzarea de bitcoin fără KYC sunt ATM-urile criptomonedelor (ATM). Personal, nu am avut niciodată ocazia să testez această soluție, deoarece nu există niciunul în țara mea. Dar această metodă poate fi foarte interesantă în funcție de locul în care trăiești.

![BTC204](assets/notext/44/09.webp)
Problema cu ATM-urile este că sunt interzise în unele țări sau foarte reglementate în altele. Dacă un ATM necesită un proces de verificare a identității, atunci se confruntă cu aceleași riscuri ca și cele inerente platformelor KYC reglementate. Totuși, dacă ATM-ul permite tranzacții fără verificarea identității pentru sume mici, atunci utilizarea sa poate oferi un nivel de confidențialitate comparabil cu cel al unui schimb P2P bazat pe numerar, evitând majoritatea riscurilor asociate cu acest tip de schimb.
Principalul dezavantaj al ATM-urilor constă în taxele lor de schimb adesea ridicate, care variază de la câteva procente până la uneori 15% din suma schimbată.

### Carduri Cadou

În final, am vrut să prezint și o soluție care funcționează bine pentru cei care doresc să-și folosească bitcoinii în mod regulat pentru achiziții, în loc să-i vândă pentru monede fiat.

Cel mai bun mod de a cheltui BTC este evident să folosești direct Bitcoin sau Lightning Network pentru a achiziționa bunuri sau servicii. Totuși, în multe țări, numărul comercianților care acceptă bitcoin rămâne limitat. O alternativă practică este atunci utilizarea cardurilor cadou.

Mai multe platforme care nu necesită o procedură KYC oferă posibilitatea de a schimba bitcoinii pentru carduri cadou care pot fi utilizate în magazine mari. Printre aceste platforme, găsim [CoinsBee](https://www.coinsbee.com/), [The Bitcoin Company](https://thebitcoincompany.com/), și [Bitrefill](https://www.bitrefill.com/). Aceste platforme facilitează în mare măsură utilizarea zilnică a bitcoinilor tăi, permițându-ți să accesezi o gamă largă de produse și servicii fără a trebui să treci printr-o conversie în monedă fiat.

![BTC204](assets/notext/44/10.webp)

### Alte Metode de Achiziție

Printre alte metode de a achiziționa bitcoinii protejându-ți în același timp confidențialitatea, se numără evident minarea. Pentru a începe să minezi sats, nu este necesar să-ți revelezi identitatea; trebuie doar să găsești o dovadă validă de muncă și să o trimiți rețelei. Dacă optezi pentru minarea în pool, unele pool-uri necesită o formă de identificare, cum ar fi KYC, în timp ce altele nu.

O altă metodă constă în a lucra în schimbul bitcoinilor. Această metodă de achiziție poate fi interesantă, dar gradul de identificare necesar variază foarte mult în funcție de circumstanțe.

*Pentru a scrie acest capitol, am folosit cursul [BTC205](https://planb.network/fr/courses/btc205) creat de [@pivi___](https://x.com/pivi___) pe PlanB Network (disponibil doar în franceză deocamdată).*

## Consolidare, Managementul UTXO și CIOH
<chapterId>d0486c8f-332d-402b-ae2e-949416752b9c</chapterId>
Unul dintre cele mai complicate aspecte de gestionat atunci când ai propriul portofel de auto-custodie este, fără îndoială, consolidarea. Ar trebui să consolidezi? Care este scopul? Ce dimensiune a UTXO ar trebui să urmărești? Care sunt compromisurile în termeni de confidențialitate? Aceasta este ceea ce vom încerca să explorăm în această secțiune.

### Ce este consolidarea?

Funcționarea Bitcoin este similară cu un piață de licitație unde tranzacțiile care oferă cele mai bune taxe sunt favorizate de mineri. Cu toate acestea, fiecare bloc are o greutate maximă, limitând numărul de tranzacții care pot fi incluse. Deoarece un bloc este produs în medie la fiecare 10 minute, spațiul disponibil în fiecare bloc este o resursă rară.

Minerii, a căror activitate implică costuri semnificative în electricitate, capital și întreținere, caută în mod natural să-și maximizeze profitabilitatea. Ei tind să favorizeze tranzacțiile care le oferă cele mai multe taxe în raport cu greutatea lor.

Într-adevăr, nu toate tranzacțiile Bitcoin cântăresc la fel. Cele cu mai multe intrări și ieșiri vor cântări mai mult. De exemplu, consideră 2 tranzacții:
- Tranzacția A include 1 intrare și 1 ieșire. Alocă 1,994 sats de taxe și greutatea sa este de 141 vB;
- Tranzacția B, mai complexă, cu 2 intrări și 2 ieșiri, alocă 2,640 sats de taxe pentru o greutate de 220 vB.

![BTC204](assets/notext/45/01.webp)

În acest exemplu, deși tranzacția B propune un total de taxe mai mare, minerii vor favoriza tranzacția A deoarece oferă un raport mai bun între taxe și greutate. Iată calculul pentru fiecare tranzacție, exprimat în sats per byte virtual (sat/vB):

```text
TXA: 1994 / 141 = 14 sats/vB

TXB: 2640 / 220 = 12 sats / vB
```

Acest lucru înseamnă că pentru fiecare unitate de greutate, tranzacția A oferă mai multe taxe decât tranzacția B, chiar dacă aceasta din urmă oferă mai multe taxe în valoare absolută.

![BTC204](assets/notext/45/02.webp)

Prin urmare, este întotdeauna mai interesant pentru utilizator să consume cel mai mic număr posibil de intrări în tranzacțiile lor. Cu toate acestea, este necesar să se consume cantități suficiente pentru a putea satisface plata în ieșire. În gestionarea portofelului lor, trebuie să aibă UTXO-uri suficient de mari.

Principiul consolidării este precis de a profita de perioadele când taxele sunt scăzute pe Bitcoin pentru a fuziona UTXO-urile mici într-unul singur mai mare. Astfel, când taxele pe Bitcoin cresc, se pot face tranzacții cu un minim de intrări, și prin urmare se cheltuie mai puțin în taxe absolute. Scopul este de a planifica tranzacțiile obligatorii care trebuie efectuate în perioade de taxe ridicate.

![BTC204](assets/en/45/03.webp)
În plus față de economiile la taxele de tranzacție, consolidarea UTXO-urilor ajută la evitarea creării de "praf". Praf se referă la UTXO-urile a căror valoare în sats este atât de mică încât nu este suficientă pentru a acoperi taxele de tranzacție necesare pentru a le cheltui. Acest lucru face ca aceste UTXO-uri să fie iraționale din punct de vedere economic de utilizat atâta timp cât taxele de tranzacție rămân ridicate. Prin gruparea proactivă a UTXO-urilor tale, previi transformarea lor în praf, asigurând că toate fondurile tale rămân utilizabile.

### Care este dimensiunea minimă pentru UTXO-urile tale?

Uneori, mi se pune întrebarea care este valoarea minimă recomandată pentru un UTXO. Din păcate, nu există un răspuns universal, deoarece depinde de preferințele tale și de condițiile pieței pentru taxe. Cu toate acestea, iată o formulă care te poate ajuta să determini un prag adaptat nevoilor tale:

$$
\frac {P \times F}T = M
$$

Unde:
- $P$ este greutatea tranzacției;
- $F$ reprezintă rata maximă a taxei în satoshi per vbyte (sats/vB) pe care o acoperiți;
- $T$ este procentul taxei tranzacției pe care sunteți dispus să o plătiți relativ la valoarea totală a UTXO;
- $M$ este suma minimă în satoshi pentru fiecare UTXO.

Presupunând că intenționați să acoperiți taxele pentru o tranzacție SegWit standard cu 1 intrare și 2 ieșiri, având o greutate de 141 vB. Dacă acoperiți până la 800 sats/vB, și sunteți dispus să cheltuiți până la 12% din valoarea UTXO în taxe la maximum, atunci calculul ar fi:

$$
\frac{141 \times 800}{0.12} = 940\ 000
$$

În acest exemplu, ar fi înțelept să mențineți o valoare minimă de 940.000 sats pentru UTXO-urile din portofelul dvs.

### Consolidarea și COIH

Una dintre euristicile cel mai des utilizate în analiza lanțurilor este COIH (*Common Input Ownership Heuristic*), care permite presupunerea că toate intrările unei tranzacții Bitcoin aparțin aceleiași entități. Precis, principiul consolidării este de a consuma mai multe UTXO-uri ca intrări și de a crea un singur UTXO ca ieșire. Prin urmare, consolidarea permite aplicarea COIH.

![BTC204](assets/notext/45/04.webp)

În practică, acest lucru înseamnă că un observator extern poate deduce că toate UTXO-urile consolidate probabil aparțin aceleiași persoane și că ieșirea unică generată le aparține de asemenea. Această situație poate compromite confidențialitatea dvs. prin legarea diferitelor istorii de tranzacții. De exemplu, să presupunem că consolidez 3 UTXO-uri achiziționate în P2P cu un UTXO obținut prin intermediul unei platforme care necesită KYC:
![BTC204](assets/notext/45/05.webp)

Făcând acest lucru, orice entitate cu acces la datele platformei de schimb, inclusiv potențial agențiile guvernamentale, pot identifica că dețin alte sume în BTC. Anterior, aceste UTXO-uri nu erau direct legate de identitatea mea; acum sunt. Mai mult, acest lucru dezvăluie tuturor surselor că sunt în posesia unei anumite sume de bitcoin.

În gestionarea UTXO-urilor, considerentele economice, care împing spre consolidare pentru a reduce taxele, intră astfel în conflict cu bunele practici de confidențialitate, care ar recomanda să nu îți consolidezi niciodată UTXO-urile. Alegerea între economie și confidențialitate depinde astfel de prioritățile fiecărui utilizator.

Dacă puteți evita consolidarea menținând dimensiuni substanțiale ale UTXO-urilor, acesta este ideal. Pentru a face acest lucru, optimizați metodele dvs. de achiziție. Dacă cumpărați bitcoinii în DCA, încercați să vă spațiați achizițiile unice cât mai mult posibil pentru a grupa valoarea în mai puține UTXO-uri. Va fi mai ușor să gestionați o achiziție unică de 1.000 € la fiecare 2 luni, decât o achiziție de 120 € în fiecare săptămână. Acest lucru minimizează numărul de UTXO-uri generate și simplifică gestionarea portofelului dvs. păstrând în același timp confidențialitatea.

Dacă vă găsiți în situația de a avea nevoie să consolidați bitcoinii, prioritizați mai întâi consolidarea UTXO-urilor din aceeași sursă. De exemplu, fuzionarea a 10 UTXO-uri de pe o singură platformă va afecta mai puțin confidențialitatea dvs. decât amestecarea a 5 UTXO-uri de pe platforma A cu 5 UTXO-uri de pe platforma B. Dacă consolidarea din diverse surse este inevitabilă, încercați să le separați conform caracteristicilor lor. De exemplu, grupați UTXO-urile achiziționate prin KYC într-o tranzacție și pe cele obținute în P2P în alta.
În orice caz, amintiți-vă că orice consolidare duce inevitabil la o pierdere a confidențialității. Prin urmare, evaluați cu atenție necesitatea acestei operațiuni și impacturile potențiale asupra confidențialității dumneavoastră, luând în considerare riscul.
## Alte Practici Bune
<chapterId>b5216965-7d13-4ea1-9b7c-e292966a487b</chapterId>

Haideți să explorăm împreună alte practici bune care vă pot ajuta să vă optimizați confidențialitatea pe Bitcoin.

### Nodul Complet
Deținerea bitcoinilor în custodie proprie este bună, dar utilizarea propriului nod complet este și mai bine! Iată de ce deținerea propriului nod este crucială pentru o utilizare complet suverană a Bitcoin:
- **Rezistență la Cenzură**: Tranzacțiile dumneavoastră nu pot fi blocate de nimeni;
- **Independență față de Terți**: Nu mai depindeți de niciun serviciu extern pentru a verifica datele blockchain;
- **Participare Activă**: Aveți capacitatea de a stabili propriile reguli de validare și de a participa direct în consens;
- **Contribuție la Rețea**: Prin rularea unui nod, ajutați la întărirea și distribuirea rețelei Bitcoin;
- **Educație Tehnică**: Gestionarea unui nod complet este o modalitate excelentă de a vă aprofunda cunoștințele tehnice despre Bitcoin.

Pe lângă aceste beneficii, utilizarea unui nod complet îmbunătățește de asemenea confidențialitatea dumneavoastră atunci când difuzați tranzacțiile. Când emiteți o tranzacție, aceasta este mai întâi creată și semnată prin portofelul dumneavoastră. Pentru a o difuza în rețeaua Bitcoin, trebuie să fie cunoscută de cel puțin un nod. Utilizând propriul nod, controlați direct această difuzare, îmbunătățind astfel confidențialitatea dumneavoastră și limitând riscurile de scurgere a datelor.

![BTC204](assets/notext/46/01.webp)

Dacă nu aveți propriul nod Bitcoin, veți fi forțat să utilizați unul al unei terțe părți, cum ar fi cel oferit de furnizorul software-ului portofelului dumneavoastră. Pe lângă difuzarea tranzacțiilor, portofelul dumneavoastră necesită acces la diverse informații, cum ar fi tranzacțiile în așteptare, soldurile asociate cu adresele dumneavoastră sau numărul de confirmări pentru tranzacțiile dumneavoastră. Pentru a accesa toate aceste date, trebuie să interogați un nod.

![BTC204](assets/notext/46/02.webp)

Principalul risc când nu utilizați propriul nod Bitcoin este că operatorul nodului terț poate observa activitățile dumneavoastră pe blockchain, sau chiar să împărtășească aceste informații cu alte entități. Pentru a limita acest risc, o soluție intermediară este să utilizați software de portofel care vă permite să mascați conexiunile prin Tor. Aceasta poate reduce expunerea datelor dumneavoastră. Cu toate acestea, soluția optimă rămâne să aveți propriul nod Bitcoin și să-l utilizați pentru difuzarea tranzacțiilor dumneavoastră. Evident, va trebui de asemenea să vă asigurați că nicio informație nu scapă de la nodul dumneavoastră, dar acesta este un alt subiect pe care îl vom explora în secțiunile următoare.
Dincolo de avantajul evident pentru confidențialitatea dumneavoastră, deținerea propriului nod complet asigură de asemenea veridicitatea datelor pe blockchain, protejează împotriva cenzurii și vă permite să participați activ în guvernanța Bitcoin. Utilizând propriul nod, contribuiți cu greutatea economică la lanțul de alegere, ceea ce este important în timpul conflictelor din comunitate, cum ar fi în timpul Războiului Dimensiunii Blocului din 2015 până în 2017, de exemplu. În cazul unui fork, utilizarea unui nod al unei terțe părți v-ar putea determina să susțineți un lanț pe care nu doriți să-l favorizați, deoarece operatorul nodului face alegerea pentru dumneavoastră.
După cum puteți înțelege, dintr-o preocupare pentru confidențialitate și mai larg pentru suveranitatea individuală, este esențial să rulați și să utilizați propriul nod complet!

### Păcălirea Euristicilor de Analiză
Mai pe larg, este important să înțelegem euristicile despre care am vorbit în partea anterioară, pentru a le evita sau păcăli mai bine. Adoptarea unei serii de bune practici se poate dovedi benefică, chiar dacă acestea nu sunt indispensabile. Ele oferă un strat suplimentar de protecție care poate fi important pentru menținerea unei bune confidențialități atunci când folosești Bitcoin.

Primul sfat pe care l-aș putea oferi este să te amesteci în mulțimea cea mai densă. Pe Bitcoin, acest lucru înseamnă utilizarea celor mai adoptate modele de scripturi. De exemplu, scripturile P2WSH, adesea utilizate pentru configurații multisig SegWit V0, sunt foarte rare. Acestea nu îți permit să te ascunzi într-un set mare de anonimitate. La fel se întâmplă și cu modelele vechi precum P2PKH sau P2SH. Deși sunt larg prezente în setul UTXO, sunt utilizate din ce în ce mai puțin pentru tranzacții noi.

În general, este mai sigur să te orientezi către cel mai recent standard de script, cu condiția să fie suficient de adoptat. Astfel, dacă în 2022 aș fi sfătuit împotriva utilizării P2TR (Taproot) din cauza adoptării sale scăzute, până în 2024, aș recomanda optarea pentru acest tip de script, sau, în lipsa acestuia, pentru scriptul SegWit V0, deoarece numărul tranzacțiilor care folosesc P2TR începe să reprezinte o porțiune foarte semnificativă.

![BTC204](assets/notext/46/03.webp)

Sursa: [txstats.com](https://txstats.com/d/000000054/utxo-set-repartition-by-output-type)
Un alt sfat pentru păstrarea confidențialității tale este să încerci să ocolești euristicile interne ale tranzacțiilor. De exemplu, când faci un plată, ai putea încerca să eviți crearea unui output cu o sumă rotundă, deoarece acest lucru ar putea semnala că celălalt output reprezintă restul. Dacă trebuie să trimiți 100k sats unui prieten, ia în considerare transferul unei sume ușor mai mari pentru a scăpa de această euristică. În mod similar, încearcă să nu creezi output-uri de rest care sunt disproporționat de mari comparativ cu plata efectuată, deoarece acest lucru ar putea dezvălui, de asemenea, care dintre output-uri reprezintă restul.
![BTC204](assets/notext/46/04.webp)

În final, dacă efectuezi tranzacții Bitcoin în mod regulat, asigură-te că nu le transmiți întotdeauna la aceleași ore. Răspândind transmiterea tranzacțiilor tale pe parcursul zilei și al săptămânii, eviți oferirea observatorilor externi a posibilității de a detecta un model temporal bazat pe fusuri orare care ar putea îmbunătăți analiza lor.

Dincolo de toate aceste bune practici de adoptat zilnic, există metode și mai eficiente pentru a rupe complet urmăribilitatea bitcoinilor tăi. Printre acestea, se numără evident tranzacțiile coinjoin pe care le vom studia în detaliu în partea următoare.

# Înțelegerea Tranzacțiilor Coinjoin
<partId>6d0bbf16-3714-4db1-9897-2d45019f6bdc</partId>

## Ce este o Tranzacție Coinjoin?
<chapterId>0862bc6b-1c48-4aa4-b76d-4f547b469008</chapterId>

După ce am studiat fundamentele protecției confidențialității, vom discuta acum despre tehnici mai sofisticate, menite să apere activ confidențialitatea ta, în special prin disocierea istoricului bitcoinilor tăi. În partea următoare, vom explora multe tehnici mici, dar mai întâi, vreau să vă vorbesc despre coinjoin.

Coinjoin este adesea considerată metoda cea mai eficientă pentru protejarea confidențialității utilizatorilor Bitcoin. Dar ce este exact o tranzacție coinjoin? Să aflăm împreună.

### Principiile de bază ale Coinjoin

Coinjoin este o tehnică care rupe urmăribilitatea bitcoinilor pe blockchain. Se bazează pe o tranzacție colaborativă cu o structură specifică cu același nume: tranzacția coinjoin.
Așa cum am văzut în primele părți ale acestui training, tranzacțiile pe Bitcoin sunt cunoscute tuturor utilizatorilor prin nodul lor. Prin urmare, este ușor să verifici lanțul de semnături electronice al fiecărei monede și să observi istoricul său. Asta înseamnă că toți utilizatorii pot încerca să analizeze tranzacțiile altor utilizatori. Ca rezultat, anonimitatea la nivelul tranzacției este imposibilă. Totuși, anonimitatea este păstrată la nivelul identificării individuale. Spre deosebire de sistemul bancar tradițional unde fiecare cont este legat de o identitate personală, pe Bitcoin, fondurile sunt asociate cu perechi de chei criptografice (sau scripturi), oferind astfel utilizatorilor o formă de pseudonimitate în spatele identificatorilor criptografici.

Astfel, confidențialitatea pe Bitcoin este compromisă când observatorii externi reușesc să asocieze UTXO-uri specifice cu utilizatori identificați. Odată ce această asociere este stabilită, devine posibil să urmărești tranzacțiile lor și să analizezi istoricul bitcoinilor lor. Coinjoin este exact o tehnică dezvoltată pentru a rupe urmăribilitatea UTXO-urilor, pentru a oferi un anumit nivel de confidențialitate utilizatorilor Bitcoin la nivelul tranzacției.

Coinjoin îmbunătățește confidențialitatea utilizatorilor Bitcoin complicând analiza lanțului pentru observatorii externi. Structura lor permite combinarea mai multor monede de la utilizatori diferiți într-o singură tranzacție, estompând astfel urmele și făcând dificilă determinarea legăturilor între adresele de intrare și ieșire.

Este important de înțeles că scopul unei tranzacții coinjoin este de a rupe istoricul unei monede. Această tehnică nu conferă anonimitate permanentă nici nu blochează definitiv urmărirea bitcoinilor, contrar a ceea ce s-ar putea crede. Coinjoin are ca scop doar ruperea istoricului în punctul în care tranzacția coinjoin este efectuată. Totuși, înainte și după această operațiune, moneda rămâne supusă acelorași riscuri de confidențialitate.

### Cum funcționează coinjoin?

Principiul coinjoin se bazează pe o abordare colaborativă: mai mulți utilizatori care doresc să își amestece bitcoinii depun sume identice în intrările aceleiași tranzacții. Aceste sume sunt apoi redistribuite în ieșiri de valori egale fiecărui utilizator.

La sfârșitul tranzacției, devine imposibil să asociezi o ieșire specifică cu un utilizator cunoscut la intrare. Nu există o legătură directă între intrări și ieșiri, ceea ce rupe asocierea între utilizatori și UTXO-urile lor, precum și istoricul fiecărei monede.

Să luăm exemplul lui Alice. Ea vrea să trimită aproximativ 100.000 de sats surorii sale Eve pentru ziua ei de naștere. Totuși, Alice nu vrea ca Eve să poată urmări istoricul tranzacțiilor sale pentru că nu vrea să dezvăluie câți bitcoini deține sau cum i-a obținut. Pentru a face asta, Alice decide să rupă istoricul UTXO-ului său cu o tranzacție coinjoin. Ea organizează cu Bob, Charles, David și Frank să efectueze o tranzacție colaborativă:
- Alice, Bob, Charles, David și Frank angajează fiecare un UTXO de 105.000 de sats (cu 5.000 de sats pentru taxele de minare) ca intrări pentru tranzacție:

- În schimbul consumării acestor intrări, fiecare generează o adresă nouă pentru a crea cinci ieșiri identice de 100.000 de sats fiecare. Fiecare recuperează o ieșire:

- Alice se alege cu un UTXO de 100.000 de sats al cărui istoric este amestecat. Ea folosește acest UTXO într-o nouă tranzacție pentru a trimite suma lui Eve pentru ziua ei de naștere:
![BTC204](assets/notext/51/07.webp)
- Dacă Eve încearcă să analizeze această tranzacție pentru a extrage informații, se va confrunta cu tranzacția coinjoin care îi implică pe Alice, Bob, Charles, David și Frank. Fiind incapabilă să distingă care intrare aparține cui datorită uniformității sumelor, Eve nu poate urmări istoria UTXO-ului lui Alice, nici să determine câți bitcoini deține sora ei sau cum i-a achiziționat:

![BTC204](assets/notext/51/08.webp)

În acest scenariu, Alice a folosit tehnica coinjoin pentru a-și mări intimitatea împotriva analizei retrospective. Într-adevăr, Alice se protejează împotriva unei posibile analize din partea Evei care ar începe de la o tranzacție specifică pentru a urmări istoria UTXO-ului înapoi. Această protecție împotriva analizei de la prezent la trecut este ceea ce numim anonset retrospectiv. Vom explora acest concept mai detaliat în ultimele capitole ale acestei părți.

Totuși, coinjoin oferă și posibilitatea de a îmbunătăți intimitatea împotriva analizei de la trecut la prezent, ceea ce se referă la anonset prospectiv. Să ne întoarcem la exemplul nostru în care Alice i-a trimis lui Eve 98.000 de sats pentru ziua ei de naștere, dar inversând rolurile. Acum imaginați-vă că Eve este cea preocupată de intimitatea ei. Într-adevăr, Alice ar putea fi tentată să urmărească moneda pe care a trimis-o lui Eve pentru a aduna informații. Eve ar putea consolida acest UTXO pe care tocmai l-a primit cu toate celelalte UTXO-uri ale ei, ceea ce ar putea dezvălui lui Alice suma de bitcoini pe care o deține în portofelul ei. Pentru a evita acest lucru, Eve poate, de asemenea, să rupă istoria monedei pe care tocmai a primit-o.
- Eve, Grace, Mallory, Oscar și Victor pun fiecare un UTXO de 98.000 de sats ca intrări într-o tranzacție Bitcoin:
![BTC204](assets/notext/51/09.webp)

- În schimbul consumării acestor intrări, fiecare oferă o adresă nouă pentru a crea 5 ieșiri de 97.500 de sats fiecare, perfect egale. Fiecare utilizator recuperează o ieșire:

![BTC204](assets/notext/51/10.webp)

- Eve deține acum un UTXO de 97.500 de sats cu o istorie întreruptă. Poate să-l folosească fără teamă pentru tranzacții viitoare. Într-adevăr, dacă Alice încearcă să urmărească bitcoinii pe care i-a trimis lui Eve, se va întâlni cu o tranzacție coinjoin. Ea va fi incapabilă să determine cărui UTXO de ieșire îi aparține Evei. Analiza devine atunci imposibilă:

![BTC204](assets/notext/51/11.webp)

În primul exemplu, am văzut cum coinjoin poate proteja intimitatea unei monede în relație cu trecutul său, iar în al doilea exemplu, cum poate de asemenea să securizeze istoria unei monede în relație cu viitorul său. De aceea am menționat că coinjoin ar trebui văzut ca un eveniment unic care segmentează istoria unei monede în ambele direcții:

![BTC204](assets/notext/51/02.webp)

### Mixing, coinjoins, mixers... Care este diferența?

Termenul "mixing" este uneori folosit pentru a descrie coinjoins, un termen pe care unii bitcoineri îl resping deoarece se tem de confuzie cu mixerele custodiale. Totuși, cred că această aprehensiune este nefondată, deoarece, într-un context matematic, coinjoin încorporează conceptul de mixing precis.
În domeniul general al matematicii, amestecarea se referă la proprietatea unui sistem dinamic unde, după un anumit timp, toate porțiunile spațiului inițial pot teoretic fi amestecate cu orice altă porțiune. Amestecarea implică faptul că poziția unei particule sau starea unui sistem evoluează într-un mod în care distribuția sa viitoare este independentă de distribuția sa inițială, ajungând astfel la o stare în care caracteristicile stării inițiale sunt distribuite uniform în spațiul sistemului. Acest lucru se întâmplă exact într-un coinjoin cu bitcoinii. Astfel, în opinia mea, coinjoin este cu adevărat o metodă de amestecare a monedelor.
![BTC204](assets/notext/51/12.webp)

Cu toate acestea, este important să distingem coinjoin de mixere. Un mixer este un serviciu unde utilizatorii își trimit bitcoinii pentru a fi amestecați. Aceste servicii au fost populare în anii 2010, dar utilizarea lor a scăzut din cauza a două dezavantaje majore în comparație cu coinjoin:
- Necesită ca utilizatorul să renunțe la custodia fondurilor sale în timpul procesului de amestecare, ceea ce îi expune riscurilor de furt;
- Nu există nicio garanție că mixerul nu înregistrează detaliile tranzacțiilor, sau chiar vinde aceste informații companiilor de analiză a lanțului.
![BTC204](assets/notext/51/13.webp)

În zilele noastre, utilizatorii preferă deci coinjoin, deoarece le permite să mențină controlul complet asupra fondurilor lor pe parcursul procesului. Participanții la un coinjoin nu riscă să le fie furate bitcoinii de alte părți implicate. Să explorăm împreună cum este posibil tot acest lucru în capitolul următor.

## Zerolink și Chaumian Coinjoins
<chapterId>326c9654-b359-4906-b23d-d6518dd5dc3e</chapterId>

Confidențialitatea oferită de un coinjoin este câștigată pe dimensiunea grupului în care piesa noastră este ascunsă. Prin urmare, este necesar să găsim cât mai mulți participanți posibil. Este complet posibil să efectuezi un coinjoin manual, cu utilizatori găsiți de unul singur, dar această metodă este complexă și nu permite atingerea unor anonseturi mari.

De aceea, coordonatorii de coinjoin s-au dezvoltat pe Bitcoin. Rolul lor este de a conecta diferiți utilizatori și de a transmite informațiile necesare pentru finalizarea cu succes a tranzacției colaborative.

![BTC204](assets/notext/52/01.webp)

Dar cum ne asigurăm că coordonatorul nu are niciodată control asupra bitcoinilor utilizatorilor, și în ciuda faptului că ei sunt persoana care construiește tranzacția coinjoin, cum ne asigurăm că nu pot lega intrările și ieșirile utilizatorilor, ceea ce ar putea constitui o scurgere de confidențialitate?

### Semnăturile Oarbe ale lui Chaum

Implementările moderne de coinjoin folosesc semnăturile oarbe ale lui David Chaum pentru a evita scurgerea de informații. Să studiem rapid împreună cum funcționează aceste semnături oarbe.

Semnăturile oarbe ale lui Chaum sunt o formă de semnătură digitală unde emitentul unei semnături nu cunoaște conținutul mesajului pe care îl semnează. Cu toate acestea, semnătura poate fi verificată ulterior cu mesajul original. Această tehnică a fost dezvoltată de criptograful David Chaum în 1983.

![BTC204](assets/notext/52/02.webp)

Luăm exemplul unei companii care dorește să autentifice un document confidențial, cum ar fi un contract, fără a dezvălui conținutul său. Compania aplică un proces de mascare care transformă criptografic documentul original într-o manieră reversibilă. Acest document modificat este trimis unei autorități de certificare care aplică o semnătură oarbă fără a cunoaște conținutul subiacent. După primirea documentului semnat, compania dezvăluie semnătura. Rezultatul este un document original autentificat de semnătura autorității, fără ca autoritatea să fi văzut vreodată conținutul original.
Semnăturile oarbe ale lui Chaum permit astfel certificarea autenticității unui document fără a cunoaște conținutul său, ceea ce garantează atât confidențialitatea datelor utilizatorului, cât și integritatea documentului semnat.
### Coinjoin-uri Chaumian
În "Coinjoin-uri Chaumian", utilizarea Tor și semnăturile oarbe ale lui David Chaum sunt combinate pentru a asigura că coordonatorul nu poate ști care ieșire aparține cărui utilizator. Procesul de construire a tranzacției coinjoin se învârte în jurul a 3 pași principali: înregistrarea intrărilor, înregistrarea ieșirilor și semnarea tranzacției. Să examinăm acest proces prin exemplul Alicei, unul dintre participanții la coinjoin. Toți ceilalți participanți urmează aceiași pași ca Alice, fiecare pe cont propriu.

**Pasul 1: Înregistrarea intrărilor.**
- Alice trimite coordonatorului UTXO-ul pe care dorește să-l folosească ca intrare pentru tranzacție, precum și adresa de primire mascată pe care vrea să o folosească ca ieșire pentru a primi bitcoinii săi. Prin urmare, coordonatorul nu poate cunoaște adresa Alicei. El vede doar versiunea sa mascată:

![BTC204](assets/notext/52/03.webp)

- Coordonatorul verifică validitatea intrărilor, apoi semnează adresa mascată a Alicei cu cheia sa privată. El îi trimite înapoi Alicei semnătura oarbă:

![BTC204](assets/notext/52/04.webp)

**Pasul 2: Înregistrarea ieșirilor.**
- Alice poate acum să-și dezvăluie adresa semnată de cheia privată a coordonatorului. Ea stabilește o nouă conexiune sub o altă identitate Tor. Coordonatorul nu poate identifica că este Alice cea care se conectează sub această nouă identitate:

![BTC204](assets/notext/52/05.webp)

- Alice trimite adresa dezvăluită și semnătura coordonatorului (care încă nu știe că este Alice):

![BTC204](assets/notext/52/06.webp)

**Pasul 3: Semnarea tranzacției.**
- Coordonatorul recuperează similar ieșirile dezvăluite de la toți participanții. Datorită semnăturilor asociate, el poate verifica că fiecare ieșire trimisă anonim a fost într-adevăr semnată de cheia sa privată anterior, asigurându-le legitimitatea. El este apoi pregătit să construiască tranzacția coinjoin și o trimite participanților pentru a o semna:

![BTC204](assets/notext/52/07.webp)

- Alice, la fel ca ceilalți participanți, verifică dacă intrarea și ieșirea ei sunt corect incluse în tranzacția construită de coordonator. Dacă totul este satisfăcător, ea trimite semnătura care deblochează scriptul intrării sale coordonatorului:

![BTC204](assets/notext/52/08.webp)

- După colectarea semnăturilor de la toți participanții la coinjoin, coordonatorul poate difuza tranzacția în rețeaua Bitcoin, astfel încât să poată fi adăugată într-un bloc.
În acest sistem, coordonatorul nu poate lega o intrare de o ieșire specifică. Mai mult, ei nu pot prelua posesia fondurilor participanților, deoarece nu au acces niciodată la cheile private necesare pentru a debloca UTXO-urile lor. Pe parcursul procesului, și până la sfârșitul pasului 3, ei nu au, de asemenea, acces la semnături. Când Alice și ceilalți participanți semnează tranzacția globală, după ce s-au asigurat că totul este corect, coordonatorul nu mai poate modifica această tranzacție, inclusiv ieșirile, fără a o invalida. Acest lucru previne astfel furtul de bitcoin de către coordonator.
În ultimă instanță, când înregistrează rezultatul lor în tranzacție, utilizatorul coinjoin dorește garanții similare cu cele ale unui cetățean care votează într-o alegeri. Există o dualitate între aspectele publice și private ale acestor acțiuni. Pe de o parte, există ceea ce cineva dorește să păstreze privat: pentru votant, nu își doresc ca votul lor să fie legat de identitatea lor; pentru utilizatorul coinjoin, nu își doresc ca rezultatul lor să fie asociat cu intrarea lor. Într-adevăr, dacă coordonatorul sau orice altă parte, reușește să stabilească o legătură între o intrare și un rezultat, coinjoin își pierde tot scopul. Așa cum a fost explicat anterior, coinjoin trebuie să funcționeze ca o întrerupere în istoria unei monede. Această oprire are loc tocmai din cauza imposibilității de a asocia o intrare specifică cu un rezultat specific în tranzacția coinjoin (anonset prospectiv) și invers (anonset retrospectiv).

Pe de altă parte, există aspectul public: votantul dorește să se asigure că votul lor este inclus în urna de vot; similar, utilizatorul coinjoin dorește să se asigure că rezultatul lor este inclus în tranzacția coinjoin. Într-adevăr, este absolut necesar ca participanții la coinjoin să poată verifica prezența rezultatului lor înainte de a semna tranzacția, altfel coordonatorul ar putea să fure fondurile.

Sunt exact aceste 2 aspecte, public și privat, făcute posibile prin utilizarea semnăturilor oarbe ale lui David Chaum, care garantează participanților la coinjoins Chaumian că bitcoinii lor nu vor fi furați, și că fondurile lor nu pot fi urmărite.

### Cine a inventat conceptul de coinjoin?

Este dificil de determinat cu certitudine cine a introdus prima dată ideea de coinjoin pe Bitcoin, și cine a avut ideea de a utiliza semnăturile oarbe ale lui David Chaum în acest context. Se crede adesea că Gregory Maxwell a fost cel care a vorbit prima dată despre acesta în [un mesaj pe BitcoinTalk în 2013](https://bitcointalk.org/index.php?topic=279249.0):
Utilizând Semnături Oarbe Chaum: Utilizatorii se loghează și oferă intrări (și adrese de schimb) precum și o versiune criptografic oarbă a adresei către care doresc să-și trimită monedele private; serverul semnează tokenurile și le returnează utilizatorilor. Utilizatorii se reconectează anonim, dezvăluie adresele lor de ieșire, și le trimit înapoi serverului. Serverul poate vedea că toate ieșirile au fost semnate de acesta și că, în consecință, toate ieșirile provin de la participanți validați. Mai târziu, oamenii se reconectează și semnează.
Maxwell, G. (2013, August 22). *CoinJoin: Confidențialitatea Bitcoin pentru lumea reală*. Forumul BitcoinTalk. https://bitcointalk.org/index.php?topic=279249.0

![BTC204](assets/notext/52/09.webp)

Cu toate acestea, există mențiuni anterioare, atât pentru semnăturile Chaum în contextul amestecării, cât și pentru coinjoins. [În iunie 2011, Duncan Townsend a prezentat pe BitcoinTalk](https://bitcointalk.org/index.php?topic=12751.0) un mixer care utilizează semnături Chaum într-un mod destul de similar cu coinjoins Chaumian moderne.
În același fir de discuție, există [un mesaj de la hashcoin ca răspuns pentru Duncan Townsend](https://bitcointalk.org/index.php?topic=12751.msg315793#msg315793) pentru a-și îmbunătăți mixerul. Procesul descris în acest mesaj reprezintă exact ceea ce se aseamănă cel mai mult cu coinjoins. De asemenea, există o mențiune despre un sistem similar în [un mesaj de la Alex Mizrahi în 2012](https://gist.github.com/killerstorm/6f843e1d3ffc38191aebca67d483bd88#file-laundry), în timp ce acesta îi sfătuia pe creatorii lui Tenebrix, una dintre primele altcoins care a servit ca bază pentru crearea Litecoin mai târziu. Chiar și termenul "coinjoin" însuși nu a fost inventat de Greg Maxwell, ci a venit dintr-o idee de la Peter Todd.
![BTC204](assets/notext/52/10.webp)

### Zerolink

Zerolink este un protocol de mixare cuprinzător care integrează coinjoins Chaumian și diverse strategii pentru a proteja anonimatul utilizatorilor împotriva mai multor forme de analiză a lanțului, minimizând în mod notabil erorile legate de gestionarea portofelului. Acest protocol [a fost introdus de nopara73 și TDevD în 2017](https://github.com/nopara73/ZeroLink/blob/master/README.md).

![BTC204](assets/notext/52/11.webp)

După cum sugerează și numele, principiul Zerolink este de a efectua tranzacții coinjoin care asigură imposibilitatea urmăririi legăturilor între intrări și ieșiri. Această caracteristică este realizată asigurând că toate ieșirile prezintă sume perfect identice.

![BTC204](assets/notext/52/12.webp)
O măsură preventivă importantă a Zerolink implică separarea completă a UTXO-urilor nemixate de UTXO-urile mixate, utilizând seturi distincte de chei criptografice, sau chiar portofele separate. Astfel, portofelul "pre-mix", destinat monedelor înainte de mixare, este diferențiat de portofelul "post-mix", rezervat monedelor care au fost mixate.
![BTC204](assets/notext/52/13.webp)

Această separare strictă a UTXO-urilor servește în primul rând pentru a preveni asocierile accidentale între un UTXO mixat și unul nemixat. Într-adevăr, dacă astfel de legături apar, eficacitatea coinjoin asupra UTXO-ului mixat este anulată fără ca utilizatorul să fie conștient, compromițând astfel confidențialitatea unui UTXO al cărui istoric credea că a fost întrerupt. Aceste legături pot apărea fie prin reutilizarea adresei la securizarea unui UTXO mixat cu unul nemixat, fie prin aplicarea Euristică de Proprietate Comună a Intrărilor (CIOH), dacă utilizatorul consumă UTXO-uri mixate și nemixate ca intrări ale aceleiași tranzacții. Prin separarea portofelelor pre-mixare și post-mixare, aceste asocieri accidentale sunt evitate, iar utilizatorul este protejat împotriva erorilor involuntare.

![BTC204](assets/notext/52/14.webp)

Această separare oferă, de asemenea, posibilitatea de a aplica reguli distincte între portofelele pre-mixare și post-mixare la nivelul software-ului portofelului. De exemplu, în portofelul post-mix, software-ul poate interzice combinarea UTXO-urilor în intrări pentru a preveni aplicarea CIOH care ar compromite anonsetul utilizatorului. De asemenea, este posibil să se standardizeze utilizarea scripturilor și opțiunilor de tranzacție (cum ar fi semnalizarea RBF, de exemplu) pentru a preveni identificarea prin amprente de portofel.

În prezent, Whirlpool este singura implementare a coinjoin care aplică riguros protocolul Zerolink. În capitolul următor, vom explora diferitele implementări existente de coinjoin și avantajele și dezavantajele fiecăreia.

## Implementări Coinjoin
<chapterId>e37ed073-9498-4e4f-820b-30951e829596</chapterId>
*În 2024, suntem martorii unor schimbări semnificative în instrumentele disponibile pentru utilizatorii care doresc să efectueze coinjoins pe Bitcoin. Ne aflăm într-o perioadă pivotală, iar piața coinjoin trece printr-o restructurare majoră. Prin urmare, acest capitol va fi probabil actualizat în timp.*

Pentru moment, există în principal 3 implementări diferite de coinjoin pe Bitcoin:
- Whirlpool;
- Wabisabi;
- JoinMarket.
Fiecare dintre aceste implementări își propune să rupă istoria UTXO-urilor prin tranzacții coinjoin. Cu toate acestea, mecanismele lor variază semnificativ. Prin urmare, este esențial să înțelegem cum funcționează fiecare pentru a alege opțiunea cea mai potrivită pentru nevoile tale.

### JoinMarket

JoinMarket, creat în 2015 de Adam Gibson și Chris Belcher, se distinge de alte implementări coinjoin datorită modelului său unic de potrivire a utilizatorilor. Acest sistem se bazează pe o piață de schimb P2P unde unii utilizatori, "makerii", își pun la dispoziție bitcoinii pentru mixare, în timp ce alții, "takerii", folosesc acești fonduri pentru a efectua coinjoins în schimbul unei taxe.

![BTC204](assets/notext/53/01.webp)

În acest model, "makerii" își lasă bitcoinii disponibili pentru "takeri" și primesc taxe în schimbul serviciului lor. Pe de altă parte, "takerii" plătesc pentru a folosi bitcoinii "makerilor" pentru a efectua propriile tranzacții coinjoin. Taxele de serviciu variază în funcție de rol: "makerii" acumulează taxe pentru oferta lor de lichiditate, în timp ce "takerii" plătesc taxele. Această piață funcționează liber fără condiții de utilizare.

Unul dintre principalele dezavantaje ale JoinMarket este complexitatea utilizării, care necesită o anumită familiaritate cu terminalele pentru a-l exploata eficient. Deși această complexitate nu este o barieră pentru un utilizator experimentat, poate limita accesul publicului larg. Cu toate acestea, introducerea recentă a unei interfețe web numită JAM a facilitat oarecum utilizarea sa.

![BTC204](assets/notext/53/02.webp)

Sursa: [JAM](https://github.com/joinmarket-webui/jam/blob/devel/docs/assets/screenshot-dark.webp)

Cu toate acestea, bariera tehnică rămâne un obstacol major. În ecosistemul coinjoin, unde confidențialitatea este îmbunătățită de numărul de participanți, orice limitare care reduce accesibilitatea afectează direct lichiditatea disponibilă, care este un factor crucial pentru eficiența mixării. Bitcoin, deja o nișă în tranzacțiile financiare, își vede utilizarea coinjoins ca o sub-nișă, iar JoinMarket reprezintă o fracțiune și mai specializată, restricționând astfel potențialul său de a crește anonseturile utilizatorilor săi.

În ciuda modelului său inovator P2P de potrivire pentru coinjoins, JoinMarket are unele dezavantaje semnificative, în special în ceea ce privește structura tranzacțională. Spre deosebire de alte implementări precum Whirlpool, JoinMarket nu garantează egalitate perfectă între ieșiri, și este posibil să se traceze legături deterministe între intrări și ieșiri. Mai mult, îi lipsește instrumente pentru a preveni mixarea din nou a monedelor care au fost deja mixate împreună, ceea ce ar putea compromite confidențialitatea căutată de utilizatori.
În final, deși conceptul JoinMarket este interesant, în special pentru cei interesați de o piață de lichiditate dinamică, slăbiciunile sale structurale și complexitatea tehnică îl fac, în opinia mea, mai puțin atractiv, atât pentru novici, cât și pentru experții care caută o implementare coinjoin.
### Wabisabi
Wabisabi este o altă implementare a coinjoin, cu o abordare care centralizează coordonarea tranzacțiilor. Acest model a fost proiectat de Ádám Ficsór (nopara73), Yuval Kogman, Lucas Ontivero și István András Seres în 2021 și a fost integrat în software-ul Wasabi 2.0 în anul următor. Wabisabi este precis o evoluție a modelului coinjoin al software-ului Wasabi lansat în 2018.

Spre sfârșitul anilor 2010, Wasabi a adoptat o structură de tranzacție pentru coinjoin-urile sale care era radical diferită de cea a Whirlpool. Pentru a crește anonset-urile participanților săi, Wasabi a utilizat tranzacții coinjoin foarte mari, grupând zeci de participanți. În contrast, Whirlpool a optat pentru multiple tranzacții mici, permițând o creștere exponențială a anonset-urilor cu fiecare ciclu.

Metodele de gestionare a restului au deosebit de asemenea cele două implementări. Cu Whirlpool, restul era exclus și izolat de UTXO-uri înainte de ciclurile coinjoin datorită TX0, un concept pe care îl voi explica mai detaliat în capitolul următor. La Wasabi, pe de altă parte, restul forma unul dintre output-urile tranzacției coinjoin, menținând legături deterministe între anumite input-uri și output-uri.

Cu Wabisabi, versiunea 2.0 a Wasabi și-a adaptat abordarea față de coinjoin-uri pentru a se apropia de cea a Whirlpool. Deși tranzacțiile coinjoin rămân foarte mari, este acum posibil să se lanseze mai multe cicluri succesive, urmând astfel modelul Whirlpool. Un efort deosebit a fost de asemenea făcut pe gestionarea restului: spre deosebire de Wasabi 1.0, unde restul era direct legat de input-urile utilizatorilor, Wabisabi caută să subdivizeze restul în mai multe sume mici, distribuite în denominații egale pentru toți participanții.

Să ilustrăm acest lucru cu un exemplu simplificat implicând doar 2 utilizatori: Alice dorește să amestece 115,000 sats și Bob, 210,000 sats. Ignorând taxele, cu Wasabi 1.0, o tranzacție coinjoin ar fi generat 3 output-uri de 100,000 sats, plus 1 rest de 15,000 sats pentru Alice și 1 rest de 10,000 sats pentru Bob. Output-urile de rest ar fi fost întotdeauna legate de input-uri:

Sub Wabisabi, aceeași tranzacție ar fi produs 3 output-uri de 100,000 sats și 5 output-uri de 5,000 sats, dispersând astfel restul într-un mod în care acesta nu este direct urmăribil la un input specific:

Personal, consider că gestionarea restului în Wabisabi prezintă mai multe riscuri care ar putea compromite eficacitatea sa în ceea ce privește confidențialitatea:
- Când un utilizator contribuie cu un UTXO semnificativ mai mare decât cele ale altor participanți, acesta ajunge inevitabil cu o sumă de rest care va fi legată de input-ul său. Acest lucru contravine obiectivului inițial al protocolului, care vizează eliminarea oricărui rest identificabil;
- Multiplicarea denominațiilor pentru a fragmenta restul poate paradoxal să dăuneze eficienței amestecării. Acest proces poate duce la o scădere a anonset-urilor pentru anumite output-uri, deoarece acestea devin mai ușor identificabile.
- Această metodă generează de asemenea UTXO-uri de valoare scăzută care reprezintă o problemă de gestionare pentru utilizator. Aceste UTXO-uri mici, dacă devin prea costisitoare pentru a fi cheltuite în raport cu valoarea lor, pot deveni "praf". Acest fenomen îl împinge pe utilizator să combine mai multe UTXO-uri în intrări în tranzacțiile lor viitoare sau să le consolideze. În ambele cazuri, din cauza COH, acest lucru poate fie să scadă anonseturile obținute, fie să anuleze complet beneficiile de confidențialitate dobândite prin coinjoin-ul inițial.
Spre deosebire de Whirlpool, care implementează protocolul ZeroLink asigurând o separare riguroasă între UTXO-urile pre-mix și post-mix, Wabisabi nu menține această segregare strictă. De asemenea, au existat probleme cu reutilizarea adreselor de către unii clienți Wasabi, care sunt evident foarte dăunătoare pentru utilizator.

În versiunea 2.0 a Wasabi, a fost implementată o nouă politică de taxe pentru coinjoin. Acum, taxele coordonatorului sunt stabilite la 0,3% pentru UTXO-uri mai mari de 0,01 bitcoin, în timp ce pentru UTXO-urile mai mici, aceste taxe sunt complet eliminate. Mai mult, remixurile pentru aceste UTXO-uri mici sunt gratuite, deși taxele de minare rămân responsabilitatea utilizatorului pentru toate tranzacțiile, inclusiv remixurile.

Această politică contrastează cu cea a Whirlpool, unde taxele rămân fixe, indiferent de dimensiunea anonseturilor obținute. Cu Wasabi 2.0, deși taxele coordonatorului sunt eliminate pentru UTXO-urile mici, utilizatorul trebuie să plătească în continuare taxele de minare pentru toate tranzacțiile, inclusiv remixurile.
La momentul redactării, utilizarea Wabisabi a devenit notabil mai complexă în urma evenimentelor recente. Într-adevăr, după arestarea fondatorilor Samourai Wallet, zkSNACKs, compania care finanțează și gestionează dezvoltarea Wasabi, a anunțat încheierea serviciului său de coordonare coinjoin pe 1 iunie 2024. Acest coordonator, care era setat implicit pe Wasabi, avea majoritatea lichidităților.

Cu închiderea acestui coordonator principal, utilizatorii trebuie acum să se conecteze la noi coordonatori independenți. Această schimbare ridică preocupări: pe de o parte, noii coordonatori s-ar putea să nu aibă suficientă lichiditate, reducând astfel eficacitatea coinjoin-urilor în termeni de confidențialitate. Pe de altă parte, există riscul de a întâlni un coordonator rău intenționat. Această situație adaugă noi riscuri semnificative pentru cei care doresc să utilizeze Wabisabi.

Dincolo de problemele tehnice, decizia companiei zkSNACKs, din spatele Wasabi, de a utiliza serviciile unei companii de analiză a lanțului pentru a filtra participanții la coinjoins ridică întrebări serioase etice și strategice. Ideea inițială era de a preveni utilizarea coinjoin-urilor pe Wasabi de către criminali, o mișcare care poate părea legitimă. Totuși, acest lucru ridică un paradox: să plătești taxe unui coordonator, a cărui misiune principală este de a îmbunătăți confidențialitatea utilizatorilor, doar pentru ca acesta să finanțeze apoi o companie al cărei scop este de a compromite aceeași confidențialitate.

Și mai îngrijorător este principiul filtrării, care contrastează puternic cu filozofia Bitcoin de a oferi un sistem financiar deschis și necenzurabil. Deși poate părea justificat să vrei să excluzi activitățile criminale, această filtrare ar putea afecta de asemenea indivizi ale căror acțiuni, deși clasificate ca ilegale în unele contexte, ar putea fi moral justificabile sau social benefice. Exemplul lui Edward Snowden ilustrează perfect această dicotomie: considerat un criminal de unele guverne pentru dezvăluirile sale, el este văzut de alții ca un avertizor care a acționat în interes public. Această complexitate subliniază pericolul potențial al filtrării care, deși pleacă de la o intenție bună, poate în cele din urmă să încalce drepturile și securitatea utilizatorilor legitimi. Aș fi putut menționa de asemenea activiștii și jurnaliștii care sunt persecutați sub anumite regimuri autoritare.
După cum probabil ați înțeles, preferința mea merge fără îndoială către modelul Whirlpool pentru efectuarea coinjoin-urilor pe Bitcoin. Acest sistem se remarcă prin rigurozitatea sa și oferă garanții superioare în ceea ce privește confidențialitatea. De asemenea, este singurul care propune un amestec considerat perfect într-un context matematic. Din punctul meu de vedere, acest model reprezintă viitorul coinjoin-urilor pe Bitcoin. Prin urmare, vă invit să explorați mai profund acest model în capitolul următor.
## Funcționarea Whirlpool
<chapterId>bdbd7109-e36d-4b4f-a3c6-928df4e9bfda</chapterId>

Whirlpool se distinge de alte metode coinjoin prin utilizarea tranzacțiilor "_ZeroLink_", care asigură că nu există absolut nicio legătură tehnică posibilă între toate intrările și toate ieșirile. Acest amestec perfect este realizat printr-o structură în care fiecare participant contribuie cu o sumă identică la intrare (cu excepția taxelor de minare), generând astfel ieșiri de sume perfect egale.

Această abordare restrictivă asupra intrărilor conferă tranzacțiilor coinjoin Whirlpool o caracteristică unică: absența totală a legăturilor deterministe între intrări și ieșiri. Cu alte cuvinte, fiecare ieșire are o probabilitate egală de a fi atribuită oricărui participant, în raport cu toate celelalte ieșiri ale tranzacției.

![BTC204](assets/notext/54/01.webp)

### Funcționarea Generală a Whirlpool

Inițial, numărul de participanți în fiecare coinjoin Whirlpool era limitat la 5, cu 2 noi intranți și 3 remixeri (vom explica aceste concepte mai departe). Totuși, creșterea taxelor pentru tranzacțiile on-chain observată în 2023 i-a determinat pe echipele Samourai să-și reconsidere modelul pentru a îmbunătăți confidențialitatea reducând în același timp costurile. Astfel, luând în considerare situația pieței taxelor și numărul de participanți, coordonatorul poate acum să organizeze coinjoin-uri incluzând 6, 7 sau 8 participanți. Aceste sesiuni îmbunătățite sunt desemnate sub numele de "_Surge Cycles_". Este important de notat că, indiferent de configurație, există întotdeauna doar 2 noi intranți în coinjoin-urile Whirlpool.

Astfel, tranzacțiile Whirlpool sunt caracterizate de un număr identic de intrări și ieșiri, care pot fi:
- 5 intrări și 5 ieșiri;

![BTC204](assets/notext/54/02.webp)

- 6 intrări și 6 ieșiri;

![BTC204](assets/notext/54/03.webp)

- 7 intrări și 7 ieșiri;

![BTC204](assets/notext/54/04.webp)

- 8 intrări și 8 ieșiri.

![BTC204](assets/notext/54/05.webp)
Modelul propus de Whirlpool se bazează astfel pe tranzacții coinjoin de dimensiuni mici. Spre deosebire de Wabisabi și JoinMarket, unde robustețea anonseturilor se bazează pe volumul de participanți într-un singur ciclu (sau câteva cicluri), Whirlpool pariază pe înlănțuirea mai multor cicluri de dimensiuni mici. În acest model, utilizatorul suportă taxe doar la intrarea inițială într-un pool, permițându-i să participe la o multitudine de remixuri fără costuri suplimentare. Noii intranți acoperă taxele de minare pentru remixeri.

Cu fiecare coinjoin adițional în care un coin participă, alături de colegii săi întâlniți în trecut, anonseturile vor crește exponențial. Scopul este, prin urmare, să se profite de aceste remixuri gratuite care, cu fiecare apariție, contribuie la întărirea densității anonseturilor asociate fiecărui coin amestecat.

![BTC204](assets/notext/54/06.webp)

Whirlpool a fost conceput având în minte două cerințe importante:
- Accesibilitatea implementării pe dispozitive mobile, având în vedere că Samourai Wallet este în primul rând o aplicație pentru smartphone;
- Viteza ciclurilor de remixare pentru a încuraja o creștere semnificativă a anonseturilor.

Aceste imperative au ghidat alegerile dezvoltatorilor Samourai Wallet în proiectarea Whirlpool, determinându-i să limiteze numărul de participanți per ciclu. Prea puțini participanți ar fi compromis eficacitatea coinjoin, reducând drastic anonseturile generate în fiecare ciclu, în timp ce prea mulți participanți ar fi pus probleme de gestionare pe aplicațiile mobile și ar fi împiedicat fluxul ciclurilor.

În cele din urmă, nu este necesar să avem un număr mare de participanți per coinjoin pe Whirlpool, deoarece anonseturile sunt realizate prin acumularea mai multor cicluri de coinjoin. Principiul cel mai important aici este omogenitatea UTXO-urilor tuturor participanților, deoarece acest lucru permite un amestec perfect și, astfel, să beneficiezi pe deplin de ciclurile de amestecare și reamestecare.

### Piscinele și taxele pentru coinjoin

Pentru ca aceste multiple cicluri să crească efectiv anonseturile monedelor amestecate, trebuie stabilit un anumit cadru pentru a restricționa cantitățile de UTXO-uri utilizate. Whirlpool definește astfel diferite piscine.

O piscină reprezintă un grup de utilizatori care doresc să se amestece împreună, care sunt de acord asupra cantității de UTXO-uri de utilizat pentru a optimiza procesul de coinjoin menținând în același timp o omogenitate perfectă a monedelor. Fiecare piscină specifică o sumă fixă pentru UTXO, pe care utilizatorul trebuie să o respecte pentru a participa. Astfel, pentru a efectua coinjoins cu Whirlpool, trebuie să selectezi o piscină. Piscinele disponibile în acest moment sunt următoarele:
- 0.5 bitcoin;
- 0.05 bitcoin;
- 0.01 bitcoin;
- 0.001 bitcoin (= 100,000 sats).
Prin alăturarea unei piscine cu bitcoinii tăi, aceștia vor fi împărțiți pentru a genera UTXO-uri care sunt perfect omogene cu cele ale celorlalți participanți din piscină. Fiecare piscină are o limită maximă; astfel, pentru sume care depășesc această limită, vei fi forțat fie să faci două intrări separate în aceeași piscină, fie să te orientezi către o altă piscină cu o sumă mai mare:
| Piscină (bitcoin) | Suma maximă per intrare (bitcoin) |
|-------------------|------------------------------------|
| 0.5               | 35                                 |
| 0.05              | 3.5                                |
| 0.01              | 0.7                                |
| 0.001             | 0.025                              |

Un UTXO este considerat că aparține unei piscine când este pregătit să fie integrat într-un coinjoin. Cu toate acestea, acest lucru nu înseamnă că utilizatorul își pierde posesia asupra lui. Așa cum am văzut în primele capitole ale acestei părți, prin diferitele cicluri de amestecare, îți păstrezi controlul complet asupra cheilor tale și, prin urmare, asupra bitcoinilor tăi. Acesta este ceea ce diferențiază tehnica coinjoin de alte tehnici centralizate de amestecare.

Pentru a intra într-o piscină coinjoin, trebuie să plătești taxe de serviciu precum și taxe de minare. Taxele de serviciu sunt fixe pentru fiecare piscină și sunt destinate să compenseze echipele responsabile pentru dezvoltarea și întreținerea Whirlpool.

Taxele de serviciu pentru utilizarea Whirlpool sunt de plătit o singură dată la intrarea în piscină. Odată ce acest pas este completat, ai posibilitatea de a participa la un număr nelimitat de remixuri fără taxe suplimentare. Iată taxele fixe actuale pentru fiecare piscină:

| Piscină (bitcoin) | Taxa de intrare (bitcoin) |
|-------------------|---------------------------|
| 0.5               | 0.0175                    |
| 0.05              | 0.00175                   |
| 0.01              | 0.0005 (50,000 sats)      |
| 0.001          | 0.00005 (5,000 sats)        |
Aceste taxe funcționează esențial ca un bilet de intrare pentru pool-ul ales, indiferent de suma pe care o investești în coinjoin. Astfel, fie că te alături pool-ului de 0.01 cu exact 0.01 BTC sau intri în el cu 0.5 BTC, taxele vor rămâne aceleași ca valoare absolută.

Înainte de a proceda cu Whirlpool coinjoins, utilizatorul are deci o alegere între 2 strategii:
- Optează pentru un pool mai mic pentru a minimiza taxele de serviciu, știind că va primi în schimb mai multe UTXO-uri de valoare mică;
- Sau preferă un pool mai mare, acceptând să plătească taxe mai mari pentru a obține un număr redus de UTXO-uri de valoare mai mare.
De obicei, nu se recomandă combinarea mai multor UTXO-uri mixate după ciclurile de coinjoin, deoarece acest lucru ar putea compromite confidențialitatea obținută, în special din cauza euristică de proprietate comună a intrărilor (CIOH: *Common-Input-Ownership-Heuristic*). Prin urmare, ar putea fi înțelept să alegi un pool mai mare, chiar dacă înseamnă să plătești mai mult, pentru a evita să ai prea multe UTXO-uri de valoare mică ca output-uri. Utilizatorul trebuie să cântărească aceste compromisuri pentru a alege pool-ul pe care îl preferă.
Pe lângă taxele de serviciu, trebuie luate în considerare și taxele de minare inerente oricărei tranzacții Bitcoin. Ca utilizator Whirlpool, va trebui să plătești taxele de minare pentru tranzacția de pregătire (`Tx0`) precum și pentru primul coinjoin. Toate remixurile ulterioare vor fi gratuite, datorită modelului Whirlpool care se bazează pe plata noilor participanți.

Într-adevăr, în fiecare Whirlpool coinjoin, 2 utilizatori dintre intrări sunt noi participanți. Celelalte intrări provin de la remixeri. Ca rezultat, taxele de minare pentru toți participanții la tranzacție sunt acoperite de acești 2 noi participanți, care vor beneficia apoi și ei de remixuri gratuite:

![BTC204](assets/en/54/07.webp)

Datorită acestui sistem de taxe, Whirlpool se diferențiază cu adevărat de alte implementări coinjoin deoarece anonseturile UTXO-urilor nu sunt proporționale cu prețul plătit de utilizator. Astfel, este posibil să se atingă niveluri considerabil de înalte de anonimitate plătind doar taxa de intrare a pool-ului și taxele de minare pentru 2 tranzacții („Tx0” și mixul inițial).

Este important de notat că utilizatorul va trebui, de asemenea, să acopere taxele de minare pentru a retrage UTXO-urile din pool după efectuarea mai multor coinjoins, cu excepția cazului în care a selectat opțiunea „mix to”, care permite furnizarea unei adrese externe care va primi direct fondurile ca un output de coinjoin, fără nicio tranzacție suplimentară.

### Conturi de Portofel HD

Pentru a efectua un coinjoin prin Whirlpool, portofelul trebuie să genereze mai multe conturi distincte. Acesta este principiul protocolului ZeroLink. Un cont, în contextul unui portofel HD (*Hierarchical Deterministic*), constituie o secțiune complet izolată de celelalte, această separare având loc la al treilea nivel de adâncime al ierarhiei portofelului, adică la nivelul `xpub`.

![BTC204](assets/en/54/08.webp)

Un portofel HD poate deriva teoretic până la `2^(32/2)` de conturi diferite. Contul inițial, utilizat în mod implicit pe toate portofelele Bitcoin, corespunde indexului `0'`.

Pentru portofelele adaptate la Whirlpool, se utilizează 4 conturi pentru a satisface nevoile procesului ZeroLink:
- **Contul de depozit**, identificat prin indexul `0'`;
- Contul **bad bank** (sau "schimb toxic"), identificat prin indexul `2 147 483 644'`;
- Contul **premix**, identificat prin indexul `2 147 483 645`;
- Contul **postmix**, identificat prin indexul `2 147 483 646`.

Fiecare dintre aceste conturi îndeplinește o funcție specifică în procesul coinjoin, pe care îl vom explora în secțiunile următoare.

Toate aceste conturi sunt legate de un singur seed, permițând utilizatorului să recupereze accesul la toți bitcoinii săi folosind fraza de recuperare și, dacă este necesar, parola. Totuși, este necesar să specifici software-ului, în timpul acestei operațiuni de recuperare, diferiții indici de conturi care au fost utilizați.

Să examinăm acum diferitele etape ale unui coinjoin Whirlpool în cadrul acestor conturi.

### TX0

Punctul de plecare al oricărui coinjoin Whirlpool este **contul de depozit**. Acest cont este cel pe care îl folosești automat când creezi un nou portofel Bitcoin. Acest cont trebuie creditat cu bitcoinii pe care dorești să îi amesteci.

`Tx0` reprezintă primul pas în procesul de amestecare Whirlpool. Scopul său este să pregătească și să egalizeze UTXO-urile pentru coinjoin, împărțindu-le în unități corespunzătoare sumei selectate pentru pool, pentru a asigura omogenitatea amestecării. UTXO-urile egalizate sunt apoi trimise către contul **premix**. În ceea ce privește diferența care nu poate intra în pool, aceasta este separată într-un cont specific: **bad bank** (sau "schimb toxic").

Această tranzacție inițială `Tx0` servește și la achitarea taxelor de serviciu datorate coordonatorului coinjoin. Spre deosebire de pașii următori, această tranzacție nu este colaborativă; utilizatorul trebuie, prin urmare, să suporte integral taxele de minare:

![BTC204](assets/en/54/09.webp)

În acest exemplu de tranzacție `Tx0`, o intrare de `372 000 sats` din contul nostru **de depozit** este împărțită în mai multe UTXO-uri de ieșire, care sunt distribuite astfel:
- O sumă de `5 000 sats` destinată coordonatorului pentru taxele de serviciu, corespunzând intrării în pool de `100 000 sats`;
- 3 UTXO-uri pregătite pentru amestecare, redirecționate către contul nostru **premix** și înregistrate cu coordonatorul. Aceste UTXO-uri sunt egalizate la `108 000 sats` fiecare, pentru a acoperi taxele de minare pentru amestecul lor inițial viitor;
- Surplusul care nu poate intra în pool, fiind prea mic, este considerat schimb toxic. Este trimis către contul său specific. Aici, acest schimb se ridică la `40 000 sats`;
- În final, există `3,000 sats` care nu constituie o ieșire, dar sunt taxele de minare necesare pentru a confirma `Tx0`.
De exemplu, iată o tranzacție Tx0 Whirlpool reală (nu de la mine): [edef60744f539483d868caff49d4848e5cc6e805d6cdc8d0f9bdbbaedcb5fc46](https://mempool.space/fr/tx/edef60744f539483d868caff49d4848e5cc6e805d6cdc8d0f9bdbbaedcb5fc46)

![BTC204](assets/notext/54/10.webp)

### Schimbul Toxic

Excesul care nu a putut fi integrat în pool, aici echivalentul a `40,000 sats`, este redirecționat către contul **bad bank**, de asemenea referit ca "schimb toxic", pentru a asigura o separare strictă de celelalte UTXO-uri din portofel.
Acest UTXO este periculos pentru confidențialitatea utilizatorului deoarece nu numai că este încă legat de trecutul său, și astfel posibil de identitatea proprietarului său, dar este și marcat ca aparținând unui utilizator care a participat la un coinjoin.
![BTC204](assets/notext/54/11.webp)

Dacă acest UTXO este combinat cu ieșiri mixate, acestea vor pierde toată confidențialitatea obținută în timpul ciclurilor de coinjoin, în special din cauza CIOH (*Common-Input-Ownership-Heuristic*). Dacă este combinat cu alte schimburi toxice, utilizatorul riscă să piardă confidențialitatea deoarece acest lucru va lega diferitele intrări din ciclurile de coinjoin. Prin urmare, trebuie manevrat cu precauție. Vom discuta mai detaliat despre gestionarea acestor UTXO-uri toxice în ultima secțiune a acestui capitol.

### Amestecul Inițial

După ce `Tx0` este completat, UTXO-urile egalizate sunt trimise în contul **premix** al portofelului nostru, pregătite să fie introduse în primul lor ciclu de coinjoin, numit și "amestecul inițial". Dacă, ca în exemplul nostru, `Tx0` generează mai multe UTXO-uri destinate amestecării, fiecare dintre ele va fi integrat într-un amestec inițial separat.

La sfârșitul acestor prime amestecuri, contul **premix** va fi gol, în timp ce monedele noastre, după ce au plătit taxele de minare pentru acest prim coinjoin, vor fi ajustate exact la suma definită de pool-ul ales. În exemplul nostru, UTXO-urile noastre inițiale de `108,000 sats` vor fi reduse exact la `100,000 sats`.

![BTC204](assets/notext/54/12.webp)

### Remixurile
După amestecul inițial, UTXO-urile sunt transferate în contul **postmix**. Acest cont adună atât UTXO-urile deja amestecate, cât și pe cele care așteaptă să fie remixate. Când clientul Whirlpool este activ, UTXO-urile din contul **postmix** sunt automat disponibile pentru remixare și vor fi alese aleatoriu pentru a participa în aceste noi cicluri.
Ca un memento, remixurile sunt apoi 100% gratuite: nu sunt necesare taxe suplimentare de serviciu sau taxe de minare. Păstrarea UTXO-urilor în contul **postmix** menține astfel valoarea lor intactă și îmbunătățește simultan anonimatul lor. De aceea este important să permiți acestor monede să participe la multiple cicluri de coinjoin. Nu te costă absolut nimic și crește nivelurile lor de anonimat.

Când decizi să cheltuiești UTXO-urile mixate, poți face acest lucru direct din acest cont **postmix**. Este recomandabil să păstrezi UTXO-urile mixate în acest cont pentru a beneficia de remixuri gratuite și pentru a preveni ieșirea lor din circuitul Whirlpool, ceea ce ar putea scădea confidențialitatea lor.

### Cum să gestionezi corect postmixul?

După efectuarea ciclurilor de coinjoin, cea mai bună strategie este să păstrezi UTXO-urile în contul **postmix**, așteptând utilizarea lor viitoare. Este chiar recomandabil să le lași să se remixeze la nesfârșit până când trebuie să le cheltuiești.

Unii utilizatori ar putea lua în considerare transferul bitcoinilor mixați într-un portofel securizat de un portofel hardware. Acest lucru este posibil, dar este important să urmezi meticulos recomandările Samourai Wallet pentru a nu compromite confidențialitatea dobândită.

Combinarea UTXO-urilor este greșeala cea mai frecvent făcută. Este necesar să eviți combinarea UTXO-urilor mixate cu UTXO-urile nemixate în aceeași tranzacție, pentru a evita Common-Input-Ownership-Heuristic (CIOH). Acest lucru necesită o gestionare atentă a UTXO-urilor în cadrul portofelului tău, în special în ceea ce privește etichetarea.

![BTC204](assets/notext/54/13.webp)
Este de asemenea important să fii precaut în legătură cu consolidarea UTXO-urilor mixte între ele. Consolidări moderate sunt concepibile dacă UTXO-urile tale mixte au seturi anonime semnificative, dar acest lucru va scădea inevitabil confidențialitatea monedelor tale. Asigură-te că consolidările nu sunt nici prea semnificative, nici efectuate după un număr insuficient de remixări, pentru a evita riscul de a stabili legături deducibile între UTXO-urile tale înainte și după ciclurile de coinjoin. În caz de îndoială despre aceste manipulări, cea mai bună practică este să nu consolidezi UTXO-urile postmix, și să le transferi unul câte unul în portofelul tău hardware, generând de fiecare dată o nouă adresă goală. Din nou, amintește-ți să etichetezi corespunzător fiecare UTXO primit. De asemenea, se sfătuiește împotriva transferării UTXO-urilor tale postmix într-un portofel care folosește scripturi neobișnuite. De exemplu, dacă intri în Whirlpool de pe un portofel multisig care folosește scripturi `P2WSH`, există o șansă mică să fii amestecat cu alți utilizatori care au același tip de portofel inițial. Dacă retragi postmixul în același portofel multisig, nivelul de confidențialitate al bitcoinilor tăi mixați va fi considerabil diminuat. Dincolo de scripturi, există multe alte amprente ale portofelului care te pot înșela.
Ca în cazul oricărei tranzacții Bitcoin, este de asemenea important să nu reutilizezi adresele de primire. Fiecare tranzacție nouă ar trebui primită pe o nouă adresă goală.

Cea mai simplă și sigură soluție este să lași UTXO-urile tale mixate să se odihnească în contul lor **postmix**, permițându-le să se remixeze și să le atingi doar pentru a cheltui. Portofelele Samourai și Sparrow au protecții suplimentare împotriva tuturor acestor riscuri legate de analiza lanțului. Aceste protecții te ajută să eviți să faci greșeli.

### Cum să gestionezi corect schimbul toxic?

În continuare, trebuie să fii atent în gestionarea schimbului tău toxic, schimbul care nu a putut intra în piscina de coinjoin. Aceste UTXO-uri toxice, rezultate din utilizarea Whirlpool, reprezintă un risc pentru confidențialitatea ta deoarece stabilesc o legătură între tine și utilizarea coinjoin. Prin urmare, este imperativ să le manevrezi cu precauție și să nu le combini cu alte UTXO-uri, în special cu UTXO-uri mixate.

Iată diferite strategii de luat în considerare pentru utilizarea lor:
- **Amestecă-le în piscine mai mici:** Dacă UTXO-ul tău toxic este suficient de mare pentru a intra singur într-o piscină mai mică, ia în considerare amestecarea acestuia. Aceasta este adesea cea mai bună opțiune. Totuși, combinarea mai multor UTXO-uri toxice pentru a accesa o piscină este descurajată, deoarece acest lucru ar putea lega diferitele tale intrări;
- **Marchează-le ca "nespendabile":** O altă abordare este să nu le mai folosești, să le marchezi ca "nespendabile" în contul lor dedicat și să le hodlești. Acest lucru asigură că nu le vei cheltui accidental. Dacă valoarea bitcoinului crește, pot apărea noi piscine mai potrivite pentru UTXO-urile tale toxice;
- **Fă donații:** Ia în considerare să faci donații, chiar și modeste, dezvoltatorilor care lucrează la Bitcoin și software-ul asociat acestuia. Poți dona și organizațiilor care acceptă BTC. Dacă gestionarea UTXO-urilor tale toxice pare prea complicată, poți pur și simplu să scapi de ele făcând o donație.
- **Cumpără carduri cadou:** Platforme precum [Bitrefill](https://www.bitrefill.com/) îți permit să schimbi bitcoinii pentru carduri cadou care pot fi folosite la diverși comercianți. Aceasta poate fi o modalitate de a dispune de UTXO-urile tale toxice fără a pierde valoarea asociată.
- **Consolidează-le pe Monero:** Portofelul Samourai oferă un serviciu de schimb atomic între BTC și XMR. Aceasta este ideală pentru gestionarea UTXO-urilor toxice prin consolidarea lor pe Monero, fără a compromite confidențialitatea prin KYC, înainte de a le trimite înapoi la Bitcoin. Totuși, această opțiune poate fi costisitoare în termeni de taxe de minare și prime datorate constrângerilor de lichiditate.
- **Trimite-le în Lightning Network:** Transferarea acestor UTXO-uri în Lightning Network pentru a beneficia de taxe de tranzacție reduse este o opțiune interesantă. Cu toate acestea, această metodă poate dezvălui anumite informații în funcție de utilizarea Lightning și, prin urmare, ar trebui practicată cu precauție.

### Cum să folosești Whirlpool?

După arestarea fondatorilor portofelului Samourai și confiscarea serverelor lor pe 24 aprilie 2024, instrumentul Whirlpool nu mai funcționează, chiar și pentru cei care au propriul Dojo. Anterior, era disponibil pe Samourai Wallet și Sparrow Wallet.

![BTC204](assets/notext/54/14.webp)

Cu toate acestea, rămâne posibil ca acest instrument să fie repus în funcțiune în săptămânile următoare, în funcție de rezultatul proceselor, sau relansat într-un mod diferit. În orice caz, cred că piața pentru coinjoin pe Bitcoin nu va rămâne fără o ofertă pentru mult timp, deoarece există o cerere clară. Mai mult, modelul Whirlpool, fiind cel mai avansat în termeni de confidențialitate, va fi cu siguranță utilizat în viitor pentru alte implementări.

Urmărim îndeaproape evoluția acestui caz, precum și dezvoltările referitoare la instrumentele asociate. Fiți siguri că vom actualiza acest curs de formare pe măsură ce apar noi informații.

În capitolul următor, vom descoperi ce sunt "anonsets", cum sunt calculate aceste indicatori și cum ne pot ajuta să estimăm eficacitatea ciclurilor de coinjoin.

https://planb.network/tutorials/privacy/coinjoin-sparrow-wallet

https://planb.network/tutorials/privacy/coinjoin-samourai-wallet

https://planb.network/tutorials/privacy/coinjoin-dojo

## Seturi de Anonimitate
<chapterId>be1093dc-1a74-40e5-9545-2b97a7d7d431</chapterId>

După ce am studiat cum funcționează coinjoins și provocările asociate cu amestecarea eficientă, acum vom învăța cum să măsurăm această eficacitate. Cum să determinăm dacă un proces de coinjoin a fost eficace și ce grad de anonimitate a dobândit o monedă? Acesta este subiectul pe care îl vom explora în acest capitol cu seturile de anonimitate sau "anonsets" în engleză.

### Reamintire despre Utilitatea Coinjoin
Utilitatea CoinJoin constă în capacitatea sa de a produce negabilitate plauzibilă prin imersarea monedei tale într-un grup de monede de nedistinguit. Scopul acestei acțiuni este de a rupe legăturile de urmăribilitate, atât din trecut spre prezent, cât și din prezent spre trecut.
Cu alte cuvinte, un analist care cunoaște tranzacția ta inițială (`Tx0`) la intrarea în ciclurile CoinJoin nu ar trebui să poată identifica cu certitudine UTXO-ul tău la ieșirea din ciclurile de remixare (analiză de la intrarea în ciclu la ieșirea din ciclu).

![BTC204](assets/en/55/01.webp)

În mod invers, un analist care cunoaște UTXO-ul tău la ieșirea din ciclurile CoinJoin nu ar trebui să poată determina tranzacția originală la intrarea ciclurilor (analiză de la ieșirea din ciclu la intrarea în ciclu).

![BTC204](assets/en/55/02.webp)
Pentru a evalua dificultatea pentru un analist de a lega trecutul de prezent și invers, este necesar să cuantificăm dimensiunea grupurilor de monede omogene în cadrul cărora moneda ta este ascunsă. Această măsură ne spune numărul de analize care au o probabilitate identică. Astfel, dacă analiza corectă este înecată printre alte 3 analize de probabilitate egală, nivelul tău de ascundere este foarte scăzut. Totuși, dacă analiza corectă se află într-un set de 20.000 de analize, toate la fel de probabile, moneda ta este foarte bine ascunsă. Și precis, dimensiunea acestor grupuri reprezintă indicatori numiți "anonsets".
### Înțelegerea Anonsets

Anonsets servesc ca indicatori pentru a evalua gradul de confidențialitate al unui UTXO specific. Mai precis, ei măsoară numărul de UTXO-uri indistincte din setul care include moneda studiată. Cerința unui set UTXO omogen înseamnă că anonsets sunt de obicei calculați peste ciclurile CoinJoin. Utilizarea acestor indicatori este deosebit de relevantă pentru Whirlpool CoinJoins datorită uniformității lor.

Anonsets permit, după caz, să judece calitatea CoinJoins. O dimensiune mare a anonsetului semnifică un nivel înalt de anonimitate, deoarece devine dificil să distingi un UTXO specific în cadrul setului omogen.

Există 2 tipuri de anonsets:
- **Anonsetul prospectiv;**
- **Anonsetul retrospectiv.**

### Anonsetul Prospectiv

Anonsetul prospectiv indică dimensiunea grupului printre care UTXO-ul studiat este ascuns la ieșirea ciclului, știind UTXO-ul la intrare, adică numărul de monede indistincte prezente în acest grup. În engleză, numele acestui indicator este "forward anonset", sau "forward-looking metrics".
Acest indicator permite măsurarea rezistenței la confidențialitate a monedei împotriva unei analize de la trecut la prezent (input la output).

Această metrică estimează în ce măsură UTXO-ul tău este protejat împotriva încercărilor de a reconstrui istoria sa de la punctul său de intrare până la punctul său de ieșire în procesul de coinjoin.

De exemplu, dacă tranzacția ta a participat în primul său ciclu de coinjoin și au fost completate două cicluri descendente suplimentare, anonsetul prospectiv al monedei tale ar fi `13`:

Pentru exemplu, să ne imaginăm că moneda noastră la intrarea ciclului de coinjoin beneficiază de un anonset prospectiv de `86,871`. Practic, acest lucru înseamnă că este ascunsă printre `86,871` monede indistincte. Pentru un observator extern conștient de această monedă la începutul ciclurilor de coinjoin și încercând să urmărească ieșirea sa, ar fi confruntat cu `86,871` posibile UTXO-uri, fiecare cu o probabilitate identică de a fi moneda căutată.

### Anonsetul Retrospectiv

Anonsetul retrospectiv indică numărul de surse posibile pentru o monedă dată, știind UTXO-ul la ieșirea ciclului. Acest indicator măsoară rezistența la confidențialitate a monedei împotriva unei analize de la prezent la trecut (ieșire la input), adică cât de dificil este pentru un analist să urmărească înapoi la originea monedei tale, înainte de ciclurile de coinjoin. În engleză, numele acestui indicator este "backward anonset," sau "backward-looking metrics."

Știind UTXO-ul tău la ieșirea ciclurilor, anonsetul retrospectiv determină numărul de posibile tranzacții Tx0 care ar fi putut constitui intrarea ta în ciclurile de coinjoin. În diagrama de mai jos, acest lucru corespunde sumei tuturor bulelor portocalii.
![BTC204](assets/notext/55/07.webp)
De exemplu, să ne imaginăm că moneda noastră la ieșirea din ciclul coinjoin beneficiază de un anonset retrospectiv de `42,185`. Practic, acest lucru înseamnă că există `42,185` surse potențiale pentru acest UTXO. Dacă un observator extern identifică această monedă la sfârșitul ciclurilor și încearcă să-i urmărească originea, se va confrunta cu `42,185` surse posibile, toate având o probabilitate egală de a fi originea căutată.

![BTC204](assets/en/55/08.webp)

### Cum să calculăm concret anonseturile?
Este posibil să calculăm manual anonseturile folosind un explorator de blocuri pentru seturi mici. Totuși, pentru anonseturi mai mari, utilizarea unui instrument specializat devine imperativă. După cunoștințele mele, singurul software capabil să efectueze această sarcină este *Whirlpool Stats Tool*, un instrument Python dezvoltat de echipele de la Samourai și OXT. Din păcate, acest instrument este în prezent indisponibil urmând arestarea fondatorilor Samourai și întreruperea activității OXT, care era folosit pentru a extrage date din blockchain.
![BTC204](assets/notext/55/09.webp)

Așa cum am văzut în acest capitol, anonseturile pot fi calculate doar dacă există o anumită omogenitate în structura coinjoins. Și precis, în capitolul următor, vom descoperi cum să cuantificăm această omogenitate într-o tranzacție Bitcoin, fie că este vorba de un coinjoin sau o tranzacție mai tradițională.

https://planb.network/tutorials/privacy/wst-anonsets

## Entropie
<chapterId>e4fe289d-618b-49a2-84c9-68c562e708b4</chapterId>

Așa cum am văzut în această parte despre coinjoins, omogenitatea UTXO-urilor în intrări și ieșiri joacă un rol important în îmbunătățirea confidențialității unei tranzacții Bitcoin. Acest parametru permite negarea plauzibilă împotriva analizei lanțului. Există mai multe metode care pot măsura această omogenitate, dar una dintre cele mai eficiente, în opinia mea, este utilizarea indicatorilor furnizați de instrumentul *Boltzmann*, dezvoltat de echipele de la OXT și Samourai Wallet, în special entropia tranzacției. Acesta este ceea ce vom studia în detaliu în acest capitol.

Spre deosebire de anonseturi, care sunt calculate pe un set de tranzacții, indicatorii pe care îi vom prezenta aici se concentrează exclusiv pe o singură tranzacție, fie că este vorba de un coinjoin sau o tranzacție mai tradițională.

### Numărul de interpretări

Primul indicator care poate fi observat la o tranzacție Bitcoin este numărul total de interpretări posibile în ochii unui observator extern care analizează tranzacția. Luând în considerare valorile UTXO-urilor implicate în tranzacție, acest indicator indică numărul de moduri în care intrările pot fi asociate cu ieșirile. Cu alte cuvinte, determină numărul de interpretări posibile pe care o tranzacție le poate genera în fluxul de bitcoin din perspectiva unui observator extern care o analizează.

De exemplu, o simplă tranzacție de plată cu 1 intrare și 2 ieșiri va avea doar o interpretare, și anume că intrarea #0 a finanțat ieșirea #0 și ieșirea #1. Nu există alte interpretări posibile:

![BTC204](assets/notext/56/01.webp)

În contrast, un coinjoin structurat conform modelului Whirlpool 5x5 prezintă $1,496$ combinații posibile:
![BTC204](assets/notext/56/02.webp)
Un coinjoin Whirlpool Surge Cycle 8x8 se prezintă cu $9,934,563$ interpretări posibile:

![BTC204](assets/notext/56/03.webp)

### Entropia
Din numărul de interpretări ale unei tranzacții Bitcoin, putem calcula entropia acesteia.

În contextul general al criptografiei și informației, entropia este o măsură cantitativă a incertitudinii sau imprevizibilității asociate cu o sursă de date sau un proces aleator. Cu alte cuvinte, entropia este o modalitate de a măsura cât de dificilă este informația de prezis sau ghicit.

În contextul specific al analizei lanțurilor, entropia este de asemenea numele unui indicator, derivat din entropia Shannon și [inventat de LaurentMT](https://gist.github.com/LaurentMT/e758767ca4038ac40aaf), care poate fi calculat pentru o tranzacție Bitcoin.

Când o tranzacție prezintă un număr mare de interpretări posibile, este adesea mai relevant să ne referim la entropia sa. Acest indicator permite măsurarea lipsei de cunoștințe ale analiștilor despre configurația exactă a tranzacției. Cu alte cuvinte, cu cât entropia este mai mare, cu atât sarcina de identificare a fluxurilor de bitcoini între intrări și ieșiri devine mai dificilă pentru analiști.

În practică, entropia dezvăluie dacă, din perspectiva unui observator extern, o tranzacție prezintă multiple interpretări posibile, bazându-se exclusiv pe sumele de intrări și ieșiri, fără a lua în considerare alte modele și euristici externe sau interne. O entropie mare este atunci sinonimă cu o confidențialitate mai bună pentru tranzacție.

Entropia este definită ca logaritmul binar al numărului de combinații posibile. Iată formula utilizată cu $E$ fiind entropia tranzacției și $C$ numărul de interpretări posibile:

$$
E = \log_2(C)
$$

În matematică, logaritmul binar (logaritmul în baza 2) corespunde operației inverse de ridicare la putere a lui 2. Cu alte cuvinte, logaritmul binar al lui $x$ este exponentul la care trebuie ridicat $2$ pentru a obține $x$. Acest indicator este astfel exprimat în biți.

Să luăm exemplul calculării entropiei pentru o tranzacție coinjoin structurată conform modelului Whirlpool 5x5, care, după cum s-a menționat în secțiunea anterioară, prezintă un număr de interpretări posibile de $1,496$:

$$
\begin{align*}
C &= 1,496 \\
E &= \log_2(1,496) \\
E &= 10.5469 \text{ biți}
\end{align*}
$$
Astfel, această tranzacție coinjoin afișează o entropie de $10.5469$ biți, ceea ce este considerat foarte satisfăcător. Cu cât această valoare este mai mare, cu atât tranzacția admite mai multe interpretări diferite, sporind astfel nivelul său de confidențialitate.
Pentru o tranzacție coinjoin 8x8 care prezintă $9,934,563$ interpretări, entropia ar fi:

$$
\begin{align*}
C &= 9,934,563 \\
E &= \log_2(9,934,563) \\
E &= 23.244 \text{ biți}
\end{align*}
$$

Să luăm un alt exemplu cu o tranzacție standard de plată, având 1 intrare și 2 ieșiri: [1b1b0c3f0883a99f1161c64da19471841ed12a1f78e77fab128c69a5f578ccce](https://mempool.space/tx/1b1b0c3f0883a99f1161c64da19471841ed12a1f78e77fab128c69a5f578ccce)

![BTC204](assets/notext/56/04.webp)

În cazul acestei tranzacții, singura interpretare posibilă este: `(In.0) > (Out.0 ; Out.1)`. Prin urmare, entropia sa este stabilită la $0$:
Eficiență

Pornind de la entropia tranzacției, putem calcula de asemenea eficiența acesteia în termeni de confidențialitate. Acest indicator evaluează eficiența tranzacției comparând-o cu tranzacția optimă concepută într-o configurație identică.

Aceasta ne conduce la discuția despre conceptul de entropie maximă, care corespunde celei mai mari entropii pe care o structură specifică de tranzacție ar putea teoretic să o atingă. Eficiența tranzacției este apoi calculată prin confruntarea acestei entropii maxime cu entropia reală a tranzacției analizate.

Formula utilizată este următoarea, cu:
- $E_R$: entropia reală a tranzacției exprimată în biți;
- $E_M$: entropia maximă posibilă pentru o structură de tranzacție, de asemenea exprimată în biți;
- $Ef$: eficiența tranzacției în biți:

$$
Ef = E_R - E_M
$$

De exemplu, pentru o structură de tip coinjoin Whirlpool 5x5, entropia maximă este $10.5469$:

$$
\begin{align*}
E_R &= 10.5469 \\
E_M &= 10.5469 \\
Ef &= E_R - E_M \\
Ef &= 10.5469 - 10.5469 \\
Ef &= 0 \text{ biți}
\end{align*}
$$

Acest indicator este exprimat de asemenea ca un procentaj. Formula utilizată este următoarea, cu:
- $C_R$: numărul de interpretări reale posibile;
- $C_M$: numărul maxim de interpretări posibile cu aceeași structură;
- $Ef$: eficiența exprimată în procentaj:

$$
\begin{align*}
E_f &= \frac{C_R}{C_M} \\
E_f &= \frac{1\,496}{1\,496} \\
E_f &= 100\%
\end{align*}
$$

O eficiență de $100\%$ indică astfel că tranzacția își maximizează potențialul pentru confidențialitate bazat pe structura sa.

### Densitatea Entropiei

Entropia este un indicator bun pentru măsurarea confidențialității unei tranzacții, dar depinde parțial de numărul de intrări și ieșiri din tranzacție. Pentru a compara entropia a 2 tranzacții diferite care nu au același număr de intrări și ieșiri, se poate calcula densitatea entropiei. Acest indicator oferă o perspectivă asupra entropiei relative la fiecare intrare sau ieșire a tranzacției. Densitatea se dovedește utilă pentru evaluarea și compararea eficienței tranzacțiilor de dimensiuni diferite.

Pentru a o calcula, pur și simplu împărțiți entropia totală a tranzacției la numărul total de intrări și ieșiri implicate în tranzacție:
- $E_D$: densitatea entropiei exprimată în biți;
- $E$: entropia tranzacției exprimată în biți;
- $T$: numărul total de intrări și ieșiri în tranzacție:

$$
E_D = \frac{E}{T}
$$

Să luăm exemplul unui coinjoin Whirlpool 5x5:

$$
\begin{align*}
T &= 5 + 5 = 10 \\
E &= 10.5469 \\
E_D &= \frac{E}{T} \\
E_D &= \frac{10.5469}{10} \\
E_D &= 1.054 \text{ biți}
\end{align*}
$$

Să calculăm de asemenea densitatea entropiei pentru un coinjoin Whirlpool 8x8:

$$
\begin{align*}
T &= 8 + 8 = 16 \\
E &= 23.244 \\
E_D &= \frac{E}{T} \\
E_D &= \frac{23.244}{16} \\
```
E_D &= 1.453 \text{ biți}\end{align*}
```

Analizând densitatea entropiei acestor două tipuri de coinjoin, devine evident că, chiar și atunci când se normalizează entropia prin numărul de elemente, coinjoin-ul "Surge Cycle 8x8" generează mai multă incertitudine pentru analiză.

### Scorul Boltzmann
O altă piesă de informație analizată într-o tranzacție este scorul Boltzmann al fiecărui element relativ la altul. Aceasta este o tabelă a probabilităților de potrivire între intrări și ieșiri. Această tabelă indică, prin scorul Boltzmann, probabilitatea condiționată ca o anumită intrare să fie legată de o ieșire dată. Prin urmare, este o măsură cantitativă a probabilității condiționate că o asociere între o intrare și o ieșire într-o tranzacție are loc, stabilită pe baza raportului dintre numărul de apariții favorabile ale acestui eveniment comparativ cu numărul total de apariții posibile, într-un set de interpretări.
Luând exemplul unui coinjoin Whirlpool, tabelul probabilităților condiționate ar evidenția șansele unei legături între fiecare intrare și ieșire, oferind o măsură cantitativă a ambiguității asocierilor în tranzacție:

| %       | Ieșire 0 | Ieșire 1 | Ieșire 2 | Ieșire 3 | Ieșire 4 |
| ------- | -------- | -------- | -------- | -------- | -------- |
| Intrare 0 | 34%      | 34%      | 34%      | 34%      | 34%      |
| Intrare 1 | 34%      | 34%      | 34%      | 34%      | 34%      |
| Intrare 2 | 34%      | 34%      | 34%      | 34%      | 34%      |
| Intrare 3 | 34%      | 34%      | 34%      | 34%      | 34%      |
| Intrare 4 | 34%      | 34%      | 34%      | 34%      | 34%      |

Aici, este clar că fiecare intrare are o șansă egală de a fi asociată cu orice ieșire, ceea ce îmbunătățește confidențialitatea tranzacției.

Calculul scorului Boltzmann implică împărțirea numărului de interpretări în care un anumit eveniment se manifestă la numărul total de interpretări disponibile. Astfel, pentru a determina scorul asociind intrarea #0 cu ieșirea #3 (un eveniment prezent în 512 interpretări), procesul este următorul:

```
\begin{align*}
\text{Interpretări (IN.0 > OUT.3)} &= 512 \\
\text{Interpretări Totale} &= 1496 \\
\text{Scor} &= \frac{512}{1496} \\
\text{Scor} &= 34 \%
\end{align*}
```

Dacă revenim la exemplul unui coinjoin Whirlpool 8x8 Surge Cycle, tabelul Boltzmann ar arăta astfel:

|       | OUT.0 | OUT.1 | OUT.2 | OUT.3 | OUT.4 | OUT.5 | OUT.6 | OUT.7 |
|-------|-------|-------|-------|-------|-------|-------|-------|-------|
| IN.0  | 23%   | 23%   | 23%   | 23%   | 23%   | 23%   | 23%   | 23%   |
| IN.1  | 23%   | 23%   | 23%   | 23%   | 23%   | 23%   | 23%   | 23%   |
| IN.2  | 23%   | 23%   | 23%   | 23%   | 23%   | 23%   | 23%   | 23%   |
| IN.3  | 23%   | 23%   | 23%   | 23%   | 23%   | 23%   | 23%   | 23%   |
| IN.4  | 23%   | 23%   | 23%   | 23%   | 23%   | 23%   | 23%   | 23%   |
| IN.5  | 23%   | 23%   | 23%   | 23%   | 23%   | 23%   | 23%   | 23%   |
| IN.6  | 23%   | 23%   | 23%   | 23%   | 23%   | 23%   | 23%   | 23%   |
| IN.7  | 23%   | 23%   | 23%   | 23%   | 23%   | 23%   | 23%   | 23%   |

Cu toate acestea, în cazul unei tranzacții simple care implică un singur input și 2 output-uri, situația este diferită:

| %       | Output 0 | Output 1 |
|---------|----------|----------|
| Input 0 | 100%     | 100%     |

Aici, observăm că probabilitatea ca fiecare output să provină de la input-ul #0 este de 100%. O probabilitate mai mică se traduce astfel într-o mai mare confidențialitate prin diluarea legăturilor directe între input-uri și output-uri.

### Legături Deterministe

Este de asemenea posibil să calculăm numărul de legături deterministe într-o tranzacție. Acest indicator dezvăluie câte conexiuni între input-uri și output-uri în tranzacția analizată sunt indiscutabile, cu o probabilitate de 100%. Acest indicator poate fi apoi completat prin calcularea raportului de legături deterministe. Raportul oferă o perspectivă asupra greutății acestor legături deterministe în cadrul tuturor legăturilor tranzacției.

De exemplu, o tranzacție de tip Whirlpool coinjoin arată nicio legătură deterministă între input-uri și output-uri, afișând astfel un indicator de 0 legături și un raport de 0%. Pe de altă parte, în a noastră a doua tranzacție de plată simplă examinată (cu un input și 2 output-uri), indicatorul ne spune că există 2 legături deterministe și raportul atinge 100%. Prin urmare, un indicator nul semnalează o confidențialitate excelentă datorită absenței conexiunilor directe și indiscutabile între input-uri și output-uri.

### Cum se Calculează Acești Indicatori?
Calcularea manuală a acestor indicatori folosind ecuațiile pe care le-am furnizat este relativ simplă. Principala dificultate constă în determinarea numărului de interpretări posibile ale unei tranzacții. Pentru o tranzacție standard, acest calcul poate fi efectuat manual. Totuși, pentru un coinjoin, sarcina este semnificativ mai complexă.

Anterior, exista un instrument Python numit _Boltzmann Calculator_, dezvoltat de echipele de la OXT și Samourai, care permitea calculul automat al tuturor acestor indicatori pentru o tranzacție Bitcoin:

![BTC204](assets/notext/56/05.webp)

De asemenea, era posibil să se utilizeze site-ul KYCP.org pentru aceste analize:

![BTC204](assets/notext/56/06.webp)
Din păcate, în urma arestării fondatorilor Samourai, aceste unelte nu sunt în prezent operaționale.
Acum că am discutat în detaliu despre coinjoins, vom explora alte tehnici de confidențialitate disponibile pe Bitcoin în ultima secțiune a instruirii noastre. Vom examina tranzacțiile payjoin, tipuri specifice de tranzacții pseudo-coinjoins, protocoale de adrese statice, precum și măsuri menite să îmbunătățească confidențialitatea nu la nivelul tranzacției, ci la nivelul rețelei de noduri.

https://planb.network/tutorials/privacy/boltzmann-entropy

# Înțelegerea mizelor altor tehnici avansate de confidențialitate
<partId>19989ae6-d608-4acf-b698-2cf1e7e5e6ae</partId>

## Tranzacții Payjoin
<chapterId>c1e90b95-f709-4574-837b-2ec26b11286f</chapterId>

Coinjoin reprezintă în prezent metoda cea mai eficientă pentru introducerea incertitudinii în urmărirea monedelor în timpul unei analize a lanțului. Așa cum am văzut în capitolele anterioare, pentru a realiza un amestec eficient, este necesar ca intrările și ieșirile să fie cât mai omogene posibil. Mai mult, este crucial ca monedele să fie integrate într-un grup cât mai mare posibil pentru a maximiza anonseturile. Astfel, pentru ca coinjoins să fie eficiente, trebuie să implice un număr mare de monede uniforme. Această multitudine de cerințe înseamnă că tranzacțiile coinjoin au o structură foarte rigidă: sumele sunt prestabilite, și toți participanții trebuie să le respecte pentru a asigura uniformitatea procesului. În plus, coinjoins necesită sincronizare între toți participanții și coordonator în timpul construcției tranzacției.
Aceste cerințe fac ca coinjoin să fie nepotrivit pentru plăți directe. De exemplu, dacă deții o piesă de 1M sats într-un pool coinjoin, utilizarea ei directă ca plată ar fi complexă. Ar necesita sincronizare cu ceilalți participanți și coordonatorul pentru a construi tranzacția colaborativă exact în momentul în care trebuie să faci o plată, iar suma achiziției ar trebui să se potrivească exact cu valoarea piesei tale, ceea ce este practic imposibil. Prin urmare, o tranzacție coinjoin este prin natura sa o tranzacție colaborativă de măturare, ceea ce înseamnă că, în general, aceiași proprietari ai intrărilor se regăsesc în ieșiri.
Cu toate acestea, ar fi interesant să avem structuri de tranzacții care să permită plăți practice introducând în același timp îndoială în analiza lanțului. Acest lucru este exact ceea ce vom explora în acest capitol și în următorul.

### Ce este o tranzacție payjoin?

Payjoin este o structură specifică de tranzacție Bitcoin care îmbunătățește confidențialitatea utilizatorului în timpul unei cheltuieli colaborând cu destinatarul plății.

A fost în 2015 când LaurentMT a menționat prima dată această metodă sub numele de "*tranzacții steganografice*", conform unui document accesibil [aici](https://gist.githubusercontent.com/LaurentMT/e758767ca4038ac40aaf/raw/c8125f6a3c3d0e90246dc96d3b603690ab6f1dcc/gistfile1.txt). Această tehnică a fost mai târziu adoptată de portofelul Samourai, care în 2018, a fost primul client care a implementat-o cu instrumentul Stowaway. Conceptul de payjoin se regăsește și în [BIP79](https://github.com/bitcoin/bips/blob/master/bip-0079.mediawiki) și [BIP78](https://github.com/bitcoin/bips/blob/master/bip-0078.mediawiki). Mai multe termeni sunt astfel utilizați pentru a desemna un payjoin:
- Payjoin;
- Stowaway;
- P2EP (*Pay-to-End-Point*);
- Tranzacție steganografică.
Particularitatea payjoin constă în capacitatea sa de a genera o tranzacție care pare obișnuită la prima vedere, dar este de fapt un mini Coinjoin între două persoane. Pentru aceasta, structura tranzacției implică participarea destinatarului plății în inputuri alături de expeditorul real. Astfel, destinatarul include o plată către sine în mijlocul tranzacției, ceea ce îi permite să fie plătit.

Să luăm un exemplu pentru a înțelege mai bine acest proces. Alice cumpără o baghetă pentru 4.000 de sats folosind un UTXO de 10.000 de sats și optează pentru un payjoin. Brutăria ei, Bob, adaugă un UTXO de 15.000 de sats care îi aparține în input, pe care îl recuperează integral în output, în plus față de cei 4.000 de sats ai lui Alice.

![BTC204](assets/notext/61/01.webp)
În acest exemplu, Bob brutarul introduce 15.000 de sats și iese cu 19.000 de sats, diferența fiind exact 4.000 de sats, care este prețul baghetei. Din partea lui Alice, ea intră cu 10.000 de sats și se termină cu 6.000 de sats în output, ceea ce reprezintă un sold de -4.000 de sats, adică prețul baghetei. Pentru a simplifica exemplul, am omis intenționat taxele de minare în această tranzacție.

### Care este scopul payjoin?

Tranzacția payjoin îndeplinește două obiective care permit utilizatorilor să îmbunătățească confidențialitatea plății lor.

În primul rând, payjoin urmărește să inducă în eroare un observator extern prin crearea unui momeală în analiza lanțului. Acest lucru este posibil datorită euristicului CIOH (*Common Input Ownership Heuristic*). Așa cum am văzut în partea a 3-a, de obicei, când o tranzacție pe blockchain are mai multe inputuri, se presupune că toate aceste inputuri aparțin aceleiași entități sau utilizatorului.

Astfel, când un analist examinează o tranzacție payjoin, este condus să creadă că toate inputurile provin de la aceeași persoană. Cu toate acestea, această percepție este incorectă, deoarece destinatarul plății contribuie de asemenea la inputuri alături de plătitorul real. Analiza lanțului este deci deviată către o interpretare care se dovedește a fi falsă.

Să ne întoarcem la exemplul nostru de tranzacție payjoin pentru plata unei baghete:

![BTC204](assets/notext/61/02.webp)

Văzând această tranzacție pe blockchain, un observator extern care urmează euristicile obișnuite de analiză a lanțului ar interpreta astfel: "*Alice a combinat 2 UTXOs în inputurile tranzacției pentru a plăti 19.000 de sats lui Bob*".

![BTC204](assets/en/61/03.webp)

Această interpretare este evident incorectă, după cum deja știți, cele două UTXOs în inputuri nu aparțin aceleiași persoane. Unul vine de la Alice, cumpărătoarea baghetei, și celălalt de la Bob, brutarul.

![BTC204](assets/notext/61/04.webp)

Analiza observatorului extern este astfel îndreptată către o concluzie greșită, ceea ce asigură păstrarea confidențialității părților implicate.

### Tranzacția steganografică

Al doilea obiectiv al payjoin este de a înșela un observator extern cu privire la suma reală a plății care a fost efectuată. Examinând structura tranzacției, analistul ar putea crede că plata este echivalentă cu suma unuia dintre outputuri.
Dacă ne reîntoarcem la exemplul nostru cu cumpărarea unei baghete, analistul va crede că suma plătită corespunde fie UTXO-ului de 6.000 sats, fie UTXO-ului de 19.000 sats. În acest caz, analistul este mai predispus să creadă că suma plătită este de 19.000 sats, deoarece există 2 UTXO-uri în output-uri, cel puțin unul dintre acestea fiind mai mare decât 6.000 sats (nu există un motiv logic pentru a folosi 2 UTXO-uri pentru a plăti 6.000 sats când un singur UTXO ar fi fost suficient pentru această plată). ![BTC204](assets/en/61/05.webp)

Dar, în realitate, această analiză este incorectă. Suma plătită nu corespunde niciunui dintre output-uri. Este de fapt diferența dintre UTXO-ul destinatarului în output și UTXO-ul destinatarului în input.

![BTC204](assets/en/61/06.webp)

În acest caz, tranzacția payjoin intră în domeniul steganografiei. Permite ascunderea sumei reale a unei tranzacții în cadrul unei tranzacții false care acționează ca un momeală.

Steganografia este o tehnică de ascundere a informațiilor în cadrul altor date sau obiecte, în așa fel încât prezența informațiilor ascunse să nu fie perceptibilă. De exemplu, un mesaj secret poate fi ascuns în interiorul unui punct dintr-un text care nu este legat, făcându-l nedetectabil cu ochiul liber (aceasta este tehnica [micropoint](https://fr.wikipedia.org/wiki/Micropoint)).

Spre deosebire de criptare, care face informațiile neinteligibile fără cheia de decriptare, steganografia nu modifică informațiile. Acestea rămân la vedere. Scopul său este mai degrabă de a ascunde existența însăși a mesajului secret, în timp ce criptarea dezvăluie clar prezența informațiilor ascunse, deși inaccesibile fără cheie. De aceea, numele inițial pentru payjoin a fost "tranzacții steganografice".

O analogie poate fi făcută între criptografie și coinjoin, precum și între steganografie și payjoin. Într-adevăr, coinjoin are atribute similare cu cele ale criptării: metoda este recunoscută, dar informația este indecidabilă. Pe de altă parte, payjoin este asemănător cu steganografia: informația este teoretic accesibilă, dar deoarece metoda sa de ascundere nu este recunoscută, devine inaccesibilă.

### Cum să folosești payjoin?

Printre software-urile cunoscute care suportă payjoin, se numără Sparrow Wallet, Wasabi Wallet, Mutiny, BitMask, BlueWallet și JoinMarket, precum și procesatorul de plăți BTCPay.

![BTC204](assets/notext/61/07.webp)
Cea mai avansată implementare a payjoin a fost doar Stowaway pe Samourai Wallet. Totuși, de la arestarea fondatorilor software-ului, acest instrument funcționează acum doar parțial. Avantajul Stowaway este că este un protocol complet și foarte simplu de utilizat, care suportă atât primirea, cât și trimiterea de payjoins. Tranzacțiile parțial semnate pot fi schimbate manual prin scanarea mai multor coduri QR sau automat prin Tor prin intermediul Soroban. Este această ultimă opțiune de comunicare care este în prezent indisponibilă.
![BTC204](assets/notext/61/08.webp)

Dificultatea utilizării payjoin constă în dependența de participarea comerciantului. Ca client, utilizarea unui payjoin este imposibilă dacă comerciantul nu îl suportă. Acest lucru adaugă o dificultate suplimentară în timpul unei achiziții: nu doar că este complicat să găsești comercianți care acceptă bitcoin, dar dacă cauți și pe cei care suportă payjoins, devine și mai complicat.
O soluție ar fi să utilizăm structuri tranzacționale care introduc ambiguitate în analiza lanțului fără a necesita cooperarea destinatarului. Acest lucru ne-ar permite să îmbunătățim confidențialitatea plăților noastre fără a depinde de participarea activă a comercianților. Acesta este exact ceea ce vom studia în capitolul următor.
https://planb.network/tutorials/privacy/payjoin-sparrow-wallet

https://planb.network/tutorials/privacy/payjoin-samourai-wallet

## Mini-Coinjoins pentru Plăți
<chapterId>300777ee-30ae-43d7-ab00-479dac3522c1</chapterId>

Când căutăm să efectuăm o tranzacție de plată păstrând un anumit grad de confidențialitate, payjoin este o opțiune bună. Dar, așa cum am văzut, payjoin necesită implicarea destinatarului. Ce să facem atunci când acesta refuză să participe la un payjoin, sau dacă pur și simplu preferăm să nu îl implicăm? O alternativă este să utilizăm o tranzacție Stonewall sau Stonewall x2. Să aruncăm o privire mai atentă asupra acestor două tipuri de tranzacții.

### Tranzacția Stonewall

Stonewall este o formă specifică de tranzacție Bitcoin menită să crească confidențialitatea utilizatorului în timpul unei cheltuieli prin imitarea unui pseudo-coinjoin între două persoane, fără a fi de fapt unul. Într-adevăr, această tranzacție nu este colaborativă. Un utilizator o poate construi singur, implicând doar UTXO-urile pe care le deține ca intrări. Prin urmare, poți crea o tranzacție Stonewall pentru orice ocazie, fără a fi nevoie să te sincronizezi cu un alt utilizator sau cu destinatarul.

Funcționarea tranzacției Stonewall este următoarea: în intrarea tranzacției, expeditorul folosește 2 UTXO-uri care îi aparțin. În ieșire, tranzacția produce 4 UTXO-uri, dintre care 2 vor fi exact aceeași sumă. Celelalte 2 UTXO-uri vor constitui restul. Printre cele 2 ieșiri de aceeași sumă, doar una va merge de fapt către destinatarul plății.
Există doar 2 roluri într-o tranzacție Stonewall:
- Expeditorul, care face plata;
- Destinatarul, care poate fi inconștient de natura specifică a tranzacției și așteaptă pur și simplu o plată din partea expeditorului.

Să luăm un exemplu pentru a înțelege această structură de tranzacție. Alice este la brutarul Bob pentru a-și cumpăra bagheta, care costă 4,000 sats. Ea dorește să plătească în bitcoin menținând un anumit nivel de confidențialitate în ceea ce privește plata ei. Prin urmare, ea decide să construiască o tranzacție Stonewall pentru plată.

![BTC204](assets/notext/62/01.webp)

Analizând această tranzacție, putem vedea că Bob brutarul a primit într-adevăr 4,000 sats în plată pentru baghetă. Alice a folosit 2 UTXO-uri ca intrări: unul de 10,000 sats și unul de 15,000 sats. În ieșiri, ea a primit 3 UTXO-uri: unul de 4,000 sats, unul de 6,000 sats și unul de 11,000 sats. Astfel, Alice are un sold net de -4,000 sats pe această tranzacție, care corespunde exact prețului baghetei.

În acest exemplu, am neglijat intenționat taxele de minare pentru a facilita înțelegerea. În realitate, taxele de tranzacție sunt suportate în întregime de expeditor.

### Care sunt obiectivele unei tranzacții Stonewall?
Structura Stonewall adaugă multă entropie tranzacției și estompează urmele analizei lanțului. Din exterior, o astfel de tranzacție poate fi interpretată ca un mini-coinjoin între două persoane. Dar, în realitate, este vorba despre o plată. Această metodă generează astfel incertitudini în analiza lanțului, sau chiar duce la piste false.
Să ne întoarcem la exemplul cu Alice la brutarul Bob. Tranzacția pe blockchain ar arăta astfel:

![BTC204](assets/notext/62/02.webp)

Un observator extern care se bazează pe euristici comune de analiză a lanțului ar putea concluziona în mod eronat că "*două persoane au realizat un mic coinjoin, cu câte un UTXO fiecare la intrare și două UTXO-uri fiecare la ieșire*". Analiza acestei tranzacții din exterior nu conduce la aplicarea Euristicii de Proprietate Comună a Intrării (CIOH), deoarece prezența a două ieșiri de aceeași sumă sugerează un model de coinjoin. Dintr-un punct de vedere extern, CIOH nu este deci aplicabilă în acest caz specific.

![BTC204](assets/notext/62/03.webp)

Această interpretare este inexactă, deoarece, după cum știți, un UTXO a fost trimis către Bob brutarul, cele 2 UTXO-uri la intrări provin de la Alice, iar ea a recuperat 3 ieșiri de rest.

![BTC204](assets/notext/62/04.webp)
Și ceea ce este deosebit de interesant despre structura tranzacției Stonewall este că, din perspectiva unui observator extern, arată exact ca aceea a unei tranzacții Stonewall x2.

### Tranzacția Stonewall x2

Stonewall x2 este o altă formă specifică de tranzacție Bitcoin care își propune de asemenea să crească confidențialitatea utilizatorului în timpul unei cheltuieli, dar de data aceasta colaborând cu o terță parte neimplicată în cheltuială. Această metodă funcționează ca un pseudo-coinjoin între doi participanți, în timp ce se face o plată către o a treia persoană în același timp.

Funcționarea tranzacției Stonewall x2 este relativ simplă: se utilizează un UTXO din posesia proprie pentru a efectua plata și se solicită ajutorul unei terțe părți care contribuie de asemenea cu un UTXO pe care îl dețin. Tranzacția se încheie cu patru ieșiri: două dintre ele de sume egale, una destinată adresei destinatarului plății, cealaltă unei adrese aparținând colaboratorului. Un al treilea UTXO este trimis înapoi la o altă adresă a colaboratorului, permițându-le să recupereze suma inițială (o acțiune neutră pentru ei, minus taxele de minare), și un ultim UTXO revine la o adresă care ne aparține, constituind restul plății.

Astfel, sunt definite trei roluri diferite în tranzacțiile Stonewall x2:
- Expeditorul, care efectuează plata efectivă;
- Destinatarul, care poate fi inconștient de natura specifică a tranzacției și pur și simplu așteaptă o plată din partea expeditorului;
- Colaboratorul, care furnizează bitcoinii pentru a arunca îndoială în analiza tranzacției, recuperându-și în totalitate fondurile la final (o acțiune neutră pentru ei, minus taxele de minare).

Să ne întoarcem la exemplul nostru cu Alice care este la brutarul Bob pentru a-și cumpăra bagheta care costă 4,000 sats. Ea dorește să plătească în bitcoin menținând un anumit nivel de confidențialitate asupra plății sale. Așadar, ea apelează la prietenul ei Charles, care o va ajuta în acest proces.

![BTC204](assets/notext/62/05.webp)
Analizând această tranzacție, putem observa că Bob brutarul a primit într-adevăr 4.000 de sats ca plată pentru baghetă. Alice a folosit 10.000 de sats ca intrare și a recuperat 6.000 de sats ca ieșire, rezultând un sold net de -4.000 de sats, care corespunde prețului baghetei. În ceea ce-l privește pe Charles, el a furnizat 15.000 de sats ca intrare și a primit două ieșiri: una de 4.000 de sats și cealaltă de 11.000 de sats, făcând un sold de 0.
În acest exemplu, am neglijat intenționat taxele pentru a facilita înțelegerea. În realitate, taxele de minare sunt, în general, împărțite în mod egal între emitentul plății și colaborator.

### Care sunt obiectivele unei tranzacții Stonewall x2?
La fel ca structura Stonewall, structura Stonewall x2 adaugă o cantitate semnificativă de entropie tranzacției și obscurizează urmele analizei lanțului. Dintr-un punct de vedere extern, o astfel de tranzacție ar putea fi interpretată ca un mic coinjoin între două persoane. Dar, în realitate, este o plată. Această metodă, prin urmare, generează incertitudini în analiza lanțului, conducând chiar la piste false.

Să revenim la exemplul cu Alice, Bob Brutarul și Charles. Tranzacția pe blockchain ar arăta astfel:

![BTC204](assets/notext/62/06.webp)

Un observator extern care se bazează pe euristici comune de analiză a lanțului ar putea concluziona în mod eronat că "*Alice și Charles au efectuat un mic coinjoin, cu câte un UTXO fiecare la intrare și două UTXO-uri fiecare la ieșire*". Din nou, analiza acestei tranzacții din exterior nu duce la aplicarea Euristicii de Proprietate Comună a Intrării (CIOH), deoarece prezența a două ieșiri de aceeași sumă sugerează un model de coinjoin. Dintr-un punct de vedere extern, CIOH nu este, prin urmare, aplicabilă în acest caz specific.

![BTC204](assets/notext/62/07.webp)

Această interpretare este inexactă deoarece, după cum știți, un UTXO a fost trimis către Bob Brutarul, Alice are doar o ieșire de rest, iar Charles are două.

![BTC204](assets/notext/62/08.webp)

Și, din nou, ceea ce este deosebit de interesant cu structura tranzacției Stonewall x2 este că, din punctul de vedere al unui observator extern, arată exact ca aceea a unei tranzacții Stonewall.

### Care este diferența între Stonewall și Stonewall x2?

O tranzacție StonewallX2 funcționează exact ca o tranzacție Stonewall, cu excepția faptului că prima este colaborativă, în timp ce ultima nu este. După cum am văzut, o tranzacție Stonewall x2 implică participarea unei terțe părți (Charles), care este externă plății și care furnizează bitcoinii săi pentru a spori confidențialitatea tranzacției. Într-o tranzacție Stonewall clasică, rolul colaboratorului este preluat de expeditor.

![BTC204](assets/notext/62/09.webp)

Dintr-un punct de vedere extern, modelul tranzacției este, prin urmare, exact același.

![BTC204](assets/notext/62/10.webp)

Faptul că aceste două structuri de tranzacție împărtășesc exact același model implică faptul că, chiar dacă un observator extern reușește să identifice un model "Stonewall(x2)", ei nu vor avea toate informațiile. Nu vor putea determina care dintre cele două UTXO-uri de aceleași sume corespunde plății. Mai mult, nu vor putea determina dacă cele două UTXO-uri la intrări provin de la două persoane diferite (Stonewall x2) sau dacă aparțin unei singure persoane care le-a unit (Stonewall).
Acest ultim punct se datorează faptului că tranzacțiile Stonewall x2 urmează exact același model ca tranzacțiile Stonewall. Din exterior și fără informații suplimentare despre context, este imposibil să diferențiezi o tranzacție Stonewall de o tranzacție Stonewall x2. Totuși, primele nu sunt tranzacții colaborative, în timp ce cele din urmă sunt. Acest lucru adaugă și mai multă îndoială în analiza unei astfel de tranzacții.
### Când să folosești tranzacțiile Stonewall și Stonewall x2?

Logica ar trebui să fie următoarea când dorești să folosești un instrument de confidențialitate pentru o tranzacție:
- Ca prioritate, se poate alege să se realizeze un payjoin;
- Dacă comerciantul nu suportă payjoins, se poate realiza o tranzacție colaborativă cu o altă persoană din afara plății folosind structura Stonewall x2;
- Dacă nu se găsește pe nimeni pentru a realiza o tranzacție Stonewall x2, se poate face o tranzacție Stonewall singur, care va imita comportamentul unei tranzacții Stonewall x2.

### Cum să folosești tranzacțiile Stonewall și Stonewall x2?

Tranzacțiile Stonewall și Stonewall x2 sunt disponibile atât în aplicația Samourai Wallet cât și în software-ul Sparrow Wallet.

![BTC204](assets/notext/62/11.webp)

Totuși, la fel ca în cazul payjoins, urmând arestarea fondatorilor Samourai, tranzacțiile Stonewall x2 funcționează acum doar prin schimbul manual al PSBT-urilor între părțile implicate. Schimbul automat prin Soroban, din păcate, nu este disponibil în acest moment.

Este de asemenea posibil să se efectueze manual acest tip de tranzacție de la orice software de portofel Bitcoin.

În capitolul următor, vom studia o altă tehnică de confidențialitate care este relativ necunoscută, dar este foarte utilă în adiție la ceea ce am studiat deja.

https://planb.network/tutorials/privacy/stonewall

https://planb.network/tutorials/privacy/stonewall-x2

## Ricochets

<chapterId>db9a20ac-a149-443d-884b-ea6c03f28499</chapterId>

Utilizarea structurilor de tranzacție Bitcoin care adaugă ambiguitate în analiza lanțului, cum ar fi coinjoin, este deosebit de benefică pentru protecția confidențialității. Cu toate acestea, așa cum am discutat în capitolul despre payjoins, tranzacțiile coinjoin sunt natural identificabile în lanț. Amintește-ți de analogia pe care am stabilit-o între criptare și coinjoins: când cineva criptează un fișier, o terță parte care descoperă acest fișier criptat nu poate accesa conținutul său, dar poate identifica clar că a avut loc o modificare a fișierului pentru a-i ascunde conținutul. Același lucru este valabil și pentru coinjoin: când un analist examinează o tranzacție coinjoin, deși nu poate stabili legături directe între intrări și ieșiri (și invers), poate totuși recunoaște că tranzacția observată este un coinjoin.
În funcție de utilizarea intenționată pentru moneda ta după ce a trecut prin cicluri de coinjoin, faptul că a suferit acest proces poate fi problematic. De exemplu, dacă plănuiești să vinzi moneda ta pe o platformă de schimb reglementată, dar recent a suferit un coinjoin, instrumentul de analiză a lanțului platformei va detecta acest fapt. Platforma ar putea atunci refuza să accepte UTXO-ul tău care a suferit un coinjoin, sau chiar să ceară explicații de la tine, cu riscul de a avea contul suspendat sau fondurile înghețate. În unele cazuri, platforma poate, de asemenea, raporta comportamentul tău autorităților statului (de exemplu, acesta este ceea ce TRACFIN cere de la Furnizorii de Servicii de Active Digitale (PSAN) în Franța).
![BTC204](assets/notext/63/01.webp)
Ce am avea nevoie pentru a evita acest lucru este un instrument capabil să estompeze urmele trecutului unei monede Bitcoin, pentru a restabili o anumită formă de fungibilitate. Acesta este precis obiectivul ricochet.

![BTC204](assets/notext/63/02.webp)

### Ce este un ricochet?

Ricochet este o tehnică care implică efectuarea mai multor tranzacții fictive către sine (sweeping) pentru a simula un transfer de proprietate al bitcoinilor. Acest instrument se diferențiază de alte structuri de tranzacție despre care am discutat deoarece nu permite anonimatul prospectiv, ci mai degrabă o formă de anonimat retrospectiv. Într-adevăr, ricochet permite estomparea detaliilor care ar putea compromite fungibilitatea unei monede Bitcoin din cauza trecutului său.

Pentru a estompa amprenta lăsată de un eveniment trecut pe o monedă, cum ar fi ciclurile coinjoin, de exemplu, ricochet execută patru tranzacții succesive în care utilizatorul își transferă fondurile către sine pe adrese diferite.

![BTC204](assets/en/63/03.webp)

După această secvență de tranzacții, instrumentul ricochet direcționează în final bitcoinii către destinația lor finală, cum ar fi o platformă de schimb.

![BTC204](assets/en/63/04.webp)

Obiectivul este de a crea o distanță care afectează fungibilitatea monedei, cum ar fi o tranzacție coinjoin, și actul final de cheltuire care ar putea respinge această monedă din cauza trecutului său. Astfel, instrumentele de analiză a lanțului ar putea concluziona că probabil a avut loc o schimbare a proprietății după eveniment și consideră că această monedă este fungibilă. În cazul unui coinjoin, instrumentele de analiză a lanțului ar putea atunci presupune că nu aceeași persoană a trimis bitcoinii și a efectuat coinjoin-ul, și prin urmare nu este necesar să inițieze acțiuni împotriva expeditorului.

![BTC204](assets/notext/63/05.webp)

### De ce funcționează acest lucru?
În fața acestei metode ricochet, cineva ar putea imagina că software-ul de analiză a lanțului ar aprofunda examinarea lor dincolo de patru sărituri. Cu toate acestea, aceste platforme se confruntă cu un dilemă în optimizarea pragului de detectare. Ele trebuie să stabilească o limită pentru numărul de sărituri după care admit că este probabil să fi avut loc o schimbare a proprietății și că legătura cu un eveniment anterior (cum ar fi un coinjoin) ar trebui ignorată.
![BTC204](assets/en/63/06.webp)

Cu toate acestea, determinarea acestui prag se dovedește a fi riscantă: fiecare extindere a numărului observat de sărituri crește exponențial volumul de falsi pozitivi, adică indivizi marcați eronat ca participanți la un eveniment, când operațiunea a fost efectuată de altcineva. Acest scenariu reprezintă un risc major pentru aceste companii, deoarece falsii pozitivi duc la nemulțumire, ceea ce poate împinge clienții afectați către concurență. Pe termen lung, un prag de detectare prea larg conduce o platformă să piardă mai mulți clienți decât concurenții săi, ceea ce ar putea amenința viabilitatea sa. Prin urmare, este complicat pentru aceste platforme să crească numărul de sărituri observate, și 4 este adesea un număr suficient pentru a contracara analizele lor.

Fenomenul observat aici este oarecum analog cu teoria celor șase grade de separare.

Teoria celor șase grade de separare sugerează că orice persoană de pe Pământ este conectată la oricare alta printr-un lanț de cunoștințe care include nu mai mult de șase intermediari. Ar fi suficient să treci printr-o serie de șase persoane, fiecare cunoscând personal pe următoarea, pentru a ajunge la orice individ din lume.

Pentru tranzacțiile Bitcoin, se găsește un fenomen similar. Urmărind înapoi un număr suficient de tranzacții Bitcoin, se ajunge inevitabil la un coinjoin. Metoda ricochet profită de acest principiu folosind un număr de sărituri mai mare decât ceea ce platformele de schimb pot urmări în mod rezonabil. Dacă platformele decid să urmărească mai multe tranzacții, atunci este posibil să se adauge pur și simplu o săritură suplimentară pentru a ocoli această măsură.

### Când și cum să folosești ricochet?
Cel mai comun caz de utilizare pentru ricochet apare atunci când este necesar să se ascundă participarea anterioară într-un coinjoin pe un UTXO pe care îl dețineți. Ideal, este mai bine să evitați transferul de bitcoini care au trecut printr-un coinjoin către entități reglementate. Cu toate acestea, în cazul în care cineva se găsește fără altă opțiune, mai ales în urgența de a lichida bitcoinii în monedă fiat, ricochet oferă o soluție eficientă.
Această metodă este eficientă nu doar pentru coinjoins, dar și pentru orice altă marcă care ar putea compromite fungibilitatea unei monede.
Ideea acestei metode ricochet provine inițial de la echipele de la Samourai Wallet, care au integrat-o în aplicația lor pentru a automatiza procesul. Serviciul este plătit pe Samourai, deoarece un ricochet implică o taxă de serviciu de 100.000 sats, în plus față de taxele de minare. Astfel, utilizarea sa este recomandată mai degrabă pentru transferuri de sume semnificative.

![BTC204](assets/notext/63/07.webp)

Aplicația Samourai oferă două variante de ricochet:
- Ricochetul îmbunătățit, sau "livrarea eșalonată", care are avantajul de a distribui taxele de serviciu Samourai pe cinci tranzacții succesive. Această opțiune asigură, de asemenea, că fiecare tranzacție este difuzată la un moment distinct și înregistrată într-un bloc diferit, ceea ce îi permite să imite comportamentul unei schimbări de proprietate cât mai aproape posibil. Deși mai lentă, această metodă este preferabilă pentru cei care nu se grăbesc, deoarece maximizează eficiența ricochetului prin întărirea rezistenței sale la analiza lanțului;

![BTC204](assets/notext/63/08.webp)

- Ricochetul clasic, care este conceput pentru a executa operațiunea rapid prin difuzarea tuturor tranzacțiilor într-un interval scurt de timp. Această metodă, prin urmare, oferă mai puțină confidențialitate și o rezistență mai scăzută la analiză decât metoda îmbunătățită. Ar trebui utilizată doar pentru trimiteri urgente.

![BTC204](assets/notext/63/09.webp)

Ricochetul implică pur și simplu trimiterea de bitcoini către sine. Este complet posibil să efectuați un ricochet manual pe orice software de portofel, fără a utiliza un instrument specializat. Doar transferați aceeași monedă către voi înșivă succesiv, folosind o nouă adresă goală de fiecare dată.

În capitolul următor, explorăm diferite tehnici pentru transferuri secrete de proprietate. Aceste metode diferă radical de cele examinate până acum, atât în ceea ce privește modul de operare, cât și rezultatele.

https://planb.network/tutorials/privacy/ricochet
 
## Transferuri Secrete de Proprietate
<chapterId>a2067036-849c-4d6b-87d2-44235cfae7a1</chapterId>

Printre tehnicile de confidențialitate pe Bitcoin, se numără și transferul secret de proprietate. Această metodă are ca scop transferul proprietății bitcoinilor de la o persoană la alta, și invers, fără ca această tranzacție să fie vizibilă explicit pe blockchain. Să studiem împreună diferitele tehnici disponibile, precum și avantajele și dezavantajele lor.

### CoinSwap

CoinSwap se bazează pe un concept relativ simplu: folosește contracte inteligente pentru a facilita un transfer de proprietate bitcoin între doi utilizatori, fără necesitatea de încredere și fără ca acest transfer să fie vizibil explicit pe blockchain.

![BTC204](assets/notext/64/01.webp)
Să ne imaginăm un exemplu simplist cu Alice și Bob. Alice deține 1 BTC securizat cu cheia privată $A$, iar Bob deține, de asemenea, 1, securizat cu cheia privată $B$. Teoretic, ei ar putea schimba cheile lor private prin intermediul unui canal de comunicare extern pentru a efectua un transfer secret.
Totuși, această metodă naivă prezintă un risc ridicat în ceea ce privește încrederea. Nimic nu o împiedică pe Alice să păstreze o copie a cheii private $A$ după schimb și să o folosească mai târziu pentru a fura bitcoinii, odată ce cheia este în posesia lui Bob.
![BTC204](assets/notext/64/03.webp)

Mai mult, nu există o garanție care să o împiedice pe Alice să primească cheia privată a lui Bob $B$ și să nu îi trimită niciodată în schimb propria cheie privată $A$. Acest schimb, prin urmare, se bazează pe o încredere excesivă între părți și se dovedește a fi ineficient în asigurarea unei transferuri secrete de proprietate în mod sigur.

![BTC204](assets/notext/64/04.webp)

Pentru a rezolva aceste probleme și a permite schimburile între părți care nu au încredere una în alta, putem folosi în schimb sisteme de contracte inteligente. Un contract inteligent este un program care se execută automat atunci când sunt îndeplinite condiții predefinite, care, în cazul nostru, asigură că schimbul de proprietate se întâmplă automat fără a necesita încredere reciprocă.

Pentru a face acest lucru, putem folosi HTLC (*Hash Time-Locked Contracts*) sau PTLC (*Point Time-Locked Contracts*). Aceste două protocoale funcționează similar, folosind un sistem de blocare temporală care garantează că schimbul este fie completat cu succes, fie anulat în întregime, protejând astfel integritatea fondurilor ambelor părți. Diferența principală între HTLCs și PTLCs este că HTLCs folosesc hash-uri și preimagini pentru a securiza tranzacția, în timp ce PTLCs folosesc Semnături Adaptor.

Într-un scenariu de coinswap folosind un HTLC sau un PTLC între Alice și Bob, schimbul se desfășoară în siguranță: fie reușește, și fiecare primește BTC-ul celuilalt, fie eșuează, și fiecare își păstrează propriul BTC. Astfel, este imposibil pentru una dintre părți să înșele sau să fure BTC-ul celeilalte.

> *HTLCs sunt de asemenea mecanismul utilizat pentru rutarea plăților în siguranță prin canalele bidirecționale ale Lightning Network.*

Utilizarea Semnăturilor Adaptor este deosebit de interesantă în acest context, deoarece permite ocolirea scripturilor tradiționale (acesta este un mecanism uneori referit ca "_scriptless scripts_"). Această caracteristică ajută la reducerea taxelor asociate cu schimbul. Un alt avantaj major al Semnăturilor Adaptor este că nu necesită utilizarea unui hash comun pentru ambele părți ale tranzacției, evitând astfel dezvăluirea unei legături directe între ele în anumite tipuri de schimburi.
### Semnături Adaptor

Semnăturile Adaptor sunt o metodă criptografică care integrează o semnătură validă cu o semnătură suplimentară, numită "_semnătură adaptor_," pentru a dezvălui o bucată secretă de date. Acest mecanism este conceput în așa fel încât cunoașterea a 2 dintre următoarele 3 elemente: semnătura validă, semnătura adaptor și secretul, permite deducerea elementului lipsă al treilea. O proprietate interesantă a acestei metode este că, dacă cunoaștem semnătura adaptor a contrapartidei noastre și punctul specific pe curba eliptică asociată cu secretul folosit pentru a calcula această semnătură adaptor, putem deriva propria noastră semnătură adaptor care va fi compatibilă cu același secret, fără a avea vreodată acces direct la secret în sine.

Într-un coinswap, utilizarea Semnăturilor Adaptor permite dezvăluirea simultană a două informații sensibile între participanți, evitând astfel nevoia de încredere reciprocă. Să luăm un exemplu pentru a ilustra acest proces cu Alice și Bob, care doresc să schimbe proprietatea a 1 BTC fiecare, dar nu au încredere unul în celălalt. Ei folosesc Semnături Adaptor pentru a elimina nevoia de încredere în acest schimb. Iată cum procedează:
* Alice inițiază schimbul creând o tranzacție $m_A$ care trimite 1 BTC către Bob. Ea generează o semnătură $s_A$, care validează această tranzacție, folosindu-și cheia privată $p_A$ ($P_A = p_A \cdot G$), un nonce $n_A$ ($N_A = n_A \cdot G$) și un secret $t$ ($T = t \cdot G$):
$$s_A = n_A + t + H(N_A + T \parallel P_A \parallel m_A) \cdot p_A$$

* Alice calculează semnătura adaptor $s_A'$ prin scăderea secretului $t$ din semnătura ei adevărată $s_A$:

$$s_A' = s_A - t$$

* Alice îi trimite lui Bob semnătura ei adaptor $s'_A$, tranzacția ei nesemnată $m_A$, punctul corespunzător secretului ($T$) și punctul corespunzător nonce-ului ($N_A$). Aceste elemente constituie ceea ce se numește un "*adaptor*". Este important de notat că, având doar aceste informații, Bob nu poate recupera BTC-urile lui Alice.
* Totuși, Bob are capacitatea de a verifica că Alice nu încearcă să îl fure. Pentru a face acest lucru, el verifică dacă semnătura adaptor a lui Alice $s_A'$ corespunde cu adevărat tranzacției propuse $m_A$. Dacă următoarea ecuație este corectă, atunci el poate fi sigur că semnătura adaptor a lui Alice este validă:
$$s_A' \cdot G = N_A + H(N_A + T \parallel P_A \parallel m_A) \cdot P_A$$

* Această verificare îi oferă lui Bob garanții suficiente pentru a proceda cu schimbul în mod încrezător. El apoi creează propria sa tranzacție $m_B$, destinată să trimită 1 BTC către Alice, și generează semnătura sa adaptor $s_B'$, care va fi de asemenea legată de același secret $t$. La acest punct, doar Alice cunoaște valoarea lui $t$; Bob cunoaște doar punctul corespunzător $T$ pe care Alice i l-a transmis:

$$s_B' = n_B + H(N_B + T \parallel P_B \parallel m_B) \cdot p_B$$

* Bob îi transmite lui Alice semnătura sa adaptor $s_B'$, tranzacția sa nesemnată $m_B$, precum și punctul corespunzător secretului ($T$) și punctul corespunzător nonce-ului ($N_B$). Alice, care cunoaște secretul $t$, poate acum combina semnătura adaptor a lui Bob $s_B'$ cu acest secret pentru a genera o semnătură validă $s_B$ pentru tranzacția $m_B$ care va transfera BTC-urile lui Bob către ea:

$$s_B = s_B' + t$$

$$(s_B' + t) \cdot G = N_B + T + H(N_B + T \parallel P_B \parallel m_B) \cdot P_B$$

* Alice difuzează această tranzacție semnată $m_B$ pe blockchain-ul Bitcoin pentru a recupera BTC-urile promise de Bob. Când Bob vede această tranzacție pe blockchain, el poate extrage semnătura $s_B = s_B' + t$. Cu aceste informații, Bob este atunci capabil să izoleze faimosul secret $t$ de care avea nevoie:

$$t = (s_B' + t) - s_B' = s_B - s_B'$$

* Și într-adevăr, acest secret $t$ era singurul element lipsă pentru ca Bob să genereze semnătura validă $s_A$ din semnătura adaptor a lui Alice $s_A'$. Această semnătură permite validarea tranzacției $m_A$ care trimite un BTC de la Alice la Bob. Bob calculează apoi $s_A$ și, la rândul său, difuzează tranzacția $m_A$ pe blockchain: 

$$s_A = s_A' + t$$
$$(s_A' + t) \cdot G = N_A + T + H(N_A + T \parallel P_A \parallel m_A) \cdot P_A$$
Să rezumăm cum funcționează o Semnătură Adaptor într-un schimb de monede. Inițial, Alice îi trimite lui Bob o tranzacție nesemnată împreună cu un adaptor, care îi permite lui Bob să verifice că secretul dezvăluit mai târziu îi va oferi acces la bitcoinii săi. În schimb, Bob îi trimite lui Alice propria tranzacție nesemnată și adaptorul său. Alice poate apoi să finalizeze tranzacția lui Bob și să recupereze bitcoinii prin difuzarea unei tranzacții valide folosind secretul. Când această tranzacție este publicată pe blockchain, Bob are capacitatea de a extrage secretul și astfel de a debloca tranzacția lui Alice. Prin urmare, dacă Alice inițiază un transfer al bitcoinilor lui Bob, acesta poate, la rândul său, să acceseze bitcoinii lui Alice fără a necesita încredere mutuală.
Merită menționat că schimburile de monede au fost propuse inițial de [Gregory Maxwell în octombrie 2013 pe BitcoinTalk](https://bitcointalk.org/index.php?topic=321228.0).

### Schimbul Atomic

Similar cu schimbul de monede și folosind aceleași tipuri de contracte inteligente, este de asemenea posibil să se efectueze schimburi atomice. Un schimb atomic permite un schimb direct de criptomonede diferite, cum ar fi BTC și XMR, între doi utilizatori fără a necesita încredere sau intervenția unui intermediar. Aceste schimburi sunt numite "atomice" deoarece au doar două rezultate posibile: fie schimbul este reușit și ambele părți sunt mulțumite, fie eșuează și fiecare își păstrează criptomonedele originale, eliminând astfel necesitatea de încredere în cealaltă parte.

![BTC204](assets/notext/64/05.webp)

Schimbul atomic și schimbul de monede împărtășesc o metodă similară de operare și oferă aceleași avantaje și dezavantaje în ceea ce privește confidențialitatea. Într-adevăr, din perspectiva Bitcoin, un schimb atomic este comparabil cu un schimb de monede efectuat în două etape. Mai întâi, schimbăm BTC pentru o altă criptomonedă, și apoi această criptomonedă poate fi schimbată pentru alți BTC. În cele din urmă, recuperăm BTC-ul altui utilizator. De aceea, în analiza problemelor de confidențialitate, grupez aceste două protocoale sub categoria schimburilor secrete de proprietate.

![BTC204](assets/notext/64/06.webp)

Cu toate acestea, spre deosebire de schimbul de monede, schimbul atomic poate avea dezechilibre în ceea ce privește lichiditatea disponibilă, în special în schimburile BTC/XMR. Este în general mai ușor să schimbi bitcoin pentru altcoinuri, deoarece există o cerere mare pentru bitcoin, ceea ce menține primele scăzute pentru această direcție de conversie. Totuși, schimbul de altcoinuri pentru a obține BTC poate fi mai complex din cauza cererii mai scăzute, rezultând adesea în prime foarte mari.

În final, când un schimb atomic implică bitcoinii onchain și bitcoinii pe rețeaua Lightning, ne referim la acesta ca la un "*submarine swap*".

### Este Cu Adevărat Util?
Transferurile secrete de proprietate, cum ar fi schimburile de monede și schimburile atomice, au avantajul de a înșela euristicile de analiză a lanțului. Aceste metode pot da impresia că tranzacțiile implică același utilizator, chiar dacă proprietatea reală a fost schimbată. Totuși, principalul dezavantaj al acestor metode este că sunt foarte riscante fără utilizarea unei tehnici suplimentare pentru a întrerupe istoricul monedei.

Într-adevăr, când Alice efectuează un schimb de monede sau un schimb atomic cu Bob, ea schimbă proprietatea bitcoinilor săi cu cei ai lui Bob. În cazul unui schimb atomic, schimbul include o altcoin, dar principiul rămâne același. Astfel, Alice se termină cu moneda $B$ și Bob cu moneda $A$. Acest lucru adaugă îndoieli în analiza lanțului, dar istoricul monedelor rămâne urmăribil. Dacă un analist examinează moneda $A$, poate urmări activitățile anterioare ale lui Alice, și invers pentru moneda $B$.
![BTC204](assets/en/64/07.webp)
Din perspectiva lui Alice, riscul este că istoricul monedei $B$ ar putea fi considerat suspect de anumite entități. Dacă, de exemplu, Bob a dobândit moneda $B$ printr-un act criminal, cum ar fi hacking-ul, această monedă ar rămâne legată de activitățile sale ilegale. Alice ar putea ajunge astfel în posesia unei monede pe care nu o poate transfera pe platformele de schimb reglementate fără a risca să îi fie înghețate fondurile, sau chiar să fie acuzată de crimele lui Bob, deși nu a avut nimic de-a face cu ele.

![BTC204](assets/en/64/08.webp)

Și, desigur, metodele de protejare a intimității, cum ar fi coinswap sau atomic swap, sunt preferate de criminali ale căror fonduri sunt monitorizate de autorități. Aceste protocoale le oferă oportunitatea de a se debarasa de bitcoinii lor monitorizați în schimbul unor bitcoini perfect fungibili. Acest lucru le permite, de asemenea, să creeze o diversiune, îndreptând autoritățile către alți utilizatori. Există astfel o dublă utilitate pentru acești indivizi.

Cu coinjoin, chiar dacă moneda ta este amestecată cu bitcoini monitorizați, istoricul monedei este întrerupt, ceea ce oferă o formă de negare plauzibilă care nu există în protocoalele secrete de transfer de proprietate, cum ar fi coinswap sau atomic swap.

![BTC204](assets/notext/64/09.webp)
Dacă Alice dorește să evite orice risc, trebuie neapărat să utilizeze o metodă pentru a întrerupe istoricul monedei $B$, cum ar fi trecerea acesteia prin coinjoins, de exemplu. Acest lucru ridică o întrebare despre utilitatea combinării transferului secret al proprietății și a coinjoin. Coinjoin, prin întreruperea istoricului unei monede, oferă deja un nivel suficient de intimitate pentru Alice. Astfel, opinia mea este că, dacă Alice caută să-și protejeze intimitatea, ar fi mai prudent să procedeze direct cu un coinjoin, în loc să se angajeze într-un coinswap urmat de un coinjoin.
Pentru ca metodele de transfer secret al proprietății să fie cu adevărat eficace și să evite riscul de a lega istoricul unui utilizator $A$ de un utilizator $B$, ar fi paradoxal necesar ca utilizarea lor să fie larg cunoscută. Dacă coinswap este utilizat masiv și autoritățile sunt conștiente de această practică comună, atunci o formă de negare plauzibilă ar putea fi stabilită. Totuși, atâta timp cât utilizarea acestor transferuri rămâne marginală, cred că aceste metode vor rămâne prea riscante pentru utilizatori.

Până acum, am studiat în principal metodele de protejare a intimității la nivelul tranzacțiilor în sine. În capitolul următor, vom explora problemele la nivelul rețelei și diseminarea tranzacțiilor.

## Intimitatea pe Rețeaua P2P
<chapterId>04a2467b-db84-4076-a9ff-919be5135106</chapterId>

În partea a 4-a, am discutat despre importanța utilizării unui nod complet pentru a proteja intimitatea tranzacțiilor tale. Totuși, este important să înțelegem că nodul tău însuși poate fi supus atacurilor care caută să extragă informații despre activitățile tale. În acest capitol, vom examina deci diferitele măsuri de protecție a intimității, nu la nivelul tranzacțiilor în sine sau al fluxurilor de bitcoini, ci la nivelul rețelei.

### Dandelion

O modalitate de a evita diverse atacuri de de-anonimizare este să folosești propunerea Dandelion. Acest protocol de difuzare a fost formalizat în BIP156, dar nu a fost niciodată implementat pe Bitcoin.

Ideea Dandelion este de a îmbunătăți intimitatea rutării tranzacțiilor în rețeaua Bitcoin pentru a contracara diverse forme de atacuri. Obiectivul principal este de a ascunde nodul sursă care a difuzat inițial o tranzacție în rețea. Divulgarea acestui nod ar putea lega o tranzacție Bitcoin de o anumită adresă IP (dacă nodul funcționează pe clearnet), ceea ce ar putea oferi un punct de intrare pentru analiza lanțului.
Această asociere între o activitate pe Bitcoin și o adresă IP reprezintă un risc semnificativ pentru confidențialitatea utilizatorului. Într-adevăr, numeroase entități pot lega cu ușurință o adresă IP de o identitate personală. Acest lucru include, în mod notabil, guvernele și furnizorii de servicii de internet. Mai mult, aceste informații pot deveni accesibile publicului, de exemplu, dacă adresa ta IP și datele personale sunt expuse din cauza unei scurgeri în timpul hacking-ului bazei de date a unui site web. În funcționarea standard a Bitcoin, tranzacțiile construite de un utilizator pe software-ul său de portofel sunt transmise nodului său personal. Acest nod difuzează imediat noua tranzacție tuturor nodurilor cu care este conectat.

![BTC204](assets/notext/65/01.webp)

Aceste noduri verifică apoi tranzacția pentru a se asigura că respectă regulile de consens și regulile de standardizare locală. Odată validată, fiecare nod, la rândul său, transmite tranzacția propriilor noduri, și așa mai departe.

![BTC204](assets/notext/65/02.webp)

Distribuția tranzacțiilor în așteptarea integrării într-un bloc se face într-un mod destul de echilibrat și statistic previzibil. Această vulnerabilitate poate fi exploatată de nodurile spion coluzive, care colaborează pentru a monitoriza și analiza rețeaua, în scopul de a identifica primul nod care a difuzat o tranzacție. Dacă un observator reușește să localizeze nodul sursă, poate presupune că tranzacția provine de la operatorul acelui nod. Acest tip de observație poate lega tranzacțiile, în mod normal anonime, de adrese IP specifice.

![BTC204](assets/notext/65/03.webp)

Scopul BIP156 este de a aborda această problemă. Pentru a face acest lucru, introduce o fază suplimentară în difuzarea unei noi tranzacții pentru a păstra anonimatul înainte de propagarea publică pe scară largă. Dandelion folosește mai întâi o fază "stem" (tulpină) unde tranzacția este trimisă printr-o cale aleatorie de noduri.

![BTC204](assets/notext/65/04.webp)

Tranzacția este apoi difuzată întregii rețele în faza "fluff" (puf).

![BTC204](assets/notext/65/05.webp)

Stem și fluff sunt referințe la comportamentul de propagare a tranzacției prin rețea, asemănându-se cu forma unei păpădii.

Astfel, nodurile spion pot urmări potențial tranzacția înapoi la nodul care a inițiat faza de fluff (difuzarea masivă), dar acest nod nu este cel care a difuzat prima dată tranzacția, deoarece a primit-o de la ultimul nod în stem. Dacă nodurile spion nu pot urmări înapoi pe stem, nu pot identifica, de asemenea, nodul sursă.

![BTC204](assets/notext/65/06.webp)
Chiar și în prezența nodurilor spion în timpul fazei stem, întotdeauna rămâne îndoiala, deoarece de îndată ce întâlnesc un nod onest în graficul de difuzie, spionii nu pot determina dacă acest nod este sursa originală sau pur și simplu un intermediar.
![BTC204](assets/notext/65/07.webp)

Această metodă de rutare estompează urma care duce la nodul sursă, făcând dificilă urmărirea unei tranzacții prin rețea înapoi la originea sa. Dandelion îmbunătățește astfel confidențialitatea limitând capacitatea adversarilor de a deanomiza rețeaua. Această metodă este și mai eficientă atunci când tranzacția traversează în timpul fazei "stem" un nod care criptează comunicațiile sale de rețea, ca de exemplu cu Tor sau P2P Transport V2.
BIP156 nu a fost integrat în Bitcoin Core și este în prezent clasificat sub statutul "respins". Una dintre principalele preocupări legate de acest protocol constă în faptul că, în timpul fazei stem, tranzacțiile trebuie retransmise de noduri intermediare înainte de a fi verificate. Așa cum am văzut, în modelul normal al Bitcoin, fiecare nod verifică mai întâi tranzacția înainte de a o difuza către colegii săi. Dacă o tranzacție nu respectă regulile de consens sau regulile de standardizare locale ale nodului, acesta o ignoră și nu o difuzează. Acest proces este important pentru a contracara atacurile DoS, deoarece numai tranzacțiile valide sunt difuzate în întreaga rețea. Tranzacțiile invalide, potențial generate în masă pentru a supraîncărca rețeaua, sunt oprite la primul nod întâlnit și nu se propagă. Principalul risc cu Dandelion este că acest nou protocol ar putea introduce noi vectori pentru atacurile DoS, permițând difuzarea tranzacțiilor invalide prin parte a rețelei.

### P2P Transport V2

P2P Transport V2 este un alt protocol de rețea prezentat în BIP324. Este o nouă versiune a protocolului de transport P2P Bitcoin care incorporează criptarea oportunistă pentru a îmbunătăți confidențialitatea și securitatea comunicațiilor între noduri.

Această îmbunătățire își propune să rezolve mai multe probleme cu versiunea de bază a protocolului P2P. Pe de o parte, face ca datele schimbate să fie de nerecunoscut de alte tipuri de date care circulă pe Internet pentru un observator pasiv. Obiectivul principal este de a preveni guvernele, furnizorii de servicii de internet sau furnizorii de VPN să monitorizeze masiv utilizatorii Bitcoin. Acest lucru complică de asemenea sarcina pentru aceste entități de a determina dacă un utilizator de Internet este, de asemenea, un utilizator Bitcoin, adică dacă operează un nod complet.
P2P V2 contribuie de asemenea la reducerea riscurilor de cenzură și atacuri prin detectarea unor modele specifice în pachetele de date. Complică și face executarea diverselor tipuri de atacuri Sybil mai costisitoare la nivelul rețelei. Un atac Sybil se produce când un actor creează multiple identități false pentru a obține un avantaj nedrept. În contextul rețelei Bitcoin, acest lucru se manifestă adesea ca un actor care controlează un număr mare de noduri complete și le folosește agresiv pentru a multiplica conexiunile. Atacurile Sybil pot fi pasive, având ca scop colectarea informațiilor și compromiterea confidențialității utilizatorului, sau active, sub forma atacurilor Eclipse. Acestea din urmă izolează un nod specific de restul rețelei, permițând fie cenzurarea utilizatorului, fie alterarea datelor pe care le primește. În final, P2P V2 face atacurile *Man-In-The-Middle* (MITM) mai costisitoare și mai ușor de detectat.
Criptarea implementată de P2P V2 nu include autentificarea pentru a nu adăuga complexitate inutilă și pentru a nu compromite natura fără permisiune a conexiunii în rețea. Acest nou protocol de transport P2P oferă totuși o securitate mai bună împotriva atacurilor pasive și face atacurile active semnificativ mai costisitoare și detectabile. Introducerea unui flux de date pseudo-aleatoriu în mesajele rețelei complică sarcina pentru atacatorii care doresc să cenzureze sau să manipuleze comunicațiile.

Transportul P2P V2 a fost inclus ca o opțiune (dezactivată implicit) în versiunea 26.0 a Bitcoin Core, lansată în decembrie 2023. A fost apoi activată implicit în versiunea 27.0 în aprilie 2024. Poate fi modificat cu opțiunea `v2transport=` în fișierul de configurare.

### Tor

O altă soluție relativ simplă pentru a evita riscurile pierderii confidențialității pentru un nod la nivelul rețelei este să îl rulezi în întregime sub Tor.
Tor este o rețea de servere de retransmisie (noduri) care anonimizează originea conexiunilor TCP pe internet. Funcționează prin încapsularea datelor în mai multe straturi de criptare. Fiecare nod de retransmisie îndepărtează un strat pentru a dezvălui adresa nodului următor, până când ajunge la destinația finală. Rețeaua Tor asigură anonimitatea prin prevenirea nodurilor intermediare de a cunoaște atât originea, cât și destinația datelor, făcând foarte dificilă pentru un observator urmărirea activității utilizatorului.
![BTC204](assets/notext/65/08.webp)
Prin urmare, Tor nu doar criptează datele comunicate, dar permite și mascarea originii și destinației comunicațiilor. Utilizând Tor pentru comunicațiile nodului personal, îmbunătățim confidențialitatea tranzacțiilor noastre: Furnizorul de Servicii Internet (ISP) nu poate decripta comunicațiile, iar alte noduri din rețeaua Bitcoin nu pot identifica adresa IP a nodului sursă. Mai mult, Tor ascunde de asemenea utilizarea Bitcoin de ISP-ul tău.

Principalul risc asociat cu această metodă este că Tor este un protocol independent de Bitcoin. Dacă ai un nod Bitcoin sub Tor și Tor încetează să funcționeze, atunci nodul tău Bitcoin nu va mai putea comunica.

De asemenea, este important de notat că comunicațiile prin Tor sunt mai lente. Această latență este deosebit de deranjantă în timpul lansării inițiale a unui nod, deoarece Descărcarea Inițială a Blocului (IBD) necesită multe comunicații. Ca rezultat, sincronizarea inițială cu rețeaua Bitcoin ar putea fi semnificativ mai lungă utilizând Tor. Este de asemenea posibil să efectuezi IBD pe clearnet, apoi să activezi Tor mai târziu. Deși această metodă dezvăluie existența nodului tău Bitcoin ISP-ului tău, protejează informațiile legate de tranzacțiile tale personale odată ce treci pe Tor.

După explorarea diferitelor metode de confidențialitate la nivel de rețea, vreau să introduc în capitolele următoare două soluții elegante pentru a evita reutilizarea adreselor: BIP47 și Plăți Silențioase.

## BIP47 și Coduri de Plată Reutilizabile
<chapterId>ad88e076-a04b-4aec-b3b2-7b4760175504</chapterId>

Așa cum am văzut în partea a 3-a, reutilizarea adreselor reprezintă un obstacol serios pentru confidențialitatea utilizatorilor pe protocolul Bitcoin. Pentru a atenua aceste riscuri, se recomandă cu tărie generarea unei adrese de primire noi pentru fiecare plată nouă primită într-un portofel. Deși generarea unei noi adrese este astăzi simplificată de utilizarea software-ului modern și a portofelelor deterministice ierarhice, această practică poate părea contraintuitivă.

![BTC204](assets/notext/66/1.webp)

În sistemul bancar tradițional, de exemplu, suntem obișnuiți să împărtășim IBAN-ul nostru, care rămâne întotdeauna același. Odată comunicat cuiva, aceștia ne pot trimite mai multe plăți fără a fi nevoie să interacționăm din nou cu ei. Neo-băncile oferă de asemenea posibilități mai moderne precum utilizarea de adrese de email unice pe PayPal sau RevTags pe Revolut. Chiar și în afara domeniului financiar, identificatorii noștri zilnici precum adresa poștală, numărul de telefon și adresa de email sunt de asemenea unice și permanente. Nu trebuie să le reînnoim la fiecare nouă interacțiune.

![BTC204](assets/notext/66/2.webp)
Cu toate acestea, funcționarea Bitcoin este diferită: este imperativ să generăm o nouă adresă de primire pentru fiecare tranzacție primită. Acest compromis între ușurința de utilizare și confidențialitate datează de la originea însăși a White Paper-ului Bitcoin. De la publicarea primei versiuni a documentului său la sfârșitul anului 2008, Satoshi Nakamoto ne-a avertizat deja despre acest risc:
**"*Ca un firewall suplimentar, un nou pereche de chei ar putea fi utilizată pentru fiecare tranzacție pentru a le menține nelegate de un proprietar comun.*"**
Există numeroase metode pentru a primi mai multe plăți către un singur identificator fără a cauza reutilizarea adresei. Fiecare are propriile compromisuri și dezavantaje. Printre aceste metode se numără BIP47, o propunere dezvoltată de Justus Ranvier și publicată în 2015. Această propunere își propune să creeze coduri de plată reutilizabile care permit efectuarea mai multor tranzacții către aceeași persoană evitând reutilizarea adresei. În esență, BIP47 caută să ofere un sistem de plată la fel de intuitiv ca un identificator unic, păstrând în același timp confidențialitatea tranzacțiilor.
![BTC204](assets/notext/66/3.webp)

BIP47 nu îmbunătățește direct confidențialitatea utilizatorului, deoarece o plată BIP47 oferă același nivel de confidențialitate ca o tranzacție Bitcoin clasică folosind adrese proaspete. Cu toate acestea, face utilizarea Bitcoinului mai convenabilă și intuitivă, o ușurință care, în mod normal, ar trebui să compromită confidențialitatea. Mulțumită BIP47, această ușurință de utilizare atinge același nivel de confidențialitate ca o tranzacție clasică. Acesta este motivul pentru care BIP47 este un instrument valoros pentru păstrarea confidențialității.

Inițial, BIP47 a fost o propunere formulată pentru a fi integrată în Bitcoin Core, dar nu a fost niciodată adoptată. Unele software-uri au ales totuși să o implementeze pe cont propriu la nivelul aplicației. Astfel, echipele de la Samourai Wallet au dezvoltat propria lor implementare a BIP47 numită "PayNym".

### Principiul General al BIP47 și PayNym

Scopul BIP47 este de a permite recepționarea numeroaselor plăți fără a cauza reutilizarea adresei. Se bazează pe utilizarea unui cod de plată reutilizabil, care permite diferiților expeditori să trimită mai multe plăți către un singur cod aparținând altui utilizator. Astfel, destinatarul nu trebuie să furnizeze o nouă adresă proaspătă pentru fiecare tranzacție, ceea ce facilitează în mare măsură schimburile lor păstrând în același timp confidențialitatea.

![BTC204](assets/en/66/4.webp)

Un utilizator poate, prin urmare, să împărtășească liber codul său de plată, fie pe rețelele sociale, fie pe site-ul său web, fără a risca să piardă confidențialitatea, spre deosebire de ceea ce s-ar întâmpla cu o adresă clasică de primire sau o cheie publică.
Pentru a efectua o tranzacție, ambele părți trebuie să aibă un portofel Bitcoin cu o implementare a BIP47, cum ar fi PayNym pe Samourai Wallet sau Sparrow Wallet. Utilizarea comună a codurilor lor de plată creează un canal secret între ele. Pentru a stabili acest canal eficient, expeditorul trebuie să efectueze o tranzacție specifică pe blockchain-ul Bitcoin, cunoscută sub numele de "tranzacție de notificare" (vă voi oferi mai multe detalii despre acest lucru mai târziu).

Combinarea codurilor de plată ale ambilor utilizatori generează secrete comune, care, la rândul lor, permit crearea unui număr mare de adrese unice de primire Bitcoin (exact 2^32, sau aproximativ 4 miliarde). Astfel, plățile efectuate prin BIP47 nu sunt de fapt adresate codului de plată în sine, ci mai degrabă adreselor clasice de primire derivate din codurile de plată ale utilizatorilor implicați.

Codul de plată servește astfel ca un identificator virtual derivat din sămânța portofelului. În structura de derivare ierarhică a portofelului, codul de plată este poziționat la nivelul 3, adică la nivelul contului.

![BTC204](assets/en/66/5.webp)

Scopul derivării pentru BIP47 este identificat de indexul `47'` (`0x8000002F`), referindu-se la BIP47. Un exemplu de cale de derivare pentru un cod de plată reutilizabil ar fi următorul:
```plaintext
m/47'/0'/0'/
```

Pentru a vă oferi o idee despre cum arată un cod de plată, iată al meu:
```plaintext
Acest cod poate fi, de asemenea, codificat într-un cod QR, pentru a facilita comunicarea sa, la fel ca o adresă de primire clasică.

În ceea ce privește PayNym Bots, acești roboți care sunt uneori văzuți pe Twitter, sunt reprezentări vizuale ale codului de plată, create de Samourai Wallet. Aceștia sunt generați printr-o funcție de hashing, ceea ce le conferă aproape unicitate. Apar sub forma unui mic șir de caractere care începe cu `+`:
```plaintext
+throbbingpond8B1
+twilightresonance487
+billowingfire340
```

Acești avataruri pot fi, de asemenea, reprezentați sub forma unor imagini:

![BTC204](assets/notext/66/6.webp)

Deși acești roboți nu au o funcționalitate tehnică specifică în cadrul BIP47, ei joacă un rol în facilitarea interacțiunilor între utilizatori prin oferirea unei identități vizuale ușor de recunoscut.
În secțiunile următoare ale acestui capitol dedicat BIP47, vom examina în detaliu modul său de funcționare, cu un accent deosebit pe metodele criptografice utilizate. Pentru a înțelege pe deplin aceste explicații oarecum tehnice, este esențial să înțelegeți mai întâi structura portofelelor HD, procesele de derivare a cheilor și principiile fundamentale ale criptografiei bazate pe curbe eliptice. Dacă doriți să aprofundați aceste concepte, un alt curs gratuit este disponibil pe PlanB Network: [CRYPTO 301](https://planb.network/en/courses/crypto301). Totuși, vă sfătuiesc să le urmați, deoarece înțelegerea funcționării tehnice a BIP47 vă va face mult mai ușor să înțelegeți alte propuneri similare pe care le vom discuta în capitolele următoare.
### Cod de Plată Reutilizabil

Așa cum am menționat anterior, codul de plată reutilizabil se află la adâncimea 3 a portofelului HD, făcându-l comparabil cu un `xpub`, atât în poziția sa în cadrul structurii portofelului, cât și în rolul său.

Codul de plată de 80 de octeți se descompune astfel:
- **Octetul `0`: Versiunea**. Pentru prima versiune a BIP47, acest octet este setat la `0x01`;
- **Octetul `1`: Câmpul de biți**. Acest spațiu este rezervat pentru integrarea indicațiilor suplimentare în timpul utilizărilor specifice. Pentru utilizarea standard cu PayNym, acest octet este definit ca `0x00`;
- **Octetul `2`: Paritatea `y`**. Acest octet este `0x02` sau `0x03`, indicând dacă ordonata cheii publice este pară sau impară, deoarece se utilizează o cheie publică comprimată;
- **De la octetul `3` la octetul `34`: Valoarea `x`**. Acești octeți reprezintă abscisa cheii publice. Concatenarea valorii `x` și a parității `y` formează cheia publică comprimată completă;
- **De la octetul `35` la octetul `66`: Codul lanțului**. Acest spațiu conține codul lanțului asociat cu cheia publică;
- **De la octetul `67` la octetul `79`: Umplutura**. Acest spațiu este destinat posibilelor dezvoltări viitoare. Pentru versiunea curentă, sunt plasați pur și simplu zerouri aici pentru a atinge dimensiunea necesară de 80 de octeți pentru un output `OP_RETURN`.

Iată reprezentarea hexadecimală a codului meu de plată reutilizabil prezentat deja în secțiunea anterioară:
```plaintext
0x010002a0716529bae6b36c5c9aa518a52f9c828b46ad8d907747f0d09dcd4d9a39e97c3c5f37c470c390d842f364086362f6122f412e2b0c7e7fc6e32287e364a7a36a00000000000000000000000000

![BTC204](assets/en/66/7.webp)

În primul rând, este necesar să adăugăm octetul prefix `P` la început pentru a indica clar că este vorba despre un cod de plată. Acest octet este reprezentat de `0x47`:
```plaintext
0x47010002a0716529bae6b36c5c9aa518a52f9c828b46ad8d907747f0d09dcd4d9a39e97c3c5f37c470c390d842f364086362f6122f412e2b0c7e7fc6e32287e364a7a36a00000000000000000000000000
```

În final, pentru a asigura integritatea codului de plată, se efectuează un calcul de checksum folosind `HASH256`, care constă într-un dublu hashing cu funcția `SHA256`. Primele patru octeți rezultați din acest hash sunt apoi concatenati la sfârșitul codului de plată:
```plaintext
0x47010002a0716529bae6b36c5c9aa518a52f9c828b46ad8d907747f0d09dcd4d9a39e97c3c5f37c470c390d842f364086362f6122f412e2b0c7e7fc6e32287e364a7a36a00000000000000000000000000567080c4
```

![BTC204](assets/en/66/8.webp)

Odată ce acești pași sunt finalizați, codul de plată este gata. Singurul lucru rămas de făcut este să-l convertim în base 58 pentru a obține versiunea sa finală:
```plaintext
PM8TJSBiQmNQDwTogMAbyqJe2PE2kQXjtgh88MRTxsrnHC8zpEtJ8j7Aj628oUFk8X6P5rJ7P5qDudE4Hwq9JXSRzGcZJbdJAjM9oVQ1UKU5j2nr7VR5
```

În timpul acestui proces de creare a codului de plată, folosim o cheie publică comprimată și un cod de lanț. Ambele sunt derivate dintr-o derivare deterministă și ierarhică din sămânța portofelului. Calea de derivare folosită pentru a realiza acest lucru este:
```plaintext
m/47'/0'/0'/
```
Pentru a genera cheia publică comprimată și codul de lanț asociat pentru codul de plată reutilizabil, începem prin calcularea cheii private maestre din sămânța portofelului. Apoi, procedăm la derivarea unui pereche de chei copil folosind indexul `47 + 2^31` (derivare întărită). Acest pas este urmat de încă două derivări succesive de perechi de chei copil, fiecare folosind indexul `2^31` (derivare întărită).
![BTC204](assets/notext/66/9.webp)

### Schimbul de chei Elliptic-Curve Diffie-Hellman (ECDH)
Protocolul criptografic din centrul BIP47 este menționat prin acronimul ECDH, pentru *Elliptic-Curve Diffie-Hellman*. Această metodă este o variantă a schimbului de chei original Diffie-Hellman.
Introdus în 1976, Diffie-Hellman este un protocol de acordare a cheilor care permite celor două părți, fiecare echipată cu o pereche de chei (publică și privată), să cadă de acord asupra unui secret comun, chiar și comunicând exclusiv printr-un canal public și nesigur.

![BTC204](assets/en/66/10.webp)

Acest secret comun (aici, cheia albastră), poate fi apoi utilizat pentru alte operațiuni. De obicei, acest secret partajat poate fi folosit pentru a cripta și decripta comunicațiile printr-o rețea nesigură:

![BTC204](assets/notext/66/11.webp)

Pentru a realiza acest schimb, Diffie-Hellman folosește aritmetica modulară pentru a calcula secretul partajat. Iată o explicație simplificată despre cum funcționează:
- Alice și Bob cad de acord asupra unei culori comune, aici galben, care constituie date publice (atacatorii cunosc această culoare);
- Alice selectează o culoare secretă, aici roșu, și amestecă cele două pentru a obține portocaliu;
- Bob, de asemenea, alege o culoare secretă, aici albastru, și o amestecă cu galbenul pentru a obține verde;
- Apoi, ei schimbă culorile obținute, portocaliu și verde. Acest schimb poate avea loc printr-o rețea nesigură și observată;
- Amestecând verdele lui Bob cu propria sa culoare secretă, Alice produce maro;
- Bob, făcând același lucru cu portocaliul lui Alice și albastrul său secret, obține de asemenea maro.

![BTC204](assets/en/66/12.webp)

În această simplificare, culoarea maro reprezintă secretul partajat între Alice și Bob. Este important de înțeles că, în realitate, este imposibil pentru atacator să separe culorile portocaliu și verde pentru a descoperi culorile secrete ale lui Alice sau Bob.

Acum, să examinăm cum funcționează de fapt acest protocol, nu cu analogii de culoare, ci folosind numere reale și aritmetică modulară!
Înainte de a discuta mecanismele Diffie-Hellman, permiteți-mi să vă reamintesc pe scurt două concepte matematice esențiale de care vom avea nevoie:

- Un **număr prim** este un număr natural care are doar doi divizori: $1$ și el însuși. De exemplu, $7$ este un număr prim pentru că poate fi împărțit doar la $1$ și $7$. Pe de altă parte, $8$ nu este un număr prim deoarece este divizibil cu $1$, $2$, $4$ și $8$. Prin urmare, are patru divizori întregi pozitivi în loc de doi;
- **Modulo** (notat $mod$ sau $\%$) este o operație matematică care, între doi întregi, returnează restul împărțirii euclidiene a primului la al doilea. De exemplu, $16 \bmod 5 = 1$.

**Schimbul de chei Diffie-Hellman între Alice și Bob se desfășoară astfel:**

- Alice și Bob cad de acord asupra a două numere comune: $p$ și $g$. $p$ este un număr prim, și cu cât acest număr este mai mare, cu atât Diffie-Hellman va fi mai sigur. $g$ este un rădăcină primitivă a lui $p$. Aceste două numere pot fi comunicate deschis printr-o rețea nesecurizată. Ele reprezintă echivalentul **culorii galbene** din simplificarea anterioară. Prin urmare, este important ca Alice și Bob să folosească exact aceleași valori pentru $p$ și $g$.
- Odată ce acești parametri sunt definiți, Alice și Bob aleg fiecare un număr secret aleatoriu. Alice își numește numărul secret aleatoriu $a$ (echivalent cu **culoarea roșie**) iar Bob își numește al său $b$ (echivalent cu **culoarea albastră**). Aceste numere trebuie să rămână strict confidențiale.
- În loc să-și schimbe direct numerele $a$ și $b$, fiecare parte calculează $A$ și $B$ după cum urmează:

$A$ este egal cu $g$ ridicat la puterea lui $a$ modulo $p$:

$$
A = g^a \bmod p
$$

$B$ este egal cu $g$ ridicat la puterea lui $b$ modulo $p$:

$$
B = g^b \bmod p
$$

- Valorile $A$ (echivalent cu **culoarea portocalie**) și $B$ (echivalent cu **culoarea verde**) sunt schimbate între cele două părți. Acest schimb poate avea loc deschis pe o rețea nesecurizată;

- Alice, după ce a primit $B$, calculează valoarea lui $z$ după cum urmează:

$z$ este egal cu $B$ ridicat la puterea lui $a$ modulo $p$:

$$
z = B^a \bmod p
$$

Pentru a reaminti:

$$
B = g^b \bmod p
$$

Astfel, obținem:

$$
z = B^a \bmod p
$$

$$
z = (g^b)^a \bmod p
$$

Aplicând regulile exponenților:
$$
(x^n)^m = x^{nm}
$$

Apoi obținem:

$$
z = g^{ba} \bmod p
$$

- La rândul său, Bob, după ce a primit $A$, calculează de asemenea valoarea lui $z$ în următorul mod:

$z$ este egal cu $A$ ridicat la puterea lui $b$ modulo $p$:

$$
z = A^b \bmod p
$$

Astfel, obținem:

$$
z = (g^a)^b \bmod p
$$

$$
z = g^{ab} \bmod p
$$

$$
z = g^{ba} \bmod p
$$

Mulțumită distributivității operatorului modulo, Alice și Bob obțin exact aceeași valoare $z$. Acest număr reprezintă secretul lor comun, echivalent cu **culoarea maro** în simplificarea anterioară cu oalele de vopsea. Acum pot folosi acest secret comun pentru a cripta comunicațiile lor simetric peste o rețea nesecurizată.

![BTC204](assets/notext/66/13.webp)

Un atacator, chiar și în posesia lui $p$, $g$, $A$, și $B$ (valorile publice), nu va putea calcula $a$, $b$, sau $z$ (valorile private). Pentru a realiza acest lucru, ar trebui să inverseze exponențierea, o operație imposibilă fără a încerca toate posibilitățile una câte una, deoarece echivalează cu calcularea logaritmului discret, adică inversul exponențialului într-un grup ciclic finit.

Astfel, atâta timp cât valorile lui $a$, $b$, și $p$ sunt suficient de mari, protocolul Diffie-Hellman este sigur. De obicei, cu parametri de 2048 de biți (un număr cu 600 de cifre în zecimal), testarea tuturor posibilităților pentru $a$ și $b$ ar fi impracticabilă. Până în ziua de azi, cu astfel de numere, acest algoritm este considerat sigur.
Acesta este exact locul unde se află principalul dezavantaj al protocolului Diffie-Hellman. Pentru a fi sigur, algoritmul trebuie să utilizeze numere mari. De aceea, în zilele noastre, se preferă algoritmul ECDH (*Elliptic Curve Diffie-Hellman*), o variantă a Diffie-Hellman care se bazează pe o curbă algebrică, mai precis pe o curbă eliptică. Această abordare permite lucrul cu numere mult mai mici menținând în același timp o securitate echivalentă, reducând astfel resursele necesare pentru calcul și stocare.
Principiul general al algoritmului rămâne același. Totuși, în loc să utilizăm un număr aleatoriu $a$ și un număr $A$ calculat din $a$ prin exponențiere modulară, folosim un pereche de chei stabilite pe o curbă eliptică. În loc să ne bazăm pe distributivitatea operatorului modulo, folosim legea grupului pe curbele eliptice, și mai specific asociativitatea acestei legi.
Pentru a explica pe scurt principiul criptografiei cu curbe eliptice, o cheie privată este reprezentată de un număr aleatoriu între $1$ și $n-1$, unde $n$ reprezintă ordinul curbei. Cheia publică, pe de altă parte, este un punct specific pe această curbă, obținut din cheia privată prin operații de adunare și dublare a punctelor începând de la punctul generator, conform ecuației:
$$
K = k \cdot G
$$

În această formulă, $K$ denotă cheia publică, $k$ cheia privată, și $G$ punctul generator.

Una dintre caracteristicile esențiale ale acestor chei este ușurința calculării lui $K$ din $k$ și $G$, în timp ce este practic imposibil să găsești $k$ din $K$ și $G$. Această asimetrie creează o funcție unidirecțională. Cu alte cuvinte, este ușor să calculezi cheia publică dacă știi cheia privată, dar este imposibil să găsești cheia privată din cheia publică. Această securitate se bazează încă pe dificultatea computațională a logaritmului discret.

Vom folosi această proprietate pentru a adapta algoritmul nostru Diffie-Hellman. **Principiul de funcționare al ECDH este următorul:**

- Alice și Bob se pun de acord împreună pe o curbă eliptică criptografic sigură și parametrii săi. Aceste informații sunt publice;

- Alice generează un număr aleatoriu $ka$ care va fi cheia ei privată. Această cheie privată trebuie să rămână secretă. Ea determină cheia ei publică $Ka$ prin adunare și dublare de puncte pe curba eliptică aleasă:

$$
K_a = k_a \cdot G
$$

- Bob generează de asemenea un număr aleatoriu $kb$ care va fi cheia lui privată. El calculează cheia publică asociată $Kb$:

$$
K_b = k_b \cdot G
$$

- Alice și Bob își schimbă cheile publice $Ka$ și $Kb$ printr-o rețea publică nesecurizată.

- Alice calculează un punct $(x,y)$ pe curbă aplicând cheia ei privată $ka$ la cheia publică a lui Bob $Kb$:

$$
(x,y) = k_a \cdot K_b
$$

- Bob calculează un punct $(x,y)$ pe curbă aplicând cheia lui privată $kb$ la cheia publică a lui Alice $Ka$:

$$
(x,y) = k_b \cdot K_a
$$

- Alice și Bob obțin același punct pe curba eliptică. Secretul comun va fi coordonata x $x$ a acestui punct.

Ei obțin într-adevăr același secret comun pentru că:
(x,y) = k_a \cdot K_b = k_a \cdot (k_b \cdot G) = (k_a \cdot k_b) \cdot G = (k_b \cdot k_a) \cdot G = k_b \cdot (k_a \cdot G) = k_b \cdot K_a$$
Un atacator care observă rețeaua publică nesecurizată poate obține doar cheile publice ale fiecărei părți și parametrii curbei eliptice alese. Așa cum a fost explicat anterior, aceste informații singure nu sunt suficiente pentru a determina cheile private. Prin urmare, atacatorul nu poate găsi secretul comun între Alice și Bob.

ECDH este astfel un algoritm care permite schimbul de chei. Este adesea utilizat în combinație cu alte metode criptografice pentru a stabili un protocol complet. De exemplu, ECDH este integrat în nucleul TLS (*Transport Layer Security*), un protocol de criptare și autentificare utilizat pentru stratul de transport al internetului. TLS utilizează ECDHE pentru schimbul de chei, o variantă a ECDH unde cheile sunt efemere, pentru a oferi confidențialitate persistentă. În plus, TLS utilizează algoritmi de autentificare precum ECDSA, algoritmi de criptare cum ar fi AES și funcții hash precum SHA256.

TLS este notabil responsabil pentru `s` din `https` precum și pentru lacătul vizibil în bara de adrese a browserului tău, simboluri ale comunicațiilor criptate. Urmând acest curs, folosești deci ECDH, și este foarte probabil că îl folosești zilnic fără să știi.

### Tranzacția de Notificare

Așa cum am văzut în secțiunea precedentă, ECDH este o variantă a schimbului Diffie-Hellman folosind perechi de chei stabilite pe o curbă eliptică. Convenabil, noi deja deținem multe perechi de chei care aderă la acest standard în portofelele noastre Bitcoin! Ideea BIP47 este de a folosi perechile de chei din portofelele Bitcoin ierarhice deterministe ale ambelor părți pentru a stabili secrete comune și efemere între ele. În contextul BIP47, ECDHE (*Elliptic Curve Diffie-Hellman Ephemeral*) este folosit în schimb.

![BTC204](assets/notext/66/14.webp)

ECDHE este folosit pentru prima dată în BIP47 pentru a transmite codul de plată de la expeditor la destinatar. Aceasta este faimoasa **tranzacție de notificare**. Acest pas este esențial deoarece, pentru ca BIP47 să funcționeze eficient, ambele părți implicate (expeditorul și destinatarul) trebuie să cunoască codul de plată al celuilalt. Această cunoaștere permite derivarea cheilor publice efemere și, prin urmare, a adreselor de primire asociate goale.
Înainte de acest schimb, expeditorul este logic deja conștient de codul de plată al destinatarului deoarece l-au obținut off-chain, de exemplu, de pe site-ul lor, dintr-o factură sau de pe rețelele sociale. Cu toate acestea, destinatarul nu poate să cunoască neapărat codul de plată al expeditorului. Totuși, acest cod trebuie transmis lor; altfel, nu vor putea deriva cheile efemere necesare pentru identificarea adreselor unde sunt stocate bitcoinii lor, nici să acceseze fondurile lor. Deși această transmitere a codului expeditorului poate fi tehnic realizată off-chain prin alte mijloace de comunicare, acest lucru pune o problemă dacă portofelul trebuie recuperat doar din sămânță.
Într-adevăr, spre deosebire de adresele convenționale, adresele BIP47 nu sunt derivate direct din seed-ul destinatarului - utilizarea unui `xpub` ar fi mai simplă în acest caz - ci rezultă dintr-un calcul care combină ambele coduri de plată: cel al expeditorului și cel al destinatarului. Astfel, dacă destinatarul își pierde portofelul și încearcă să-l restaureze din seed-ul său, își va recupera propriul cod de plată, care este derivat direct din seed-ul său. Totuși, pentru a găsi adresele efemere, va fi esențial pentru ei să aibă de asemenea codurile de plată ale tuturor celor care le-au trimis bitcoin prin BIP47. De aici importanța tranzacției de notificare, care permite salvarea acestei informații pe blockchain-ul Bitcoin, putând fi găsită foarte ușor fără a fi nevoie să se caute prin miliardul de tranzacții executate de la lansarea sa în 2009.
![BTC204](assets/en/66/15.webp)

Prin urmare, ar fi posibil să se implementeze BIP47 fără a recurge la tranzacția de notificare, cu condiția ca fiecare utilizator să păstreze o copie de rezervă a codurilor de plată ale colegilor săi. Totuși, această metodă se dovedește complexă de gestionat atâta timp cât nu este dezvoltată o soluție simplă, robustă și eficientă pentru crearea, stocarea și actualizarea acestor copii de rezervă. În starea actuală a lucrurilor, tranzacția de notificare devine astfel aproape indispensabilă.

În capitolele următoare, vom studia alte protocoale cu obiective similare celor ale BIP47, dar care nu necesită o tranzacție de notificare. Aceste alternative, totuși, introduc propriile lor compromisuri.

Pe lângă rolul său în backup-ul codurilor de plată, tranzacția de notificare servește de asemenea ca o funcție de notificare pentru destinatar, așa cum sugerează și numele său. Semnalează clientului destinatarului că un nou canal de plată a fost stabilit și, prin urmare, sugerează monitorizarea adreselor efemere rezultate.

### Modelul de Confidențialitate al BIP47

Înainte de a detalia funcționarea tehnică a tranzacției de notificare, este important să discutăm modelul de confidențialitate asociat cu BIP47, care justifică anumite măsuri luate în timpul creării acestei tranzacții inițiale.
Codul de plată, în sine, nu reprezintă un risc direct pentru confidențialitate. Spre deosebire de modelul tradițional Bitcoin, care își propune să rupă legătura dintre identitatea unui utilizator și tranzacțiile sale (care sunt publice) prin păstrarea anonimatului cheilor și adreselor, codul de plată poate fi asociat deschis cu o identitate fără a reprezenta o amenințare.
Într-adevăr, codul de plată nu este folosit pentru a deriva direct adresele care primesc plăți BIP47. Aceste adrese sunt generate în schimb prin aplicarea ECDH între cheile derivate ale codurilor de plată ale celor două părți implicate.

Astfel, un cod de plată în sine nu duce direct la o pierdere a confidențialității, deoarece doar adresa de notificare este derivată din acesta. Deși această adresă poate dezvălui unele informații, în mod normal nu permite descoperirea părților cu care efectuați tranzacții, decât prin intermediul unei analize amănunțite a lanțului. Într-adevăr, dacă expeditorul folosește UTXO-uri care pot fi legate de identitatea sa pentru a efectua tranzacția de notificare, atunci devine posibil să se deducă că identitatea lor este probabil legată de plățile BIP47 către codul dvs. de plată. Acest lucru nu va dezvălui tranzacțiile subiacente, dar va indica existența probabilă a acestora.

Prin urmare, este esențial să se mențină această separare strictă între codurile de plată ale utilizatorilor. Spre acest scop, pasul inițial de comunicare al codului este un moment critic pentru confidențialitatea plății, totuși obligatoriu pentru funcționarea corectă a protocolului. Dacă unul dintre codurile de plată poate fi obținut public (cum ar fi pe un site web), al doilea cod, cel al expeditorului, nu trebuie să fie legat în niciun caz de primul.

Să luăm un exemplu concret: Vreau să fac o donație unei mișcări politice prin BIP47:
- Organizația și-a făcut codul de plată public pe site-ul său sau prin rețelele sale sociale;
- Acest cod este astfel legat de mișcarea politică;
- Recuperez acest cod de plată;
- Înainte de a proceda cu o trimitere, trebuie să mă asigur că ei cunosc propriul meu cod de plată, care este de asemenea legat de identitatea mea deoarece îl folosesc pentru a primi tranzacții pe rețelele mele sociale.

Cum să transmit codul meu fără risc? Utilizarea mijloacelor de comunicare convenționale ar putea duce la scurgerea informațiilor, și, prin urmare, mă poate asocia cu această mișcare politică. Tranzacția de notificare oferă o soluție datorită unui strat de criptare care previne precis această asociere între două coduri. Deși aceasta nu este singura metodă de a transmite în secret codul de plată al expeditorului, se dovedește a fi foarte eficientă.

În diagrama de mai jos, liniile portocalii indică punctele unde fluxul de informații trebuie întrerupt, iar săgețile negre arată conexiunile care ar putea fi observate potențial de terțe părți:
![BTC204](assets/en/66/16.webp)
În realitate, în cadrul modelului tradițional de confidențialitate al Bitcoin, este adesea complex să disociezi complet fluxul de informații între perechea de chei și utilizator, mai ales în timpul tranzacțiilor la distanță. De exemplu, în contextul unei campanii de donații, destinatarul trebuie inevitabil să dezvăluie o adresă sau o cheie publică prin intermediul site-ului sau rețelelor sociale. Utilizarea corectă a BIP47, în special cu tranzacția de notificare, permite ocolirea acestei probleme datorită ECDHE și stratului de criptare pe care îl vom studia mai departe.

Desigur, modelul clasic de confidențialitate al Bitcoin se aplică în continuare cheilor publice efemere, care sunt derivate din combinația celor două coduri de plată. Cele două modele sunt de fapt complementare. Ceea ce vreau să subliniez aici este că, spre deosebire de utilizarea obișnuită a unei chei publice pentru a primi bitcoin, codul de plată poate fi legat de o identitate specifică, deoarece informația "_Alice efectuează o tranzacție cu Bob_" este întreruptă la o altă etapă. Codul de plată este folosit pentru a genera adrese de plată, dar bazându-se exclusiv pe observația blockchain-ului, este imposibil să se lege o tranzacție de plată BIP47 de codurile de plată folosite pentru a o executa, decât dacă UTXO-urile implicate au fost deja legate de o identitate anterior și utilizatorii și-au asociat codurile de plată cu identitățile lor respective.

Pentru a rezuma, modelul de confidențialitate oferit de plățile BIP47 ar putea fi considerat superior celui de bază al Bitcoin, deși nu este magic prin niciun mijloc.

### Construcția Tranzacției de Notificare

Acum, să vedem cum funcționează această tranzacție de notificare. Imaginați-vă că Alice dorește să trimită fonduri lui Bob cu BIP47. În exemplul meu, Alice acționează ca expeditor și Bob ca destinatar. Acesta din urmă și-a publicat codul de plată pe site-ul său. Prin urmare, Alice este deja conștientă de codul de plată al lui Bob.

**1- Alice calculează un secret comun cu ECDH:**

- Ea selectează o pereche de chei din portofelul său HD situat pe o ramură diferită de codul său de plată. Notă, această pereche nu ar trebui să fie ușor asociată cu adresa de notificare a lui Alice, nici cu identitatea lui Alice (vezi secțiunea anterioară);

- Alice selectează cheia privată din această pereche. O numim $a$ (minuscul);

$$
a
$$
- Alice recuperează cheia publică asociată cu adresa de notificare a lui Bob. Această cheie este prima fiică derivată din codul de plată al lui Bob (indexul $/0$). Această cheie publică o numim $B$ (majuscul). Cheia privată asociată cu această cheie publică este numită $b$ (minuscul). $B$ este determinată prin adiție și dublare de puncte pe curba eliptică de la $G$ (punctul generator) cu $b$ (cheia privată):
$$ B = b \cdot G $$
- Alice calculează un punct secret $S$ (majuscul) pe curba eliptică prin adunare și dublare de puncte aplicând cheia sa privată $a$ la cheia publică a lui Bob $B$.
$$ S = a \cdot B $$

- Alice calculează factorul de orbire $f$ care îi va permite să cripteze codul ei de plată. Pentru a face acest lucru, ea va determina un număr pseudo-aleator cu funcția HMAC-SHA512. În al doilea input al acestei funcții, ea folosește o valoare pe care numai Bob o va putea recupera: $x$ care este abscisa punctului secret calculat anterior. Primul input este $o$ care este UTXO consumat în inputul acestei tranzacții (outpoint).

$$ f = \text{HMAC-SHA512}(o, x) $$

**2- Alice convertește codul ei personal de plată în baza 2 (binar).**

**3- Ea folosește acest factor de orbire ca o cheie pentru a efectua criptarea simetrică a payload-ului codului ei de plată.** Algoritmul de criptare folosit este simplu un `XOR`. Operația efectuată este comparabilă cu cifrul Vernam, numit și "One-Time Pad".

- Alice împarte mai întâi factorul său de orbire în două: primii 32 de bytes sunt numiți $f1$ și ultimii 32 de bytes sunt numiți $f2$. Astfel, avem:

$$ f = f1 || f2 $$

- Alice calculează $x'$ criptat al abscisei cheii publice $x$ a codului ei de plată, și $c'$ criptat al codului ei de lanț $c$ separat. $f1$ și $f2$ acționează respectiv ca chei de criptare. Operația folosită este `XOR` (sau exclusiv).

$$ x' = x \oplus f1 $$
$$ c' = c \oplus f2 $$

- Alice înlocuiește valorile reale ale abscisei cheii publice $x$ și codul lanțului $c$ în codul ei de plată cu valorile criptate $x'$ și $c'$.
**4-** Alice are acum codul ei de plată cu un payload criptat. Ea va construi și va difuza o tranzacție care implică cheia ei publică $A$ ca input, un output către adresa de notificare a lui Bob, și un output `OP_RETURN` conținând codul ei de plată cu payload-ul criptat. **Această tranzacție este tranzacția de notificare**.
Un `OP_RETURN` este un opcode care marchează un output al tranzacției Bitcoin ca fiind invalid. Astăzi, este folosit pentru a difuza sau ancora informații pe blockchain-ul Bitcoin. Până la 80 de bytes de date pot fi stocate, care sunt scrise pe lanț și astfel vizibile tuturor celorlalți utilizatori.

Așa cum am văzut în secțiunile anterioare, ECDH este folosit pentru a genera un secret comun între doi utilizatori care comunică printr-o rețea nesigură, posibil observată de atacatori. În BIP47, ECDH este utilizat pentru comunicare peste rețeaua Bitcoin, care prin natura sa este o rețea de comunicare transparentă observată de mulți atacatori. Secretul comun calculat prin schimbul de chei ECDH este apoi folosit pentru a cripta informațiile secrete care trebuie transmise: codul de plată al expeditorului (Alice).

Să recapitulăm pașii pe care tocmai i-am revizuit împreună pentru a efectua o tranzacție de notificare:
- Alice recuperează codul de plată și adresa de notificare a lui Bob;
- Alice selectează un UTXO pe care îl deține în portofelul ei HD cu perechea de chei corespunzătoare;
- Ea calculează un punct secret pe curba eliptică folosind ECDH;
- Ea folosește acest punct secret pentru a calcula un HMAC, care este factorul de orbire;
- Ea folosește acest factor de orbire pentru a cripta payload-ul codului ei personal de plată;
- Ea folosește un output de tranzacție `OP_RETURN` pentru a comunica codul de plată mascat către Bob.
![BTC204](assets/en/66/17.webp)

### Tranzacție de Notificare: Studiu Concret

Pentru a înțelege mai detaliat funcționarea sa, în special utilizarea `OP_RETURN`, să examinăm împreună o tranzacție reală de notificare. Am efectuat o astfel de tranzacție pe testnet, pe care o puteți găsi [dând clic aici](https://mempool.space/fr/testnet/tx/0e2e4695a3c49272ef631426a9fd2dae6ec3a469e3a39a3db51aa476cd09de2e).

![BTC204](assets/notext/66/18.webp)

Observând această tranzacție, putem vedea că are un singur input și 4 outputs:
- Primul output este `OP_RETURN` care conține codul meu de plată mascat;
- Al doilea output de 546 sats indică adresa de notificare a destinatarului meu;
- Al treilea output de 15,000 sats reprezintă taxele de serviciu, deoarece am folosit Samourai Wallet pentru a construi această tranzacție;
- Al patrulea output de 2 milioane sats reprezintă restul, adică diferența rămasă din inputul meu care se întoarce la o altă adresă care îmi aparține.
Cel mai interesant de studiat este, evident, output-ul 0 folosind `OP_RETURN`. Să privim mai atent ce conține. Iată `scriptPubKey` în hexadecimal:

```text
6a4c50010002b13b2911719409d704ecc69f74fa315a6cb20fdd6ee39bc9874667703d67b164927b0e88f89f3f8b963549eab2533b5d7ed481a3bea7e953b546b4e91b6f50d800000000000000000000000000
```

În acest script, putem diseca mai multe părți. În primul rând, opcode-urile:

```text
6a4c
```

Printre opcode-uri, putem recunoaște `0x6a` care desemnează `OP_RETURN` și `0x4c` care desemnează `OP_PUSHDATA1`.

Byte-ul care urmează acestui ultim opcode indică dimensiunea payload-ului care urmează. Acesta indică `0x50`, sau 80 de bytes:

```text
6a4c50
```

Apoi, avem metadatele codului meu de plată în text clar:

```text
010002
```

Coordonata x criptată a cheii publice a codului meu de plată:

```text
b13b2911719409d704ecc69f74fa315a6cb20fdd6ee39bc9874667703d67b164
```

Codul lanțului criptat al codului meu de plată:

```text
927b0e88f89f3f8b963549eab2533b5d7ed481a3bea7e953b546b4e91b6f50d8
```

Și, în final, padding pentru a ajunge la 80 de bytes, dimensiunea standard a unui `OP_RETURN`:

```text
00000000000000000000000000
```

Pentru a înțelege mai bine, iată codul meu de plată în text clar în base 58:

```text
Când comparam codul meu de plată în text clar cu `OP_RETURN`, se observă că HRP-ul (`0x47`) și checksum-ul (`0x8604e4db`) nu sunt transmise. Acest lucru este așteptat, deoarece aceste informații sunt destinate oamenilor.
În continuare, putem identifica versiunea (`0x01`), câmpul de biți (`0x00`) și paritatea cheii publice (`0x02`). Și, la sfârșitul codului de plată, octeții goi (`0x00000000000000000000000000`) sunt folosiți pentru a completa codul la un total de 80 de octeți. Toate aceste metadate sunt transmise în text clar (necriptat).

În final, se poate observa că coordonata x a cheii publice (`0x77507c9c17a89cfca2d3af554745d6c2db0e7f6b2721a3941a504933103cc42a`) și codul lanțului (`0xdd94881210d6e752a9abc8a9fa0070e85184993c4f643f1121dd807dd556d1dc`) au fost criptate. Aceasta constituie payload-ul codului de plată.

### Ce este XOR?

În secțiunile anterioare, am văzut că codul de plată a fost transmis criptat folosind operația XOR. Să ne luăm un moment pentru a înțelege cum funcționează acest operator, deoarece este larg utilizat în criptografie.

XOR este un operator logic pe biți bazat pe algebra booleană. Cu doi operanzi pe biți, acesta returnează `1` dacă biții de același rang sunt diferiți, și returnează `0` dacă biții de același rang sunt la fel. Iată tabelul adevărului pentru XOR bazat pe valorile operanzilor `D` și `E`:

| D   | E   | D XOR E |
| --- | --- | ------- |
| 0   | 0   | 0       |
| 0   | 1   | 1       |
| 1   | 0   | 1       |
| 1   | 1   | 0       |

De exemplu:

$$
0110 \oplus 1110 = 1000
$$

Sau:

$$
010011 \oplus 110110 = 100101
$$

Cu ECDH, folosirea XOR ca strat de criptare este deosebit de potrivită. În primul rând, datorită acestui operator, criptarea este simetrică. Acest lucru permite destinatarului să decripteze codul de plată cu aceeași cheie folosită pentru criptare. Cheia de criptare și decriptare este calculată din secretul comun datorită ECDH. Această simetrie este posibilă datorită proprietăților comutative și asociative ale operatorului XOR:

- Alte proprietăți:

$$
D \oplus D = 0
$$
D ⊕ 0 = D
- Comutativitate:

$$
D \oplus E = E \oplus D
$$

- Asociativitate:

$$
D \oplus (E \oplus Z) = (D \oplus E) \oplus Z = D \oplus E \oplus Z
$$

Dacă:

$$
D \oplus E = L
$$

Atunci:

$$
D \oplus L = D \oplus (D \oplus E) = D \oplus D \oplus E = 0 \oplus E = E \\
\therefore D \oplus L = E
$$

În continuare, această metodă de criptare seamănă foarte mult cu cifrul Vernam (One-Time Pad), singurul algoritm de criptare cunoscut până în prezent care are securitate necondiționată (sau absolută). Pentru ca cifrul Vernam să aibă această caracteristică, cheia de criptare trebuie să fie perfect aleatorie, trebuie să aibă aceeași dimensiune ca mesajul și trebuie folosită doar o singură dată. În metoda de criptare utilizată aici pentru BIP47, cheia este într-adevăr de aceeași dimensiune ca mesajul, factorul de orbire este exact aceeași dimensiune ca și concatenarea coordonatei x a cheii publice cu codul lanțului codului de plată. Această cheie de criptare este într-adevăr folosită doar o singură dată. Cu toate acestea, această cheie nu este rezultatul unei aleatorii perfecte deoarece este un HMAC. Este mai degrabă pseudo-aleatorie. Prin urmare, nu este un cifru Vernam, dar metoda este similară.

### Primirea Tranzacției de Notificare

Acum că Alice a trimis tranzacția de notificare către Bob, să vedem cum o interpretează el. Ca un memento, Bob trebuie să poată accesa codul de plată al lui Alice. Fără această informație, după cum vom vedea în secțiunea următoare, el nu va putea deriva perechile de chei create de Alice și, prin urmare, nu va putea accesa bitcoinii săi primiți prin BIP47. Pentru moment, payload-ul codului de plată al lui Alice este criptat. Să vedem cum îl decriptează Bob.

**1-** Bob monitorizează tranzacțiile care creează output-uri cu adresa sa de notificare.

**2-** Când o tranzacție are un output pe adresa sa de notificare, Bob o analizează pentru a vedea dacă conține un output OP_RETURN care urmează standardul BIP47.

**3-** Dacă primul octet al payload-ului OP_RETURN este `0x01`, Bob începe căutarea unui posibil secret comun cu ECDH:
- Bob selectează cheia publică în input-ul tranzacției. Adică, cheia publică a lui Alice numită $A$ cu:

$$ A = a \cdot G $$

- Bob selectează cheia privată $b$ asociată cu adresa sa personală de notificare:

$$ b $$
- Bob calculează punctul secret $S$ (secretul comun ECDH) pe curba eliptică prin adăugarea și dublarea punctelor, aplicând cheia sa privată $b$ la cheia publică a lui Alice $A$:
$$ S = b \cdot A $$

- Bob determină factorul de orbire $f$ care îi va permite să decripteze payload-ul codului de plată al lui Alice. În același mod în care Alice a calculat anterior, Bob va găsi $f$ aplicând HMAC-SHA512 pe $x$ coordonata x a punctului secret $S$, și pe $o$ UTXO-ul consumat ca input în această tranzacție de notificare:

$$ f = \text{HMAC-SHA512}(o, x) $$

**4-** Bob interpretează datele din OP_RETURN al tranzacției de notificare ca un cod de plată. El va decripta pur și simplu payload-ul acestui potențial cod de plată folosind factorul de orbire $f$:
- Bob împarte factorul de orbire $f$ în 2 părți: primele 32 de octeți din $f$ vor fi $f1$ iar ultimii 32 de octeți vor fi $f2$;
- Bob decriptează coordonata x criptată $x'$ a cheii publice din codul de plată al Alicei:

$$ x = x' \oplus f1 $$

- Bob decriptează valoarea criptată a codului lanțului $c'$ din codul de plată al Alicei:

$$ c = c' \oplus f2 $$

**5-** Bob verifică dacă valoarea cheii publice din codul de plată al Alicei este într-adevăr parte a grupului secp256k1. Dacă acesta este cazul, el interpretează acest lucru ca un cod de plată valid. Altfel, el ignoră această tranzacție.

Acum că Bob este conștient de codul de plată al Alicei, ea îi poate trimite până la `2^32` plăți, fără a mai avea nevoie să facă o altă tranzacție de notificare de acest tip din nou.

De ce funcționează acest lucru? Cum reușește Bob să determine același factor de orbire ca și Alice, și astfel să decripteze codul ei de plată? Să privim mai atent rolul ECDH în ceea ce tocmai am descris.

În primul rând, avem de-a face cu criptarea simetrică. Acest lucru înseamnă că cheia de criptare și cheia de decriptare sunt aceeași valoare. Această cheie în tranzacția de notificare este factorul de orbire:

$$ f = f1 || f2 $$

Prin urmare, Alice și Bob trebuie să obțină aceeași valoare pentru $f$, fără a o transmite direct deoarece un atacator ar putea să o fure și să decripteze informațiile secrete. Acest factor de orbire este obținut aplicând HMAC-SHA512 pe 2 valori:
- coordonata x a unui punct secret;
- și UTXO-ul consumat ca intrare în tranzacție.
Bob, prin urmare, are nevoie de aceste două informații pentru a decripta payload-ul codului de plată al Alicei. Pentru UTXO ca intrare, Bob poate pur și simplu să-l recupereze observând tranzacția de notificare. Pentru punctul secret, Bob va trebui să folosească ECDH. Așa cum am văzut în secțiunea anterioară despre Diffie-Hellman, simplu prin schimbul respectivelor chei publice și aplicând în secret cheile lor private la cheia publică a celuilalt, Alice și Bob pot găsi un punct specific și secret pe curba eliptică. Tranzacția de notificare se bazează pe acest mecanism:
- Perechea de chei a lui Bob:

$$ B = b \cdot G $$

- Perechea de chei a Alicei:

$$ A = a \cdot G $$

- Pentru un secret $S (x, y)$:

$$ S = a \cdot B = a \cdot (b \cdot G) = (b \cdot a) \cdot G = b \cdot A $$

![BTC204](assets/en/66/19.webp)

Acum că Bob cunoaște codul de plată al Alicei, el va putea detecta plățile ei BIP47, și poate deriva cheile private care blochează bitcoinii primiți.

Să recapitulăm pașii pe care tocmai i-am parcurs pentru a primi și interpreta o tranzacție de notificare:
- Bob monitorizează output-urile tranzacțiilor către adresa sa de notificare;
- Când detectează una, el recuperează informațiile conținute în OP_RETURN;
- Bob selectează cheia publică în input și calculează un punct secret folosind ECDH;
- El folosește acest punct secret pentru a calcula un HMAC care este factorul de orbire;
- El folosește acest factor de orbire pentru a decripta payload-ul codului de plată al Alicei conținut în OP_RETURN.

![BTC204](assets/en/66/20.webp)

### Tranzacția de Plată BIP47

Să studiem acum împreună procesul de plată cu BIP47. Pentru a vă reaminti starea actuală a lucrurilor:
- Alice cunoaște codul de plată al lui Bob, pe care l-a obținut pur și simplu de pe site-ul lui;
- Bob cunoaște codul de plată al lui Alice datorită tranzacției de notificare;
- Alice va efectua o primă plată către Bob. Ea va putea efectua multe altele în același mod.

Înainte de a explica acest proces, cred că este important să reamintim indicii la care lucrăm în prezent. Calea de derivare a unui cod de plată este descrisă astfel: `m/47'/0'/0'`. Următoarea adâncime distribuie indicii în acest mod:
- Primul pereche de copii normali (neîntăriți) este cel folosit pentru a genera adresa de notificare despre care am vorbit în partea precedentă: `m/47'/0'/0'/0`;
- Perechile de chei copil normale sunt folosite în cadrul ECDH pentru a genera adrese de primire a plăților BIP47, așa cum vom vedea în această secțiune: de la `m/47'/0'/0'/0` până la `m/47'/0'/0'/2 147 483 647`;
- Perechile de chei copil întărite sunt coduri de plată efemere: de la `m/47'/0'/0'/0'` până la `m/47'/0'/0'/2 147 483 647'`.

De fiecare dată când Alice dorește să trimită o plată către Bob, ea derivă o nouă adresă virgină unică, mulțumită din nou protocolului ECDH:
- Alice selectează prima cheie privată derivată din codul ei personal reutilizabil de plată:

$$ a $$

- Alice selectează prima cheie publică neutilizată derivată din codul de plată al lui Bob. Această cheie publică, o vom numi $B$. Este asociată cu cheia privată $b$ pe care doar Bob o cunoaște:

$$ B = b \cdot G $$

- Alice calculează un punct secret $S$ pe curba eliptică prin adiție de puncte și dublare aplicând cheia ei privată $a$ la cheia publică $B$ a lui Bob:

$$ S = a \cdot B $$

- Din acest punct secret, Alice va calcula secretul comun $s$ (literă mică). Pentru a face acest lucru, ea selectează coordonata x a punctului secret $S$ numită $Sx$, și trece această valoare prin funcția de hash SHA256:

$$ S = (Sx, Sy) $$
$$ s = \text{SHA256}(Sx) $$

- Alice folosește acest secret comun $s$ pentru a calcula o adresă de primire a plăților Bitcoin. Inițial, ea verifică dacă $s$ este conținut în ordinea curbei secp256k1. Dacă nu, ea incrementează indexul cheii publice a lui Bob pentru a deriva un alt secret comun;
- În al doilea rând, ea calculează o cheie publică $K0$ adăugând pe curba eliptică punctele $B$ și $s·G$. Cu alte cuvinte, Alice adaugă cheia publică derivată din codul de plată al lui Bob $B$ cu un alt punct calculat pe curba eliptică prin adiție de puncte și dublare cu secretul comun $s$ din punctul generator al curbei secp256k1 $G$. Acest nou punct reprezintă o cheie publică, și îl numim $K0$:

$$ K0 = B + s \cdot G $$

- Cu această cheie publică $K0$, Alice poate deriva o adresă virgină standard de primire (de exemplu, SegWit V0 în bech32).
Odată ce Alice a obținut adresa de primire a lui Bob $K0$, ea poate efectua o tranzacție Bitcoin într-un mod standard. Pentru a face acest lucru, ea selectează un UTXO pe care îl deține, securizat de o pereche de chei dintr-o ramură diferită a portofelului ei HD, și îl cheltuiește pentru a satisface o ieșire către adresa lui Bob $K0$. Este important de notat că această plată, odată ce adresa este derivată, urmează un proces convențional și nu mai depinde de cheile asociate cu BIP47.
Să recapitulăm pașii pe care tocmai i-am parcurs împreună pentru a trimite un plăți BIP47:
- Alice selectează prima cheie privată derivată copil din codul ei personal de plată;
- Ea calculează un punct secret pe curba eliptică folosind ECDH din prima cheie publică derivată copil neutilizată din codul de plată al lui Bob;
- Ea folosește acest punct secret pentru a calcula un secret comun cu SHA256;
- Ea folosește acest secret comun pentru a calcula un nou punct secret pe curba eliptică;
- Ea adaugă acest nou punct secret la cheia publică a lui Bob;
- Ea obține o nouă cheie publică efemeră pentru care doar Bob are cheia privată asociată;
- Alice poate face o tranzacție standard către Bob cu adresa de primire efemeră derivată.

![BTC204](assets/en/66/21.webp)

Dacă Alice dorește să facă o a doua plată, ea va urma aceiași pași ca înainte, exceptând de data aceasta că va selecta a doua cheie publică derivată din codul de plată al lui Bob. Specific, ea va folosi următoarea cheie neutilizată. Astfel, ea va obține o nouă adresă de primire aparținând lui Bob, desemnată $K1$:

![BTC204](assets/en/66/22.webp)

Ea poate continua în acest mod și poate deriva până la `2^32` adrese neutilizate aparținând lui Bob.

Dintr-un punct de vedere extern, observând blockchain-ul, este teoretic imposibil să diferențiezi o plată BIP47 de o plată standard. Iată un exemplu de tranzacție de plată BIP47 pe Testnet:

```text
94b2e59510f2e1fa78411634c98a77bbb638e28fb2da00c9f359cd5fc8f87254
```

Aceasta arată ca o tranzacție standard cu un input consumat, un output de plată și o restituire:

![BTC204](assets/notext/66/23.webp)

### Primirea Plății BIP47 și Derivarea Cheii Private

Alice tocmai a făcut prima ei plată către o nouă adresă BIP47 aparținând lui Bob. Acum să vedem cum primește Bob această plată. Vom vedea de asemenea de ce Alice nu are acces la cheia privată a adresei pe care tocmai a generat-o singură, și cum Bob recuperează această cheie pentru a cheltui bitcoinii pe care tocmai i-a primit.
De îndată ce Bob primește tranzacția de notificare de la Alice, el derivă cheia publică BIP47 $K0$ chiar înainte ca ea să fi trimis orice plată. Apoi, el monitorizează orice plăți către adresa asociată. De fapt, el derivă imediat mai multe adrese pe care le va monitoriza ($K0$, $K1$, $K2$, $K3$...). Iată cum derivă el această cheie publică $K0$:
- Bob selectează prima cheie privată copil derivată din codul său de plată. Această cheie privată este numită $b$. Este asociată cu cheia publică $B$ cu care Alice a făcut calculele în pasul anterior:

$$ b $$

- Bob selectează prima cheie publică a Alicei derivată din codul ei de plată. Această cheie este numită $A$. Este asociată cu cheia privată $a$ cu care Alice a făcut calculele, și de care doar Alice este conștientă. Bob poate efectua acest proces deoarece este conștient de codul de plată al Alicei care i-a fost transmis cu tranzacția de notificare:

$$ A = a \cdot G $$

- Bob calculează punctul secret $S$, prin adiție și dublare de puncte pe curba eliptică, aplicând cheia sa privată $b$ la cheia publică a Alicei $A$. Aici regăsim utilizarea ECDH care garantează că acest punct $S$ va fi același atât pentru Bob cât și pentru Alice:

$$ S = b \cdot A $$
- La fel ca Alice, Bob izolează coordonata x a acestui punct $S$. Am numit această valoare $Sx$. El trece această valoare prin funcția SHA256 pentru a găsi secretul comun $s$ (literă mică):
$$ s = \text{SHA256}(Sx) $$

- La fel ca Alice, Bob calculează punctul $s·G$ pe curba eliptică. Apoi, el adaugă acest punct secret la cheia sa publică $B$. Astfel, el obține un nou punct pe curba eliptică pe care îl interpretează ca o cheie publică $K0$:

$$ K0 = B + s \cdot G $$

Odată ce Bob are această cheie publică $K0$, el poate deriva cheia privată asociată pentru a putea cheltui bitcoins. El este singurul care poate genera această cheie privată:

- Bob adaugă cheia sa privată derivată $b$ din codul său personal de plată. El este singurul care poate obține valoarea lui $b$. Apoi, el adaugă $b$ cu secretul comun $s$ pentru a obține $k0$, cheia privată a lui $K0$:

$$ k0 = b + s $$

Mulțumită legii grupului curbei eliptice, Bob obține exact cheia privată corespunzătoare cheii publice folosite de Alice. Astfel, avem:

$$ K0 = k0 \cdot G $$
Voi rezuma pașii pe care tocmai i-am parcurs împreună pentru a primi un plată BIP47 și a calcula cheia privată corespunzătoare:
- Bob selectează prima cheie privată derivată din codul său personal de plată;
- El calculează un punct secret pe curba eliptică folosind ECDH din prima cheie publică derivată din codul lanțului Alice;
- El folosește acest punct secret pentru a calcula un secret comun cu SHA256;
- El folosește acest secret comun pentru a calcula un nou punct secret pe curba eliptică;
- El adaugă acest nou punct secret la cheia sa publică personală;
- El obține o nouă cheie publică efemeră, către care Alice îi va trimite prima plată;
- Bob calculează cheia privată asociată cu această cheie publică efemeră adăugând cheia sa privată derivată din codul său de plată și secretul comun.

![BTC204](assets/en/66/24.webp)

Deoarece Alice nu poate obține $b$ (cheia privată a lui Bob), ea nu poate determina $k0$ (cheia privată asociată cu adresa de primire BIP47 a lui Bob). Schematic, putem reprezenta calculul secretului comun $S$ astfel:

![BTC204](assets/en/66/19.webp)

Odată ce secretul comun este găsit cu ECDH, Alice și Bob calculează cheia publică de plată BIP47 $K0$, iar Bob calculează de asemenea cheia privată asociată $k0$:

![BTC204](assets/en/66/25.webp)

### Rambursarea Plății BIP47

Deoarece Bob este conștient de codul de plată reutilizabil al lui Alice, el are deja toate informațiile necesare pentru a-i trimite o rambursare. El nu va avea nevoie să contacteze din nou pe Alice pentru a cere orice informație. El va trebui doar să o notifice cu o tranzacție de notificare, în special pentru ca ea să-și poată recupera adresele BIP47 cu semința ei, și apoi el poate de asemenea să-i trimită până la `2^32` de plăți.

Funcționalitatea de rambursare este specifică BIP47 și este unul dintre avantajele sale față de alte metode pe care le vom studia în capitolele următoare, cum ar fi Plățile Silențioase.

Bob îi poate rambursa lui Alice în același mod în care ea i-a trimis plăți. Rolurile sunt inversate:

![BTC204](assets/en/66/26.webp)
*Un mare mulțumesc lui [Fanis Michalakis](https://x.com/FanisMichalakis) pentru recenzia sa și sfaturile valoroase de expert privind articolul care a inspirat scrierea acestui capitol!*
https://planb.network/tutoriale/privacy/paynym-bip47

## Plăți Silențioase
<chapterId>2871d594-414e-4598-a830-91c9eb84dfb8</chapterId>
BIP47 a fost criticat pentru ineficiența sa pe lanțul de blocuri. Așa cum a fost explicat în capitolul anterior, acesta necesită o tranzacție de notificare pentru fiecare destinatar nou. Această constrângere devine neglijabilă dacă cineva intenționează să stabilească un canal de plată de lungă durată cu acest destinatar. Într-adevăr, o singură tranzacție de notificare deschide calea pentru un număr aproape infinit de plăți BIP47 ulterioare.

Cu toate acestea, în anumite situații, tranzacția de notificare poate fi un obstacol pentru utilizator. Luați exemplul unei donații unice către un destinatar: cu o adresă Bitcoin clasică, o singură tranzacție este suficientă pentru a face donația. Dar cu BIP47, sunt necesare două tranzacții: una pentru notificare și alta pentru plata efectivă. Când cererea pentru spațiu în bloc este scăzută și taxele de tranzacție sunt minime, acest pas suplimentar, în general, nu reprezintă o problemă. Cu toate acestea, în perioadele de congestie, taxele de tranzacție pot deveni exorbitante pentru o singură plată, dublând potențial costul pentru utilizator comparativ cu o tranzacție Bitcoin standard, ceea ce poate fi inacceptabil pentru utilizator.

Pentru situațiile în care utilizatorul intenționează să facă doar câteva plăți către un identificator static, au fost dezvoltate alte soluții. Printre ele se numără Plățile Silențioase, descrise în [BIP352](https://github.com/bitcoin/bips/blob/master/bip-0352.mediawiki). Acest protocol permite utilizarea unui identificator static pentru a primi plăți fără a genera reutilizarea adresei și fără a necesita utilizarea tranzacțiilor de notificare. Să examinăm cum funcționează acest protocol.

---

*Pentru a înțelege pe deplin acest capitol, este esențial să fiți familiarizat cu funcționarea ECDH (Elliptic Curve Diffie-Hellman) și derivarea cheilor criptografice într-un portofel HD. Aceste concepte au fost detaliate în capitolul anterior despre BIP47. Nu voi reveni asupra lor aici. Dacă nu sunteți încă familiarizat cu aceste noțiuni, vă recomand să consultați capitolul anterior înainte de a continua cu acesta. De asemenea, nu voi reveni asupra riscurilor asociate cu reutilizarea adreselor de primire, nici asupra importanței de a avea un identificator unic pentru a primi plăți.*

---

### De ce să nu mutăm notificarea?

Așa cum s-a discutat în capitolul despre BIP47, tranzacția de notificare îndeplinește în principal două funcții:
- Notifică destinatarul;
- Transmite codul de plată al expeditorului.

S-ar putea crede naiv că acest proces de notificare ar putea fi realizat off-chain. În teorie, acest lucru este complet fezabil: ar fi suficient ca destinatarul să indice un mijloc de comunicare pentru a primi codurile de plată BIP47 de la expeditori. Cu toate acestea, această abordare prezintă două probleme majore:
- În primul rând, acest lucru ar transfera procesul de transmitere a codului către un alt protocol de comunicare. Problemele legate de costuri și de confidențialitatea schimbului ar rămâne, dar ar fi pur și simplu transferate către acest nou protocol. În termeni de confidențialitate, acest lucru ar putea, de asemenea, să creeze o legătură între identitatea unui utilizator și activitatea sa pe lanțul de blocuri, ceea ce este ceva ce încercăm să evităm prin efectuarea notificării direct pe blockchain. Mai mult, efectuarea notificării în afara blockchain-ului ar introduce riscuri de cenzură (cum ar fi blocarea fondurilor) care nu există pe Bitcoin;
- În continuare, acest lucru ar reprezenta o problemă de recuperare. Cu BIP47, destinatarul trebuie să cunoască neapărat codurile de plată ale expeditorilor pentru a accesa fondurile. Acest lucru este valabil în momentul primirii, dar și în cazul recuperării fondurilor prin intermediul seminței în caz de pierdere a portofelului. Cu notificările onchain, acest risc este evitat, deoarece utilizatorul poate găsi și decripta tranzacțiile de notificare pur și simplu știind semința sa. Totuși, dacă notificarea este efectuată în afara lanțului blockchain, utilizatorul ar trebui să mențină o copie de rezervă dinamică a tuturor codurilor de plată primite, ceea ce este impracticabil pentru utilizatorul mediu.
Toate aceste constrângeri fac utilizarea notificării onchain indispensabilă în contextul BIP47. Cu toate acestea, Plățile Silențioase caută în mod specific să evite acest pas de notificare onchain din cauza costului său. Prin urmare, soluția adoptată nu este de a muta notificarea, ci de a o elimina complet. Pentru a realiza acest lucru, trebuie acceptat un compromis: acela al scanării. Spre deosebire de BIP47, unde utilizatorul știe exact unde să-și găsească fondurile datorită tranzacțiilor de notificare, în contextul Plăților Silențioase, utilizatorul trebuie să examineze toate tranzacțiile Bitcoin existente pentru a detecta orice plăți care ar putea fi destinate lor. Pentru a reduce această sarcină operațională, căutarea Plăților Silențioase este limitată doar la tranzacțiile susceptibile de a conține astfel de plăți, și anume acelea care includ cel puțin un output Taproot P2TR. Scanarea se concentrează exclusiv pe tranzacțiile de la data creării portofelului (nu este necesar să scanezi tranzacțiile înapoi până în 2009 dacă portofelul a fost creat în 2024).

Prin urmare, puteți vedea de ce BIP47 și Plățile Silențioase, deși urmăresc un obiectiv similar, implică compromisuri diferite și **astfel se adresează de fapt cazurilor de utilizare distincte**. Pentru plățile unice, cum ar fi donațiile ocazionale, Plățile Silențioase sunt mai potrivite datorită costului lor mai scăzut. Pe de altă parte, pentru tranzacții regulate către același destinatar, cum ar fi în cazul platformelor de schimb sau al bazinelor de minerit, BIP47 ar putea fi preferat.
Să explorăm împreună funcționarea tehnică a Plăților Silențioase pentru a înțelege mai bine implicațiile lor. Pentru a face acest lucru, sugerez să adoptăm aceeași abordare ca documentul explicativ al BIP352. Vom descompune treptat calculele ce trebuie efectuate, element cu element, justificând fiecare nouă adăugire.
### Unele concepte de înțeles

Înainte de a începe, este important să clarificăm că Plățile Silențioase se bazează exclusiv pe utilizarea tipurilor de scripturi P2TR (*Pay to Taproot*). Spre deosebire de BIP47, nu este necesar să derivăm adresele de primire din cheile publice copil prin hash-uirile acestora. Într-adevăr, în standardul P2TR, cheia publică modificată este utilizată direct și deschis în adresă. Astfel, o adresă de primire Taproot este esențialmente o cheie publică însoțită de unele metadate. Această cheie publică modificată este agregarea a două alte chei publice: una care permite cheltuirea directă și tradițională prin intermediul unei semnături simple, și cealaltă reprezentând rădăcina Merkle a MAST, care autorizează cheltuirea supusă satisfacerii uneia dintre condițiile potențial inscrise în arborele Merkle.

![BTC204](assets/en/67/01.webp)

Decizia de a limita Plățile Silențioase exclusiv la Taproot este motivată de două motive principale:
- În primul rând, facilitează semnificativ implementarea și actualizările viitoare în software-ul portofelului, deoarece trebuie aderat doar la un singur standard;
- În al doilea rând, această abordare ajută la îmbunătățirea setului de anonimat al utilizatorilor încurajându-i să nu se răspândească printre diferite tipuri de scripturi, care generează amprente distincte ale portofelului în analiza lanțului (pentru mai multe informații despre acest concept, vă invit să consultați capitolul 4 din partea a 2-a).

### Derivarea naivă a unei chei publice pentru Plățile Silențioase
Să începem cu un exemplu simplu care te va ajuta să înțelegi funcționarea de bază a Plăților Silențioase (SP - Silent Payments). Luăm cazul lui Alice și Bob, doi utilizatori Bitcoin. Alice vrea să trimită bitcoini lui Bob pe o adresă de primire nouă. Trei obiective trebuie atinse în acest proces:
- Alice trebuie să poată genera o adresă nouă;
- Bob trebuie să poată identifica un plătit trimis către această adresă specifică;
- Bob trebuie să poată obține cheia privată asociată cu această adresă pentru a putea cheltui fondurile sale.

Alice are un UTXO în portofelul ei Bitcoin securizat cu următorul pereche de chei:
- $a$: cheia privată;
- $A$: cheia publică ($A = a \cdot G$)

Bob are o adresă SP pe care a publicat-o pe internet cu:
- $b$: cheia privată;
- $B$: cheia publică ($B = b \cdot G$)
Prin recuperarea adresei lui Bob, Alice poate calcula o nouă adresă goală care îi aparține lui Bob folosind ECDH. Să numim această adresă $P$:
$$  P = B + \text{hash}(a \cdot B) \cdot G  $$

În această ecuație, Alice a calculat pur și simplu produsul scalar dintre cheia ei privată $a$ și cheia publică a lui Bob $B$. Ea a trecut acest rezultat printr-o funcție de hash cunoscută de toți. Valoarea rezultată este apoi înmulțită scalar cu punctul generator $G$ al curbei eliptice `secp256k1`. În final, Alice adaugă punctul obținut la cheia publică a lui Bob $B$. Odată ce Alice are această adresă $P$, o folosește ca output într-o tranzacție, adică trimite bitcoini către ea.

> *În contextul Plăților Silențioase, funcția "hash" corespunde unei funcții de hash SHA256 etichetată specific cu `BIP0352/SharedSecret`, asigurând că hash-urile generate sunt unice pentru acest protocol și nu pot fi reutilizate în alte contexte, oferind în același timp protecție suplimentară împotriva reutilizării noncelor în semnături. Acest standard corespunde celui [specificat în BIP340 pentru semnăturile Schnorr](https://github.com/bitcoin/bips/blob/master/bip-0340.mediawiki) pe `secp256k1`.*

Datorită proprietăților curbei eliptice pe care se bazează ECDH, știm că:

$$  a \cdot B = b \cdot A  $$

Astfel, Bob va putea calcula adresa de primire pe care Alice a trimis bitcoini. Pentru a face acest lucru, el monitorizează toate tranzacțiile Bitcoin care îndeplinesc criteriile Plăților Silențioase și aplică următoarea calculație fiecăreia dintre ele pentru a vedea dacă plata este adresată lui (*scanare*):

$$  P' = B + \text{hash}(b \cdot A) \cdot G  $$

Când el scanează tranzacția lui Alice, își dă seama că $P'$ este egal cu $P$. Astfel, știe că această plată îi este adresată:

$$  P' = B + \text{hash}(b \cdot A) \cdot G = B + \text{hash}(a \cdot B) \cdot G = P   $$

De aici, Bob va putea calcula cheia privată $p$ care permite cheltuirea adresei $P$:

$$  p = (b + \text{hash}(b \cdot A)) \bmod n  $$

După cum poți vedea, pentru a calcula această cheie privată $p$, trebuie neapărat să ai cheia privată $b$. Numai Bob are această cheie privată $b$. Prin urmare, el va fi într-adevăr singurul care va putea cheltui bitcoinii trimiși către adresa sa de Plăți Silențioase.

![BTC204](assets/notext/67/02.webp)
*Legenda:*
- $B$: Cheia publică / adresa statică publicată de Bob
- $b$: Cheia privată a lui Bob
- $A$: Cheia publică a UTXO-ului lui Alice folosit ca intrare pentru tranzacție
- $a$: Cheia privată a lui Alice
- $G$: Punctul generator al curbei eliptice `secp256k1`
- $\text{SHA256}$: Funcția de hash SHA256 etichetată cu `BIP0352/SharedSecret`
- $s$: Secretul comun ECDH
- $P$: Cheia publică / adresa unică pentru plata către Bob

Iată o abordare inițială destul de naivă de a folosi adresa statică a lui Bob, notată $B$, pentru a deriva o adresă unică $P$ pentru trimiterea de bitcoin. Totuși, această metodă este prea simplistă și are mai multe defecte care necesită corectare. Prima problemă este că, în acest schema, Alice nu poate crea multiple ieșiri către Bob în cadrul aceleiași tranzacții.

### Cum să creezi multiple ieșiri?

În exemplul din secțiunea precedentă, Alice creează o singură ieșire care va merge către Bob la adresa sa unică $P$. Cu aceeași intrare selectată, este imposibil pentru Alice să creeze două adrese virgine distincte pentru Bob, deoarece metoda folosită ar conduce întotdeauna la același rezultat pentru $P$, deci aceeași adresă. Cu toate acestea, pot exista multe situații în care Alice dorește să împartă plata ei către Bob în mai multe sume mai mici, creând astfel multiple UTXO-uri. Prin urmare, este necesar să găsim o metodă care să permită acest lucru.

Pentru a realiza acest lucru, vom modifica ușor calculul pe care Alice îl efectuează pentru a deriva $P$, astfel încât ea să poată genera două adrese distincte pentru Bob, și anume $P_0$ și $P_1$.

Pentru a modifica calculul și a obține 2 adrese diferite, este suficient să adăugăm un întreg care modifică rezultatul. Astfel, Alice va adăuga $0$ în calculul ei pentru a obține adresa $P_0$ și $1$ pentru a obține adresa $P_1$. Să numim acest întreg $i$:

$$  P_i = B + \text{hash}(a \cdot B \text{ ‖ } i) \cdot G  $$

Procesul de calcul rămâne neschimbat față de metoda anterioară, cu excepția faptului că de data aceasta Alice va concatena $a \cdot B$ cu $i$ înainte de a proceda la hash. Apoi, este suficient să schimbăm $i$ pentru a avea o nouă adresă aparținând lui Bob. De exemplu:

$$  P_0 = B + \text{hash}(a \cdot B \text{ ‖ } 0) \cdot G  $$

$$  P_1 = B + \text{hash}(a \cdot B \text{ ‖ } 1) \cdot G  $$
Când Bob scanează blockchain-ul pentru Plăți Silențioase destinate lui, începe folosind $i = 0$ pentru adresa $P_0$. Dacă nu găsește nicio plată pe $P_0$, concluzionează că această tranzacție nu conține nicio Plată Silențioasă pentru el și oprește analiza acesteia. Totuși, dacă $P_0$ este valid și conține o plată pentru el, procedează cu $P_1$ în aceeași tranzacție pentru a verifica dacă Alice a făcut o a doua plată. Dacă $P_1$ se dovedește a fi invalid, își oprește căutarea pentru această tranzacție; altfel, continuă să testeze valori succesive ale lui $i$.
$$  P_1 = B + \text{hash}(b \cdot A \text{ ‖ } 1) \cdot G  $$
Deoarece Bob se oprește imediat la $i = 0$ dacă $P_0$ nu produce nimic, utilizarea acestui întreg adaugă aproape nicio povară operațională suplimentară pentru Bob în pasul de scanare a tranzacțiilor.

Bob poate apoi să calculeze cheile private în același mod:

$$ 
p_0 = (b + \text{hash}(b \cdot A \text{ ‖ } 0)) \bmod n
 $$

$$ 
p_1 = (b + \text{hash}(b \cdot A \text{ ‖ } 1)) \bmod n 
 $$

![BTC204](assets/notext/67/03.webp)

*Legenda:*
- $B$: Cheia publică / adresa statică publicată de Bob
- $b$: Cheia privată a lui Bob
- $A$: Cheia publică a UTXO-ului lui Alice folosită ca intrare pentru tranzacție
- $a$: Cheia privată a lui Alice
- $G$: Punctul generator al curbei eliptice `secp256k1`
- $\text{SHA256}$: Funcția de hash SHA256 etichetată cu `BIP0352/SharedSecret`
- $s_0$: Primul secret ECDH partajat
- $s_1$: Al doilea secret ECDH partajat
- $P_0$: Prima cheie publică / adresa unică pentru plata către Bob
- $P_1$: A doua cheie publică / adresa unică pentru plata către Bob

Cu această metodă, începem să avem un protocol frumos, dar există încă unele provocări de depășit, în special prevenirea reutilizării adreselor.

### Cum să evităm reutilizarea adreselor?
După cum am văzut în secțiunile anterioare, Alice folosește perechea de chei care securizează UTXO-ul ei, pe care îl va cheltui pentru a calcula secretul ECDH partajat cu Bob. Acest secret îi permite să derive adresa unică $P_0$. Cu toate acestea, perechea de chei ($a$, $A$) folosită de Alice poate securiza multiple UTXO-uri dacă ea a reutilizat această adresă de mai multe ori. În cazul în care Alice face două plăți către adresa statică a lui Bob $B$ folosind două UTXO-uri securizate de aceeași cheie $A$, acest lucru ar rezulta în reutilizarea adresei pentru Bob.
> *Reutilizarea adresei este o practică foarte rea pentru confidențialitatea utilizatorului. Pentru a înțelege de ce, vă sfătuiesc să revizuiți primele părți ale acestui training.*

Într-adevăr, deoarece adresa unică $P_0$ este derivată din $A$ și $B$, dacă Alice derivează o a doua adresă pentru o a doua plată către $B$, cu aceeași cheie $A$, ea va ajunge cu aceeași adresă $P_0$. Pentru a evita acest risc și a preveni reutilizarea adreselor în cadrul Plăților Silențioase, trebuie să modificăm puțin calculele noastre.

Ceea ce dorim este ca fiecare UTXO consumat de Alice ca intrare a unei plăți să ofere o adresă unică din partea lui Bob, chiar dacă mai multe UTXO-uri sunt securizate de aceeași pereche de chei. Prin urmare, este suficient să adăugăm o referință la UTXO în calculul adresei unice $P_0$. Această referință va fi pur și simplu hash-ul UTXO-ului consumat ca intrare:

$$  \text{inputHash} = \text{hash}(\text{outpoint} \text{ ‖ } A)  $$

Și această referință de intrare, Alice o va adăuga în calculul ei al adresei unice $P_0$:
$$  P_0 = B + \text{hash}(\text{inputHash} \cdot a \cdot B \text{ ‖ } 0) \cdot G  $$
În timpul scanării sale, Bob poate adăuga de asemenea $\text{inputHash}$, deoarece tot ce trebuie să facă este să observe tranzacția pentru a deduce $\text{outpoint}$:

$$  P_0 = B + \text{hash}(\text{inputHash} \cdot b \cdot A \text{ ‖ } 0) \cdot G  $$

Când găsește un $P_0$ valid, poate calcula cheia privată corespunzătoare $p_0$:

$$ 
p_0 = (b + \text{hash}(\text{inputHash} \cdot b \cdot A \text{ ‖ } 0)) \bmod n
 $$

![BTC204](assets/notext/67/04.webp)

*Legendă:*
- $B$: Cheia publică / adresa statică publicată de Bob
- $b$: Cheia privată a lui Bob
- $A$: Cheia publică a UTXO-ului lui Alice folosit ca intrare pentru tranzacție
- $a$: Cheia privată a lui Alice
- $H$: Hash-ul UTXO-ului folosit ca intrare
- $G$: Punctul generator al curbei eliptice `secp256k1`
- $\text{SHA256}$: Funcția de hash SHA256 etichetată cu `BIP0352/SharedSecret`
- $s_0$: Primul secret ECDH partajat
- $P_0$: Prima cheie publică / adresa unică pentru plată către Bob

În acest moment, calculele noastre presupun că Alice folosește o singură intrare pentru tranzacția ei. Totuși, ea ar trebui să poată folosi multiple intrări. Prin urmare, din partea lui Bob, pentru fiecare tranzacție care conține multiple intrări, teoretic ar trebui să calculeze ECDH pentru fiecare intrare pentru a determina dacă o plată este destinată lui. Această metodă nu este satisfăcătoare, așa că avem nevoie să găsim o soluție pentru a reduce volumul de muncă!

### Modificarea cheilor publice în intrări

Pentru a rezolva această problemă, în loc să folosim perechea de chei care securizează o anumită intrare din partea lui Alice, vom folosi suma tuturor perechilor de chei folosite în intrările tranzacției. Această sumă va fi apoi considerată ca o nouă pereche de chei. Această tehnică este cunoscută sub numele de "tweak".

De exemplu, imaginați-vă că tranzacția lui Alice are 3 intrări, fiecare securizată cu o pereche diferită de chei:
- $a_0$ securizează intrarea #0;
- $a_1$ securizează intrarea #1;
- $a_2$ securizează intrarea #2.

![BTC204](assets/notext/67/05.webp)

Urmând metoda descrisă mai sus, Alice ar trebui să aleagă o singură pereche de chei dintre $a_0$, $a_1$ și $a_2$ pentru a calcula secretul ECDH și a genera adresa unică de plată $P$ din adresa statică a lui Bob $B$. Totuși, această abordare necesită ca Bob să testeze fiecare posibilitate secvențial, începând cu $a_0$, apoi $a_1$, și așa mai departe, până când identifică o pereche care generează o adresă validă $P$. Acest proces necesită ca Bob să execute calculul ECDH pe toate intrările tuturor tranzacțiilor, crescând semnificativ volumul de muncă operațional de scanare.

Pentru a evita acest lucru, îi vom cere lui Alice să efectueze calculul lui $P$ folosind suma tuturor cheilor din intrare. Luând exemplul nostru, cheia privată modificată $a$ ar fi calculată astfel:

$$  a = a_0 + a_1 + a_2  $$
Similar, Alice și Bob vor putea să calculeze cheia publică ajustată:
$$  A = A_0 + A_1 + A_2  $$
Datorită acestei metode, Bob trebuie doar să calculeze suma cheilor publice ale tranzacției, apoi să calculeze secretul ECDH doar din $A$, ceea ce reduce semnificativ numărul de calcule de efectuat pentru etapa de scanare. Totuși, amintiți-vă din secțiunea anterioară. Am inclus în calculul nostru hash-ul $\text{inputHash}$ care este folosit ca un nonce pentru a preveni reutilizarea adresei:

$$  \text{inputHash} = \text{hash}(\text{outpoint} \text{ ‖ } A)  $$

Dar dacă există multiple intrări într-o tranzacție, este necesar să se determine care $\text{outpoint}$ este ales în acest calcul. Conform BIP352, criteriul de selecție pentru $\text{outpoint}$ de utilizat este să se aleagă cel mai mic lexicografic, ceea ce înseamnă selectarea UTXO-ului care apare primul în ordine alfabetică. Această metodă standardizează UTXO-ul de ales în fiecare tranzacție. De exemplu, dacă acest $\text{outpoint}$ cel mai mic lexicografic este $\text{outpoint}_L$, calculul $\text{inputHash}$ va fi:

$$  \text{inputHash} = \text{hash}(\text{outpoint}_L \text{ ‖ } A)  $$

Calculele rămân apoi identice cu cele prezentate în secțiunea anterioară, cu excepția faptului că cheia privată $a$ și corespondenta sa cheie publică $A$ nu mai reprezintă un cuplu care securizează o singură intrare, ci acum reprezintă ajustarea tuturor perechilor de chei din intrări.

### Separarea Cheilor de Cheltuire și Scanare

Până acum, am discutat despre adresa statică de Plată Silențioasă $B$ ca fiind o cheie publică unică. Amintiți-vă, este această cheie publică $B$ care este folosită de Alice pentru a crea secretul ECDH partajat, care la rândul său este folosit pentru a calcula adresa unică de plată $P$. Bob folosește această cheie publică $B$ și corespondenta cheie privată $b$ pentru etapa de scanare. Dar el va folosi de asemenea cheia privată $b$ pentru a calcula cheia privată $p$ care permite cheltuirea de la adresa $P$.

Dezavantajul acestei metode este că cheia privată $b$, care este folosită pentru a calcula toate cheile private pentru adresele care primesc Plăți Silențioase, este de asemenea folosită de Bob pentru a scana tranzacțiile. Acest pas necesită ca cheia $b$ să fie disponibilă pe un software de portofel conectat la internet, ceea ce o expune la un risc mai mare de furt comparativ cu păstrarea ei pe un portofel rece. Ideal, ar fi benefic să se poată profita de Plățile Silențioase păstrând cheia privată $b$, care controlează accesul la toate celelalte chei private, securizată pe un portofel hardware. Din fericire, protocolul a fost adaptat pentru a permite exact acest lucru.
Pentru a realiza acest lucru, BIP352 specifică că receptorul folosește 2 perechi diferite de chei:
- $B_{\text{spend}}$: pentru a calcula cheile private ale adreselor unice de plată;
- $B_{\text{scan}}$: pentru a găsi adresele unice de plată.

În acest mod, Bob poate păstra cheia privată $b_{\text{spend}}$ pe un portofel hardware și să folosească cheia privată $b_{\text{scan}}$ pe software online pentru a găsi Plățile Silențioase ale sale, fără a dezvălui $b_{\text{spend}}$. Totuși, cheile publice $B_{\text{scan}}$ și $B_{\text{spend}}$ sunt ambele dezvăluite public, deoarece se găsesc în adresa statică a lui Bob $B$:
Pentru a calcula o adresă unică de plată $P_0$ care îi aparține lui Bob, Alice va efectua următoarea calculație:

$$  P_0 = B_{\text{spend}} + \text{hash}(\text{inputHash} \cdot a \cdot B_{\text{scan}} \text{ ‖ } 0) \cdot G  $$

Pentru a găsi plățile care îi sunt adresate, Bob va efectua următoarea calculație:

$$  P_0 = B_{\text{spend}} + \text{hash}(\text{inputHash} \cdot b_{\text{scan}} \cdot A \text{ ‖ } 0) \cdot G  $$

După cum puteți vedea, până acum, Bob nu a avut nevoie să folosească $b_{\text{spend}}$ care se află pe portofelul său hardware. Când dorește să cheltuie $P_0$, el poate efectua următoarea calculație pentru a găsi cheia privată $p_0$:

$$ p_0 = (b_{\text{spend}} + \text{hash}(\text{inputHash} \cdot b_{\text{scan}} \cdot A \text{ ‖ } 0)) \bmod n $$

![BTC204](assets/notext/67/06.webp)

*Legenda:*
- $B_{\text{scan}}$: Cheia publică de scanare a lui Bob (adresă statică)
- $b_{\text{scan}}$: Cheia privată de scanare a lui Bob
- $B_{\text{spend}}$: Cheia publică de cheltuire a lui Bob (adresă statică)
- $b_{\text{spend}}$: Cheia privată de cheltuire a lui Bob
- $A$: Suma cheilor publice la intrare (ajustare)
- $a$: Cheia privată corespunzătoare cheii publice ajustate
- $H$: Hash-ul celui mai mic UTXO (lexicografic) folosit la intrare
- $G$: Punctul generator al curbei eliptice `secp256k1`
- $\text{SHA256}$: Funcția de hash SHA256 etichetată cu `BIP0352/SharedSecret`
- $s_0$: Primul secret ECDH partajat
- $P_0$: Prima cheie publică / adresă unică de plată pentru Bob

### Utilizând adresele SP cu o etichetă

Astfel, Bob are o adresă statică $B$ pentru Plăți Silențioase după cum urmează:

$$ B = B_{\text{scan}} \text{ ‖ } B_{\text{spend}} $$

Problema cu această metodă este că nu permite segregarea diferitelor plăți trimise la această adresă. De exemplu, dacă Bob are 2 clienți diferiți pentru afacerea sa și dorește să diferențieze clar plățile de la fiecare, ar avea nevoie de 2 adrese statice diferite. O soluție naivă, cu abordarea actuală, ar fi ca Bob să creeze două portofele separate, fiecare cu propria adresă statică, sau chiar să stabilească două adrese statice diferite în cadrul aceluiași portofel. Totuși, această soluție necesită scanarea întregului blockchain de două ori (o dată pentru fiecare adresă) pentru a detecta respectiv plățile destinate fiecărei adrese. Această dublă scanare crește nerezonabil sarcina operațională pentru Bob.
Pentru a rezolva această problemă, BIP352 utilizează un sistem de etichetare care permite utilizarea diferitelor adrese statice fără a crește în mod nerezonabil volumul de muncă necesar pentru a găsi Plățile Silențioase pe blockchain. Pentru a realiza acest lucru, un întreg $m$ este adăugat la cheia publică de cheltuieli $B_{\text{spend}}$. Acest întreg poate lua valoarea de $1$ pentru prima adresă statică, apoi $2$ pentru a doua, și așa mai departe. Cheile de cheltuieli $B_{\text{spend}}$ vor fi de acum înainte numite $B_m$ și vor fi construite în acest mod:
$$  B_m = B_{\text{spend}} + \text{hash}(b_{\text{scan}} \text{ ‖ } m) \cdot G  $$

De exemplu, pentru prima cheie de cheltuieli cu eticheta $1$:

$$  B_1 = B_{\text{spend}} + \text{hash}(b_{\text{scan}} \text{ ‖ } 1) \cdot G  $$

Adresa statică publicată de Bob va consta acum din $B_{\text{scan}}$ și $B_m$. De exemplu, prima adresă statică cu eticheta $1$ va fi:

$$ B = B_{\text{scan}} \text{ ‖ } B_1 $$

> *Începem doar de la eticheta 1 deoarece eticheta 0 este rezervată pentru rest.*

Alice, din partea ei, va deriva adresa unică de plată $P$ în același mod ca înainte, dar folosind noul $B_1$ în loc de $B_{\text{spend}}$.
$$  P_0 = B_1 + \text{hash}(\text{inputHash} \cdot a \cdot B_{\text{scan}} \text{ ‖ } 0) \cdot G  $$

În realitate, Alice s-ar putea să nu știe chiar că Bob are o adresă etichetată, deoarece ea pur și simplu folosește a doua parte a adresei statice pe care el i-a furnizat-o, care în acest caz, este valoarea $B_1$ în loc de $B_{\text{spend}}$.

Pentru a scana plățile, Bob va folosi întotdeauna valoarea adresei sale statice inițiale cu $B_{\text{spend}}$ în acest mod:

$$   P_0 = B_{\text{spend}} + \text{hash}(\text{inputHash} \cdot b_{\text{scan}} \cdot A \text{ ‖ } 0) \cdot G  $$

Apoi, el pur și simplu scade valoarea pe care o găsește pentru $P_0$ din fiecare ieșire, una câte una. Apoi verifică dacă una dintre rezultatele acestor scăderi se potrivește cu valoarea uneia dintre etichetele pe care le folosește în portofelul său. Dacă se potrivește, de exemplu, pentru ieșirea #4 cu eticheta $1$, acest lucru înseamnă că această ieșire este o Plată Silențioasă asociată cu adresa sa statică etichetată $B_1$:

$$ Out_4 - P_0 = \text{hash}(b_{\text{scan}} \text{ ‖ } 1) \cdot G $$

Acest lucru funcționează pentru că:

$$  B_1 = B_{\text{spend}} + \text{hash}(b_{\text{scan}} \text{ ‖ } 1) \cdot G  $$
Mulțumită acestei metode, Bob poate folosi o multitudine de adrese statice ($B_1$, $B_2$, $B_3$...), toate derivate din adresa sa statică de bază ($B = B_{\text{scan}} \text{ ‖ } B_{\text{spend}}$), pentru a separa corespunzător utilizările.
Totuși, această separare a adreselor statice este valabilă doar din perspectiva gestionării personale a portofelului și nu permite separarea identităților. Deoarece toate au același $B_{\text{scan}}$, este foarte ușor să asociezi toate adresele statice împreună și să deduci că aparțin unei singure entități.

![BTC204](assets/notext/67/07.webp)

*Legenda:*
- $B_{\text{scan}}$: cheia publică de scanare a lui Bob (adresa statică)
- $b_{\text{scan}}$: cheia privată de scanare a lui Bob
- $B_{\text{spend}}$: cheia publică de cheltuire a lui Bob (adresa inițială)
- $B_m$: cheia publică de cheltuire etichetată a lui Bob (adresa statică)
- $b_m$: cheia privată de cheltuire etichetată a lui Bob
- $A$: suma cheilor publice de intrare (tweak)
- $a$: cheia privată corespunzătoare cheii publice ajustate
- $H$: hash-ul celui mai mic UTXO (lexicografic) folosit ca intrare
- $G$: punctul generator al curbei eliptice `secp256k1`
- $\text{SHA256}$: Funcția de hash SHA256 etichetată cu `BIP0352/SharedSecret`
- $s_0$: primul secret ECDH partajat
- $P_0$: prima cheie publică / adresa unică pentru plata către Bob
- $p_0$: cheia privată a primei adrese unice de plată către Bob
- $X$: hash-ul cheii private de scanare cu eticheta

### Cum se construiește o adresă pentru Plăți Silențioase?

Pentru a construi o adresă dedicată Plăților Silențioase, trebuie mai întâi derivat un set de 2 perechi de chei în portofelul HD Bitcoin al tău:
- Perechea $b_{\text{scan}}$, $B_{\text{scan}}$ pentru căutarea plăților adresate nouă;
- Perechea $b_{\text{spend}}$, $B_{\text{spend}}$ pentru cheltuirea bitcoinilor pe care i-am primit.

Aceste perechi sunt derivate urmând aceste căi (*Bitcoin Mainnet*):

```text
scan: m / 352' / 0' / 0' / 1' / 0
spend: m / 352' / 0' / 0' / 0' / 0
```

Odată ce aceste 2 perechi de chei sunt disponibile, se concatenează pur și simplu (cap-la-cap) pentru a crea payload-ul adresei statice:

$$ B = B_{\text{scan}} \text{ ‖ } B_{\text{spend}} $$

Dacă se doresc etichete, $B_{\text{spend}}$ este înlocuit cu $B_m$:

$$ B = B_{\text{scan}} \text{ ‖ } B_m $$

Cu eticheta $m$:

$$  B_m = B_{\text{spend}} + \text{hash}(b_{\text{scan}} \text{ ‖ } m) \cdot G  $$

Odată ce acest payload este disponibil, se adaugă HRP (*Human-Readable Part*) `sp` și versiunea `q` (= versiunea 0). Se adaugă de asemenea un checksum, iar adresa este formatată în bech32m.
De exemplu, iată adresa mea statică pentru Plăți Silențioase:
```text
sp1qqvhjvsq2vz8zwrw372vuzle7472zup2ql3pz64yn5cpkw5ngv2n6jq4nl8cgm6zmu48yk3eq33ryc7aam6jrvrg0d0uuyzecfhx2wgsumcurv77e
```
Un punct important referitor la adresele statice, pe care s-ar putea să le fi introdus în secțiunile anterioare, este că aceste adrese nu sunt vizibile în tranzacțiile Bitcoin. Doar adresele de plată $P$, utilizate în output-uri, apar pe blockchain în formatul standard Taproot. Astfel, din exterior, este imposibil de distins o tranzacție care implică o Plată Silențioasă de o tranzacție obișnuită care utilizează output-uri P2TR.
La fel ca în cazul BIP47, este imposibil să se stabilească o conexiune între o adresă statică $B$ și o adresă de plată $P$ derivată din $B$. Într-adevăr, chiar dacă Eve, un potențial atacator, încearcă să scaneze blockchain-ul cu adresa statică a lui Bob $B$, ea nu va putea efectua calculele necesare pentru a determina $P$. Pentru a face acest lucru, ea ar avea nevoie fie de cheia privată de scanare a lui Bob $b_{\text{scan}}$, fie de cheile private ale expeditorului $a$, dar ambele aceste elemente sunt, bineînțeles, private. Prin urmare, este posibil să se lege explicit adresa statică de o formă de identitate personală.

### Cum să folosești Plățile Silențioase?

Propunerea pentru Plățile Silențioase este relativ recentă și a fost implementată doar de un număr foarte limitat de portofele până acum. După cunoștințele mele, există doar 3 software-uri care le suportă:
- [CakeWallet](https://cakewallet.com/)
- [Silentium](https://app.silentium.dev/)
- [DonationWallet](https://github.com/Sosthene00/donationwallet)

În curând, vom oferi un tutorial detaliat despre configurarea propriei adrese statice pentru Plăți Silențioase.

Deoarece această funcție este recentă, este recomandabil să exerciți prudență și să eviți utilizarea Plăților Silențioase pentru sume mari pe mainnet.

*Pentru a crea acest capitol despre Plățile Silențioase, am folosit [site-ul de explicație al Plăților Silențioase](https://silentpayments.xyz/) și [documentul de explicație BIP352](https://github.com/bitcoin/bips/blob/master/bip-0352.mediawiki).*

## Oferiți-ne feedback despre acest curs
<chapterId>195d149f-80fa-5816-8b46-995a9226d082</chapterId>
<isCourseReview>true</isCourseReview>

## Concluzie
<chapterId>cd8e5c67-50e4-4dcd-8e04-88ba5ec95305</chapterId>

Felicitări pentru finalizarea acestui training despre confidențialitate în Bitcoin!

Am acoperit multe subiecte avansate și tehnice în acest training, dar nu este imperativ să folosești toate instrumentele prezentate. Obiectivul principal a fost să te împuternicești să alegi informațiile pe care dorești să le divulgi și informațiile pe care preferi să le păstrezi confidențiale în utilizarea ta a Bitcoin. Acesta încorporează esența protecției confidențialității. Pentru a face alegeri informate despre informațiile de împărtășit sau de ascuns, este necesar să fim conștienți de implicațiile acțiunilor noastre. Sper că acest training te-a ajutat să dobândești această cunoaștere.
Dacă ar trebui să aleg cea mai importantă parte a acestui training, aș alege secțiunea dedicată analizei lanțului. Înțelegerea tehnicilor utilizate de potențialii tăi atacatori este cea mai bună modalitate de a te proteja. Prin urmare, sfatul meu ar fi să revizuiești cu atenție această parte și să încerci să înțelegi toate detaliile sale.
În acest training, ne-am concentrat exclusiv pe confidențialitatea Bitcoin pe lanțul principal. Problemele de confidențialitate pe sistemele de nivel secundar, cum ar fi Lightning Network și sidechains, sunt de asemenea semnificative și au caracteristici foarte specifice. Deși utilizarea tranzacțiilor off-chain poate fi o strategie eficientă pentru a ocoli numeroasele riscuri de urmăribilitate pe Bitcoin pe care le-am studiat, te expune la alte riscuri de care este esențial să fii conștient. De aceea, aceste subiecte vor fi acoperite într-un training dedicat viitor pe PlanB Network.
Dacă ți-a plăcut acest training, aș fi foarte recunoscător dacă ai putea să-l împărtășești cu prietenii tăi și pe rețelele sociale. Mulțumesc! :)