---
name: Мнемонічна Фраза - Кидок Кубика
description: Як згенерувати власну фразу відновлення за допомогою кубиків?
---
![обкладинка](assets/cover.webp)

У цьому навчальному посібнику ви дізнаєтесь, як вручну скласти фразу відновлення для гаманця Bitcoin, використовуючи кидки кубиків.

**ПОПЕРЕДЖЕННЯ:** Генерація мнемонічної фрази безпечним способом вимагає відсутності будь-якого цифрового сліду під час її створення, що майже неможливо. В іншому випадку, гаманець представлятиме надто велику атаковану поверхню, значно збільшуючи ризик крадіжки ваших біткойнів. **Тому настійно не рекомендується переказувати кошти на гаманець, який залежить від фрази відновлення, створеної вами самостійно.** Навіть якщо ви слідуватимете цьому навчальному посібнику до літери, існує ризик, що фраза відновлення може бути скомпрометована. **Тому цей навчальний посібник не слід застосовувати для створення реального гаманця.** Використання апаратного гаманця для цієї задачі є набагато менш ризикованим, оскільки він генерує фразу офлайн, і справжні криптографи врахували використання якісних джерел ентропії.

Цей навчальний посібник можна слідувати лише для експериментальних цілей для створення фіктивного гаманця, без наміру використовувати його з реальними біткойнами. Однак, досвід пропонує дві переваги:
- По-перше, він дозволяє вам краще зрозуміти механізми, що лежать в основі вашого гаманця Bitcoin;
- По-друге, він дозволяє вам знати, як це зробити. Я не кажу, що це колись стане в нагоді, але можливо!

## Що таке мнемонічна фраза?
Фраза відновлення, яку іноді також називають "мнемоніка", "фраза-насіння" або "секретна фраза", є послідовністю, зазвичай складеною з 12 або 24 слів, яка генерується псевдовипадковим чином з джерела ентропії. Псевдовипадкова послідовність завжди доповнюється контрольною сумою.

Мнемонічна фраза разом з необов'язковим пароль-фразою використовується для детермінованого походження всіх ключів, асоційованих з HD (ієрархічно детермінованим) гаманцем. Це означає, що з цієї фрази можливо детерміновано генерувати та відтворювати всі приватні та публічні ключі гаманця Bitcoin, і, відповідно, отримувати доступ до коштів, асоційованих з ним.
![мнемоніка](assets/notext/1.webp)
Метою цієї фрази є надання зручного засобу резервного копіювання та відновлення біткойнів. Надзвичайно важливо зберігати мнемонічну фразу в безпечному та захищеному місці, оскільки будь-хто, хто володіє цією фразою, матиме доступ до коштів відповідного гаманця. Якщо вона використовується в контексті традиційного гаманця, і без необов'язкової пароль-фрази, вона часто становить SPOF (Single Point Of Failure - єдину точку відмови).
Зазвичай ця фраза надається вам безпосередньо при створенні вашого гаманця, програмним або апаратним гаманцем, який ви використовуєте. Однак також можливо згенерувати цю фразу самостійно, а потім ввести її на обраному носії для похідних ключів гаманця. Саме це ми і навчимося робити в цьому навчальному посібнику.

## Підготовка необхідних матеріалів
Для створення вашої фрази відновлення вручну вам знадобиться:
- Аркуш паперу;
- Ручка або олівець, ідеально різних кольорів для полегшення організації;
- Кілька кубиків, щоб мінімізувати ризики упередженості, пов'язані з незбалансованим кубиком;
- [Список 2048 слів BIP39](https://github.com/PlanB-Network/bitcoin-educational-content/blob/dev/resources/bet/bip39-wordlist/assets/BIP39-WORDLIST.pdf), роздрукований.

Пізніше стане необхідним використання комп'ютера з терміналом для розрахунку контрольної суми. Саме з цієї причини я раджу проти ручного генерування мнемонічної фрази. На мою думку, втручання комп'ютера, навіть за умов, зазначених у цьому навчальному посібнику, значно збільшує вразливість гаманця.
Для експериментального підходу, що стосується "фіктивного гаманця", можна використовувати ваш звичайний комп'ютер та його термінал. Однак для більш ретельного підходу, спрямованого на мінімізацію ризиків компрометації вашої фрази, ідеальним було б використання ПК, від'єднаного від інтернету (бажано без компонента wifi або дротового з'єднання RJ45), оснащеного мінімумом периферійних пристроїв (всі з яких мають бути підключені кабелем, щоб уникнути Bluetooth), і, перш за все, працюючого на амнезійній дистрибуції Linux, такій як [Tails](https://tails.boum.org/index.fr.html), запущеному з знімного носія.
![мнемоніка](assets/notext/2.webp)

У реальному контексті було б критично важливо забезпечити конфіденційність вашого робочого простору, обравши місце подалі від сторонніх очей, без проходу людей, і вільне від камер (веб-камер, телефонів...).
Рекомендується використовувати велику кількість кубиків, щоб зменшити вплив потенційно незбалансованого кубика на ентропію. Перед їх використанням рекомендується перевірити кубики: це можна зробити, випробувавши їх у мисці з насиченою сольовою водою, дозволяючи кубикам плавати. Потім прокотіть кожен кубик приблизно двадцять разів у сольовій воді, спостерігаючи за результатами. Якщо одна або дві грані з'являються непропорційно порівняно з іншими, продовжте тест з більшою кількістю кидків. Рівномірно розподілені результати вказують на те, що кубик надійний. Однак, якщо одна або дві грані регулярно домінують, такі кубики слід відкласти, оскільки вони можуть скомпрометувати ентропію вашої мнемонічної фрази і, відповідно, безпеку вашого гаманця.
У реальних умовах, після проведення цих перевірок, ви були б готові генерувати необхідну ентропію. Для експериментального фіктивного гаманця, створеного як частина цього навчального посібника, ви могли б природно пропустити ці підготовки.

## Кілька нагадувань про фразу відновлення
Для початку ми розглянемо основи створення мнемонічної фрази відповідно до BIP39. Як було раніше пояснено, фраза походить з псевдовипадкової інформації певного розміру, до якої додається контрольна сума для забезпечення її цілісності.

Розмір цієї початкової інформації, яку часто називають "ентропією", визначається кількістю слів, які ви хочете отримати у фразі відновлення. Найпоширеніші формати - це фрази з 12 і 24 слів, які відповідно походять від ентропії 128 біт і 256 біт. Ось таблиця, що показує різні розміри ентропії відповідно до BIP39:

| Фраза (слова) | Ентропія (біти) | Контрольна сума (біти) | Ентропія + Контрольна сума (біти) |
| --------------- | --------------- | --------------- | -------------------------- |
| 12              | 128             | 4               | 132                        |
| 15              | 160             | 5               | 165                        |
| 18              | 192             | 6               | 198                        |
| 21              | 224             | 7               | 231                        |
| 24              | 256             | 8               | 264                        |

Таким чином, ентропія є випадковим числом між 128 і 256 бітами. У цьому навчальному посібнику ми розглянемо приклад фрази з 12 слів, в якій ентропія становить 128 біт, що означає, що ми згенеруємо випадкову послідовність з 128 `0` або `1`. Це представляє число, складене з 128 цифр у двійковій системі (бінарному).
На основі цієї ентропії буде згенерована контрольна сума. Контрольна сума - це значення, розраховане з набору даних, використовуване для перевірки цілісності та валідності цих даних під час їх передачі або зберігання. Алгоритми контрольної суми призначені для виявлення випадкових помилок або змін у даних.
У випадку нашої мнемонічної фрази, функція контрольної суми полягає в виявленні будь-яких помилок при введенні фрази в програмне забезпечення гаманця. Недійсна контрольна сума сигналізує про наявність помилки у фразі. Навпаки, дійсна контрольна сума вказує на те, що фраза найімовірніше правильна.
Щоб отримати цю контрольну суму, ентропію пропускають через хеш-функцію SHA256. Ця операція виробляє на виході послідовність у 256 біт, з яких буде збережено лише перші `N` біт, `N` залежить від бажаної довжини фрази відновлення (дивіться таблицю вище). Таким чином, для 12-слівної фрази буде збережено перші 4 біти хешу.
![mnemonic](assets/en/3.webp)
Ці перші 4 біти, що формують контрольну суму, потім додаються до оригінальної ентропії. На цьому етапі фраза відновлення практично сформована, але вона все ще в бінарній формі. Щоб перетворити цю бінарну послідовність у слова відповідно до стандарту BIP39, ми спочатку поділимо послідовність на 11-бітні сегменти.
![mnemonic](assets/notext/4.webp)
Кожен з цих пакетів представляє число в бінарному форматі, яке потім буде перетворено на десяткове число (основа 10). Ми додамо `1` до кожного числа, тому що в обчисленнях, підрахунок починається з `0`, але список BIP39 нумерується, починаючи з `1`.

![mnemonic](assets/notext/5.webp)

Нарешті, число в десятковій системі показує нам позицію відповідного слова в [списку з 2048 слів BIP39](https://github.com/PlanB-Network/bitcoin-educational-content/blob/dev/resources/bet/bip39-wordlist/assets/BIP39-WORDLIST.pdf). Залишається лише вибрати ці слова, щоб скласти фразу відновлення для нашого гаманця.

![mnemonic](assets/notext/6.webp)

Тепер перейдемо до практики! Ми згенеруємо 12-слівну фразу відновлення. Однак, ця операція залишається ідентичною у випадку 24-слівної фрази, за винятком того, що для неї потрібно 256 біт ентропії та 8-бітна контрольна сума, як вказано в таблиці еквівалентності на початку цього розділу.

## Крок 1: Генерація Ентропії
Підготуйте свій аркуш паперу, ручку та кубики. Для початку нам потрібно випадково згенерувати 128 біт, тобто послідовність з 128 `0` та `1` підряд. Для цього ми використаємо кубики.
![mnemonic](assets/notext/7.webp)

Кубики мають 6 сторін, кожна з однаковою ймовірністю випадання. Однак, наша мета - отримати бінарний результат, тобто два можливі результати. Тому ми призначимо значення `0` кожному кидку, який приземлиться на парне число, і `1` для кожного непарного числа. В результаті ми виконаємо 128 кидків, щоб створити нашу 128-бітну ентропію. Якщо кубик покаже `2`, `4`, або `6`, ми запишемо `0`; для `1`, `3`, або `5`, це буде `1`. Кожен результат буде записаний послідовно, зліва направо та зверху вниз.

Щоб полегшити наступні кроки, ми згрупуємо біти в пакети по чотири та три, як показано на зображенні нижче. Кожен рядок повинен мати 11 біт: 2 пакети по 4 біти та один пакет по 3 біти.

![mnemonic](assets/notext/8.webp)
Як ви можете побачити в моєму прикладі, дванадцяте слово наразі складається лише з 7 бітів. Вони будуть доповнені 4 бітами контрольної суми на наступному кроці, щоб сформувати 11 бітів.
![мнемоніка](assets/notext/9.webp)

## Крок 2: Розрахунок контрольної суми
Цей крок є найважливішим у ручному генеруванні мнемонічної фрази, оскільки він вимагає використання комп'ютера. Як було зазначено раніше, контрольна сума відповідає початку хешу SHA256, який генерується з ентропії. Хоча теоретично можливо розрахувати SHA256 вручну для вхідних даних 128 або 256 біт, це завдання може зайняти цілий тиждень. Більше того, будь-яка помилка в ручних розрахунках буде виявлена лише в кінці процесу, змушуючи вас починати все спочатку. Тому, неможливо здійснити цей крок лише з аркушем паперу та ручкою. Використання комп'ютера майже обов'язкове. Якщо ви все ще хочете дізнатися, як робити SHA256 вручну, ми пояснюємо, як це зробити в [курсі CRYPTO301](https://planb.network/en/courses/crypto301).

З цієї причини я настійно раджу не створювати мнемонічну фразу вручну для реального гаманця. На мою думку, використання комп'ютера на цьому етапі, навіть з усіма необхідними заходами безпеки, нераціонально збільшує поверхню атаки гаманця.
Для розрахунку контрольної суми, залишаючи якомога менше слідів, ми використаємо амнезійну Linux дистрибуцію з знімного диска під назвою **Tails**. Ця операційна система завантажується з USB-накопичувача і працює повністю в оперативній пам'яті комп'ютера, не взаємодіючи з жорстким диском. Таким чином, теоретично, вона не залишає слідів на комп'ютері після його вимкнення. Зверніть увагу, що Tails сумісна лише з процесорами типу x86_64, а не з процесорами типу ARM.
Для початку, з вашого звичайного комп'ютера, [завантажте образ Tails з його офіційного сайту](https://tails.net/install/index.fr.html). Переконайтеся в автентичності вашого завантаження, використовуючи підпис розробника або інструмент перевірки, який пропонує сайт.
![мнемоніка](assets/notext/10.webp)
Спочатку, проведіть форматування вашого USB-накопичувача, потім встановіть Tails за допомогою такого інструменту, як [Balena Etcher](https://etcher.balena.io/).
![мнемоніка](assets/notext/11.webp)
Після підтвердження успішного запису, вимкніть ваш комп'ютер. Потім приступіть до відключення джерела живлення та вийміть жорсткий диск з материнської плати вашого ПК. У випадку наявності WiFi-карти, її слід відключити. Аналогічно, вийміть будь-який кабель RJ45 Ethernet. Для мінімізації ризику витоку даних рекомендується відключити ваш інтернет-бокс та вимкнути мобільний телефон. Крім того, переконайтеся, що від комп'ютера відключені будь-які зайві периферійні пристрої, такі як мікрофон, веб-камера, динаміки або гарнітура, і перевірте, що інші периферійні пристрої підключені лише через дріт. Усі ці кроки підготовки ПК не є обов'язковими, але вони просто допомагають зменшити поверхню атаки якомога більше в реальному контексті.

Перевірте, чи ваш BIOS налаштований на дозвіл завантаження з зовнішнього пристрою. Якщо ні, змініть цей параметр, а потім перезапустіть машину. Після того, як ви забезпечили безпеку комп'ютерного середовища, перезапустіть комп'ютер з USB-накопичувача з ОС Tails.

На вітальному екрані Tails виберіть мову на ваш вибір, потім запустіть систему, натиснувши на `Start Tails`.

![мнемоніка](assets/notext/12.webp)

З робочого столу натисніть на вкладку `Applications`.

![мнемоніка](assets/notext/13.webp)

Перейдіть до меню `Utilities`.
![mnemonic](assets/notext/14.webp)
І нарешті, натисніть на додаток `Terminal`.

![mnemonic](assets/notext/15.webp)

Ви потрапите на новий порожній командний термінал.

![mnemonic](assets/notext/16.webp)
Введіть команду `echo`, за нею ваш раніше згенерований ентропій, переконавшись, що вставили пробіл між `echo` та вашою послідовністю двійкових цифр.
![mnemonic](assets/notext/17.webp)

Додайте додатковий пробіл, потім введіть наступну команду, використовуючи *pipe* (`|`):
```plaintext
| shasum -a 256 -0
```

![mnemonic](assets/notext/18.webp)

У прикладі з моїм ентропієм загальна команда виглядає наступним чином:
```plaintext
echo 11010111000110111011000011000010011000100111000001000000001001011011001010111111001010011111110001010100000101110010010011011010 | shasum -a 256 -0
```

У цій команді:
- `echo` використовується для відправлення послідовності бітів;
- `|`, *pipe*, використовується для перенаправлення виводу команди `echo` на вхід наступної команди;
- `shasum` запускає функцію хешування, що належить до сімейства SHA (*Secure Hash Algorithm*);
- `-a` вказує на вибір конкретного алгоритму хешування;
- `256` вказує, що використовується алгоритм SHA256;
- `-0` дозволяє інтерпретувати вхід як двійкове число.

Після ретельної перевірки, що ваша послідовність бітів не містить помилок у наборі, натисніть клавішу `Enter`, щоб виконати команду. Термінал потім відобразить хеш SHA256 вашого ентропію.

![mnemonic](assets/notext/19.webp)

Наразі хеш виражений у шістнадцятковому форматі (основа 16). Наприклад, мій такий:
```plaintext
a27abf1aff70311917a59a43ce86fa45a62723a00dd2f9d3d059aeac9b4b13d8
```

Щоб завершити нашу мнемонічну фразу, нам потрібні лише перші 4 біти хешу, які становлять контрольну суму. У шістнадцятковому форматі кожен символ представляє 4 біти. Таким чином, ми збережемо лише перший символ хешу. Для фрази з 24 слів необхідно враховувати перші два символи. У моєму прикладі це відповідає літері: `a`. Ретельно занотуйте цей символ десь на вашому аркуші, а потім вимкніть комп'ютер.

Наступний крок - перетворити цей шістнадцятковий символ (основа 16) на двійкове значення (основа 2), оскільки наша фраза побудована в цьому форматі. Для цього ви можете використовувати наступну таблицю перетворення:


| Decimal (основа 10) | Hexadecimal (основа 16) | Binary (основа 2) |
| ------------------- | ----------------------- | ----------------- |
| 0                   | 0                       | 0000              |
| 1                   | 1                       | 0001              |
| 2                   | 2                       | 0010              |
| 3                   | 3                       | 0011              |
| 4                   | 4                       | 0100              |
| 5                   | 5                       | 0101              |
| 6                   | 6                       | 0110              |
| 7                   | 7                       | 0111              |
| 8                   | 8                       | 1000              |
| 9                 | 9                     | 1001            |
| 10                | a                     | 1010            |
| 11                | b                     | 1011            |
| 12                | c                     | 1100            |
| 13                | d                     | 1101            |
| 14                | e                     | 1110            |
| 15                | f                     | 1111            |

У моєму прикладі, літера `a` відповідає двійковому числу `1010`. Ці 4 біти формують контрольну суму нашої фрази відновлення. Тепер ви можете додати їх до ентропії, яку вже занотували на вашому аркуші паперу, розмістивши їх в кінці останнього слова.

![mnemonic](assets/notext/20.webp)

Тепер ваша мнемонічна фраза повна, але вона в двійковому форматі. Наступним кроком буде перетворення її в десяткову систему, щоб ви могли потім асоціювати кожне число з відповідним словом у списку BIP39.

## Крок 3: Перетворення Слів у Десяткові Числа
Щоб перетворити кожен рядок двійкових чисел у десяткове число, ми використаємо метод, який полегшує ручний розрахунок. Наразі у вас на папері дванадцять рядків, кожен з яких складається з 11 двійкових цифр `0` або `1`. Для перетворення в десяткові числа, присвойте кожній першій цифрі значення `1024`, якщо це `1`, інакше `0`. Для другої цифри, значення `512` буде присвоєно, якщо це `1`, інакше `0`, і так далі до одинадцятої цифри. Відповідності такі:
- 1-й біт: `1024`;
- 2-й біт: `512`;
- 3-й біт: `256`;
- 4-й біт: `128`;
- 5-й біт: `64`;
- 6-й біт: `32`;
- 7-й біт: `16`;
- 8-й біт: `8`;
- 9-й біт: `4`;
- 10-й біт: `2`;
- 11-й біт: `1`.

Для кожного рядка ми додамо значення, що відповідають цифрам `1`, щоб отримати десяткове число, еквівалентне двійковому числу. Візьмемо для прикладу рядок двійкових чисел, рівний:
```plaintext
1010 1101 101
```

Перетворення буде наступним:
![mnemonic](assets/notext/21.webp)
Результат буде таким:
```plaintext
1389
```

Для кожного біта, рівного `1`, відзвітуйте асоційоване число нижче. Для кожного біта, рівного `0`, нічого не відзвітуйте.

![mnemonic](assets/notext/22.webp)
Потім просто додайте всі числа, підтверджені `1`, щоб отримати десяткове число, яке представляє кожен рядок двійкових чисел. Наприклад, ось як це виглядає для мого аркуша:
![mnemonic](assets/notext/23.webp)

## Крок 4: Пошук Слів Мнемонічної Фрази
З отриманими десятковими числами ми тепер можемо знайти відповідні слова у списку, щоб скласти мнемонічну фразу. Однак, нумерація 2048 слів у списку BIP39 варіюється від `1` до `2048`. Але наші розраховані двійкові результати варіюються від `0` до `2047`. Тому існує зсув на одиницю, який потрібно виправити. Щоб виправити цей зсув, просто додайте `1` до дванадцяти раніше розрахованих десяткових чисел.

![mnemonic](assets/notext/24.webp)
Після цієї корекції ви маєте ранг кожного слова у списку. Все, що залишається, це ідентифікувати кожне слово за його номером. Звісно, як і на всіх інших етапах, ви не повинні використовувати свій комп'ютер для виконання цього перетворення. Тому переконайтеся, що ви роздрукували список заздалегідь.
[**-> Роздрукуйте список BIP39 у форматі A4.**](https://github.com/PlanB-Network/bitcoin-educational-content/blob/dev/resources/bet/bip39-wordlist/assets/BIP39-WORDLIST.pdf)

Наприклад, якщо номер, отриманий з першого рядка, є 1721, відповідне слово буде 1721-м у списку:
```plaintext
1721. strike
```
![мнемонічна фраза](assets/notext/25.webp)
Таким чином, ми послідовно просуваємося з 12 словами, щоб побудувати нашу мнемонічну фразу.

![мнемонічна фраза](assets/notext/26.webp)

## Крок 5: Створення Bitcoin гаманця
На цьому етапі все, що залишається, це імпортувати нашу мнемонічну фразу до програмного забезпечення Bitcoin гаманця. Залежно від наших переваг, це можна зробити на програмному забезпеченні для настільних комп'ютерів, щоб отримати гарячий гаманець, або на апаратному гаманці для холодного гаманця.

![мнемонічна фраза](assets/notext/27.webp)

Лише під час імпорту ви можете перевірити валідність вашої контрольної суми. Якщо програмне забезпечення відображає повідомлення на кшталт `Invalid Checksum`, це означає, що в процес створення вкралася помилка. Зазвичай, ця помилка виникає або через помилку в ручних перетвореннях та додаваннях, або через помилку при введенні вашої ентропії в термінал на Tails. Буде необхідно почати процес заново, щоб виправити ці помилки.

![мнемонічна фраза](assets/notext/28.webp)
Після створення вашого гаманця не забудьте зробити резервну копію вашої фрази відновлення на фізичному носії, такому як папір або метал, і знищити таблицю, використану під час її генерації, щоб запобігти будь-яким витокам інформації.

## Специфічний випадок опції кидання костей на Coldcards
Апаратні гаманці з сімейства Coldcard пропонують [функцію під назвою *Dice Roll*](https://youtu.be/Rc29d9m92xg?si=OeFW2iCGRvxexhK7), щоб генерувати фразу відновлення вашого гаманця за допомогою костей. Цей метод чудовий, оскільки він дає вам прямий контроль над створенням ентропії, не вимагаючи використання зовнішнього пристрою для розрахунку контрольної суми, як у нашому навчальному посібнику.

Однак, нещодавно були повідомлення про випадки крадіжки біткойнів через неправильне використання цієї функції. Дійсно, занадто обмежена кількість кидків костей може призвести до недостатньої ентропії, теоретично дозволяючи зламати мнемонічну фразу та вкрасти асоційовані біткойни. Щоб уникнути цього ризику, рекомендується виконати щонайменше 99 кидків костей на Coldcard, що забезпечує достатню ентропію.

Метод інтерпретації результатів, запропонований Coldcard, відрізняється від того, що представлено в цьому навчальному посібнику. Хоча ми рекомендуємо 128 кидків для досягнення 128 бітів безпеки в навчальному посібнику, Coldcard пропонує 99 кидків для досягнення 256 бітів безпеки. Дійсно, у нашому підході можливі лише два результати для кожного кидка костей: парний (`0`) або непарний (`1`). Тому ентропія, генерована кожним кидком, дорівнює `log2(2)`. У випадку з Coldcard, який враховує шість можливих граней кості (від `1` до `6`), ентропія за кидок дорівнює `log2(6)`. Саме тому в нашому навчальному посібнику потрібно виконати більше кидків, щоб досягти того ж рівня ентропії.
Ентропія = кількість бросків * log2(кількість можливих результатів на кубику)
Coldcard:

Ентропія = 99 * log2(6)
Ентропія = 255.91

Наш навчальний матеріал:

Ентропія = 128 * log2(2)
Ентропія = 128