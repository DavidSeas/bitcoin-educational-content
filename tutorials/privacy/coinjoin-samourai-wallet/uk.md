---
name: Coinjoin - Samourai Wallet
description: Як виконати coinjoin за допомогою Samourai Wallet?
---
![cover](assets/cover.webp)

***УВАГА:** Після арешту засновників Samourai Wallet та конфіскації їх серверів 24 квітня, інструмент Whirlpool більше не функціонує, навіть для осіб, які мають власний Dojo або використовують Sparrow Wallet. Однак, існує можливість, що цей інструмент може бути відновлений у найближчі тижні або запущений іншим способом. Більше того, теоретична частина цієї статті залишається актуальною для розуміння принципів та цілей coinjoins загалом (не лише Whirlpool), а також для розуміння ефективності моделі Whirlpool.*

_Ми уважно слідкуємо за розвитком цієї справи, а також за розвитком пов'язаних інструментів. Будьте впевнені, що ми оновимо цей навчальний посібник, як тільки з'явиться нова інформація._

_Цей навчальний посібник надається лише для освітніх та інформаційних цілей. Ми не підтримуємо або заохочуємо використання цих інструментів для кримінальних цілей. Кожен користувач несе відповідальність за дотримання законів у своїй юрисдикції._

---

"*біткойн-гаманець для вулиць*"

У цьому навчальному посібнику ви дізнаєтеся, що таке coinjoin і як виконати його за допомогою програмного забезпечення Samourai Wallet та реалізації Whirlpool.

## Що таке coinjoin у Bitcoin?
**Coinjoin - це техніка, яка порушує простежуваність біткойнів у блокчейні**. Вона ґрунтується на спільній транзакції зі специфічною структурою однойменної: транзакції coinjoin.

Coinjoins підвищують конфіденційність користувачів Bitcoin, ускладнюючи аналіз ланцюга для зовнішніх спостерігачів. Їх структура дозволяє об'єднувати кілька монет від різних користувачів у одну транзакцію, тим самим затемнюючи сліди і ускладнюючи визначення зв'язків між вхідними та вихідними адресами.

Принцип coinjoin базується на колаборативному підході: кілька користувачів, які бажають змішати свої біткойни, вносять однакові суми як вхідні дані однієї транзакції. Ці суми потім розподіляються як вихідні дані рівної вартості кожному користувачу. На кінці транзакції стає неможливим асоціювати певний вихід з відомим користувачем на вході. Між входами та виходами не існує прямого зв'язку, що розриває асоціацію між користувачами та їх UTXO, а також історію кожної монети.
![coinjoin](assets/notext/1.webp)

Приклад транзакції coinjoin (не моя): [323df21f0b0756f98336437aa3d2fb87e02b59f1946b714a7b09df04d429dec2](https://mempool.space/en/tx/323df21f0b0756f98336437aa3d2fb87e02b59f1946b714a7b09df04d429dec2)

Для виконання coinjoin, забезпечуючи, що кожен користувач постійно контролює свої кошти, процес починається з побудови транзакції координатором, який потім передає її учасникам. Кожен користувач підписує транзакцію після перевірки, що вона їм підходить. Усі зібрані підписи нарешті інтегруються в транзакцію. Якщо користувач або координатор спробують перенаправити кошти, змінивши виходи транзакції coinjoin, підписи виявляться недійсними, що призведе до відхилення транзакції вузлами.

Існує кілька реалізацій coinjoin, таких як Whirlpool, JoinMarket або Wabisabi, кожна з яких прагне управляти координацією серед учасників та підвищувати ефективність транзакцій coinjoin.
У цьому навчальному посібнику ми поглибимося в реалізацію **Whirlpool**, яку я вважаю найефективнішим рішенням для виконання coinjoins на Bitcoin. Хоча ця функція доступна в кількох гаманцях, у цьому посібнику ми виключно розглянемо її використання з мобільним додатком Samourai Wallet, без Dojo.
## Чому виконувати coinjoins на Bitcoin?
Однією з початкових проблем будь-якої системи платежів між однолітками є подвійні витрати: як запобігти тому, щоб зловмисники витрачали ті самі грошові одиниці кілька разів без звернення до центральної влади для арбітражу?

Сатоші Накамото запропонував рішення цієї дилеми через протокол Bitcoin, систему електронних платежів між однолітками, яка працює незалежно від будь-якої центральної влади. У своєму білому папері він підкреслює, що єдиний спосіб засвідчити відсутність подвійних витрат - це забезпечити видимість усіх транзакцій у межах платіжної системи.

Щоб гарантувати, що кожен учасник знає про транзакції, вони повинні бути публічно розкриті. Таким чином, робота Bitcoin залежить від прозорої та розподіленої інфраструктури, що дозволяє будь-якому оператору вузла перевіряти всю ланцюг електронних підписів та історію кожної монети, починаючи з її створення майнером.

Прозорий та розподілений характер блокчейна Bitcoin означає, що будь-який користувач мережі може слідкувати та аналізувати транзакції всіх інших учасників. В результаті, анонімність на рівні транзакцій неможлива. Однак, анонімність зберігається на рівні ідентифікації особи. На відміну від традиційної банківської системи, де кожен рахунок пов'язаний з особистою ідентичністю, на Bitcoin кошти асоціюються з парами криптографічних ключів, таким чином надаючи користувачам форму псевдонімності за криптографічними ідентифікаторами.

Таким чином, конфіденційність на Bitcoin порушується, коли зовнішні спостерігачі вдаються до асоціації конкретних UTXO з ідентифікованими користувачами. Як тільки ця асоціація встановлена, стає можливим відстежувати їхні транзакції та аналізувати історію їхніх біткойнів. Coinjoin - це саме техніка, розроблена для розриву слідування UTXO, тим самим надаючи певний рівень конфіденційності користувачам Bitcoin на рівні транзакцій.

## Як працює Whirlpool?
Whirlpool вирізняється з інших методів coinjoin за допомогою транзакцій "_ZeroLink_", які гарантують, що технічно неможливо створити будь-який зв'язок між усіма входами та усіма виходами. Це ідеальне змішування досягається через структуру, де кожен учасник вносить однакову суму на вхід (крім комісії за майнінг), таким чином генеруючи виходи абсолютно рівних сум.
Цей обмежувальний підхід до входів надає транзакціям Whirlpool coinjoin унікальну особливість: повна відсутність детермінованих зв'язків між входами та виходами. Іншими словами, кожен вихід має однакову ймовірність бути приписаним будь-якому учаснику, порівняно з усіма іншими виходами в транзакції.
Спочатку кількість учасників у кожному Whirlpool coinjoin була обмежена 5, з 2 новими учасниками та 3 реміксерами (ми пояснимо ці концепції далі). Однак, збільшення комісій за транзакції в мережі, спостережене в 2023 році, спонукало команди Samourai переглянути свою модель для покращення конфіденційності, знижуючи при цьому витрати. Таким чином, враховуючи ситуацію на ринку комісій та кількість учасників, координатор тепер може організовувати coinjoins, що включають 6, 7 або 8 учасників. Ці покращені сесії називаються "_Surge Cycles_". Важливо зазначити, що незалежно від конфігурації, у Whirlpool coinjoins завжди є лише 2 нових учасника.

Таким чином, транзакції Whirlpool характеризуються однаковою кількістю входів та виходів, які можуть бути:
- 5 входів та 5 виходів;
![coinjoin](assets/notext/2.webp)
- 6 входів та 6 виходів;
![coinjoin](assets/notext/3.webp)
- 7 входів та 7 виходів;
![coinjoin](assets/notext/4.webp) - 8 входів та 8 виходів.
![coinjoin](assets/notext/5.webp)
Модель, запропонована Whirlpool, базується на малих транзакціях coinjoin. На відміну від Wasabi та JoinMarket, де міцність анонімних наборів залежить від кількості учасників у одному циклі, Whirlpool робить ставку на ланцюжок декількох малих циклів.

У цій моделі користувач платить комісію лише при своєму початковому вході в пул, що дозволяє їм брати участь у безлічі реміксів без додаткових витрат. Нові учасники покривають комісію за майнінг для реміксерів.

З кожним додатковим coinjoin, у якому бере участь монета разом зі своїми попередніми партнерами, анонімні набори будуть експоненційно зростати. Таким чином, метою є використання цих безкоштовних реміксів, які з кожним разом сприяють зміцненню щільності анонімних наборів, асоційованих з кожною змішаною монетою.

Whirlpool було розроблено, враховуючи дві важливі вимоги:
- Доступність реалізації на мобільних пристроях, враховуючи, що Samourai Wallet переважно є додатком для смартфонів;
- Швидкість циклів реміксу для сприяння значному збільшенню анонімних наборів.
Ці імперативи керували розробниками Samourai Wallet у проектуванні Whirlpool, змусивши їх обмежити кількість учасників на цикл. Занадто мала кількість учасників могла б підірвати ефективність coinjoin, різко зменшивши анонімні набори, генеровані кожним циклом, тоді як занадто велика кількість учасників могла б створити проблеми з управлінням на мобільних додатках і перешкоджати потоку циклів.
**Врешті-решт, немає потреби мати велику кількість учасників на coinjoin у Whirlpool, оскільки анонімні набори досягаються через накопичення декількох циклів coinjoin.**

[-> Дізнатися більше про анонімні набори Whirlpool.](https://planb.network/tutorials/privacy/wst-anonsets)

### Пули та комісії за coinjoin
Для того, щоб ці численні цикли ефективно збільшували анонімні набори змішаних монет, має бути встановлено певний регламент, що обмежує суми UTXO, що використовуються. Whirlpool визначає різні пули.

Пул представляє групу користувачів, які бажають змішатися разом, домовляючись про суму UTXO для оптимізації процесу coinjoin. Кожен пул вказує фіксовану суму для UTXO, до якої користувач має дотримуватися, щоб взяти участь. Таким чином, для виконання coinjoins з Whirlpool, вам потрібно вибрати пул. Наразі доступні такі пули:
- 0.5 біткоїнів;
- 0.05 біткоїна;
- 0.01 біткоїна;
- 0.001 біткоїн (= 100,000 сатоші).

Приєднуючись до пулу зі своїми біткоїнами, вони будуть поділені для генерації UTXO, які є абсолютно однорідними з тими, що у інших учасників пулу. Кожен пул має максимальний ліміт; таким чином, для сум, що перевищують цей ліміт, вам буде змушено або зробити два окремі входи в межах того ж пулу, або орієнтуватися на інший пул з більшою сумою:

| Пул (біткоїн) | Максимальна сума за вхід (біткоїн) |
|---------------|------------------------------------|
| 0.5           | 35                                 |
| 0.05          | 3.5                                |
| 0.01          | 0.7                                |
| 0.001         | 0.025                              |
Як зазначалося раніше, UTXO вважається належним до пулу, коли воно готове до інтеграції у coinjoin. Однак, це не означає, що користувач втрачає над ним володіння. **Протягом різних циклів міксування ви зберігаєте повний контроль над своїми ключами і, відповідно, над своїми біткоїнами.** Ось що відрізняє техніку coinjoin від інших централізованих методів міксування.

Для входу в пул coinjoin необхідно сплатити сервісні та майнінгові збори. Сервісні збори фіксовані для кожного пулу і призначені для компенсації командам, відповідальним за розробку та підтримку Whirlpool.

Сервісні збори за використання Whirlpool сплачуються лише один раз при вході в пул. Після цього кроку у вас є можливість брати участь у необмеженій кількості реміксів без будь-яких додаткових зборів. Ось поточні фіксовані збори для кожного пулу:

| Пул (біткоїн) | Вступний збір (біткоїн) |
|---------------|------------------------|
| 0.5           | 0.0175                 |
| 0.05          | 0.00175                |
| 0.01          | 0.0005 (50,000 сатоші) |
| 0.001         | 0.00005 (5,000 сатоші) |


Ці збори по суті діють як вхідний квиток для обраного пулу, незалежно від суми, яку ви вкладаєте в coinjoin. Таким чином, незалежно від того, приєднуєтеся ви до пулу 0.01 з точно 0.01 BTC або входите в нього з 0.5 BTC, збори залишаться тими самими в абсолютному значенні.

Перед тим, як приступити до coinjoins, користувач має вибір між 2 стратегіями:
- Вибрати менший пул, щоб мінімізувати сервісні збори, знаючи, що вони отримають кілька малих UTXO в результаті;
- Або віддати перевагу більшому пулу, погоджуючись сплатити вищі збори, щоб отримати меншу кількість UTXO більшої вартості.

Зазвичай не рекомендується об'єднувати кілька змішаних UTXO після циклів coinjoin, оскільки це може поставити під загрозу здобуту конфіденційність, особливо через Гевристику Спільного Володіння Входами (CIOH). Тому може бути розумно вибрати більший пул, навіть якщо це означає сплату більше, щоб уникнути наявності занадто багатьох UTXO малої вартості на виході. Користувач має зважити ці компроміси, щоб вибрати пул, який він вважає за краще.

Окрім сервісних зборів, також необхідно враховувати майнінгові збори, притаманні будь-якій транзакції Bitcoin. Як користувач Whirlpool, вам буде необхідно сплатити майнінгові збори за підготовчу транзакцію (`Tx0`), а також за перший coinjoin. Всі наступні ремікси будуть безкоштовними, завдяки моделі Whirlpool, яка покладається на платежі нових учасників.

На кожному coinjoin Whirlpool два користувачі серед входів є новими учасниками. Інші входи походять від реміксерів. В результаті, майнінгові збори для всіх учасників транзакції покриваються цими двома новими учасниками, які потім також отримають можливість безкоштовних реміксів:
![coinjoin](assets/en/6.webp)
Завдяки цій системі зборів, Whirlpool справді відрізняється від інших сервісів coinjoin, оскільки анонімні набори UTXO не пропорційні до ціни, сплаченої користувачем. Таким чином, можливо досягти значно вищих рівнів анонімності, сплативши лише вступний збір пулу та майнінгові збори за дві транзакції (за `Tx0` та початковий мікс).
Важливо зазначити, що користувач також має покрити комісію за майнінг, щоб вивести свої UTXO з пулу після завершення кількох coinjoin, якщо вони не обрали опцію `mix to`, про яку ми поговоримо в навчальному посібнику нижче.
### Рахунки HD гаманця, що використовуються Whirlpool
Для виконання coinjoin через Whirlpool, гаманець має генерувати кілька окремих рахунків. Рахунок, в контексті HD (*Ієрархічно-Детермінованого*) гаманця, становить секцію, повністю ізольовану від інших, ця ізоляція відбувається на третьому рівні глибини ієрархії гаманця, тобто на рівні `xpub`.

HD гаманець теоретично може похіднувати до `2^(32/2)` різних рахунків. Початковий рахунок, що використовується за замовчуванням у всіх Bitcoin гаманцях, відповідає індексу `0'`.

Для гаманців, адаптованих до Whirlpool, таких як Samourai або Sparrow, використовуються 4 рахунки для задоволення потреб процесу coinjoin:
- Рахунок **депозиту**, ідентифікований індексом `0'`;
- Рахунок **поганого банку** (або doxxic change), ідентифікований індексом `2 147 483 644'`;
- Рахунок **преміксу**, ідентифікований індексом `2 147 483 645'`;
- Рахунок **постміксу**, ідентифікований індексом `2 147 483 646'`.

Кожен з цих рахунків виконує певну функцію в процесі coinjoin.

Всі ці рахунки пов'язані з одним seed, що дозволяє користувачу відновити доступ до всіх своїх біткоїнів, використовуючи свою фразу відновлення та, за потреби, свій пароль. Однак, під час цієї операції відновлення, необхідно вказати програмному забезпеченню різні індекси рахунків, що використовувалися.

Тепер давайте розглянемо різні етапи coinjoin в Whirlpool на цих рахунках.

### Різні етапи coinjoin на Whirlpool
**Етап 1: Tx0**
Вихідна точка будь-якого Whirlpool coinjoin - це рахунок **депозиту**. Цей рахунок автоматично використовується, коли ви створюєте новий Bitcoin гаманець. На цей рахунок мають бути зараховані біткоїни, які хочеться змішати.
`Tx0` представляє перший крок у процесі міксування Whirlpool. Його мета - підготувати та уніфікувати UTXO для coinjoin, розділивши їх на одиниці, що відповідають сумі обраного пулу, для забезпечення однорідності міксу. Уніфіковані UTXO потім надсилаються на рахунок **преміксу**. Що стосується різниці, яка не може увійти в пул, вона відокремлюється на специфічний рахунок: **поганий банк** (або "doxxic change").
Ця початкова транзакція `Tx0` також служить для врегулювання сервісних зборів, що належать координатору міксу. На відміну від наступних кроків, ця транзакція не є колаборативною; користувач, отже, повинен взяти на себе всі комісії за майнінг:
![coinjoin](assets/en/7.webp)

У цьому прикладі транзакції `Tx0`, вхід у `372,000 sats` з нашого рахунку **депозиту** ділиться на кілька вихідних UTXO, які розподіляються наступним чином:
- Сума `5,000 sats` призначена для координатора за сервісні збори, що відповідає входу в пул `100,000 sats`;
- Три UTXO, підготовлені для міксування, перенаправлені на наш рахунок **преміксу** та зареєстровані у координатора. Ці UTXO уніфіковані по `108,000 sats` кожен, для покриття комісій за майнінг їхнього майбутнього початкового міксу;
- Надлишок, який не може потрапити до пулу, оскільки він занадто малий, вважається токсичною зміною. Він відправляється на свій специфічний рахунок. Тут ця зміна становить `40,000 сатс`;
- Нарешті, є `3,000 сатс`, які не є виходом, але є майнінговими комісіями, необхідними для підтвердження `Tx0`.

Наприклад, ось реальний Whirlpool Tx0 (не мій): [edef60744f539483d868caff49d4848e5cc6e805d6cdc8d0f9bdbbaedcb5fc46](https://mempool.space/en/tx/edef60744f539483d868caff49d4848e5cc6e805d6cdc8d0f9bdbbaedcb5fc46)

**Крок 2: Токсична зміна**
Надлишок, який не можна було інтегрувати до пулу, тут еквівалентний `40,000 сатс`, перенаправляється на рахунок **поганого банку**, також відомий як "токсична зміна", щоб забезпечити строге відділення від інших UTXO в гаманці.

Цей UTXO небезпечний для приватності користувача, оскільки не тільки залишається пов'язаним зі своїм минулим, і таким чином, можливо, з ідентичністю його власника, але також відзначається як належний користувачу, який виконав coinjoin.
Якщо цей UTXO буде об'єднаний з перемішаними виходами, вони втратять усю конфіденційність, отриману під час циклів coinjoin, зокрема через Common-Input-Ownership-Heuristic (CIOH). Якщо він буде об'єднаний з іншими токсичними змінами, користувач ризикує втратити конфіденційність, оскільки це пов'яже різні входи циклів coinjoin. Тому з ним потрібно поводитися обережно. Спосіб управління цим токсичним UTXO буде детально описано в останній частині цієї статті, а майбутні навчальні посібники більш глибоко розкриють ці методи на мережі PlanB.

**Крок 3: Початкове змішування**
Після завершення `Tx0`, урівняні UTXO відправляються на рахунок **преміксу** нашого гаманця, готові до введення в їх перший цикл coinjoin, також називаний "початковим змішуванням". Якщо, як у нашому прикладі, `Tx0` генерує кілька UTXO для змішування, кожен з них буде інтегрований у окремий початковий coinjoin.

На кінці цих перших змішувань рахунок **преміксу** буде порожнім, тоді як наші монети, заплативши майнінгові комісії за цей перший coinjoin, будуть точно відрегульовані до суми, визначеної обраним пулом. У нашому прикладі, наші початкові UTXO `108 000 сатс` будуть зменшені до точно `100 000 сатс`.
![coinjoin](assets/en/8.webp)
**Крок 4: Ремікси**
Після початкового змішування UTXO переводяться на рахунок **постміксу**. Цей рахунок збирає вже змішані UTXO та ті, що чекають на ремікс. Коли клієнт Whirlpool активний, UTXO на рахунку **постміксу** автоматично доступні для реміксу і будуть випадково обрані для участі в цих нових циклах.

Нагадуємо, що ремікси потім є абсолютно безкоштовними: не потрібно додаткових сервісних зборів або майнінгових комісій. Зберігання UTXO на рахунку **постміксу** таким чином зберігає їхню цінність незмінною і одночасно покращує їх anonsets. Тому важливо дозволити цим монетам брати участь у кількох циклах coinjoin. Це абсолютно нічого вас не коштує, і це збільшує їх рівні анонімності.
Коли ви вирішуєте витратити змішані UTXO, ви можете зробити це безпосередньо з цього **постмікс** рахунку. Рекомендується зберігати змішані UTXO на цьому рахунку, щоб скористатися безкоштовними реміксами та уникнути їх виходу з циклу Whirlpool, що могло б зменшити їх конфіденційність.
Як ми побачимо в наступному навчальному посібнику, існує також опція `mix to`, яка пропонує можливість автоматично надсилати ваші змішані монети до іншого гаманця, наприклад, холодного гаманця, після визначеної кількості coinjoins.
Після теоретичної частини, давайте перейдемо до практики з навчальним посібником з використання Whirlpool через додаток Samourai Wallet для Android!
## Навчальний посібник: Coinjoin Whirlpool у Samourai Wallet
Існує безліч варіантів використання Whirlpool. Той, який я хочу тут представити, - це варіант Samourai Wallet (без Dojo), відкритий додаток для управління Bitcoin гаманцем на Android.

Змішування в Samourai без Dojo має перевагу в тому, що воно досить легке в обігу, швидко налаштовується і не вимагає іншого пристрою, крім телефону Android та інтернет-з'єднання.

Однак, цей метод має два значні недоліки:
- Coinjoins відбуватимуться лише тоді, коли Samourai працює в фоновому режимі та підключений. Це означає, що якщо ви хочете змішувати та реміксувати свої біткойни 24/7, вам потрібно постійно тримати Samourai увімкненим;
- Якщо ви використовуєте Whirlpool з Samourai Wallet, не дбаючи про підключення власного Dojo, то вашому додатку доведеться підключатися до сервера, який підтримується командами Samourai, і ви розкриєте їм `xpub` вашого гаманця. Ці анонімні дані необхідні для того, щоб ваш додаток міг знаходити ваші транзакції.

Ідеальне рішення для подолання цих обмежень - це використання власного Dojo, пов'язаного з інстанцією Whirlpool CLI на вашому особистому Bitcoin вузлі. Таким чином, ви уникнете будь-якого витоку інформації та досягнете повної незалежності. Хоча наведений нижче навчальний посібник корисний для певних цілей або для початківців, для справжньої оптимізації вашої сесії coinjoin рекомендується використовувати власний Dojo. Детальний посібник з налаштування цієї конфігурації незабаром буде доступний на PlanB Network.

### Встановлення Samourai Wallet
Для початку вам, звичайно, знадобиться додаток Samourai Wallet. Ви можете завантажити його безпосередньо з офіційного сайту, використовуючи APK, з їх GitLab або з Google Play Store.

### Створення програмного гаманця
Після встановлення програми вам потрібно буде приступити до створення Bitcoin гаманця в Samourai. Якщо у вас вже є гаманець, можете перейти безпосередньо до наступного кроку.

Після відкриття додатку натисніть синю кнопку `Start`. Потім вас попросять вибрати місце в файлах вашого телефону, де буде зберігатися зашифрований бекап вашого нового гаманця.

![samourai](assets/notext/9.webp)
Активуйте Tor, натиснувши на відповідний вимикач. На цьому етапі у вас також є можливість вибрати конкретний Dojo. Однак, в цьому навчальному посібнику ми продовжимо зі стандартним Dojo; тому можете залишити опцію вимкненою. Коли Tor підключений, натисніть кнопку `Створити новий гаманець`.
![samourai](assets/notext/10.webp)

Samourai Wallet потім запропонує вам встановити пароль BIP39. Цей додатковий пароль дуже важливий, оскільки він безпосередньо впливає на похідні ваші приватні ключі. Втрата цього пароля призведе до неможливості доступу до ваших біткойнів, роблячи їх незворотно втраченими. Для відновлення вашого гаманця Samourai необхідно мати як вашу 12-слівну фразу відновлення, так і пароль.
Отже, важливо обрати надійну парольну фразу та зробити одну або кілька фізичних копій на папері або металевому носії, щоб забезпечити безпеку ваших біткойнів. Після виконання цих завдань, позначте галочку `Я усвідомлюю, що у випадку втрати...`, потім натисніть кнопку `ДАЛІ`.
![samourai](assets/notext/11.webp)

Потім вам потрібно буде встановити ПІН-код, що складається з 5 до 8 цифр. Цей код забезпечить доступ до вашого гаманця на телефоні. Він буде запитуватися кожного разу, коли ви захочете відкрити додаток Samourai. Оберіть надійний ПІН-код і не забудьте зробити резервну копію. Після цього ви можете натиснути кнопку `ДАЛІ`.

![samourai](assets/notext/12.webp)

Samourai запропонує вам ввести ваш ПІН-код знову для підтвердження. Введіть його, потім натисніть `ЗАВЕРШИТИ`.

![samourai](assets/notext/13.webp)

Потім ви отримаєте доступ до вашої фрази відновлення, що складається з 12 слів. Ця фраза дозволяє вам відновити ваш гаманець за допомогою раніше введеної парольної фрази. Настійно рекомендується зробити одну або кілька копій цієї фрази на фізичних носіях, таких як папір або металевий матеріал, щоб забезпечити безпеку ваших біткойнів у разі проблем.

Після створення цих резервних копій, ви будете перенаправлені до інтерфейсу вашого нового гаманця Samourai.

![samourai](assets/notext/14.webp)

Вам буде запропоновано отримати ваш PayNym Bot. Ви можете запросити його, якщо бажаєте, хоча це не є обов'язковим для нашого навчального посібника.

![samourai](assets/notext/15.webp)
Перед тим, як приступити до отримання біткойнів на цей новий гаманець, настійно рекомендується повторно перевірити валідність ваших резервних копій (парольну фразу та фразу відновлення). Щоб перевірити парольну фразу, ви можете вибрати іконку вашого PayNym Bot, розташовану в лівому верхньому куті екрана, а потім слідувати шляхом:
```plaintext
Налаштування > Вирішення проблем > Тест парольної фрази/резервної копії
```

Введіть вашу парольну фразу для проведення перевірки.

![samourai](assets/notext/16.webp)

Samourai підтвердить, чи є вона дійсною.

![samourai](assets/notext/17.webp)

Щоб перевірити вашу резервну копію фрази відновлення, зайдіть в іконку вашого PayNym Bot, розташовану в лівому верхньому куті екрана, і слідуйте цим шляхом:
```plaintext
Налаштування > Гаманець > Показати 12-слівну фразу відновлення
```

Samourai покаже вікно з вашою фразою відновлення. Переконайтеся, що вона точно збігається з вашою фізичною резервною копією.

Щоб піти далі та провести повне тестування відновлення, запишіть свідчення елемента вашого гаманця, такого як один з `xpubs`, потім приступіть до видалення вашого гаманця (за умови, що він все ще порожній). Мета полягає в тому, щоб спробувати відновити цей порожній гаманець, використовуючи лише ваші фізичні резервні копії. Якщо відновлення вдалося, це вказує на те, що ваші резервні копії є дійсними та надійними.

### Отримання біткойнів
Після створення вашого гаманця, ви почнете з одного рахунку, ідентифікованого індексом `0'`. Це **депозитний** рахунок, про який ми говорили в попередніх частинах. Саме на цей рахунок вам потрібно буде перевести біткойни, призначені для coinjoins.

Для цього натисніть на синій символ `+`, розташований внизу справа на екрані.

![samourai](assets/notext/18.webp)

Потім натисніть на зелену кнопку `Отримати`.

![samourai](assets/notext/19.webp)

Samourai автоматично згенерує нову порожню адресу для отримання біткойнів.

![samourai](assets/notext/20.webp)
Ви можете відправити біткойни на міксування туди.
![samourai](assets/notext/21.webp)

### Створення Tx0
Коли транзакція підтверджена, ми можемо розпочати процес coinjoins. Для цього натисніть на синю кнопку `+` в правому нижньому куті екрана.

![samourai](assets/notext/22.webp)

Потім натисніть на `Whirlpool` синім кольором.

![samourai](assets/notext/23.webp)

Зачекайте, поки Whirlpool ініціалізується, а Samourai створює необхідні акаунти.

![samourai](assets/notext/24.webp)

Потім ви потрапите на домашню сторінку Whirlpool. Натисніть на `Start`.
![samourai](assets/notext/25.webp)
Виберіть UTXO з акаунту **deposit**, який ви хочете відправити в цикли coinjoin, потім натисніть на `Next`.

![samourai](assets/notext/26.webp)

На наступному кроці вам потрібно буде вибрати рівень комісії для `Tx0`, а також для вашого першого міксу. Цей параметр визначатиме швидкість, з якою ваш `Tx0` та ваш початковий coinjoin (або початкові coinjoins) будуть підтверджені. Майте на увазі, що комісії за майнінг для `Tx0` та початкового міксу лягають на ваші плечі, але ви не будете платити комісії за майнінг для наступних реміксів. Ви маєте вибір між опціями `Low`, `Normal` або `High`.

![samourai](assets/notext/27.webp)

У тому ж вікні у вас є можливість вибрати басейн, до якого ви увійдете. Враховуючи, що я спочатку вибрав UTXO `454,258 sats`, мій єдиний можливий вибір - це басейн `100,000 sats`. На цій сторінці також представлені сервісні комісії басейну, окрім комісій за майнінг, що дозволяє вам знати загальну вартість цього циклу coinjoin. Якщо все вас влаштовує, виберіть відповідний басейн і продовжуйте, натиснувши на синю кнопку `VERIFY CYCLE DETAILS`.

![samourai](assets/notext/28.webp)

Потім ви можете побачити всі деталі вашого циклу coinjoin:
- кількість UTXO, які увійдуть до басейну;
- різні затрати;
- сума токсичної здачі...

Перевірте інформацію, потім натисніть на зелену кнопку `START CYCLE`.

![samourai](assets/notext/29.webp)

З'явиться вікно, яке запропонує вам позначити токсичну здачу, що виникла в результаті вашого входу в цикл coinjoin, як "невитрачену". Вибравши `YES`, цей UTXO не буде видимим у вашому гаманці і не може бути вибраний для майбутніх транзакцій. Однак, він залишиться доступним у списку UTXO у вашому гаманці, де ви можете вручну змінити його статус. Рекомендується вибрати цю опцію, щоб уникнути будь-якої помилки управління, яка могла б пізніше поставити під загрозу вашу конфіденційність. Якщо ви виберете `NO`, токсична здача залишиться доступною для використання у вашому гаманці. Якщо ви хочете дізнатися більше про управління та використання цієї токсичної здачі, я раджу вам прочитати останню частину цього навчального посібника.

![samourai](assets/notext/30.webp)

Samourai тоді транслюватиме ваш Tx0.

![samourai](assets/notext/31.webp)

### Виконання coinjoins
Після трансляції Tx0, ви можете знайти його на вкладці `Transactions` меню Whirlpool.

![samourai](assets/notext/32.webp)
Ваші UTXO, готові до змішування, знаходяться на вкладці `Mixing in progress...`, що відповідає обліковому запису **Premix**.![samourai](assets/notext/33.webp)

Як тільки `Tx0` буде підтверджено, ваші UTXO будуть автоматично зареєстровані у координатора, і початкові змішування почнуться послідовно автоматичним способом.

![samourai](assets/notext/34.webp)

Перевіряючи вкладку `Remixing`, яка відповідає обліковому запису **Postmix**, ви побачите UTXO, отримані з початкових змішувань. Ці монети залишатимуться готовими до подальшого перезмішування, яке не потребуватиме додаткових витрат. Я рекомендую ознайомитися з цією іншою статтею, щоб дізнатися більше про процес перезмішування та ефективність циклу coinjoin: [REMIX - WHIRLPOOL](https://planb.network/tutorials/privacy/remix-whirlpool)

![samourai](assets/notext/35.webp)

Можливо тимчасово призупинити перезмішування UTXO, натиснувши кнопку паузи, розташовану праворуч від нього. Щоб знову зробити його придатним для перезмішування, просто натисніть на ту саму кнопку вдруге. Важливо зазначити, що одночасно може бути виконано лише один coinjoin на користувача та на басейн. Таким чином, якщо у вас є 6 UTXO по `100 000 sats`, готових до змішування, лише один з них може бути змішаний. Після змішування UTXO, Samourai Wallet випадковим чином вибирає новий UTXO з вашого доступу, щоб диверсифікувати та збалансувати перезмішування кожної монети.

![samourai](assets/notext/36.webp)

Для забезпечення постійної доступності ваших UTXO для перезмішування необхідно тримати додаток Samourai активним у фоновому режимі. Ви повинні побачити сповіщення на своєму телефоні, що підтверджує роботу Whirlpool. Закриття додатку або вимкнення телефону призупинить coinjoins.

### Завершення coinjoins
Щоб витратити ваші змішані біткойни, перейдіть до облікового запису **Postmix**, позначеного як `Remixing` у вкладках меню Whirlpool.

![samourai](assets/notext/37.webp)

Натисніть на синій логотип Whirlpool, розташований внизу праворуч.

![samourai](assets/notext/38.webp)

Потім натисніть на `Spend Mixed UTXOs`.

![samourai](assets/notext/39.webp)

Після цього введіть адресу одержувача та суму для відправлення, так само, як і для будь-якої іншої транзакції, здійсненої за допомогою Samourai Wallet. Синій фон вказує на те, що кошти витрачаються з облікового запису Whirlpool, а не з облікового запису **deposit**.

![samourai](assets/notext/40.webp)

Натискаючи на 3 маленькі точки вгорі праворуч, ви маєте можливість вибрати конкретні UTXO.
![samourai](assets/notext/41.webp)
Натиснувши на білий квадрат у верхній правій частині вікна, ви можете відсканувати QR-код адреси одержувача за допомогою камери.

![samourai](assets/notext/42.webp)

Введіть необхідну інформацію для вашої транзакції витрат, а потім натисніть на синю кнопку `VERIFY TRANSACTION`.

![samourai](assets/notext/43.webp)
На наступному кроці у вас є можливість змінити ставку комісії, пов'язану з вашою транзакцією. Ви також можете активувати опцію Stonewall, поставивши відповідний прапорець. Якщо опція Stonewall не доступна для вибору, це означає, що ваш обліковий запис **Postmix** не містить UTXO достатнього розміру для підтримки цієї конкретної структури транзакції.
[-> Дізнайтеся більше про транзакції Stonewall.](https://planb.network/tutorials/privacy/stonewall)

Якщо все вас влаштовує, натисніть на зелену кнопку `SEND ... BTC`.

![samourai](assets/notext/44.webp)

Після цього Samourai приступить до підписання вашої транзакції перед її трансляцією в мережу. Вам залишається лише чекати, поки вона буде додана до блоку майнером.

![samourai](assets/notext/45.webp)

### Використання SCODE
Іноді команди Samourai Wallet пропонують "SCODEs". SCODE - це промокод, який надає знижку на сервісні збори пулу. Samourai Wallet час від часу пропонує такі коди своїм користувачам під час спеціальних подій. Я раджу вам [слідкувати за Samourai Wallet](https://twitter.com/SamouraiWallet) у соціальних мережах, щоб не пропустити майбутні SCODES.

Щоб застосувати SCODE в Samourai, перед початком нового циклу coinjoin, перейдіть до меню Whirlpool і виберіть три маленькі точки, розташовані в правому верхньому куті екрана.

![samourai](assets/notext/46.webp)

Натисніть на `SCODE (промокод) Whirlpool`.

![samourai](assets/notext/47.webp)

Введіть SCODE у вікні, що відкрилося, потім підтвердіть, натиснувши на `OK`.

![samourai](assets/notext/48.webp)

Whirlpool автоматично закриється. Дочекайтеся завершення завантаження Samourai, потім знову відкрийте меню Whirlpool.

![samourai](assets/notext/49.webp)

Переконайтеся, що ваш SCODE був правильно зареєстрований, ще раз натиснувши на три маленькі точки, а потім вибравши `SCODE (промокод) Whirlpool`. Якщо все в порядку, ви готові розпочати новий цикл Whirlpool зі знижкою на сервісні збори. Важливо зазначити, що ці SCODEs є тимчасовими: вони залишаються дійсними кілька днів, перш ніж стають застарілими.

## Як дізнатися про якість наших циклів coinjoin?
Для того, щоб coinjoin був дійсно ефективним, важливо, щоб він демонстрував хорошу однорідність між сумами вхідних і вихідних коштів. Ця однорідність збільшує кількість можливих інтерпретацій в очах зовнішнього спостерігача, тим самим збільшуючи невизначеність, що оточує транзакцію. Для кількісної оцінки цієї невизначеності, створеної coinjoin, можна вдатися до розрахунку ентропії транзакції. Для глибокого вивчення цих показників я вас направляю до навчального посібника: [BOLTZMANN CALCULATOR](https://planb.network/en/tutorials/privacy/boltzmann-entropy). Модель Whirlpool визнана тією, що приносить найбільшу однорідність до coinjoins.
Далі оцінюється продуктивність кількох циклів coinjoin на основі розміру груп, в яких приховано монету. Розмір цих груп визначає те, що називається анонімними наборами (anonsets). Існує два типи анонімних наборів: перший оцінює конфіденційність, отриману проти ретроспективного аналізу (від теперішнього до минулого) і другий, проти перспективного аналізу (від минулого до теперішнього). Для детального пояснення цих двох індикаторів, запрошую вас ознайомитися з навчальним посібником: [WHIRLPOOL STATS TOOLS - ANONSETS](https://planb.network/tutorials/privacy/wst-anonsets)

## Як керувати postmix?
Після виконання циклів coinjoin найкраща стратегія - зберігати ваші UTXO на рахунку **postmix**, чекаючи їх майбутнього використання. Навіть рекомендується дозволити їм реміксуватися нескінченно, поки вам не потрібно буде їх витратити.

Деякі користувачі можуть розглядати можливість переказу своїх змішаних біткойнів на гаманець, захищений апаратним гаманцем. Це можливо, але важливо ретельно дотримуватися рекомендацій Samourai Wallet, щоб не поставити під загрозу отриману конфіденційність.

Об'єднання UTXO є найчастіше зробленою помилкою. Необхідно уникати поєднання змішаних UTXO з незмішаними UTXO в одній транзакції, щоб уникнути CIOH (*Common-Input-Ownership-Heuristic*). Це вимагає ретельного управління вашими UTXO у вашому гаманці, особливо з точки зору маркування. Понад coinjoin, об'єднання UTXO зазвичай є поганою практикою, яка часто призводить до втрати конфіденційності, якщо не керувати належним чином.
Вам також слід бути пильними щодо консолідації змішаних UTXO між собою. Помірні консолідації можливі, якщо ваші змішані UTXO мають значні анонімні набори, але це неминуче зменшить конфіденційність ваших монет. Переконайтеся, що консолідації не занадто великі та не проводяться після недостатньої кількості реміксів, оскільки це ризикує створити виводимі зв'язки між вашими UTXO до і після циклів coinjoin. У разі сумнівів щодо цих операцій, найкраща практика - не консолідувати postmix UTXO, і переказувати їх один за одним до вашого апаратного гаманця, генеруючи нову порожню адресу кожного разу. Ще раз, пам'ятайте належно маркувати кожен отриманий UTXO.

Також не рекомендується переказувати ваші postmix UTXO на гаманець, який використовує незвичайні скрипти. Наприклад, якщо ви входите в Whirlpool з мультісиг-гаманцем, який використовує скрипти `P2WSH`, мало шансів, що ви будете змішані з іншими користувачами, які спочатку мають такий самий тип гаманця. Якщо ви вийдете з вашого postmix на цей самий мультісиг-гаманець, рівень конфіденційності ваших змішаних біткойнів буде значно знижений. Понад скрипти, існує багато інших відбитків гаманців, які можуть вас обдурити.

Як і в будь-якій транзакції Bitcoin, також важливо не повторно використовувати адреси отримання. Кожна нова транзакція повинна отримуватися на нову порожню адресу.

Найпростішим і найбезпечнішим рішенням є дозволити вашим змішаним UTXO відпочивати на їхньому рахунку **postmix**, дозволяючи їм реміксуватися і торкаючись їх лише для витрат. Гаманці Samourai та Sparrow мають додаткові захисти проти всіх цих ризиків, пов'язаних з аналізом ланцюга. Ці захисти допомагають вам уникнути помилок.

## Як керувати доксичною здачею?
Далі, вам потрібно бути обережними у керуванні доксичною здачею, здачею, яка не могла увійти в пул coinjoin. Ці токсичні UTXO, що виникають в результаті використання Whirlpool, становлять ризик для вашої конфіденційності, оскільки вони встановлюють зв'язок між вами та використанням coinjoin. Тому необхідно обережно поводитися з ними і не комбінувати їх з іншими UTXO, особливо змішаними UTXO. Ось різні стратегії, які слід розглянути для їх використання:
- **Змішуйте їх у менших пулах:** Якщо ваш токсичний UTXO достатньо великий, щоб самостійно увійти в менший пул, розгляньте можливість його змішування. Це часто є найкращим варіантом. Однак, критично важливо не об'єднувати кілька токсичних UTXO для доступу до пулу, оскільки це може пов'язати ваші різні записи.
- **Позначте їх як "невитрачені":** Інший підхід полягає в припиненні їх використання, позначенні як "невитрачені" у їхньому призначеному акаунті та просто Hodl. Це гарантує, що ви випадково не витратите їх. Якщо вартість біткоїна зросте, можуть з'явитися нові пули, більш підходящі для ваших токсичних UTXO.
- **Робіть пожертви:** Розгляньте можливість робити пожертви, навіть скромні, розробникам, які працюють над Bitcoin та його супутнім програмним забезпеченням. Ви також можете пожертвувати організаціям, які приймають BTC. Якщо управління вашими токсичними UTXO здається занадто складним, ви можете просто позбутися їх, зробивши пожертву.
- **Купуйте подарункові картки:** Платформи, такі як [Bitrefill](https://www.bitrefill.com/), дозволяють обмінювати біткоїни на подарункові картки, які можна використовувати у різних торговців. Це може бути спосіб позбутися ваших токсичних UTXO без втрати асоційованої вартості.
- **Консолідуйте їх на Monero:** Samourai Wallet тепер пропонує сервіс атомарного свопу між BTC та XMR. Це ідеально для управління токсичними UTXO, консолідуючи їх на Monero, без компрометації вашої приватності через KYC, перед поверненням їх назад до Bitcoin. Однак, цей варіант може бути дорогим з точки зору комісій за майнінг та премії через обмеження ліквідності.
- **Відправте їх до Lightning Network:** Переказ цих UTXO до Lightning Network для використання знижених комісій за транзакції є опцією, яка може бути цікавою. Однак, цей метод може розкрити певну інформацію залежно від вашого використання Lightning і тому має бути використаний з обережністю.

Детальні навчальні посібники щодо впровадження цих різних технік будуть незабаром запропоновані на PlanB Network.

**Додаткові ресурси:**
[Відеоурок Samourai Wallet](https://planb.network/tutorials/wallet/samourai)
- [Документація Samourai Wallet - Whirlpool](https://docs.samourai.io/whirlpool/basic-concepts);
- [Твіттер-тред про coinjoins](https://twitter.com/SamouraiWallet/status/1489220847336308739);
- [Блог-пост про coinjoins](https://www.pandul.fr/post/comprendre-et-utiliser-le-coinjoin-sur-bitcoin).