---
name: Coinjoin - Sparrow Wallet
description: Як виконати coinjoin за допомогою Sparrow Wallet?
---
![cover](assets/cover.webp)

***УВАГА:** Після арешту засновників Samourai Wallet та конфіскації їх серверів 24 квітня, інструмент Whirlpool більше не функціонує, навіть для осіб, які мають власний Dojo або використовують Sparrow Wallet. Однак, існує можливість, що цей інструмент може бути відновлений у найближчі тижні або запущений іншим способом. Більше того, теоретична частина цієї статті залишається актуальною для розуміння принципів та цілей coinjoins загалом (не лише Whirlpool), а також для розуміння ефективності моделі Whirlpool.*

_Ми уважно слідкуємо за розвитком цієї справи, а також за розвитком пов'язаних інструментів. Будьте впевнені, що ми оновимо цей навчальний посібник, як тільки з'явиться нова інформація._

_Цей навчальний посібник надається лише для освітніх та інформаційних цілей. Ми не підтримуємо або не заохочуємо використання цих інструментів для кримінальних цілей. Кожен користувач несе відповідальність за дотримання законів у своїй юрисдикції._

---

У цьому навчальному посібнику ви дізнаєтеся, що таке coinjoin і як його виконати за допомогою програмного забезпечення Sparrow Wallet та реалізації Whirlpool.

## Що таке coinjoin в Bitcoin?
**Coinjoin - це техніка, яка розриває слідкування за біткоїнами в блокчейні**. Вона ґрунтується на спільній транзакції зі специфічною структурою однойменної транзакції: транзакції coinjoin.

Coinjoins підвищують конфіденційність користувачів Bitcoin, ускладнюючи аналіз ланцюга для зовнішніх спостерігачів. Їх структура дозволяє об'єднувати кілька монет від різних користувачів у одну транзакцію, тим самим затуманюючи сліди та ускладнюючи визначення зв'язків між вхідними та вихідними адресами.

Принцип coinjoin базується на співпраці: кілька користувачів, які бажають змішати свої біткоїни, вносять однакові суми як вхідні дані однієї транзакції. Ці суми потім перерозподіляються як вихідні дані однакової вартості кожному користувачу. В кінці транзакції стає неможливим асоціювати певний вихід з відомим користувачем на вході. Між входами та виходами не існує прямого зв'язку, що розриває асоціацію між користувачами та їх UTXO, а також історію кожної монети.
![coinjoin](assets/notext/1.webp)

Приклад транзакції coinjoin (не моя): [323df21f0b0756f98336437aa3d2fb87e02b59f1946b714a7b09df04d429dec2](https://mempool.space/en/tx/323df21f0b0756f98336437aa3d2fb87e02b59f1946b714a7b09df04d429dec2)

Для виконання coinjoin, забезпечуючи, що кожен користувач зберігає контроль над своїми коштами весь час, процес починається з побудови транзакції координатором, який потім передає її кожному учаснику. Кожен користувач підписує транзакцію після перевірки, що вона їм підходить. Всі зібрані підписи нарешті інтегруються в транзакцію. Якщо користувач або координатор намагаються перенаправити кошти, змінивши виходи транзакції coinjoin, підписи виявляться недійсними, що призведе до відхилення транзакції вузлами.

Існує кілька реалізацій coinjoin, таких як Whirlpool, JoinMarket або Wabisabi, кожна з яких прагне управляти координацією між учасниками та підвищувати ефективність транзакцій coinjoin.
У цьому навчальному посібнику ми зосереджуємося на реалізації **Whirlpool**, яку я вважаю найефективнішим рішенням для виконання coinjoins на Bitcoin. Хоча вона доступна в декількох гаманцях, цей посібник виключно досліджує її використання з настільним програмним забезпеченням Sparrow Wallet.

## Чому виконувати CoinJoins на Bitcoin?

Однією з початкових проблем будь-якої системи платежів від одного користувача до іншого є подвійні витрати: як запобігти тому, щоб зловмисні особи не витрачали ті самі грошові одиниці кілька разів без звернення до центрального органу для арбітражу?

Сатоші Накамото запропонував рішення цієї дилеми через протокол Bitcoin, систему електронних платежів від одного користувача до іншого, яка працює незалежно від будь-якого центрального органу. У своєму білому папері він підкреслює, що єдиний спосіб засвідчити відсутність подвійних витрат - це забезпечити видимість усіх транзакцій у межах платіжної системи.

Щоб забезпечити обізнаність кожного учасника про транзакції, вони повинні бути публічно розкриті. Таким чином, робота Bitcoin заснована на прозорій та розподіленій інфраструктурі, що дозволяє будь-якому оператору вузла перевіряти всю ланцюг електронних підписів та історію кожної монети, починаючи з її створення майнером.

Прозорий та розподілений характер блокчейна Bitcoin означає, що будь-який користувач мережі може слідкувати та аналізувати транзакції всіх інших учасників. Відповідно, анонімність на рівні транзакцій неможлива. Однак анонімність зберігається на рівні ідентифікації особи. На відміну від традиційної банківської системи, де кожен рахунок пов'язаний з особистою ідентичністю, на Bitcoin кошти асоціюються з парами криптографічних ключів, таким чином надаючи користувачам форму псевдонімності за криптографічними ідентифікаторами.

Таким чином, конфіденційність на Bitcoin порушується, коли зовнішні спостерігачі вдаються до асоціації конкретних UTXO з ідентифікованими користувачами. Як тільки ця асоціація встановлена, стає можливим відстежувати їхні транзакції та аналізувати історію їхніх біткойнів. Coinjoin - це саме техніка, розроблена для розриву слідування UTXO, таким чином надаючи певний рівень конфіденційності користувачам Bitcoin на рівні транзакцій.

## Як працює Whirlpool?

Whirlpool виділяється серед інших методів coinjoin за допомогою транзакцій "_ZeroLink_", які забезпечують, що технічно неможливо створити будь-який зв'язок між усіма входами та усіма виходами. Це ідеальне змішування досягається через структуру, де кожен учасник вносить ідентичну суму на вхід (крім комісії за майнінг), таким чином генеруючи виходи абсолютно рівних сум.

Цей обмежувальний підхід до входів надає транзакціям Whirlpool coinjoin унікальну характеристику: повну відсутність детермінованих зв'язків між входами та виходами. Іншими словами, кожен вихід має рівну ймовірність бути приписаним будь-якому учаснику, порівняно з усіма іншими виходами транзакції.
Спочатку кількість учасників у кожному Whirlpool coinjoin була обмежена 5, з 2 новими учасниками та 3 реміксерами (ми пояснимо ці поняття далі). Однак, зростання комісій за транзакції в мережі, спостережене в 2023 році, спонукало команди Samourai переглянути свою модель для покращення конфіденційності, знижуючи при цьому витрати. Таким чином, враховуючи ринкову ситуацію з комісіями та кількість учасників, координатор тепер може організовувати coinjoins, що включають 6, 7 або 8 учасників. Ці покращені сесії називаються "_Surge Cycles_". Важливо зауважити, що незалежно від налаштувань, у транзакціях Whirlpool завжди є лише 2 нових учасника.

Таким чином, транзакції Whirlpool характеризуються ідентичною кількістю входів та виходів, які можуть бути:
- 5 входів та 5 виходів;
![coinjoin](assets/notext/2.webp)
- 6 входів та 6 виходів;
![coinjoin](assets/notext/3.webp)
- 7 входів та 7 виходів;
![coinjoin](assets/notext/4.webp)
- 8 входів та 8 виходів. ![coinjoin](assets/notext/5.webp)
Модель, запропонована Whirlpool, базується на малих транзакціях coinjoin. На відміну від Wasabi та JoinMarket, де міцність анонімних наборів залежить від кількості учасників у одному циклі, Whirlpool робить ставку на ланцюжок декількох малих циклів.

У цій моделі користувач сплачує комісію лише при своєму початковому вході в пул, що дозволяє їм брати участь у безлічі реміксів без додаткових комісій. Нові учасники покривають комісії за майнінг для реміксерів.

З кожним додатковим coinjoin, у якому бере участь монета разом з її минулими партнерами, анонімні набори будуть зростати експоненційно. Таким чином, метою є використання цих безкоштовних реміксів, які з кожним разом сприяють зміцненню щільності анонімних наборів, асоційованих з кожною змішаною монетою.

Whirlpool було розроблено, враховуючи дві важливі вимоги:
- Доступність реалізації на мобільних пристроях, враховуючи, що Samourai Wallet переважно є додатком для смартфонів;
- Швидкість циклів реміксу для сприяння значному збільшенню анонімних наборів.

Ці імперативи керували вибором розробників Samourai Wallet у проектуванні Whirlpool, змусивши їх обмежити кількість учасників на цикл. Занадто мала кількість учасників могла б підірвати ефективність coinjoin, різко зменшивши анонімні набори, створені з кожним циклом, тоді як занадто велика кількість учасників могла б створити проблеми з управлінням на мобільних додатках і перешкоджати потоку циклів.

**Врешті-решт, немає потреби мати велику кількість учасників на кожен coinjoin у Whirlpool, оскільки анонімні набори формуються за рахунок накопичення декількох циклів coinjoin.**
[-> Дізнатися більше про анонімні набори Whirlpool.](https://planb.network/tutorials/privacy/wst-anonsets)
### Пули Coinjoin та комісії
Щоб забезпечити, що кілька циклів ефективно збільшують анонімні набори змішаних монет, має бути встановлено певний регламент для обмеження кількості використовуваних UTXO. Whirlpool визначає різні пули для цієї мети.

Пул представляє групу користувачів, які бажають змішатися разом, які домовляються про кількість UTXO для використання, щоб оптимізувати процес coinjoin. Кожен пул вказує фіксовану суму для UTXO, до якої користувач повинен дотримуватися, щоб брати участь. Таким чином, для виконання coinjoins з Whirlpool, вам потрібно вибрати пул. Наразі доступні такі пули:
- 0.5 біткоїнів;
- 0.05 біткоїна;
- 0.01 біткоїна;
- 0.001 біткоїн (= 100,000 сатоші).

Приєднуючись до пулу зі своїми біткоїнами, вони будуть поділені для генерації UTXO, які є абсолютно однорідними з тими, що у інших учасників пулу. Кожен пул має максимальний ліміт; таким чином, для сум, що перевищують цей ліміт, вам буде змушено або зробити два окремі входи в межах того ж пулу, або перейти до іншого пулу з більшою сумою:

| Пул (біткоїн) | Максимальна сума за вхід (біткоїн) |
|----------------|------------------------------------|
| 0.5            | 35                                 |
| 0.05           | 3.5                                |
| 0.01           | 0.7                                |
| 0.001          | 0.025                              |
Як зазначалося раніше, UTXO вважається належним до пулу, коли воно готове до інтеграції у coinjoin. Однак, це не означає, що користувач втрачає володіння ним. **Пройшовши через різні цикли міксування, ви зберігаєте повний контроль над своїми ключами і, відповідно, своїми біткоїнами.** Ось що відрізняє техніку coinjoin від інших централізованих методів міксування.

Щоб увійти до пулу coinjoin, необхідно сплатити сервісні та майнінгові збори. Сервісні збори фіксовані для кожного пулу і призначені для компенсації командам, відповідальним за розробку та підтримку Whirlpool. Для користувачів Sparrow Wallet ці збори передаються командами Samourai розробникам Sparrow.

Сервісні збори за використання Whirlpool сплачуються один раз при вході до пулу. Після завершення цього кроку у вас є можливість брати участь у необмеженій кількості реміксів без додаткових зборів. Ось поточні фіксовані збори для кожного пулу:

| Пул (біткоїн) | Вступний збір (біткоїн) |
|----------------|-------------------------|
| 0.5            | 0.0175                  |
| 0.05           | 0.00175                 |
| 0.01           | 0.0005 (50,000 сатоші) |
| 0.001          | 0.00005 (5,000 сатоші) |


Ці збори по суті діють як вхідний квиток до обраного пулу, незалежно від суми, яку ви вкладаєте в coinjoin. Таким чином, незалежно від того, чи приєднуєтесь ви до пулу 0.01 з точно 0.01 BTC, чи входите з 0.5 BTC, збори залишаться тими самими в абсолютному значенні.

Перед тим як продовжити з coinjoins, користувач, отже, має вибір між 2 стратегіями:
- Вибрати менший пул, щоб мінімізувати сервісні збори, знаючи, що вони отримають кілька малих UTXO в результаті;
- Або віддати перевагу більшому пулу, погоджуючись сплатити вищі збори, щоб отримати меншу кількість UTXO більшої вартості.

Зазвичай не рекомендується об'єднувати кілька змішаних UTXO після циклів coinjoin, оскільки це може поставити під загрозу здобуту конфіденційність, особливо через Евристику Спільного Володіння Входами (CIOH). Тому, можливо, мудро вибрати більший пул, навіть якщо це означає сплату більше, щоб уникнути наявності занадто багатьох UTXO малої вартості на виході. Користувач має зважити ці компроміси, щоб вибрати пул, який вони вважають за краще.

Крім сервісних зборів, також слід враховувати майнінгові збори, притаманні будь-якій транзакції Bitcoin. Як користувач Whirlpool, вам буде потрібно сплатити майнінгові збори за підготовчу транзакцію (`Tx0`), а також за перший coinjoin. Всі наступні ремікси будуть безкоштовними, завдяки моделі Whirlpool, яка покладається на платежі нових учасників.

Дійсно, у кожному Whirlpool coinjoin два користувачі серед входів є новими учасниками. Інші входи походять від реміксерів. В результаті, майнінгові збори для всіх учасників транзакції покриваються цими двома новими учасниками, які потім також отримують можливість безкоштовних реміксів:
![coinjoin](assets/en/6.webp)
Завдяки цій системі зборів, Whirlpool дійсно відрізняється від інших сервісів coinjoin, оскільки anonsets UTXO не пропорційні до ціни, сплаченої користувачем. Таким чином, можливо досягти значно вищих рівнів анонімності, сплативши лише вступні збори пулу та майнінгові збори за дві транзакції (the `Tx0` та початковий мікс).
Важливо зазначити, що користувач також має покрити комісію за майнінг, щоб вивести свої UTXO з пулу після завершення кількох coinjoin, якщо вони не обрали опцію `mix to`, про яку ми поговоримо в навчальному посібнику нижче.
### Рахунки HD гаманця, які використовуються Whirlpool
Для виконання coinjoin через Whirlpool, гаманець має генерувати кілька окремих рахунків. Рахунок, у контексті HD (Ієрархічно-Детермінованого) гаманця, становить секцію, яка повністю ізольована від інших, ця ізоляція відбувається на третьому рівні глибини ієрархії гаманця, тобто на рівні `xpub`.
HD гаманець теоретично може похіднити до `2^(32/2)` різних рахунків. Початковий рахунок, який використовується за замовчуванням у всіх гаманцях Bitcoin, відповідає індексу `0'`.

Для гаманців, адаптованих до Whirlpool, таких як Samourai або Sparrow, використовуються 4 рахунки для задоволення потреб процесу coinjoin:
- Рахунок **депозиту**, ідентифікований індексом `0'`;
- Рахунок **поганого банку** (або "doxxic change"), ідентифікований індексом `2 147 483 644'`;
- Рахунок **преміксу**, ідентифікований індексом `2 147 483 645'`;
- Рахунок **постміксу**, ідентифікований індексом `2 147 483 646'`.

Кожен з цих рахунків виконує певну функцію в межах coinjoin.

Всі ці рахунки пов'язані з одним seed, що дозволяє користувачу відновити доступ до всіх своїх біткойнів, використовуючи свою фразу відновлення і, за потреби, свій пароль. Однак, під час цієї операції відновлення, необхідно вказати програмному забезпеченню різні індекси рахунків, які були використані.

Тепер давайте розглянемо різні етапи coinjoin Whirlpool в межах цих рахунків.

### Різні етапи coinjoin на Whirlpool
**Етап 1: Tx0**
Вихідний пункт будь-якого coinjoin Whirlpool - це рахунок **депозиту**. Цей рахунок ви автоматично використовуєте, коли створюєте новий гаманець Bitcoin. На цей рахунок мають бути зараховані біткойни, які ви хочете змішати.

`Tx0` представляє перший етап процесу міксування Whirlpool. Його мета - підготувати та вирівняти UTXO для coinjoin, розділивши їх на одиниці, що відповідають сумі обраного пулу, для забезпечення однорідності міксування. Вирівняні UTXO потім надсилаються на рахунок **преміксу**. Що стосується різниці, яка не може увійти в пул, вона відокремлюється на специфічний рахунок: **поганий банк** (або "doxxic change").

Ця початкова транзакція `Tx0` також служить для врегулювання сервісних зборів, що належать координатору міксу. На відміну від наступних етапів, ця транзакція не є спільною; користувач, отже, повинен взяти на себе повні комісії за майнінг:
![coinjoin](assets/en/7.webp)
У цьому прикладі транзакції `Tx0`, вхід у `372,000 сатоші` з нашого рахунку **депозиту** ділиться на кілька вихідних UTXO, які розподіляються наступним чином:
- Сума `5,000 сатоші` призначена для координатора за сервісні збори, що відповідає входу в пул `100,000 сатоші`;
- Три UTXO, підготовлені для міксування, перенаправлені на наш рахунок **преміксу** і зареєстровані у координатора. Ці UTXO вирівнюються по `108,000 сатоші` кожен, щоб покрити комісії за майнінг для їх майбутнього початкового міксу;
- Надлишок, який не може потрапити до пулу, оскільки він занадто малий, вважається токсичною зміною. Він відправляється на його специфічний рахунок. Тут ця зміна становить `40,000 сатоші`;
- Нарешті, є `3,000 сатоші`, які не є виходом, але є комісією за майнінг, необхідною для підтвердження `Tx0`.

Наприклад, ось реальний Tx0 Whirlpool (який не від мене): [edef60744f539483d868caff49d4848e5cc6e805d6cdc8d0f9bdbbaedcb5fc46](https://mempool.space/en/tx/edef60744f539483d868caff49d4848e5cc6e805d6cdc8d0f9bdbbaedcb5fc46)

**Крок 2: Токсична Зміна**
Надлишок, який не зміг інтегруватися до пулу, тут еквівалентний `40,000 сатоші`, перенаправляється на рахунок **поганого банку**, також згадуваний як "токсична зміна", щоб забезпечити строге відділення від інших UTXO в гаманці.

Цей UTXO є небезпечним для приватності користувача, оскільки не тільки завжди пов'язаний зі своїм минулим, і тому можливо з ідентичністю його власника, але, крім того, він відзначений як належний користувачу, який виконав coinjoin.

Якщо цей UTXO буде об'єднаний з перемішаними виходами, останні втратять усю приватність, отриману під час циклів coinjoin, зокрема через CIOH (*Common-Input-Ownership-Heuristic*). Якщо він буде об'єднаний з іншими токсичними змінами, користувач ризикує втратити приватність, оскільки це пов'яже різні входи циклів coinjoin. Тому з ним потрібно поводитися обережно. Спосіб управління цим токсичним UTXO буде детально описано в останній частині цієї статті, а майбутні навчальні посібники більш глибоко розглянуть ці методи на мережі PlanB.

**Крок 3: Початкове Змішування**
Після завершення `Tx0`, урівняні UTXO відправляються на рахунок **преміксу** нашого гаманця, готові до введення у їх перший цикл coinjoin, також називаний "початковим змішуванням". Якщо, як у нашому прикладі, `Tx0` генерує кілька UTXO, призначених для змішування, кожен з них буде інтегрований у окремий початковий coinjoin.
На кінці цих початкових змішувань рахунок **преміксу** буде порожнім, тоді як наші монети, сплативши комісію за майнінг за цей перший coinjoin, будуть точно відрегульовані до суми, визначеної обраним пулом. У нашому прикладі, наші початкові UTXO `108 000 сатоші` будуть зменшені до точно `100 000 сатоші`.
![coinjoin](assets/en/8.webp)
**Крок 4: Ремікси**
Після початкового змішування UTXO переводяться на рахунок **постміксу**. Цей рахунок збирає вже змішані UTXO та ті, що чекають на ремікс. Коли клієнт Whirlpool активний, UTXO, розташовані на рахунку **постміксу**, автоматично доступні для реміксу і будуть випадково обрані для участі в цих нових циклах.

Нагадуємо, ремікси потім є абсолютно безкоштовними: не потрібно додаткових сервісних зборів або комісій за майнінг. Зберігання UTXO на рахунку **постміксу** таким чином зберігає їхню цінність незмінною, і в той же час покращує їхні анонімні набори. Тому важливо дозволити цим монетам брати участь у кількох циклах coinjoin. Це абсолютно нічого вас не коштує, і це збільшує їх рівні анонімності.
Коли ви вирішуєте витратити змішані UTXO, ви можете зробити це безпосередньо з цього **постмікс** рахунку. Рекомендується зберігати змішані UTXO на цьому рахунку, щоб скористатися безкоштовними реміксами та запобігти їх виходу з циклу Whirlpool, що могло б зменшити їхню конфіденційність.
Як ми побачимо в наступному навчальному посібнику, існує також опція `mix to`, яка пропонує можливість автоматично надсилати ваші змішані монети до іншого гаманця, наприклад, холодного гаманця, після визначеної кількості coinjoins.

Після обговорення теорії, давайте перейдемо до практики з навчальним посібником з використання Whirlpool через настільне програмне забезпечення Sparrow Wallet!

## Навчальний посібник: Coinjoin Whirlpool на Sparrow Wallet
Існує безліч опцій для використання Whirlpool. Першою, яку я хочу вам представити, є опція Sparrow Wallet, програмне забезпечення для управління гаманцем Bitcoin з відкритим вихідним кодом для ПК.
Використання Sparrow має перевагу в тому, що з ним досить легко розпочати роботу, швидко налаштувати, і для цього потрібно лише комп'ютер та інтернет-з'єднання. Однак, існує значний недолік: coinjoins відбуватимуться лише тоді, коли Sparrow запущено та підключено. Це означає, що якщо ви хочете змішувати та реміксувати свої біткойни 24/7, вам потрібно буде постійно тримати свій комп'ютер увімкненим.

### Встановлення Sparrow Wallet
Для початку, вам, звичайно, знадобиться програмне забезпечення Sparrow Wallet. Ви можете безпосередньо завантажити його з [офіційного сайту](https://sparrowwallet.com/download/) або на [їх GitHub](https://github.com/sparrowwallet/sparrow/releases).

Перед встановленням програмного забезпечення буде важливо перевірити підпис та цілісність завантаженого виконуваного файлу. Якщо ви хочете дізнатися більше про процес встановлення та перевірки програмного забезпечення Sparrow, я раджу вам прочитати цей інший навчальний посібник: *[The Sparrow Wallet Guides](https://planb.network/tutorials/wallet/sparrow)*

### Створення програмного гаманця
Після встановлення програмного забезпечення вам потрібно буде приступити до створення гаманця Bitcoin. Важливо зазначити, що для участі в coinjoins використання програмного гаманця (також званого "гарячим гаманцем") є обов'язковим. Тому **виконання coinjoins з гаманцем, захищеним апаратним гаманцем, буде неможливим**.

Хоча це не є обов'язковим, у випадку, якщо ви плануєте змішувати значні суми, настійно рекомендується вибрати використання сильної BIP39 парольної фрази для цього гаманця.

Щоб створити новий гаманець, відкрийте Sparrow, потім натисніть на вкладку `File` та `New Wallet`.

![sparrow](assets/notext/9.webp)

Виберіть назву для цього гаманця, наприклад: "Coinjoin Wallet". Натисніть на кнопку `Create Wallet`.

![sparrow](assets/notext/10.webp)

Залиште налаштування за замовчуванням, потім натисніть на кнопку `New or Imported Software Wallet`.

![sparrow](assets/notext/11.webp)

Коли ви отримаєте доступ до вікна створення гаманця, я рекомендую вибрати послідовність з 12 слів, оскільки це цілком достатньо. Виберіть `Generate New`, щоб згенерувати нову фразу відновлення, і натисніть на `Use Passphrase`, якщо ви хочете додати BIP39 парольну фразу. Важливо зробити фізичний бекап вашої інформації для відновлення, чи то на папері, чи на металевій основі, щоб забезпечити безпеку ваших біткойнів.

![sparrow](assets/notext/12.webp)
Переконайтеся в правильності вашого бекапу фрази відновлення перед тим, як натиснути на `Confirm Backup...`. Sparrow потім попросить вас ввести вашу фразу знову, щоб перевірити, що ви її записали. Після завершення цього кроку продовжуйте, натиснувши на `Create Keystore`.
![sparrow](assets/notext/13.webp)
Залиште запропонований шлях похідної як за замовчуванням і натисніть `Import Keystore`. У моєму прикладі шлях похідної відрізняється трохи, оскільки я використовую Testnet для цього навчального посібника. Шлях похідної, який має з'явитися у вас, наступний:
```plaintext
m/84'/0'/0'
```

![sparrow](assets/notext/14.webp)

Після цього Sparrow покаже деталі похідної вашого нового гаманця. У випадку, якщо ви встановили парольну фразу, настійно рекомендується занотувати ваш `Master fingerprint`. Хоча цей відбиток майстер-ключа не є конфіденційними даними, він буде корисним для вас, щоб пізніше перевірити, що ви дійсно отримуєте доступ до правильного гаманця, та підтвердити відсутність помилок при введенні вашої парольної фрази.

Натисніть кнопку `Apply`.

![sparrow](assets/notext/15.webp)

Sparrow пропонує створити пароль для вашого гаманця. Цей пароль буде потрібен для доступу до нього через програмне забезпечення Sparrow Wallet. Виберіть надійний пароль, зробіть його резервну копію, а потім натисніть на `Set Password`.

![sparrow](assets/notext/16.webp)

### Отримання біткойнів
Після створення вашого гаманця, спочатку у вас буде один рахунок з індексом `0'`. Це **депозитний** рахунок, про який ми говорили в попередніх частинах. Це рахунок, на який вам потрібно буде надіслати біткойни для міксування.

Для цього виберіть вкладку `Receive` з лівого боку вікна. Sparrow автоматично згенерує нову порожню адресу для отримання біткойнів.

![sparrow](assets/notext/17.webp)

Ви можете ввести мітку для цієї адреси, а потім надіслати на неї біткойни для міксування.

![sparrow](assets/notext/18.webp)

### Створення Tx0
Після підтвердження вашої транзакції, ви можете перейти до вкладки `UTXOs`.

![sparrow](assets/notext/19.webp)

Далі виберіть UTXO(s), які ви хочете подати на цикли coinjoin. Для вибору декількох UTXO одночасно, утримуйте натиснутою клавішу `Ctrl` під час натискання на UTXO вашого вибору.

![sparrow](assets/notext/20.webp)

Потім натисніть кнопку `Mix Selected` внизу вікна. Якщо ця кнопка не з'являється у вашому інтерфейсі, це тому, що ви використовуєте гаманець, захищений апаратним гаманцем. Вам потрібно використовувати програмний гаманець для виконання coinjoins з Sparrow.
![sparrow](assets/notext/21.webp)
Відкривається вікно, що пояснює, як працює Whirlpool. Це спрощення того, що я пояснив у попередніх частинах. Натисніть `Next`, щоб продовжити.

![sparrow](assets/notext/22.webp)

На наступній сторінці ви можете ввести "SCODE", якщо у вас є такий. SCODE - це промокод, який пропонує знижку на сервісні збори басейну. Samourai Wallet час від часу надає такі коди своїм користувачам під час спеціальних подій. Я раджу вам [слідкувати за Samourai Wallet](https://twitter.com/SamouraiWallet) у соціальних мережах, щоб не пропустити майбутні SCODES.
На цій же сторінці вам також потрібно буде встановити ставку комісії для `Tx0` та вашого початкового міксу. Цей вибір вплине на швидкість підтвердження вашої підготовчої транзакції та вашого першого койнджойну. Пам'ятайте, що ви несете відповідальність за комісії майнерів за `Tx0` та початковий мікс, але вам не доведеться платити комісії майнерів за наступні ремікси. Налаштуйте слайдер `Premix Priority` згідно з вашими перевагами, потім натисніть на `Next`.
![sparrow](assets/notext/23.webp)

У цьому новому вікні у вас буде можливість вибрати пул, до якого ви хочете увійти, використовуючи випадаючий список. У моєму випадку, спочатку вибравши UTXO `456 214 sats`, мій єдиний можливий вибір - це пул `100 000 sats`. Цей інтерфейс також інформує вас про сервісні комісії, які потрібно буде сплатити, а також про кількість UTXO, які будуть інтегровані в пул. Якщо умови здаються вам задовільними, продовжуйте, натиснувши на `Preview Premix`.

![sparrow](assets/notext/24.webp)

Після цього кроку Sparrow попросить вас ввести пароль до вашого гаманця, який ви встановили при його створенні в програмі. Після введення пароля ви отримаєте доступ до попереднього перегляду вашого `Tx0`. З лівого боку вашого вікна ви побачите, що Sparrow створив різні акаунти, необхідні для використання Whirlpool (`Deposit`, `Premix`, `Postmix` та `Badbank`). Ви також матимете можливість переглянути структуру вашого `Tx0`, з різними виходами:
- Сервісні комісії;
- Уніфіковані UTXO, призначені для входу в пул;
- Токсична здача (Doxxic Change).

![sparrow](assets/notext/25.webp)

Якщо транзакція вам до вподоби, натисніть на `Broadcast Transaction`, щоб транслювати ваш `Tx0`. В іншому випадку, у вас є можливість налаштувати параметри цього `Tx0`, вибравши `Clear`, щоб стерти введені дані та почати процес створення заново.

### Виконання Coinjoins
Після трансляції Tx0 ви знайдете ваші UTXO, готові до міксування, в акаунті `Premix`.
![sparrow](assets/notext/26.webp)

Після підтвердження `Tx0` ваші UTXO будуть зареєстровані у координатора, і початкові мікси автоматично почнуться один за одним.

![sparrow](assets/notext/27.webp)

Перевіряючи акаунт `Postmix`, ви спостерігатимете UTXO, отримані з початкових міксів. Ці монети залишатимуться готовими до наступних реміксів, за які не буде стягуватися додаткових комісій.

![sparrow](assets/notext/28.webp)

У колонці `Mixes` можна побачити кількість койнджойнів, виконаних кожною з ваших монет. Як ми побачимо в наступних розділах, справжнє значення має не стільки кількість реміксів сама по собі, скільки асоційовані анонсети, хоча ці два показники частково пов'язані.

![sparrow](assets/notext/29.webp)

Щоб тимчасово зупинити койнджойни, просто натисніть на `Stop Mixing`. Ви матимете можливість в будь-який час відновити операції, вибравши `Start Mixing`.

![sparrow](assets/notext/30.webp)
Щоб забезпечити безперервну доступність ваших UTXO для реміксу, необхідно тримати програмне забезпечення Sparrow активним. Закриття програми або вимкнення комп'ютера призупинить процеси coinjoin. Рішенням для обходу цієї проблеми є відключення функцій сну через налаштування операційної системи. Крім того, Sparrow пропонує опцію, що запобігає автоматичному переходу комп'ютера в режим сну, яку ви можете знайти в закладці `Інструменти` під назвою `Запобігти сну комп'ютера`.
![sparrow](assets/notext/31.webp)

### Завершення процесів coinjoin
Щоб витратити ваші змішані біткойни, у вас є кілька варіантів. Найпряміший метод - це доступ до облікового запису `Postmix` та вибір вкладки `Відправити`.

![sparrow](assets/notext/32.webp)

У цьому розділі у вас буде можливість ввести адресу отримувача, суму для відправлення та комісію за транзакцію, так само, як і для будь-якої іншої транзакції, здійсненої за допомогою Sparrow Wallet. Якщо бажаєте, ви також можете скористатися додатковими функціями конфіденційності, такими як Stonewall, натиснувши на кнопку `Конфіденційність`.

![sparrow](assets/notext/33.webp)

[-> Дізнатися більше про транзакції Stonewall.](https://planb.network/tutorials/privacy/stonewall)

Якщо ви хочете зробити більш точний вибір монет для витрати, перейдіть на вкладку `UTXO`. Виберіть UTXO, які ви конкретно хочете використати, потім натисніть кнопку `Відправити вибрані`, щоб ініціювати транзакцію.

![sparrow](assets/notext/34.webp)
Нарешті, опція `Перемішати до...`, доступна в Sparrow, дозволяє автоматично вилучати обрані UTXO з циклів coinjoin без додаткових комісій. Ця функція дозволяє визначити кількість реміксів, після яких UTXO не буде реінтегровано до вашого облікового запису `Postmix`, а замість цього буде безпосередньо переведено до іншого гаманця. Ця опція часто використовується для автоматичної відправки змішаних біткойнів до холодного гаманця.
Щоб скористатися цією опцією, спочатку відкрийте гаманець отримувача поруч з вашим гаманцем coinjoin у програмному забезпеченні Sparrow.

![sparrow](assets/notext/35.webp)

Потім перейдіть на вкладку `UTXO`, потім натисніть на кнопку `Перемішати до...` внизу вікна.

![sparrow](assets/notext/36.webp)

Вікно відкриється, спочатку виберіть гаманець отримувача зі спадного списку.

![sparrow](assets/notext/37.webp)

Виберіть поріг coinjoin, після якого виведення буде здійснено автоматично. Я не можу дати вам точну кількість реміксів для виконання, оскільки це залежить від вашої особистої ситуації та цілей конфіденційності, але уникайте вибору занадто низького порогу. Я рекомендую проконсультуватися з цією іншою статтею, щоб дізнатися більше про процес реміксу: [REMIX - WHIRLPOOL](https://planb.network/tutorials/privacy/remix-whirlpool)

Ви можете залишити опцію `Діапазон індексів` на її значенні за замовчуванням, `Повний`. Ця функція дозволяє змішувати одночасно з різних клієнтів, але це не те, що ми хочемо робити в цьому навчальному посібнику. Щоб завершити та активувати опцію `Перемішати до...`, натисніть `Перезапустити Whirlpool`.

![sparrow](assets/notext/38.webp)

Однак будьте обережні при використанні опції `Перемішати до`, оскільки вилучення змішаних монет з вашого облікового запису `Postmix` може значно збільшити ризик компрометації вашої конфіденційності. Причини цього потенціалу детально описані в наступних розділах.

## Як дізнатися якість наших циклів coinjoin?
Для того, щоб coinjoin був справді ефективним, важливо, щоб він забезпечував гарну однорідність між сумами вхідних і вихідних коштів. Ця уніформність збільшує кількість можливих інтерпретацій в очах зовнішнього спостерігача, тим самим збільшуючи невизначеність навколо транзакції. Для кількісної оцінки цієї невизначеності, створеної coinjoin, можна вдатися до розрахунку ентропії транзакції. Для глибокого вивчення цих індикаторів, я запрошую вас ознайомитися з навчальним посібником: [BOLTZMANN CALCULATOR](https://planb.network/en/tutorials/privacy/boltzmann-entropy). Модель Whirlpool визнана тією, що забезпечує найбільшу однорідність у coinjoins. Далі, ефективність кількох циклів coinjoin оцінюється на основі розміру груп, в яких приховано монету. Розмір цих груп визначає те, що називається anonsets. Існує два типи anonsets: перший оцінює конфіденційність, отриману проти ретроспективного аналізу (від теперішнього до минулого) і другий, проти перспективного аналізу (від минулого до теперішнього). Для детального пояснення цих двох індикаторів, я запрошую вас ознайомитися з навчальним посібником: [WHIRLPOOL STATS TOOLS - ANONSETS](https://planb.network/tutorials/privacy/wst-anonsets)

## Як керувати postmix?
Після виконання циклів coinjoin, найкраща стратегія - зберігати ваші UTXO на рахунку **postmix**, чекаючи їх майбутнього використання. Навіть рекомендується дозволити їм реміксуватися нескінченно, поки вам не потрібно буде їх витратити.

Деякі користувачі можуть розглядати можливість переказу своїх змішаних біткойнів на гаманець, захищений апаратним гаманцем. Це можливо, але важливо ретельно дотримуватися рекомендацій Samourai Wallet, щоб не поставити під загрозу отриману конфіденційність.

Об'єднання UTXO є найчастіше зробленою помилкою. Необхідно уникати комбінування змішаних UTXO з незмішаними UTXO в одній транзакції, щоб уникнути CIOH (*Common-Input-Ownership-Heuristic*). Це вимагає ретельного управління вашими UTXO у вашому гаманці, особливо з точки зору маркування. Понад coinjoin, об'єднання UTXO зазвичай є поганою практикою, яка часто призводить до втрати конфіденційності, якщо не керувати належним чином.

Також важливо бути обережними з консолідацією змішаних UTXO між собою. Помірні консолідації можливі, якщо ваші змішані UTXO мають значні anonsets, але це неминуче зменшить конфіденційність ваших монет. Переконайтеся, що консолідації не занадто великі та не проводяться після недостатньої кількості реміксів, оскільки це ризикує створити виводимі зв'язки між вашими UTXO до і після циклів coinjoin. У разі сумнівів щодо цих маніпуляцій, найкращою практикою є не консолідувати postmix UTXO, а переказувати їх по одному в ваш апаратний гаманець, генеруючи нову порожню адресу кожного разу. Знову ж таки, пам'ятайте належно маркувати кожен отриманий UTXO.
Також не рекомендується переказувати ваші postmix UTXO на гаманець, який використовує незвичайні скрипти. Наприклад, якщо ви входите в Whirlpool з мультісіг-гаманцем, який використовує скрипти `P2WSH`, малоймовірно, що ви будете змішані з іншими користувачами, які спочатку мали такий самий тип гаманця. Якщо ви виведете ваш postmix на цей самий мультісіг-гаманець, рівень конфіденційності вашого змішаного біткойна буде значно знижений. Понад скрипти, існує багато інших відбитків гаманців, які можуть вас обдурити.
Як і в будь-якій біткойн-транзакції, також важливо не повторно використовувати адреси отримання. Кожна нова транзакція повинна отримуватися на нову, порожню адресу.
Найпростішим і найбезпечнішим рішенням є залишити ваші змішані UTXO в їхньому **постмікс** рахунку, дозволяючи їм знову змішуватися і торкатися їх лише для витрат. Гаманці Samourai та Sparrow мають додаткові захисти проти всіх цих ризиків, пов'язаних з аналізом ланцюгів. Ці захисти допомагають вам уникати помилок.
## Як управляти доксичною зміною?
Далі, вам потрібно бути обережними при управлінні доксичною зміною, зміною, яка не могла увійти в пул coinjoin. Ці токсичні UTXO, що виникають в результаті використання Whirlpool, становлять ризик для вашої конфіденційності, оскільки вони створюють зв'язок між вами та використанням coinjoin. Тому вкрай важливо обережно з ними поводитися і не поєднувати їх з іншими UTXO, особливо змішаними UTXO. Ось різні стратегії, які варто розглянути для їх використання:
- **Змішайте їх у менших пулах:** Якщо ваш токсичний UTXO достатньо значний, щоб увійти в менший пул самостійно, розгляньте можливість його змішування. Це часто є найкращим варіантом. Однак, критично важливо не об'єднувати кілька токсичних UTXO для доступу до пулу, оскільки це може пов'язати ваші різні входи;
- **Позначте їх як "невитрачені":** Інший підхід полягає в тому, щоб більше їх не використовувати, позначити їх як "невитрачені" на їхньому призначеному рахунку і просто Hodl. Це забезпечує, що ви випадково не витратите їх. Якщо вартість біткоїна зросте, можуть з'явитися нові пули, більш підходящі для ваших токсичних UTXO;
- **Робіть пожертви:** Розгляньте можливість робити пожертви, навіть скромні, розробникам, які працюють над Bitcoin та його супутнім програмним забезпеченням. Ви також можете пожертвувати організаціям, які приймають BTC. Якщо управління вашими токсичними UTXO здається занадто складним, ви можете просто позбутися їх, зробивши пожертву;
- **Купуйте подарункові картки:** Платформи, такі як [Bitrefill](https://www.bitrefill.com/), дозволяють вам обмінювати біткоїни на подарункові картки, які можна використовувати в різних торгових точках. Це може бути спосіб позбутися ваших токсичних UTXO без втрати асоційованої вартості.
- **Консолідуйте їх на Monero:** Гаманець Samourai тепер пропонує сервіс атомарного свопу між BTC та XMR. Це ідеально для управління токсичними UTXO, консолідуючи їх на Monero, не компрометуючи вашу конфіденційність через CIOH, перш ніж відправляти їх назад до Bitcoin. Однак, цей варіант може бути дорогим з точки зору комісій за майнінг та премії через обмеження ліквідності.
- **Відправте їх до Lightning Network:** Передача цих UTXO до Lightning Network для використання знижених комісій за транзакції є варіантом, який може бути цікавим. Однак, цей метод може розкрити певну інформацію залежно від вашого використання Lightning і тому має бути практикований з обережністю.

Детальні навчальні посібники з реалізації цих різних технік будуть незабаром запропоновані на PlanB Network.

**Додаткові ресурси:**
[Sparrow Wallet Відео Навчальний Посібник](https://planb.network/tutorials/wallet/sparrow)
[Samourai Wallet Відео Навчальний Посібник](https://planb.network/tutorials/wallet/samourai)
- [Документація Samourai Wallet - Whirlpool](https://docs.samourai.io/whirlpool/basic-concepts);
- [Твіттер Тред про CoinJoins](https://twitter.com/SamouraiWallet/status/1489220847336308739);
- [Блог Пост про CoinJoins](https://www.pandul.fr/post/comprendre-et-utiliser-le-coinjoin-sur-bitcoin).