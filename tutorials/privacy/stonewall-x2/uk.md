---
name: Stonewall x2
description: Розуміння та використання транзакцій Stonewall x2
---
![обкладинка stonewall x2](assets/cover.webp)

***УВАГА:** Після арешту засновників Samourai Wallet та конфіскації їх серверів 24 квітня, транзакції Stonewallx2 функціонують лише шляхом ручного обміну PSBT між зацікавленими сторонами, за умови, що обидва користувачі підключені до власного Dojo. Однак, існує можливість, що ці інструменти можуть бути відновлені в найближчі тижні. Тим часом, ви все ще можете ознайомитися з цією статтею, щоб зрозуміти теоретичні аспекти роботи Stonewallx2 та дізнатися, як їх виконувати вручну.*

_Якщо ви розглядаєте можливість виконання Stonewallx2 вручну, процедура дуже схожа на описану в цьому навчальному посібнику. Основна відмінність полягає у виборі типу транзакції Stonewallx2: замість вибору `Online`, натисніть на `In Person / Manual`. Потім вам потрібно буде вручну обмінятися PSBT для створення транзакції Stonewallx2. Якщо ви фізично поруч зі своїм співробітником, ви можете послідовно сканувати QR-коди. Якщо ви знаходитесь на відстані, файли JSON можна обміняти через захищений канал зв'язку. Решта навчального посібника залишається незмінною._

_Ми уважно стежимо за розвитком цієї справи, а також за розвитком пов'язаних інструментів. Будьте впевнені, що ми оновимо цей навчальний посібник, як тільки з'явиться нова інформація._

_Цей навчальний посібник надається лише для освітніх та інформаційних цілей. Ми не підтримуємо або заохочуємо використання цих інструментів для злочинних цілей. Кожен користувач несе відповідальність за дотримання законів у своїй юрисдикції._

---

> *Робіть кожен витрату як coinjoin.*

## Що таке транзакція Stonewall x2?

Stonewall x2 - це специфічна форма транзакції Bitcoin, спрямована на збільшення конфіденційності користувача під час витрати, шляхом співпраці з третьою стороною, яка не бере участі у цій витраті. Цей метод імітує міні-coinjoin між двома учасниками, одночасно здійснюючи платіж третій стороні. Транзакції Stonewall x2 доступні як у додатку Samourai Wallet, так і в програмному забезпеченні Sparrow Wallet. Обидва є взаємосумісними.

Її робота відносно проста: ми використовуємо UTXO у нашому володінні для здійснення платежу та звертаємося за допомогою до третьої сторони, яка також вносить UTXO власного. Транзакція має чотири виходи: два з них однакових сум, один призначений для адреси отримувача платежу, інший - для адреси співробітника. Третій UTXO повертається на іншу адресу співробітника, дозволяючи йому отримати початкову суму (нейтральна дія для нього, за винятком комісії за майнінг), і останній UTXO повертається на адресу, що належить нам, що становить решту з платежу.

Таким чином, у транзакціях Stonewall x2 визначаються три різні ролі:
- Відправник, який здійснює фактичний платіж;
- Співробітник, який надає біткойни для покращення загальної анонімності транзакції, при цьому повністю відновлюючи свої кошти в кінці (нейтральна дія для нього, за винятком комісії за майнінг);
- Отримувач, який може не знати про специфіку транзакції та просто очікує платіж від відправника.

Давайте розглянемо приклад для кращого розуміння. Аліса знаходиться в булочній, щоб купити свою багету, яка коштує `4,000 сатоші`. Вона хоче заплатити біткойнами, зберігаючи певний рівень конфіденційності свого платежу. Тому вона звертається до свого друга Боба, який допоможе їй у цьому процесі.
![схема stonewall x2](assets/en/1.webp)
Аналізуючи цю транзакцію, ми можемо побачити, що пекар дійсно отримав `4,000 сатоші` як оплату за багет. Аліса використала `10,000 сатоші` як вхід і отримала `6,000 сатоші` на виході, що призвело до чистого балансу `-4,000 сатоші`, що відповідає ціні багета. Що стосується Боба, він надав `15,000 сатоші` на вхід і отримав два виходи: один `4,000 сатоші` та інший `11,000 сатоші`, що призвело до балансу `0`. У цьому прикладі я навмисно не врахував комісію за майнінг, щоб полегшити розуміння. Насправді, комісія за транзакцію ділиться порівну між відправником платежу та співпрацівником.

## Яка різниця між Stonewall та Stonewall x2?

Транзакція StonewallX2 працює точно так само, як транзакція Stonewall, за винятком того, що перша є колаборативною, тоді як друга - ні. Як ми бачили, транзакція Stonewall x2 передбачає участь третьої сторони, яка не бере участі у платежі, і яка надасть свої біткоїни для підвищення приватності транзакції. У типовій транзакції Stonewall роль співпрацівника виконує відправник.

Давайте повернемося до нашого прикладу з Алісою в пекарні. Якби вона не змогла знайти когось на кшталт Боба, щоб супроводжувати її у її витратах, вона могла б здійснити транзакцію Stonewall самостійно. Таким чином, обидва вхідні UTXO були б її, і вона отримала б 3 на виході.
![транзакція stonewall](assets/en/2.webp)

З зовнішньої точки зору, схема транзакції залишилася б тією ж.
![Stonewall чи Stonewall x2?](assets/en/5.webp)
Отже, логіка повинна бути такою при використанні інструменту витрат Samourai:
- Якщо торговець не підтримує Payjoin Stowaway, колаборативну транзакцію можна здійснити з іншою особою, яка не бере участі у платежі, використовуючи Stonewall x2.
- Якщо нікого не знайдено для здійснення транзакції Stonewall x2, можна здійснити транзакцію Stonewall самостійно, імітуючи поведінку транзакції Stonewall x2.
- Нарешті, останнім варіантом було б зробити транзакцію з JoinBot, сервером, який підтримується Samourai, який може, за запитом, виступати як співпрацівник у транзакції Stonewall x2.

Якщо ви хочете знайти співпрацівника, який готовий допомогти вам у транзакції Stonewall X2, ви також можете відвідати цю групу Telegram (неофіційну), підтримувану користувачами Samourai для з'єднання відправників та співпрацівників: [Make Every Spend a Coinjoin](https://t.me/EverySpendACoinjoin).

[**-> Дізнатися більше про транзакції Stonewall**](https://planb.network/tutorials/privacy/stonewall)

## Яка мета транзакції Stonewall x2?

Структура Stonewall x2 додає значну кількість ентропії до транзакції та заплутує аналіз ланцюга. Ззовні таку транзакцію можна інтерпретувати як маленький Coinjoin між двома особами. Але насправді це платіж. Цей метод генерує невизначеності в аналізі ланцюга, і навіть призводить до помилкових слідів.

Повернемося до прикладу з Алісою, Бобом та Пекарем. Транзакція в блокчейні виглядала б так:
![stonewall x2 public](assets/en/3.webp)
Зовнішній спостерігач, який покладається на загальноприйняті евристики аналізу ланцюгів, може помилково зробити висновок, що "Аліса та Боб виконали невеликий coinjoin, з одним UTXO кожен на вхід і двома UTXO кожен на вихід."![misinterpretation stonewall x2](assets/en/4.webp)Ця інтерпретація невірна, оскільки, як ви знаєте, UTXO було відправлено Пекарю, Аліса має лише один вихідний залишок, а Боб має два.
![transaction stonewall x2](assets/en/1.webp)
Навіть якщо зовнішній спостерігач зможе ідентифікувати шаблон транзакції Stonewall x2, він не матиме всієї інформації. Він не зможе визначити, який з двох UTXO однакових сум відповідає платежу. Більше того, він не зможе дізнатися, чи це Аліса чи Боб здійснили платіж. Нарешті, він не зможе визначити, чи два вхідних UTXO походять від двох різних осіб, чи вони належать одній особі, яка їх об'єднала. Останній пункт пов'язаний з тим, що класичні транзакції Stonewall, про які ми говорили вище, слідують точно такому ж шаблону, як і транзакції Stonewall x2. Ззовні і без додаткової інформації про контекст неможливо відрізнити транзакцію Stonewall від транзакції Stonewall x2. Однак, перші не є колаборативними транзакціями, тоді як останні є. Це додає ще більше сумнівів щодо цього витрату.
![Stonewall чи Stonewall x2 ?](assets/en/5.webp)

## Як встановити зв'язок між Paynyms, щоб мати можливість співпрацювати через Soroban?

Як і в інших колаборативних транзакціях на Samourai (*Cahoots*), виконання Stonewall x2 передбачає обмін частково підписаними транзакціями між відправником та співпрацівником. Цей обмін може бути здійснений вручну, якщо ви фізично знаходитесь зі своїм співпрацівником, або автоматично через протокол комунікації Soroban.

Якщо ви обираєте другий варіант, вам потрібно буде встановити зв'язок між Paynyms, перш ніж зможете виконати Stonewall x2. Для цього ваш Paynym має "слідувати" за Paynym вашого співпрацівника, і навпаки.

**Доступ до Paynym співпрацівника:**

Для початку необхідно отримати платіжний код Paynym вашого співпрацівника. У додатку Samourai Wallet ваш співпрацівник має натиснути на іконку свого Paynym (маленького робота), розташовану в лівому верхньому куті екрана, потім натиснути на прізвисько свого Paynym, що починається з `+...`. Наприклад, моє `+namelessmode0aF`.

![samourai paynym](assets/notext/6.webp)
Якщо ваш співпрацівник користується Sparrow Wallet, він повинен натиснути на вкладку 'Tools', а потім на 'Show PayNym'.![paynym sparrow](assets/notext/7.webp)
**Слідування за PayNym співпрацівника з Samourai Wallet:**

Якщо ви користуєтесь Samourai Wallet, запустіть додаток і отримайте доступ до меню 'PayNyms' таким же чином. Якщо ви використовуєте свій PayNym вперше, вам потрібно буде отримати його ідентифікатор.

![request paynym samourai](assets/notext/8.webp)

Потім натисніть на синій '+' в правому нижньому куті екрана.
![add collaborator paynym](assets/notext/9.webp)
Після цього ви можете вставити платіжний код вашого співпрацівника, обравши 'PASTE PAYMENT CODE', або відкрити камеру для сканування їх QR-коду, натиснувши 'SCAN QR CODE'.
![вставте ідентифікатор paynym](assets/notext/10.webp)
Натисніть кнопку 'FOLLOW'.
![слідкуйте за paynym](assets/notext/11.webp)
Підтвердіть, натиснувши 'YES'.
![підтвердіть слідкування за paynym](assets/notext/12.webp)
Після цього програмне забезпечення запропонує вам кнопку 'CONNECT'. Натискати на цю кнопку для нашого навчального посібника не потрібно. Цей крок необхідний лише у випадку, якщо ви плануєте здійснювати платежі іншому PayNym у рамках BIP47, що не стосується нашого навчального посібника.
![з'єднайтеся з paynym](assets/notext/13.webp)
Як тільки ваш PayNym почне слідкувати за PayNym вашого співробітника, повторіть цей процес у зворотному напрямку, щоб ваш співробітник також міг слідкувати за вами. Після цього ви зможете виконати транзакцію Stonewall x2.

**Слідкування за PayNym вашого співробітника з Sparrow Wallet:**

Якщо ви користуєтеся Sparrow Wallet, відкрийте свій гаманець і перейдіть до меню 'Show PayNym'. Якщо ви використовуєте свій PayNym вперше, вам потрібно буде отримати ідентифікатор, натиснувши на 'Retrieve PayNym'.
![запитайте paynym sparrow](assets/notext/14.webp)
Потім введіть ідентифікатор PayNym вашого співробітника (або їхній псевдонім '+...' або їхній платіжний код 'PM...') у поле 'Find Contact' і натисніть кнопку 'Add Contact'.
![додайте контакт paynym](assets/notext/15.webp)
Після цього програмне забезпечення запропонує вам кнопку 'Link Contact'. Натискати на цю кнопку для нашого навчального посібника не потрібно. Цей крок необхідний лише у випадку, якщо ви плануєте здійснювати платежі вказаному PayNym у рамках BIP47, що не стосується нашого навчального посібника.

Як тільки ваш PayNym почне слідкувати за PayNym вашого співробітника, повторіть цей процес у зворотному напрямку, щоб ваш співробітник також міг слідкувати за вами. Після цього ви зможете виконати транзакцію Stonewall x2.
## Як здійснити транзакцію Stonewall x2 на Samourai Wallet?

Якщо ви завершили попередні кроки з'єднання Paynyms, ви нарешті готові здійснити транзакцію Stonewall x2! Для цього слідуйте нашому відео навчальному посібнику на Samourai Wallet:
![Stonewall x2 Tutorial - Samourai Wallet](https://youtu.be/89oYE1Hw3Fk?si=QTqUZ6IypiR6PPMr)

## Як здійснити транзакцію Stonewall x2 на Sparrow Wallet?

Якщо ви завершили попередні кроки з'єднання Paynyms, ви нарешті готові здійснити транзакцію Stonewall x2! Для цього слідуйте нашому відео навчальному посібнику на Sparrow Wallet:
![Stonewall x2 Tutorial - Sparrow Wallet](https://youtu.be/mO3Xpp34Hhk?si=bfYiTl0Gxjs9sNQq)

**Зовнішні ресурси:**
- https://sparrowwallet.com/docs/spending-privately.html;
- https://docs.samourai.io/en/spend-tools#stonewallx2.