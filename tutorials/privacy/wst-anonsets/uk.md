---
name: Whirlpool Stats Tools - Anonsets
description: Розуміння концепції anonset та як її розрахувати за допомогою WST
---
![cover](assets/cover.webp)

***УВАГА:** Після арешту засновників Samourai Wallet та конфіскації їх серверів 24 квітня, інструмент Whirlpool Stats Tool більше не доступний для завантаження, оскільки він був розміщений на Gitlab Samourai. Навіть якщо ви раніше завантажили цей інструмент локально на свій комп'ютер, або він був встановлений на вашому вузлі RoninDojo, WST наразі не функціонує. Він залежав від даних, наданих OXT.me для своєї роботи, і цей сайт більше не доступний. Наразі WST не є особливо корисним, оскільки протокол Whirlpool неактивний. Однак, існує можливість, що ці програми можуть бути відновлені в найближчі тижні. Більше того, теоретична частина цієї статті залишається актуальною для розуміння принципів і цілей coinjoins загалом (не тільки Whirlpool), а також для розуміння ефективності моделі Whirlpool. Ви також можете дізнатися, як кількісно оцінити приватність, яку надають цикли coinjoin.*

_Ми уважно слідкуємо за розвитком цієї справи, а також за розвитком пов'язаних інструментів. Будьте впевнені, що ми оновимо цей навчальний посібник, як тільки з'явиться нова інформація._

_Цей навчальний посібник надається лише для освітніх та інформаційних цілей. Ми не підтримуємо або заохочуємо використання цих інструментів для злочинних цілей. Кожен користувач несе відповідальність за дотримання законів у своїй юрисдикції._

---

*"Розірвіть ланцюг, який залишають за собою ваші монети"*

У цьому навчальному посібнику ми вивчимо концепцію anonsets, індикатори, які дозволяють нам оцінити якість процесу coinjoin на Whirlpool. Ми розглянемо метод розрахунку та інтерпретації цих індикаторів. Після теоретичної частини ми перейдемо до практики, навчившись розраховувати anonsets конкретної транзакції за допомогою Python інструменту *Whirlpool Stats Tools* (WST).

## Що таке coinjoin на Bitcoin?
**Coinjoin - це техніка, яка розриває слідування біткойнів на блокчейні**. Вона ґрунтується на спільній транзакції зі специфічною структурою однойменної: транзакції coinjoin.

Транзакції coinjoin підвищують приватність користувачів Bitcoin, ускладнюючи аналіз ланцюга для зовнішніх спостерігачів. Їх структура дозволяє об'єднувати кілька монет від різних користувачів у одну транзакцію, тим самим затемнюючи сліди та ускладнюючи визначення зв'язків між вхідними та вихідними адресами.

Принцип coinjoin базується на співпраці: кілька користувачів, які бажають змішати свої біткойни, вносять однакові суми як входи однієї та тієї ж транзакції. Ці суми потім перерозподіляються у виходах еквівалентної вартості. В кінці транзакції стає неможливим асоціювати конкретний вихід з певним користувачем. Між входами та виходами не існує прямого зв'язку, тим самим розриваючи асоціацію між користувачами та їх UTXO, а також історію кожної монети.

![coinjoin](assets/notext/1.webp)

Приклад транзакції coinjoin:
[323df21f0b0756f98336437aa3d2fb87e02b59f1946b714a7b09df04d429dec2](https://mempool.space/tx/323df21f0b0756f98336437aa3d2fb87e02b59f1946b714a7b09df04d429dec2)
Для проведення coinjoin, забезпечуючи при цьому контроль кожного користувача над своїми коштами в усі часи, процес починається зі створення транзакції координатором, який потім передає її кожному учаснику. Кожен користувач підписує транзакцію після перевірки того, що вона їм підходить. Усі зібрані підписи нарешті інтегруються в транзакцію. Якщо користувач або координатор спробують перенаправити кошти, змінивши виходи транзакції coinjoin, підписи виявляться недійсними, що призведе до відхилення транзакції вузлами.
Існує кілька реалізацій coinjoin, таких як Whirlpool, JoinMarket або Wabisabi, кожна з яких прагне управляти координацією між учасниками та збільшити ефективність транзакцій coinjoin.
У цьому навчальному посібнику ми зосередимося на моїй улюбленій реалізації: Whirlpool, яка доступна в Samourai Wallet та Sparrow Wallet. На мою думку, це найефективніша реалізація для coinjoins на Bitcoin.
## Яка користь від coinjoin на Bitcoin?
Користь від coinjoin полягає в його здатності створювати правдоподібне заперечення, затоплюючи вашу монету серед групи невідрізнених монет. Метою цієї дії є розрив зв'язків слідкування, як від минулого до теперішнього, так і від теперішнього до минулого.

Іншими словами, аналітик, який знає вашу початкову транзакцію на вході в цикли coinjoin, не повинен змогти з упевненістю ідентифікувати ваш UTXO на виході з циклів реміксу (аналіз від входу в цикл до виходу з циклу).

![coinjoin](assets/en/2.webp)

Навпаки, аналітик, який знає ваш UTXO на виході з циклів coinjoin, не повинен мати можливості визначити початкову транзакцію на вході в цикли (аналіз від виходу з циклу до входу в цикл).

![coinjoin](assets/en/3.webp)

Для оцінки складності для аналітика зв'язати минуле з теперішнім і навпаки, необхідно кількісно визначити розмір груп, в яких ваша монета прихована. Цей показник говорить нам про кількість аналізів з однаковою ймовірністю. Таким чином, якщо правильний аналіз затоплений серед 3 інших аналізів з однаковою ймовірністю, ваш рівень приховування дуже низький. З іншого боку, якщо правильний аналіз знаходиться серед набору з 20 000 аналізів, всі однаково ймовірні, ваша монета дуже добре прихована.

І саме розмір цих груп представляє показники, які називаються "anonsets".

## Розуміння anonsets
Anonsets служать показниками для оцінки ступеня конфіденційності конкретного UTXO. Більш конкретно, вони вимірюють кількість невідрізнених UTXO в наборі, який включає вивчену монету. Вимога до однорідного набору UTXO означає, що anonsets зазвичай розраховуються за циклами coinjoin. Використання цих показників особливо актуально для coinjoins Whirlpool через їх однорідність.

Anonsets дозволяють, за потреби, оцінити якість coinjoins. Великий розмір anonset означає підвищений рівень анонімності, оскільки стає важко відрізнити конкретний UTXO в наборі.

Існують два типи anonsets:
- **Перспективний набір анонімності;**
- **Ретроспективний набір анонімності.**
Перший показник показує розмір групи, серед якої прихований вивчений UTXO на кінці циклу, знаючи UTXO на вході, тобто кількість невідрізнених монет, присутніх у цій групі. Цей показник дозволяє виміряти стійкість конфіденційності монети проти аналізу від минулого до теперішнього (від входу до виходу). На англійській мові назва цього показника - "*forward anonset*", або "*forward-looking metrics*".
![coinjoin](assets/en/4.webp)
Цей показник оцінює ступінь захисту вашого UTXO від спроб реконструкції його історії від точки входу до точки виходу в процесі coinjoin.

Наприклад, якщо ваша транзакція взяла участь у своєму першому циклі coinjoin і було завершено два інші нащадкові цикли, потенційний anonset вашої монети буде `13`:

![coinjoin](assets/en/5.webp)

Другий індикатор показує кількість можливих джерел для даної монети, знаючи UTXO в кінці циклу. Цей індикатор вимірює стійкість конфіденційності монети проти аналізу з сьогодення в минуле (від виходу до входу), тобто наскільки важко аналітику прослідкувати до походження вашої монети, до циклів coinjoin. Англійською назва цього індикатора - "*backward anonset*", або "*backward-looking metrics*".

![coinjoin](assets/en/6.webp)

Знаючи ваше UTXO на виході циклів, ретроспективний anonset визначає кількість потенційних транзакцій Tx0, які могли бути вашим входом у цикли coinjoin. На діаграмі нижче це відповідає сумі всіх помаранчевих бульбашок.

![coinjoin](assets/en/7.webp)

## Розрахунок anonsets за допомогою Whirlpool Stats Tools (WST)
Щоб розрахувати ці індикатори для ваших власних монет, які пройшли через цикли coinjoin, ви можете використовувати інструмент, спеціально розроблений Samourai Wallet: *Whirlpool Stats Tools*.

Якщо у вас є RoninDojo, WST вже встановлено на вашому вузлі. Тому ви можете пропустити кроки інсталяції і відразу перейти до кроків використання. Для тих, хто не має вузла RoninDojo, давайте подивимося, як просуватися з інсталяцією цього інструменту на комп'ютері.

Вам буде потрібно: Tor Browser (або Tor), Python 3.4.4 або вище, git і pip. Відкрийте термінал. Щоб перевірити наявність і версію цих програм на вашій системі, введіть наступні команди:
```plaintext
python --version
git --version
pip --version
```

Якщо потрібно, ви можете завантажити їх з їхніх відповідних вебсайтів:
- https://www.python.org/downloads/ (pip йде разом з Python починаючи з версії 3.4);
- https://www.torproject.org/download/;
- https://git-scm.com/downloads.
Після того, як всі ці програми будуть встановлені, з терміналу клонуйте репозиторій WST:
```plaintext
git clone https://code.samourai.io/whirlpool/whirlpool_stats.git
```

![WST](assets/notext/8.webp)

Перейдіть до директорії WST:
```plaintext
cd whirlpool_stats
```

Встановіть залежності:
```plaintext
pip3 install -r ./requirements.txt
```

![WST](assets/notext/9.webp)

Ви також можете встановити їх вручну (необов'язково):
```plaintext
pip install PySocks
pip install requests[socks]
pip install plotly
pip install datasketch
pip install numpy
pip install python-bitcoinrpc
```

Перейдіть до піддиректорії `/whirlpool_stats`:
```plaintext
cd whirlpool_stats
```

Запустіть WST:
```plaintext
python3 wst.py
```

![WST](assets/notext/10.webp)

Запустіть Tor або Tor Browser на задньому плані.

**-> Для користувачів RoninDojo, ви можете продовжити навчання прямо тут.**

Встановіть проксі на Tor (RoninDojo),
```plaintext
socks5 127.0.0.1:9050
```
або до Tor Browser, залежно від того, що ви використовуєте:```plaintext
socks5 127.0.0.1:9150
```

Ця маніпуляція дозволить вам завантажувати дані на OXT через Tor, щоб не розкривати інформацію про ваші транзакції. Якщо ви новачок і цей крок здається складним, знайте, що він просто передбачає направлення вашого інтернет-трафіку через Tor. Найпростіший метод полягає в запуску Tor Browser у фоновому режимі на вашому комп'ютері, а потім виконанні лише другої команди для підключення через цей браузер (`socks5 127.0.0.1:9150`).

![WST](assets/notext/11.webp)

Далі перейдіть до робочого каталогу, з якого ви маєте намір завантажити дані WST, використовуючи команду `workdir`. Ця папка слугуватиме для зберігання транзакційних даних, які ви отримаєте з OXT у форматі файлів `.csv`. Ця інформація є важливою для розрахунку індикаторів, які ви прагнете отримати. Ви вільні обрати місцезнаходження цього каталогу. Може бути розумно створити папку спеціально для даних WST. Як приклад, давайте оберемо папку завантажень. Якщо ви використовуєте RoninDojo, цей крок не потрібен:
```plaintext
workdir path/to/your/directory
```

Після цього командний рядок має змінитися, щоб вказати ваш робочий каталог.

![WST](assets/notext/12.webp)

Потім завантажте дані з пулу, що містить вашу транзакцію. Наприклад, якщо я в пулі `100,000 sats`, команда буде:
```plaintext
download 0001
```

![WST](assets/notext/13.webp)

Коди номіналів на WST наступні:
- Пул 0.5 біткойнів: `05`
- Пул 0.05 біткойнів: `005`
- Пул 0.01 біткойнів: `001`
- Пул 0.001 біткойнів: `0001`
Після завантаження даних, завантажте їх. Наприклад, якщо я в пулі `100,000 sats`, команда буде:
```plaintext
load 0001
```

Цей крок займе кілька хвилин залежно від вашого комп'ютера. Зараз гарний час, щоб зробити собі каву! :)

![WST](assets/notext/14.webp)

Після завантаження даних введіть команду `score` разом з вашим TXID (ідентифікатором транзакції), щоб отримати його anonsets:
```plaintext
score TXID
```

**Увага**, вибір TXID для використання залежить від anonset, який ви хочете розрахувати. Для оцінки перспективного anonset монети необхідно ввести через команду `score` TXID, що відповідає її першому coinjoin, який є початковим змішуванням з цим UTXO. З іншого боку, для визначення ретроспективного anonset, ви повинні ввести TXID останнього виконаного coinjoin. Таким чином, перспективний anonset розраховується з TXID першого змішування, тоді як ретроспективний anonset розраховується з TXID останнього змішування.

WST потім показує ретроспективний рахунок (*Backward-looking metrics*) та перспективний рахунок (*Forward-looking metrics*). Наприклад, я взяв TXID випадкової монети на Whirlpool, яка не належить мені.

![WST](assets/notext/15.webp)
Транзакція, що розглядається: [7fe6081fa4f4382be629fb2ef59029d058a22b6fd59cb31d1511fe9e0e7f32be](https://mempool.space/tx/7fe6081fa4f4382be629fb2ef59029d058a22b6fd59cb31d1511fe9e0e7f32be)
Якщо ми розглянемо цю транзакцію як перший coinjoin для зазначеної монети, то вона отримує потенційний anonset розміром `86,871`. Це означає, що вона прихована серед `86,871` невідрізнених монет. Для зовнішнього спостерігача, який знає цю монету на початку циклів coinjoin і намагається відстежити її вихід, він зіткнеться з `86,871` можливими UTXO, кожен з яких має однакову ймовірність бути шуканою монетою.

Якщо ми розглянемо цю транзакцію як останній coinjoin монети, то вона має ретроспективний anonset розміром `42,185`. Це означає, що існує `42,185` потенційних джерел для цього UTXO. Якщо зовнішній спостерігач ідентифікує цю монету в кінці циклів і намагається відстежити її походження, він зіткнеться з `42,185` можливими джерелами, кожне з яких має однакову ймовірність бути шуканим походженням.
Крім розмірів anonset, WST також надає вам інформацію про рівень дифузії вашого виходу в пулі на основі anonset. Цей інший індикатор просто дозволяє вам оцінити потенціал для покращення вашої частки. Цей рівень особливо корисний для потенційного anonset. Дійсно, якщо ваша частка має рівень дифузії 15%, це означає, що вона може бути сплутана з 15% часток у пулі. Це добре, але у вас все ще є дуже великий простір для покращення шляхом продовження реміксу. З іншого боку, якщо ваша частка має рівень дифузії 95%, то ви наближаєтесь до меж пулу. Ви можете продовжувати ремікс, але ваш anonset не збільшиться значно.

Важливо зазначити, що розрахунки anonset, які проводить WST, не є абсолютно точними. Враховуючи величезний обсяг даних, які потрібно обробити, WST використовує алгоритм *HyperLogLogPlusPlus* для значного зниження навантаження, пов'язаного з локальною обробкою даних та необхідною пам'яттю. Це алгоритм, який дозволяє оцінити кількість унікальних значень у дуже великих наборах даних, зберігаючи високу точність результату. Тому надані оцінки достатньо хороші для використання у ваших аналізах, оскільки вони є дуже близькими до реальності оцінками, але їх не слід інтерпретувати як точні значення до одиниці.

На завершення, майте на увазі, що не обов'язково систематично розраховувати anonset для кожної вашої частки в coinjoins. Сама конструкція Whirlpool вже надає гарантії. Дійсно, ретроспективний anonset рідко є проблемою. З вашого початкового міксу ви отримуєте особливо високий ретроспективний рахунок завдяки спадщині попередніх міксів з часу Genesis coinjoin. Що стосується потенційного anonset, достатньо тримати вашу частку в рахунку після міксу протягом достатньо тривалого періоду.
Ось чому я вважаю використання Whirlpool особливо актуальним у стратегії *Hodl -> Mix -> Spend -> Replace*. На мою думку, найлогічніший підхід полягає в тому, щоб тримати основну частину заощаджень у біткоїнах у холодному гаманці, одночасно постійно підтримуючи певну кількість монет у coinjoins на Samourai для покриття щоденних витрат. Як тільки біткоїни з coinjoins витрачаються, вони замінюються новими, щоб повернутися до визначеного порогу змішаних частин. Цей метод дозволяє звільнитися від турботи про наші UTXO anonsets, одночасно роблячи час, необхідний для ефективності coinjoins, значно менш обмежувальним.
**Зовнішні ресурси:**

- [Подкаст французькою про аналіз ланцюгів](https://fountain.fm/episode/6nNoQEUHBCQR8hAXAkEx)
- [Стаття у Вікіпедії про HyperLogLog](https://en.wikipedia.org/wiki/HyperLogLog)
- Репозиторій Samourai для статистики Whirlpool
- Вебсайт Whirlpool від Samourai
- [Стаття на Medium англійською про приватність та Біткоїн від Samourai](https://medium.com/oxt-research/understanding-bitcoin-privacy-with-oxt-part-1-4-8177a40a5923)
- [Стаття на Medium англійською про концепцію набору анонімності від Samourai](https://medium.com/samourai-wallet/diving-head-first-into-whirlpool-anonymity-sets-4156a54b0bc7)